
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 46. Add-ons - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-46-add-ons" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 46. Add-ons
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 46. Add-ons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="46-Addons.html" class="md-nav__link md-nav__link--active">
        Chapter 46. Add-ons
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-what-is-an-add-on" class="md-nav__link">
    1.  What is an Add-on?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-the-ezhighlight-add-on" class="md-nav__link">
    2.  Creating the EzHighlight Add-on
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-a-partial-add-on-implementation" class="md-nav__link">
    3.  Creating a Partial Add-on Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-the-freemarker-generated-ezhighlightaddonimpl" class="md-nav__link">
    4.  The FreeMarker-generated EzHighlightAddonImpl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-the-dialog" class="md-nav__link">
    5.  Creating the Dialog
  </a>
  
    <nav class="md-nav" aria-label="5.  Creating the Dialog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-the-ezhighlight-dialog" class="md-nav__link">
    5.1.  The EzHighlight Dialog
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-listening-to-the-dialog" class="md-nav__link">
    5.2.  Listening to the Dialog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-completing-the-implementation-of-ezhighlightaddoninpl" class="md-nav__link">
    6.  Completing the Implementation of EzHighlightAddonInpl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configuring-the-add-on" class="md-nav__link">
    7.  Configuring the Add-on
  </a>
  
    <nav class="md-nav" aria-label="7.  Configuring the Add-on">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-protocolhandlerxcu" class="md-nav__link">
    7.1.  ProtocolHandler.xcu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-addonxcs" class="md-nav__link">
    7.2.  Addon.xcs
  </a>
  
    <nav class="md-nav" aria-label="7.2.  Addon.xcs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addonmenu-attribute" class="md-nav__link">
    "AddonMenu" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#officetoolbar-attribute" class="md-nav__link">
    "OfficeToolbar" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#officehelp-attribute" class="md-nav__link">
    "OfficeHelp" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#images-attribute" class="md-nav__link">
    "Images" Attribute
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-building-and-installing-the-oxt-file" class="md-nav__link">
    8.  Building and Installing the OXT File
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-what-is-an-add-on" class="md-nav__link">
    1.  What is an Add-on?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-the-ezhighlight-add-on" class="md-nav__link">
    2.  Creating the EzHighlight Add-on
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-a-partial-add-on-implementation" class="md-nav__link">
    3.  Creating a Partial Add-on Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-the-freemarker-generated-ezhighlightaddonimpl" class="md-nav__link">
    4.  The FreeMarker-generated EzHighlightAddonImpl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-the-dialog" class="md-nav__link">
    5.  Creating the Dialog
  </a>
  
    <nav class="md-nav" aria-label="5.  Creating the Dialog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-the-ezhighlight-dialog" class="md-nav__link">
    5.1.  The EzHighlight Dialog
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-listening-to-the-dialog" class="md-nav__link">
    5.2.  Listening to the Dialog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-completing-the-implementation-of-ezhighlightaddoninpl" class="md-nav__link">
    6.  Completing the Implementation of EzHighlightAddonInpl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configuring-the-add-on" class="md-nav__link">
    7.  Configuring the Add-on
  </a>
  
    <nav class="md-nav" aria-label="7.  Configuring the Add-on">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-protocolhandlerxcu" class="md-nav__link">
    7.1.  ProtocolHandler.xcu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-addonxcs" class="md-nav__link">
    7.2.  Addon.xcs
  </a>
  
    <nav class="md-nav" aria-label="7.2.  Addon.xcs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addonmenu-attribute" class="md-nav__link">
    "AddonMenu" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#officetoolbar-attribute" class="md-nav__link">
    "OfficeToolbar" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#officehelp-attribute" class="md-nav__link">
    "OfficeHelp" Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#images-attribute" class="md-nav__link">
    "Images" Attribute
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-building-and-installing-the-oxt-file" class="md-nav__link">
    8.  Building and Installing the OXT File
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/46-Addons.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-46-add-ons">Chapter 46. Add-ons<a class="headerlink" href="#chapter-46-add-ons" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>What is an Add-
on?; Creating the
EzHighlight Add-on;
Creating a Partial Add-
on Implementation; The
FreeMarker-generated
EzHighlightAddonImpl;
Creating the Dialog;
Configuring the Add-on;
Building and Installing
the OXT File</p>
<p>Example folders:
"AddOn Tests", "Utils"</p>
</div>
<p>Add-ons build upon the UNO component techniques
described in the last chapter to make a component
accessible via an Office menu and/or toolbar item.</p>
<p>I'll implement the EzHighlight add-on, which allows word
occurrences to be highlighted in a Writer document.
EzHighlight is installed in Office as an extension in the
same way as an UNO component, and is listed by the
Extension Manger in Figure 1.</p>
<p><img alt="" src="images/46-Addons-1.png" /></p>
<p>Figure 1. The EzHighlight Add-on Extension.</p>
<p>When the Writer application is running, EzHighlight is accessible either through
Office's Tools, Add-Ons menu item (see Figure 2) or as a toolbar created by View,
Toolbars, Add-on 2 (see Figure 3). This 'floating' toolbar can be attached to an
existing toolbar.</p>
<p><img alt="" src="images/46-Addons-2.png" /></p>
<p>Figure 2. The EzHighlight Add-on on the Tools Menu.</p>
<p><img alt="" src="images/46-Addons-3.png" /></p>
<p>Figure 3. The EzHighlighter Add-on as a Toolbar.</p>
<p>When the user clicks on "EzHighlight Text", either through the menu or toolbar, the
dialog shown in Figure 4 appears.</p>
<p><img alt="" src="images/46-Addons-4.png" /></p>
<p>Figure 4. The EzHighlighter Dialog.</p>
<p>The user enters a word, and either types <ENTER> or presses the "Highlight" button.
Every matching word in the currently loaded Writer document is redrawn in red, and
the number of changes reported in the "Count:" field.</p>
<p>EzHighlight also has basic help support, accessible from Office's Help menu as the
"About EzHighlight" item (see Figure 5).</p>
<p><img alt="" src="images/46-Addons-5.png" /></p>
<p>Figure 5. The EzHighlight Help Menu Item.</p>
<p>Clicking on the help item causes a simple message box to appear, as in Figure 6.</p>
<p><img alt="" src="images/46-Addons-6.png" /></p>
<p>Figure 6. The EzHighlight Help Message Box.</p>
<h2 id="1-what-is-an-add-on">1.  What is an Add-on?<a class="headerlink" href="#1-what-is-an-add-on" title="Permanent link">&para;</a></h2>
<p>Office supports two kinds of add-on: job add-ons and ProtocolHandler add-ons.</p>
<p>A job add-on is a component triggered by events inside Office, such as when the
application is first opened or about to terminate, or when a document is loaded,
printed, or closed.</p>
<p>This chapter is about Protocol handler add-ons, which link menu and/or toolbar items
to a component using Office's dispatch framework. Every GUI element is assigned a
'command URL', a unique name made of two or three parts:</p>
<div class="highlight"><pre><span></span><code>&lt;protocol string&gt;:&lt;command string&gt;[?&lt;command string argument&gt;+ ]
</code></pre></div>
<p>A protocol string can be almost anything, and I'll be using the extension's ID
("org.openoffice.ezhighlightAddon").</p>
<p>There is a different command string for each GUI-triggered action, and I'll utilize two:
"EzHighlight" and "help". "EzHighlight" is associated with the EzHighlight menu and
toolbar items (Figures 2 and 3), and makes the dialog in Figure 4 appear. "help" is
assigned to the "About EzHighlight" help menu item, and causes the message box in
Figure 6 to be displayed.</p>
<p>I won't be using command string arguments.</p>
<p>When a user chooses an item in the user interface, its command URL is passed along
a list of dispatch handlers until one accepts the command and processes it by creating
a dispatch object. Fortunately, most of the dispatch handling behavior in an add-on
can be generated automatically.</p>
<p>The main source of information for job and ProtocolHandler add-ons is chapter 3 of
the Developer's Guide (available at
<a href="https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf">https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf</a>), or
online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/WritingUNO/Integrating">https://wiki.openoffice.org/wiki/Documentation/DevGuide/WritingUNO/Integrating</a>_
Components_into_OpenOffice.org and
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/WritingUNO/AddOns/Ad">https://wiki.openoffice.org/wiki/Documentation/DevGuide/WritingUNO/AddOns/Ad</a>
d-Ons (or use <code>loGuide "Integrating Components"</code> and <code>loGuide add-ons</code>).</p>
<p>The Developer's Guide add-on example can be found at
<a href="http://api.libreoffice.org/examples/DevelopersGuide/examples.html#Components">http://api.libreoffice.org/examples/DevelopersGuide/examples.html#Components</a></p>
<h2 id="2-creating-the-ezhighlight-add-on">2.  Creating the EzHighlight Add-on<a class="headerlink" href="#2-creating-the-ezhighlight-add-on" title="Permanent link">&para;</a></h2>
<p>There's an overlap between the steps required to create an UNO component and an
add-on. The main similarity is the need for an OXT file containing a JAR and a
description.xml. However, there's no need for an IDL file or type database (a RDB
file), but there are extra details concerning the GUI and dispatch handling.</p>
<p>The main steps in creating an add-on are illustrated by Figure 7.</p>
<p><img alt="" src="images/46-Addons-7.png" /></p>
<p>Figure 7. Toolchain for Creating an Add-on.</p>
<p>The UNO component toolchain in the previous chapter used my skelComp.bat script
to generate a partial Java implementation. The script utilizes Office's uno-
skeletonmaker which can also be employed to generate add-ons and Calc addins.
Unfortunately, I was unable to get its add-on features to work.</p>
<p>This was not a great loss since I'd already been thinking about replacing uno-
skeletonmaker with FreeMarker, a powerful template processing library
(<a href="http://freemarker.org/">http://freemarker.org/</a>). FreeMarker can easily duplicate all the features of  uno-
skeletonmaker, creating a Java class with the boilerplate code for creating a service
and handling command URLs. Also, by switching to FreeMarker, I was able to add
more automatic code generation, including code for a user input dialog and a
debugging window.</p>
<p>The OXT file requires three configuration files: a description of  the dialog in Figure
4, Addon.xcs which defines the add-on's GUI (e.g. the menu and toolbar items in
Figures 2 and 3), and ProtocolHandler.xcu which says which command URLs are
processed by the add-on's dispatch handler.</p>
<p>The toolchain in Figure 7 will be explained in more detail in the rest of this chapter.</p>
<h2 id="3-creating-a-partial-add-on-implementation">3.  Creating a Partial Add-on Implementation<a class="headerlink" href="#3-creating-a-partial-add-on-implementation" title="Permanent link">&para;</a></h2>
<p>Figure 8 shows the main elements needed to use the FreeMarker template library: a
FTL template file, and a program that instantiates the template by employing a
collection of FreeMarker variables and their bindings.</p>
<p><img alt="" src="images/46-Addons-8.png" /></p>
<p>Figure 8. Using FreeMarker.</p>
<p>The simplest FreeMarker program replaces all the FreeMarker variables in the
template by their associated bindings, generating a new text file (a Java program in
this case). However, FreeMarker contains additional programming features, including
for-loops and if-statements, which can generate more complex blocks of text.</p>
<p>The add-on template is stored in addonImpl.ftl, and is processed by
CreateAddonImpl.java. It reads in the add-on's name, and initializes a HashMap of
three FreeMarker variables called "className", "extensionID, and "cmdNames".</p>
<p>For example, CreateAddonImpl can be called like so:</p>
<div class="highlight"><pre><span></span><code>&gt; run CreateAddonImpl EzHighlight
</code></pre></div>
<p>The three variables are assigned:</p>
<ul>
<li>"className"   : "EzHighlightAddonImpl"</li>
<li>"extensionID  :  "org.openoffice.ezhighlightAddon"</li>
<li>"cmdNames"    : [ "EzHighlight", "help" ]</li>
</ul>
<p>"className" is assigned the name of the generated Java class. "extensionID" contains
the protocol string used by the command URLs. "cmdNames" holds a list of
command URL names: "EzHighlight" is linked to the add-on's menu and toolbar
items, and "help" is attached to the add-on's help menu item.</p>
<p>CreateAddonImpl outputs a class called EzHighlightAddonImpl, a fully functional
add-on, which displays a dialog like the one in Figure 4 and the help message in
Figure 6. However, after the user has typed <ENTER> in the dialog or pressed the
"Ok" button, no processing is carried out on the Office document.</p>
<p>First I'll give an overview of the features in the generated EzHighlightAddonImpl
class, then explain the additional highlighting code in a later section.</p>
<h2 id="4-the-freemarker-generated-ezhighlightaddonimpl">4.  The FreeMarker-generated EzHighlightAddonImpl<a class="headerlink" href="#4-the-freemarker-generated-ezhighlightaddonimpl" title="Permanent link">&para;</a></h2>
<p>The template in addonImpl.ftl represents a single Java class, which extends
WeakBase and implements seven interfaces:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="p">{</span><span class="n">className</span><span class="p">}</span> <span class="kd">extends</span> <span class="n">WeakBase</span> <span class="kd">implements</span>
         <span class="n">XInitialization</span><span class="p">,</span> <span class="n">XServiceInfo</span><span class="p">,</span>
         <span class="n">XDispatchProvider</span><span class="p">,</span> <span class="n">XDispatch</span><span class="p">,</span>   <span class="c1">// for the add-on</span>
         <span class="n">XActionListener</span><span class="p">,</span> <span class="n">XTopWindowListener</span><span class="p">,</span>
         <span class="n">XKeyListener</span>                    <span class="c1">// for the dialog</span>
<span class="p">{</span>
 <span class="c1">//  ... add-on code</span>
<span class="p">}</span>
</code></pre></div>
<p>WeakBase is the base class used by all components (which includes add-ons and Calc
Addins). XServiceInfo and XInitialization handle the creation and initialization of the
service at run time.</p>
<p>The XDispatchProvider method, queryDispatch(), implements the dispatch handler
for the add-on – it accepts the command URLs associated with the add-on:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in EzHighlightAddonInpl.java</span>
<span class="kd">public</span> <span class="n">XDispatch</span> <span class="nf">queryDispatch</span><span class="p">(</span><span class="n">URL</span> <span class="n">commandURL</span><span class="p">,</span>
                      <span class="n">String</span> <span class="n">targetFrameName</span><span class="p">,</span> <span class="kt">int</span> <span class="n">searchFlags</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Protocol</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span>
                 <span class="s">&quot;org.openoffice.ezhighlightAddon:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Path</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="s">&quot;EzHighlight&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;queryDispatch() for \&quot;EzHighlight\&quot;&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Path</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;queryDispatch() for \&quot;help\&quot;&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of queryDispatch()</span>
</code></pre></div>
<p>The handler signals its acceptance of a command URL by returning a dispatch object
which Office uses to process the command. EzHighlightAddonImpl also implements
the XDispatch interface, so returns a reference to itself. This means that Office calls
EzHighlightAddonImpl.dispatch(), passing it the command URL and other properties:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in EzHighlightAddonInpl.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">URL</span> <span class="n">commandURL</span><span class="p">,</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Protocol</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span>
               <span class="s">&quot;org.openoffice.ezhighlightAddon:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Path</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="s">&quot;EzHighlight&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">processCmd</span><span class="p">(</span><span class="s">&quot;EzHighlight&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">commandURL</span><span class="p">.</span><span class="na">Path</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">processCmd</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of dispatch()</span>
</code></pre></div>
<p>The template-generated code inside dispatch() distinguishes between the possible
command names ("EzHighlight" and "help") by calling processCmd() with different
arguments.</p>
<p>If processCmd()'s input argument is "help", then GUI.showMessageBox() is called to
display the window shown in Figure 6, while "EzHighlight" triggers the dialog in
Figure 4. The processCmd() code is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in EzHighlightAddonInpl.java...</span>

<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">Console</span> <span class="n">console</span><span class="p">;</span>    <span class="c1">// for debugging output</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">printCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">processCmd</span><span class="p">(</span><span class="n">String</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">addonInitialize</span><span class="p">(</span><span class="n">xcc</span><span class="p">);</span>
                   <span class="c1">// so my utils can be used safely</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Window title: &quot;</span> <span class="o">+</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getTitleBar</span><span class="p">());</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">printCount</span><span class="o">++</span> <span class="o">+</span>
                 <span class="s">&quot;. dispatch() called for \&quot;&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">GUI</span><span class="p">.</span><span class="na">showMessageBox</span><span class="p">(</span><span class="s">&quot;Add-on Help&quot;</span><span class="p">,</span>
          <span class="s">&quot;Type in the text, then press return or</span>
<span class="s">           click the Ok button.&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// &quot;EzHighlight&quot; is processed by the following code...</span>

  <span class="n">console</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

  <span class="n">dialog</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">loadAddonDialog</span><span class="p">(</span>
                    <span class="s">&quot;org.openoffice.ezhighlightAddon&quot;</span><span class="p">,</span>
                    <span class="s">&quot;dialogLibrary/&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;.xdl&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dialog</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not load &quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot; dialog&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XControl</span> <span class="n">dialogControl</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">getDialogControl</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
  <span class="n">initDialog</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">);</span>
  <span class="n">Dialogs</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">);</span>

  <span class="n">console</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of processCmd()</span>
</code></pre></div>
<p>Lo.addonInitialize() initializes the globals used by my Lo utility library and other
support classes:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XComponentContext</span> <span class="n">xcc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XDesktop</span> <span class="n">xDesktop</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiComponentFactory</span> <span class="n">mcFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiServiceFactory</span> <span class="n">msFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XComponent</span> <span class="nf">addonInitialize</span><span class="p">(</span>
                             <span class="n">XComponentContext</span> <span class="n">addonXcc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">xcc</span> <span class="o">=</span> <span class="n">addonXcc</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xcc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>  <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access component context&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">mcFactory</span> <span class="o">=</span> <span class="n">xcc</span><span class="p">.</span><span class="na">getServiceManager</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mcFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Office Service Manager is unavailable&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="n">Object</span> <span class="n">oDesktop</span> <span class="o">=</span> <span class="n">mcFactory</span><span class="p">.</span><span class="na">createInstanceWithContext</span><span class="p">(</span>
                         <span class="s">&quot;com.sun.star.frame.Desktop&quot;</span><span class="p">,</span> <span class="n">xcc</span><span class="p">);</span>
    <span class="n">xDesktop</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDesktop</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">oDesktop</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access desktop&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">xDesktop</span><span class="p">.</span><span class="na">getCurrentComponent</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>  <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access document&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">msFactory</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMultiServiceFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">doc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addonInitialize()</span>
</code></pre></div>
<p>addonInitialize() returns an instance of XComponent, which refers to the document
currently loaded into Office. Later this will be used to highlight the document's text.</p>
<p>processCmd() calls Console.setVisible() before and after the processing of the
"EzHighlight" command. The first call makes a Console debugging window visible,
and the call at the end hides it. These lines should be commented out of the completed
add-on, so the window doesn't appear.</p>
<p>The dialog is handled by methods from my Dialogs support class, and by listeners set
up in initDialog().</p>
<h2 id="5-creating-the-dialog">5.  Creating the Dialog<a class="headerlink" href="#5-creating-the-dialog" title="Permanent link">&para;</a></h2>
<p>There are two approaches for dialog creation: the easy way uses Office's dialog editor,
and the hard way calls functions in my Dialogs support class to programmatically
create the dialog's components. I'll use the editor in this chapter, and employ Dialogs
methods in my macros in Chapter 48.</p>
<p>The Developer's Guide has some information on the dialog editor in chapter 11,
"OpenOffice.org Basic". The relevant sub-sections are online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Basic/Dialog_Editor">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Basic/Dialog_Editor</a> and
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Basic/Creating_Dialogs">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Basic/Creating_Dialogs</a>
(or use loGuide "Dialog Editor" and loGuide "Creating Dialogs").</p>
<p>The editor utilizes drag-and-drop to place GUI elements in a dialog drawing area,
with property windows for specializing each element. The editor is reached via
Office's menu item Tools &gt; Macros &gt; Organize Dialogs (see Figure 9).</p>
<p><img alt="" src="images/46-Addons-9.png" /></p>
<p>Figure 9. Creating a new Dialog.</p>
<p>Figure 10 shows the dialog editor window after the creation of a new dialog called
"Basic"; the GUI controls run along the bottom of the window.</p>
<p><img alt="" src="images/46-Addons-10.png" /></p>
<p>Figure 10. The Dialog Editor Window for a new Dialog.</p>
<p>The simplest useful dialog is probably the version of the "Basic" dialog in Figure 11,
consisting of a label, text field, and "Ok" button.</p>
<p><img alt="" src="images/46-Addons-11.png" /></p>
<p>Figure 11. The "Basic" Dialog.</p>
<p>A dialog can be exported as XML using the "Export Dialog" icon above the drawing
area (the icon includes a floppy disk which will leave young programmers mystified).</p>
<p>The resulting XDL file contains text something like:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE dlg:window
       PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot;
       &quot;dialog.dtd&quot;&gt;
&lt;dlg:window xmlns:dlg=&quot;http://openoffice.org/2000/dialog&quot;
            xmlns:script=&quot;http://openoffice.org/2000/script&quot;
         dlg:id=&quot;Basic&quot;
         dlg:left=&quot;52&quot; dlg:top=&quot;44&quot; dlg:width=&quot;173&quot; dlg:height=&quot;34&quot;
         dlg:closeable=&quot;true&quot; dlg:moveable=&quot;true&quot;
         dlg:title=&quot;Basic Dialog&quot;&gt;

  &lt;dlg:styles&gt;
    &lt;dlg:style dlg:style-id=&quot;0&quot;
               dlg:background-color=&quot;0xeeeeee&quot;
               dlg:font-height=&quot;10&quot;/&gt;
  &lt;/dlg:styles&gt;

  &lt;dlg:bulletinboard&gt;
    &lt;dlg:text dlg:style-id=&quot;0&quot; dlg:id=&quot;Label1&quot;
          dlg:tab-index=&quot;0&quot;
          dlg:left=&quot;6&quot; dlg:top=&quot;11&quot; dlg:width=&quot;38&quot; dlg:height=&quot;8&quot;
          dlg:value=&quot;Enter input:&quot;/&gt;

    &lt;dlg:textfield dlg:id=&quot;TextField1&quot;
          dlg:tab-index=&quot;1&quot;
          dlg:left=&quot;41&quot; dlg:top=&quot;7&quot; dlg:width=&quot;83&quot; dlg:height=&quot;14&quot;/&gt;

    &lt;dlg:button dlg:id=&quot;CommandButton1&quot;
          dlg:tab-index=&quot;2&quot;
          dlg:left=&quot;137&quot; dlg:top=&quot;9&quot; dlg:width=&quot;28&quot; dlg:height=&quot;12&quot;
          dlg:value=&quot;Ok&quot;/&gt;

  &lt;/dlg:bulletinboard&gt;
&lt;/dlg:window&gt;
</code></pre></div>
<p>The code in EzHighlightAddonInpl assumes that the dialog contains a text field called
"TextField1" and a button called "CommandButton1", which is true of the XDL
shown above. Of course, it's possible to add more GUI components, as in the next
section.</p>
<h3 id="51-the-ezhighlight-dialog">5.1.  The EzHighlight Dialog<a class="headerlink" href="#51-the-ezhighlight-dialog" title="Permanent link">&para;</a></h3>
<p>The dialog editor has an import icon to the left of the export icon, which can be used
to load an XDL file for modification.</p>
<p>I copied the "Basic" XDL file, renaming it to "EzHighlight.xdl", and imported it; a
few changes and additions later, it looked as shown in Figure 12.</p>
<p><img alt="" src="images/46-Addons-12.png" /></p>
<p>Figure 12. The EzHighlight.xdl Dialog.</p>
<p>The exported XML is:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE dlg:window
               PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot;
               &quot;dialog.dtd&quot;&gt;
&lt;dlg:window xmlns:dlg=&quot;http://openoffice.org/2000/dialog&quot;
            xmlns:script=&quot;http://openoffice.org/2000/script&quot;
      dlg:id=&quot;EzHighlight&quot;
      dlg:left=&quot;109&quot; dlg:top=&quot;73&quot; dlg:width=&quot;184&quot; dlg:height=&quot;44&quot;
      dlg:closeable=&quot;true&quot; dlg:moveable=&quot;true&quot;
      dlg:title=&quot;EzHighlight Text Selector&quot;&gt;

 &lt;dlg:styles&gt;
  &lt;dlg:style dlg:style-id=&quot;0&quot;
             dlg:background-color=&quot;0xeeeeee&quot;/&gt;
 &lt;/dlg:styles&gt;

 &lt;dlg:bulletinboard&gt;
  &lt;dlg:text dlg:style-id=&quot;0&quot; dlg:id=&quot;Label1&quot;
          dlg:tab-index=&quot;0&quot;
          dlg:left=&quot;8&quot; dlg:top=&quot;11&quot; dlg:width=&quot;26&quot; dlg:height=&quot;10&quot;
          dlg:value=&quot;Enter text:&quot;
          dlg:align=&quot;right&quot;/&gt;

  &lt;dlg:textfield dlg:id=&quot;TextField1&quot;
          dlg:tab-index=&quot;1&quot;
          dlg:left=&quot;39&quot; dlg:top=&quot;9&quot; dlg:width=&quot;83&quot; dlg:height=&quot;12&quot;/&gt;

  &lt;dlg:textfield dlg:id=&quot;TextField2&quot;
          dlg:tab-index=&quot;2&quot;
          dlg:left=&quot;39&quot; dlg:top=&quot;26&quot; dlg:width=&quot;46&quot; dlg:height=&quot;12&quot;
          dlg:readonly=&quot;true&quot;/&gt;

  &lt;dlg:text dlg:style-id=&quot;0&quot; dlg:id=&quot;Label2&quot;
          dlg:tab-index=&quot;3&quot;
          dlg:left=&quot;8&quot; dlg:top=&quot;27&quot; dlg:width=&quot;26&quot; dlg:height=&quot;10&quot;
          dlg:value=&quot;Count:&quot;
          dlg:align=&quot;right&quot;/&gt;

  &lt;dlg:button dlg:id=&quot;CommandButton1&quot;
          dlg:tab-index=&quot;4&quot;
          dlg:left=&quot;131&quot; dlg:top=&quot;9&quot; dlg:width=&quot;46&quot; dlg:height=&quot;12&quot;
          dlg:value=&quot;Highlight&quot;/&gt;

 &lt;/dlg:bulletinboard&gt;
&lt;/dlg:window&gt;
</code></pre></div>
<p>The dialog loading code in EzHighlightAddonInpl.java assumes that the dialog's
filename is the same as the command URL name, as can be seen in processCmd():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of processCmd() in EzHighlightAddonInpl.java...</span>

<span class="n">dialog</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">loadAddonDialog</span><span class="p">(</span><span class="s">&quot;org.openoffice.ezhighlightAddon&quot;</span><span class="p">,</span>
                            <span class="s">&quot;dialogLibrary/&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;.xdl&quot;</span><span class="p">);</span>
</code></pre></div>
<p>processCmd() also assumes that the XDL file is in a dialogLibrary/ sub-directory. I'll
explain how this is part of the add-on's OXT file in a later section.</p>
<p>Dialogs.loadAddonDialog() is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Dialogs class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDialog</span> <span class="nf">loadAddonDialog</span><span class="p">(</span><span class="n">String</span> <span class="n">extensionID</span><span class="p">,</span>
                                      <span class="n">String</span> <span class="n">dialogFnm</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XDialogProvider</span> <span class="n">dp</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XDialogProvider</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                         <span class="s">&quot;com.sun.star.awt.DialogProvider&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dp</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access the Dialog Provider&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">dp</span><span class="p">.</span><span class="na">createDialog</span><span class="p">(</span><span class="s">&quot;vnd.sun.star.extension://&quot;</span> <span class="o">+</span>
                                <span class="n">extensionID</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">dialogFnm</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not load the dialog: \&quot;&quot;</span> <span class="o">+</span>
                                   <span class="n">dialogFnm</span> <span class="o">+</span> <span class="s">&quot;\&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of loadAddonDialog()</span>
</code></pre></div>
<p>The crucial line is the call to XDialogProvider.createDialog(), which constructs the
dialog name:</p>
<div class="highlight"><pre><span></span><code><span class="n">vnd</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">extension</span><span class="p">:</span><span class="c1">//org.openoffice.ezhighlightAddon/</span>
                                       <span class="n">dialogLibrary</span><span class="o">/</span><span class="n">EzHighlight</span>
</code></pre></div>
<p>The dialog is loaded from the ezhighlightAddon extension.</p>
<h3 id="52-listening-to-the-dialog">5.2.  Listening to the Dialog<a class="headerlink" href="#52-listening-to-the-dialog" title="Permanent link">&para;</a></h3>
<p>Back in processCmd(), listeners are attached to the loaded dialog, and the dialog is
made visible on-screen:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in processCmd() in EzHighlightAddonInpl.java...</span>

<span class="n">XControl</span> <span class="n">dialogControl</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">getDialogControl</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
<span class="n">initDialog</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">);</span>
<span class="n">Dialogs</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">);</span>
</code></pre></div>
<p>Dialogs.getDialogControl() casts the XDialog into an XControl:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Dialogs class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XControl</span> <span class="nf">getDialogControl</span><span class="p">(</span><span class="n">XDialog</span> <span class="n">dialog</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControl</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dialog</span><span class="p">);</span>  <span class="p">}</span>
</code></pre></div>
<p>The initDialog() method inside EzHighlightAddonInpl.java attaches three listeners to
the dialog: a window listener, an action listener for the "CommandButton1" button,
and a key listener for the "TextField1" text field:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the EzHighlightAddonInpl class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XTextComponent</span> <span class="n">textBox</span><span class="p">;</span>
             <span class="c1">// the text in the dialog&#39;s text field</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">initDialog</span><span class="p">(</span><span class="n">XControl</span> <span class="n">dialogControl</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// listen to the dialog window</span>
  <span class="n">XTopWindow</span> <span class="n">topWin</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">getDialogWindow</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">);</span>
  <span class="n">topWin</span><span class="p">.</span><span class="na">addTopWindowListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="c1">// Dialogs.showControlInfo(dialogControl);</span>

  <span class="c1">// set listener for Ok button</span>
  <span class="n">XButton</span> <span class="n">button</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XButton</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
      <span class="n">Dialogs</span><span class="p">.</span><span class="na">findControl</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">,</span> <span class="s">&quot;CommandButton1&quot;</span><span class="p">));</span>
  <span class="n">button</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="c1">// set listener for text box</span>
  <span class="n">textBox</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
      <span class="n">Dialogs</span><span class="p">.</span><span class="na">findControl</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">,</span> <span class="s">&quot;TextField1&quot;</span><span class="p">));</span>
  <span class="n">XWindow</span> <span class="n">xTFWindow</span> <span class="o">=</span> <span class="p">(</span><span class="n">XWindow</span><span class="p">)</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XWindow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textBox</span><span class="p">);</span>
  <span class="n">xTFWindow</span><span class="p">.</span><span class="na">addKeyListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">xTFWindow</span><span class="p">.</span><span class="na">setFocus</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of initDialog()</span>
</code></pre></div>
<p>These controls and listeners are all from Office's com.sun.star.awt module. The dialog
and listeners will be invoked by Office at run time, and so should use its API, not
Java's Swing.</p>
<p>The call to Dialogs.showControlInfo() is commented out in initDialog(), but is a
useful way to double-check the dialog's internal construction, and particularly the IDs
of its components. showControlInfo() prints to standard output which will be
displayed in the Console window. Figure 13 reports the structure of the
EzHighlight.xdl dialog from Figure 12.</p>
<p><img alt="" src="images/46-Addons-13.png" /></p>
<p>Figure 13. The Console Window Showing Dialog Details.</p>
<p>The dialog contains five components: two labels, two text fields, and a button.</p>
<p>Dialogs.findControl() uses a control's name to find it inside a dialog:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in Dialogs class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XControl</span> <span class="nf">findControl</span><span class="p">(</span><span class="n">XControl</span> <span class="n">dialogCtrl</span><span class="p">,</span>
                                  <span class="n">String</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XControlContainer</span> <span class="n">ctrlCon</span> <span class="o">=</span>
                  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControlContainer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dialogCtrl</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ctrlCon</span><span class="p">.</span><span class="na">getControl</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>initDialog() converts the returned "CommandButton1" control into an XButton, and
the "TextField1" control into an XTextComponent so that listeners can be attached to
them.</p>
<p>EzHighlightAddonInpl implements all of the listener interfaces used by the dialog:
XActionListener, XTopWindowListener, and XKeyListener.
XActionListener.actionPerformed() deals with button presses,
XTopWindowListener.windowClosing() listens for the closing of the dialog, and
XKeyListener.keyPressed() captures the user typing <ENTER> into the text field:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the EzHighlightAddonInpl class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">XTextComponent</span> <span class="n">textBox</span><span class="p">;</span>


<span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="p">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">info</span> <span class="o">=</span> <span class="n">textBox</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Info: \&quot;&quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span><span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
  <span class="n">textBox</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="c1">// ADD code here</span>
<span class="p">}</span>  <span class="c1">// end of actionPerformed()</span>


<span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowClosing</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">dialog</span><span class="p">.</span><span class="na">endExecute</span><span class="p">();</span>   <span class="p">}</span>


<span class="kd">public</span> <span class="kt">void</span> <span class="nf">keyPressed</span><span class="p">(</span><span class="n">KeyEvent</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">KeyCode</span> <span class="o">==</span> <span class="n">Key</span><span class="p">.</span><span class="na">RETURN</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">info</span> <span class="o">=</span> <span class="n">textBox</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Info: \&quot;&quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span><span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
    <span class="n">textBox</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="c1">// ADD code here</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of keyPressed()</span>
</code></pre></div>
<p>The template generated code for actionPerformed() and keyPressed() only print
information to the Console window. Add-on specific functionality is added next.</p>
<h2 id="6-completing-the-implementation-of-ezhighlightaddoninpl">6.  Completing the Implementation of EzHighlightAddonInpl<a class="headerlink" href="#6-completing-the-implementation-of-ezhighlightaddoninpl" title="Permanent link">&para;</a></h2>
<p>The completion of EzHighlightAddonInpl.java takes the form of new code in
processCmd(), initDialog(), actionPerformed(), and keyPressed(), and a few new
global variables.</p>
<p>processCmd() converts the XComponent document returned by Lo.addonInitialize()
into an XTextDocument, assuming that the currently loaded document is text-based.
If it isn't then there's no point continuing:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the EzHighlightAddonInpl class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">;</span>


<span class="c1">// in processCmd()</span>
    <span class="p">:</span>
<span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">addonInitialize</span><span class="p">(</span><span class="n">xcc</span><span class="p">);</span>
<span class="c1">// added</span>
<span class="n">textDoc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getTextDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">textDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
  <span class="k">return</span><span class="p">;</span>
    <span class="p">:</span>
</code></pre></div>
<p>initDialog() is extended to access the word count text field. It's only used to report the
number of changes, so doesn't need a listener:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the EzHighlightAddonInpl class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XTextComponent</span> <span class="n">countTextBox</span><span class="p">;</span>


<span class="c1">// in initDialog()</span>
    <span class="p">:</span>
<span class="c1">// get a reference to the count text field; added</span>
<span class="n">countTextBox</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
          <span class="n">Dialogs</span><span class="p">.</span><span class="na">findControl</span><span class="p">(</span><span class="n">dialogControl</span><span class="p">,</span> <span class="s">&quot;TextField2&quot;</span><span class="p">));</span>
    <span class="p">:</span>
</code></pre></div>
<p>actionPerformed() and keyPressed() must trigger the highlighting code, which is
implemented in applyEzHighlighting():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// added to actionPerformed()</span>
    <span class="p">:</span>
<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">applyEzHighlighting</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="n">countTextBox</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">count</span><span class="p">);</span>


<span class="c1">// added to keyPressed()</span>
    <span class="p">:</span>
<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">applyEzHighlighting</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="n">countTextBox</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">count</span><span class="p">);</span>
</code></pre></div>
<p>applyEzHighlighting() is passed the text entered by the user through the dialog. It uses
the XReplaceable and XReplaceDescriptor interfaces to perform a search and replace
through the document. This technique, and very similar code, was explained in
Chapter 9. applyEzHighlighting() is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the EzHighlightAddonInpl class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">;</span>


<span class="kd">private</span> <span class="kt">int</span> <span class="nf">applyEzHighlighting</span><span class="p">(</span><span class="n">String</span> <span class="n">searchKey</span><span class="p">)</span>
<span class="cm">/* Matches whole words and is case sensitive.</span>

<span class="cm">   Highlights in bold and red;  */</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;applyEzHighlighting(): &quot;</span> <span class="o">+</span> <span class="n">searchKey</span><span class="p">);</span>

  <span class="n">XReplaceable</span> <span class="n">repl</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XReplaceable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textDoc</span><span class="p">);</span>
  <span class="n">XReplaceDescriptor</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">repl</span><span class="p">.</span><span class="na">createReplaceDescriptor</span><span class="p">();</span>

  <span class="cm">/* Get a XPropertyReplace object for altering the properties</span>
<span class="cm">     of the replaced text */</span>
  <span class="n">XPropertyReplace</span> <span class="n">propReplace</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertyReplace</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>

  <span class="c1">// Set the replaced text to bold and red</span>
  <span class="n">PropertyValue</span> <span class="n">wv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="p">(</span><span class="s">&quot;CharWeight&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">FontWeight</span><span class="p">.</span><span class="na">BOLD</span><span class="p">,</span> <span class="n">PropertyState</span><span class="p">.</span><span class="na">DIRECT_VALUE</span><span class="p">);</span>
  <span class="n">PropertyValue</span> <span class="n">cv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="p">(</span><span class="s">&quot;CharColor&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">Color</span><span class="p">.</span><span class="na">RED</span><span class="p">.</span><span class="na">getRGB</span><span class="p">(),</span> <span class="n">PropertyState</span><span class="p">.</span><span class="na">DIRECT_VALUE</span><span class="p">);</span>
  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="p">{</span><span class="n">cv</span><span class="p">,</span> <span class="n">wv</span><span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="n">propReplace</span><span class="p">.</span><span class="na">setReplaceAttributes</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

    <span class="c1">// Only match whole words and be case sensitive</span>
    <span class="n">desc</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;SearchCaseSensitive&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">desc</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;SearchWords&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Error setting up search properties&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* Replaces all instances of searchKey with new Text properties</span>
<span class="cm">     and gets the number of changed instances */</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">setSearchString</span><span class="p">(</span><span class="n">searchKey</span><span class="p">);</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">setReplaceString</span><span class="p">(</span><span class="n">searchKey</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">repl</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="n">desc</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of applyEzHighlighting()</span>
</code></pre></div>
<h2 id="7-configuring-the-add-on">7.  Configuring the Add-on<a class="headerlink" href="#7-configuring-the-add-on" title="Permanent link">&para;</a></h2>
<p>An add-on OXT file requires two configuration files not used by an UNO component:
ProtocolHandler.xcu and Addon.xcs.</p>
<h3 id="71-protocolhandlerxcu">7.1.  ProtocolHandler.xcu<a class="headerlink" href="#71-protocolhandlerxcu" title="Permanent link">&para;</a></h3>
<p>ProtocolHandler.xcu specifies which command URLs will be handled by the
component. The contents of the file for EzHighlight are:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;

&lt;oor:component-data oor:name=&quot;ProtocolHandler&quot;
                    oor:package=&quot;org.openoffice.Office&quot;
      xmlns:oor=&quot;http://openoffice.org/2001/registry&quot;
      xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;node oor:name=&quot;HandlerSet&quot;&gt;

    &lt;node oor:name=&quot;EzHighlightAddonImpl&quot; oor:op=&quot;replace&quot;&gt;
      &lt;prop oor:name=&quot;Protocols&quot; oor:type=&quot;oor:string-list&quot;&gt;
        &lt;value&gt;org.openoffice.ezhighlightAddon:*&lt;/value&gt;
      &lt;/prop&gt;
    &lt;/node&gt;

  &lt;/node&gt;
&lt;/oor:component-data&gt;
</code></pre></div>
<p>The "EzHighlightAddonImpl" component will handle all command URLs that begin
with the "org.openoffice.ezhighlightAddon" extension ID. The "all" is specified using
the * wildcard. The component name is the name of the generated Java class.</p>
<h3 id="72-addonxcs">7.2.  Addon.xcs<a class="headerlink" href="#72-addonxcs" title="Permanent link">&para;</a></h3>
<p>Addon.xcs defines the add-on's GUI elements, such as its menu and toolbar items (i.e.
as seen in Figures 2, 3, and 5). Figure 14 illustrates how the file may set up to five
attributes:</p>
<p><img alt="" src="images/46-Addons-14.png" /></p>
<p>Figure 14. The Addon.xcs GUI Elements.</p>
<p>The "AddonMenu" attribute defines the look of the menu item that appears at the end
of Office's Tool &gt; Add-ons menu, as in Figure 2.</p>
<p>The "OfficeToolbar" attribute specifies the appearance of the floating toolbar reached
via View &gt; Toolbars &gt; Add-on <number>, as in Figure 3.</p>
<p>The "OfficeMenubar" attribute is used to add a menu item to Office's main menu bar,
which seems a rather poor GUI design choice, so I've chosen not to use it.</p>
<p>The OfficeHelp" attribute creates the add-on's help menu item on Office's Help menu,
as in Figure 5.</p>
<p>The "Images" attribute defines the icons that appear next to the text in the menu and
toolbar items. If you look back at Figures 2 and 3, you'll see that no icons appear, but
this isn't for want of me trying. This feature seems to be broken, but I'll still explain
how to set it up.</p>
<p>Aside from "Images", the attributes have a similar structure: a menu or toolbar item
with five sub-attributes: URL, Title, ImageIdentifier, Context, and Target; I'll not be
using sub-menu attributes.</p>
<p>The best explanation of Addon.xcs' structure is "How to distribute your macros with
an Addon" by Bernard Marcelly at
<a href="http://www.openoffice.org/documentation/HOW_TO/various_topics/Addons1_1en.pdf">http://www.openoffice.org/documentation/HOW_TO/various_topics/Addons1_1en.pdf</a>,
which dates from 2003.</p>
<h4 id="addonmenu-attribute">"AddonMenu" Attribute<a class="headerlink" href="#addonmenu-attribute" title="Permanent link">&para;</a></h4>
<p>The "AddonMenu" attribute used by the EzHighlight add-on is:</p>
<div class="highlight"><pre><span></span><code>&lt;node oor:name=&quot;AddonMenu&quot;&gt;
  &lt;node oor:name=&quot;org.openoffice.ezhighlightAddon&quot;
        oor:op=&quot;replace&quot;&gt;

    &lt;prop oor:name=&quot;URL&quot; oor:type=&quot;xs:string&quot;&gt;
      &lt;value&gt;org.openoffice.ezhighlightAddon:EzHighlight&lt;/value&gt;
    &lt;/prop&gt;

    &lt;prop oor:name=&quot;Title&quot; oor:type=&quot;xs:string&quot;&gt;
      &lt;value&gt;EzHighlight Text&lt;/value&gt;
    &lt;/prop&gt;

    &lt;prop oor:name=&quot;ImageIdentifier&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value/&gt;
    &lt;/prop&gt;

    &lt;prop oor:name=&quot;Context&quot; oor:type=&quot;xs:string&quot;&gt;
      &lt;value&gt;com.sun.star.text.TextDocument&lt;/value&gt;
    &lt;/prop&gt;

    &lt;prop oor:name=&quot;Target&quot; oor:type=&quot;xs:string&quot;&gt;
      &lt;value&gt;_self&lt;/value&gt;
    &lt;/prop&gt;
  &lt;/node&gt;
&lt;/node&gt;
</code></pre></div>
<p>The "URL" attribute holds the command URL which is dispatched by Office when
the menu item is clicked.</p>
<p>The "Title" attribute contains the menu item's text, and "ImageIdentifier" can be
assigned the path to a PNG or BMP file for the text's icon. "ImageIdentifier" is left
empty here since all the images are defined in the "Images" attribute, explained
below.</p>
<p>The "Context" attribute is assigned the document service for the Office application
utilizing the add-on. EzHighlight is accessible only from Writer, so "Context"'s value
is "com.sun.star.text.TextDocument". Other application/service mappings are shown
in Table 1.</p>
<table>
<thead>
<tr>
<th>Office Application</th>
<th>Document Service</th>
</tr>
</thead>
<tbody>
<tr>
<td>Writer</td>
<td>com.sun.star.text.TextDocument</td>
</tr>
<tr>
<td>Calc</td>
<td>com.sun.star.sheet.SpreadsheetDocument</td>
</tr>
<tr>
<td>Impress</td>
<td>com.sun.star.presentation.PresentationDocument</td>
</tr>
<tr>
<td>Draw</td>
<td>com.sun.star.drawing.DrawingDocument</td>
</tr>
<tr>
<td>Formula</td>
<td>com.sun.star.formula.FormulaProperties</td>
</tr>
<tr>
<td>Chart</td>
<td>com.sun.star.chart.ChartDocument</td>
</tr>
<tr>
<td>Bibliography</td>
<td>com.sun.star.frame.Bibliography</td>
</tr>
</tbody>
</table>
<p>Table 1. Office Application/Service Mappings Used by "Context"</p>
<p>If the "Context" field isn't assigned a value, then the add-on will be available in all of
Office's applications.</p>
<p>The "Target" field can be assigned four values: "_top", "_parent", "_blank", and
"_self", but I've never seen any other value used but "_self".</p>
<h4 id="officetoolbar-attribute">"OfficeToolbar" Attribute<a class="headerlink" href="#officetoolbar-attribute" title="Permanent link">&para;</a></h4>
<p>Figure 2 (EzHighlight's menu item) and Figure 3 (its toolbar item) look the same, and
respond in the same way when clicked, so it's no great surprise that the
"OfficeToolbar" attribute in Addon.xcs is almost exactly the same as "AddonMenu":</p>
<div class="highlight"><pre><span></span><code>&lt;node oor:name=&quot;OfficeToolBar&quot;&gt;
  &lt;node oor:name=&quot;org.openoffice.ezhighlightAddon&quot;
        oor:op=&quot;replace&quot;&gt;
    &lt;node oor:name=&quot;m1&quot; oor:op=&quot;replace&quot;&gt;

      &lt;prop oor:name=&quot;URL&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;org.openoffice.ezhighlightAddon:EzHighlight&lt;/value&gt;
      &lt;/prop&gt;

      &lt;prop oor:name=&quot;Title&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;EzHighlight Text&lt;/value&gt;
      &lt;/prop&gt;

      &lt;prop oor:name=&quot;ImageIdentifier&quot; oor:type=&quot;xs:string&quot;&gt;
         &lt;value/&gt;
      &lt;/prop&gt;

      &lt;prop oor:name=&quot;Context&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;com.sun.star.text.TextDocument&lt;/value&gt;
      &lt;/prop&gt;

      &lt;prop oor:name=&quot;Target&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;_self&lt;/value&gt;
      &lt;/prop&gt;
    &lt;/node&gt;
  &lt;/node&gt;
&lt;/node&gt;
</code></pre></div>
<p>The difference is an extra <node> attribute which allows a toolbar to hold several
items. In the description above, there's one item labeled as "m1". The labels can be
any unique string, but "m" followed by a number is used in most examples.</p>
<h4 id="officehelp-attribute">"OfficeHelp" Attribute<a class="headerlink" href="#officehelp-attribute" title="Permanent link">&para;</a></h4>
<p>The "OfficeHelp" attribute is similar to "OfficeToolbar" and "AddonMenu", but
dispatches a different command URL ("org.openoffice.ezhighlightAddon:help") and
its menu item uses a different title ("About EzHighlight").</p>
<div class="highlight"><pre><span></span><code>&lt;node oor:name=&quot;OfficeHelp&quot;&gt;
  &lt;node oor:name=&quot;org.openoffice.ezhighlightAddon&quot;
        oor:op=&quot;replace&quot;&gt;

     &lt;prop oor:name=&quot;URL&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;org.openoffice.ezhighlightAddon:help&lt;/value&gt;
     &lt;/prop&gt;

     &lt;prop oor:name=&quot;Title&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value xml:lang=&quot;en-US&quot;&gt;About EzHighlight&lt;/value&gt;
     &lt;/prop&gt;

     &lt;prop oor:name=&quot;ImageIdentifier&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value/&gt;
     &lt;/prop&gt;

      &lt;prop oor:name=&quot;Context&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;com.sun.star.text.TextDocument&lt;/value&gt;
      &lt;/prop&gt;

     &lt;prop oor:name=&quot;Target&quot; oor:type=&quot;xs:string&quot;&gt;
        &lt;value&gt;_self&lt;/value&gt;
     &lt;/prop&gt;
   &lt;/node&gt;
&lt;/node&gt;
</code></pre></div>
<h4 id="images-attribute">"Images" Attribute<a class="headerlink" href="#images-attribute" title="Permanent link">&para;</a></h4>
<p>The "Images" attribute specifies the icons used by the GUI elements. An image can be
either big or small (26x26 or 16x16 pixels), high contrast or normal, and loaded from
a file or coded as hexadecimal text. These different combinations mean there are eight
variants to choose from, each with a different property name, which are listed in Table
2.</p>
<table>
<thead>
<tr>
<th>Size in Pixels</th>
<th>Contrast</th>
<th>Hexadecimal text</th>
<th>File name</th>
</tr>
</thead>
<tbody>
<tr>
<td>16x16</td>
<td>normal</td>
<td>ImageSmall</td>
<td>ImageSmallURL</td>
</tr>
<tr>
<td>16x16</td>
<td>high</td>
<td>ImageSmallHC</td>
<td>ImageSmallHCURL</td>
</tr>
<tr>
<td>26x26</td>
<td>normal</td>
<td>ImageBig</td>
<td>ImageBigURL</td>
</tr>
<tr>
<td>26x26</td>
<td>high</td>
<td>ImageBigHC</td>
<td>ImageBigHCURL</td>
</tr>
</tbody>
</table>
<p>Table 2. Image Property Names.</p>
<p>The "Images" attribute for EzHighlight is:</p>
<div class="highlight"><pre><span></span><code>&lt;node oor:name=&quot;Images&quot;&gt;
  &lt;node oor:name=&quot;org.openoffice.ezhighlightAddon&quot;
        oor:op=&quot;replace&quot;&gt;

    &lt;prop oor:name=&quot;URL&quot; oor:type=&quot;xs:string&quot;&gt;
      &lt;value&gt;org.openoffice.ezhighlightAddon:EzHighlight&lt;/value&gt;
    &lt;/prop&gt;

    &lt;node oor:name=&quot;UserDefinedImages&quot;&gt;
      &lt;prop oor:name=&quot;ImageSmallURL&quot;&gt;
        &lt;value&gt;%origin%/images/ezhighlight16.png&lt;/value&gt;
      &lt;/prop&gt;
      &lt;prop oor:name=&quot;ImageBigURL&quot;&gt;
        &lt;value&gt;%origin%/images/ezhighlight26.png&lt;/value&gt;
      &lt;/prop&gt;
    &lt;/node&gt;

  &lt;/node&gt;
&lt;/node&gt;
</code></pre></div>
<p>The "UserDefinedImages" sub-attribute specifies two sizes of normal contrast image,
supplied as filenames. %origin% stands for the OXT file, so the two icons are stored
in the images/ subdirectory inside that zipped file.</p>
<p>The images will be used for the menu and toolbar items associated with the
"org.openoffice.ezhighlightAddon:EzHighlight" command URL. Unfortunately, the
images don't appear, as shown in Figures 2 and 3.</p>
<p>The hexadecimal text definition of a small image would be something like:</p>
<div class="highlight"><pre><span></span><code>  &lt;prop oor:name=&quot;ImageSmall&quot;&gt;
    &lt;value&gt;89504E470D0A1A0A0000000D494844520000001000000
           01008060000001FF3FF610000024F494 ... // more numbers
    &lt;/value&gt;
  &lt;/prop&gt;
</code></pre></div>
<p>One way to obtain an image's hexadecimal text is to call my ImageHex.java program
which prints it to stdout. Unfortunately, the icon still doesn't appear, even when
specified in this form.</p>
<h2 id="8-building-and-installing-the-oxt-file">8.  Building and Installing the OXT File<a class="headerlink" href="#8-building-and-installing-the-oxt-file" title="Permanent link">&para;</a></h2>
<p>Figure 7 shows the stages in building and installing the add-on as an extension. These
steps are carried out by my installAddon.bat script, which assumes that the various
configuration files have already been created and are in certain locations.</p>
<p>The completed EzHighlightAddonImpl.java file is compiled, then added to
EzHighlight.jar with a manifest that refers to Utils.jar:</p>
<div class="highlight"><pre><span></span><code><span class="nl">RegistrationClassName</span><span class="p">:</span> <span class="n">EzHighlightAddonImpl</span>
<span class="n">Class</span><span class="o">-</span><span class="n">Path</span><span class="p">:</span> <span class="n">Utils</span><span class="p">.</span><span class="na">jar</span>
</code></pre></div>
<p>Utils.jar contains my support classes, which may be required by the add-on at run-
time. installAddon.bat will add it to the OXT file along with EzHighlight.jar.</p>
<p>installAddon.bat assumes that the add-on configuration files are in a sub-directory
with the same name as the add-on. For example, when it's processing the EzHighlight
add-on, it looks for a EzHighlight/ folder with the following structure:</p>
<div class="highlight"><pre><span></span><code>EzHighlight
    |   Addons.xcu
    |   description.xml
    |   license.txt
    |   package-description.txt
    |   ProtocolHandler.xcu
    |   Utils.jar
    |
    +---dialogLibrary
    |       EzHighlight.xdl
    |
    +---images
    |       ezhighlight.png
    |       ezhighlight16.png
    |       ezhighlight26.png
    |
    \---META-INF
            manifest.xml
</code></pre></div>
<p>EzHighlight.jar is moved into EzHighlight/, and the folder is zipped into
EzHighlight.oxt. The extension is installed into Office using the unopkg tool, in the
same way as the UNO component of the last chapter.</p>
<p>EzHighlight/ contains three configuration files: ProtocolHandler.xcu, Addons.xcu,
and description.xml. description.xml plays the same role as the same-named file for
UNO components. Its contents use the same XML attributes:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;description
xmlns=&quot;http://openoffice.org/extensions/description/2006&quot;
xmlns:d=&quot;http://openoffice.org/extensions/description/2006&quot;
xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;

  &lt;identifier value=&quot;org.openoffice.ezhighlightAddon&quot;/&gt;
  &lt;version value=&quot;0.1&quot;/&gt;

  &lt;display-name&gt;
    &lt;name lang=&quot;en&quot;&gt;EzHighlight Addon&lt;/name&gt;
  &lt;/display-name&gt;

  &lt;publisher&gt;
    &lt;name xlink:href=&quot;http://fivedots.coe.psu.ac.th/~ad/jlop/&quot;
          lang=&quot;en&quot;&gt;Andrew Davison&lt;/name&gt;
  &lt;/publisher&gt;

  &lt;registration&gt;
    &lt;simple-license accept-by=&quot;user&quot; &gt;
      &lt;license-text xlink:href=&quot;license.txt&quot; lang=&quot;en&quot;/&gt;
    &lt;/simple-license&gt;
  &lt;/registration&gt;

  &lt;extension-description&gt;
    &lt;src lang=&quot;en-US&quot; xlink:href=&quot;package-description.txt&quot;/&gt;
  &lt;/extension-description&gt;

  &lt;icon&gt;
    &lt;default xlink:href=&quot;images/ezhighlight.png&quot; /&gt;
  &lt;/icon&gt;

  &lt;update-information&gt;
    &lt;src xlink:href=&quot;http://fivedots.coe.psu.ac.th/~ad/jlop/&quot;/&gt;
  &lt;/update-information&gt;

  &lt;dependencies&gt;
   &lt;OpenOffice.org-minimal-version value=&quot;3.4&quot;
                      d:name=&quot;OpenOffice.org 3.4&quot;/&gt;
  &lt;/dependencies&gt;

  &lt;platform value=&quot;all&quot; /&gt;
&lt;/description&gt;
</code></pre></div>
<p>The biggest difference is that the extension icon is located in the images/ subdirectory
inside EzHighlight/. license.txt and package-description.txt are referenced in the
description, which explains why those files are in EzHighlight/.</p>
<p>The dialog description (EzHighlight.xdl) is stored in its own subdirectory,
dialogLibrary/, to match the dialog loading code in EzHighlightAddonInpl.java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in processCmd()</span>
<span class="n">dialog</span> <span class="o">=</span> <span class="n">Dialogs</span><span class="p">.</span><span class="na">loadAddonDialog</span><span class="p">(</span><span class="s">&quot;org.openoffice.ezhighlightAddon&quot;</span><span class="p">,</span>
                            <span class="s">&quot;dialogLibrary/&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;.xdl&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The images/ subdirectory contains the extension manager icon (ezhighlight.png) and
two sizes of GUI icons (ezhighlight16.png and ezhighlight26.png). The GUI icons
must be inside images/ to match the locations specified in the "Images" attribute in
Addon.xcs.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="45-UNO_Components.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 45. Coding UNO Components" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 45. Coding UNO Components
            </div>
          </div>
        </a>
      
      
        
        <a href="47-Calc_Add-ins.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 47. Calc Add-ins" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 47. Calc Add-ins
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>