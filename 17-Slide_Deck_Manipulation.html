
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 17. Slide Deck Manipulation - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-17-slide-deck-manipulation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 17. Slide Deck Manipulation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 17. Slide Deck Manipulation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link md-nav__link--active">
        Chapter 17. Slide Deck Manipulation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-building-a-deck-from-notes" class="md-nav__link">
    1.  Building a Deck from Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-master-pages" class="md-nav__link">
    2.  Master Pages
  </a>
  
    <nav class="md-nav" aria-label="2.  Master Pages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-accessing-a-master-page" class="md-nav__link">
    2.1.  Accessing a Master Page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-whats-on-a-master-page" class="md-nav__link">
    2.2.  What's on a Master Page?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-modifying-a-master-page" class="md-nav__link">
    2.3.  Modifying a Master Page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-using-a-master-page" class="md-nav__link">
    2.4.  Using a Master Page
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-adding-a-slide-to-a-deck" class="md-nav__link">
    3.  Adding a Slide to a Deck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-rearranging-a-slide-deck" class="md-nav__link">
    4.  Rearranging a Slide Deck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-appending-slide-decks-together" class="md-nav__link">
    5.  Appending Slide Decks Together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-exporting-a-slide-as-an-image" class="md-nav__link">
    6.  Exporting a Slide as an Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-extracting-the-text-from-a-slide-deck" class="md-nav__link">
    7.  Extracting the Text from a Slide Deck
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-building-a-deck-from-notes" class="md-nav__link">
    1.  Building a Deck from Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-master-pages" class="md-nav__link">
    2.  Master Pages
  </a>
  
    <nav class="md-nav" aria-label="2.  Master Pages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-accessing-a-master-page" class="md-nav__link">
    2.1.  Accessing a Master Page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-whats-on-a-master-page" class="md-nav__link">
    2.2.  What's on a Master Page?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-modifying-a-master-page" class="md-nav__link">
    2.3.  Modifying a Master Page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-using-a-master-page" class="md-nav__link">
    2.4.  Using a Master Page
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-adding-a-slide-to-a-deck" class="md-nav__link">
    3.  Adding a Slide to a Deck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-rearranging-a-slide-deck" class="md-nav__link">
    4.  Rearranging a Slide Deck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-appending-slide-decks-together" class="md-nav__link">
    5.  Appending Slide Decks Together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-exporting-a-slide-as-an-image" class="md-nav__link">
    6.  Exporting a Slide as an Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-extracting-the-text-from-a-slide-deck" class="md-nav__link">
    7.  Extracting the Text from a Slide Deck
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/17-Slide_Deck_Manipulation.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-17-slide-deck-manipulation">Chapter 17. Slide Deck Manipulation<a class="headerlink" href="#chapter-17-slide-deck-manipulation" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Deck Building;
Master Pages; Adding a
Slide to  a Deck;
Rearranging a Deck;
Appending Two Decks;
Exporting a Slide as an
Image; Extracting the
Text from a Deck</p>
<p>Example folders: "Draw
Tests" and "Utils"</p>
</div>
<p>This chapter looks at a number of common tasks
performed with slide decks:</p>
<ul>
<li>building a slide deck based on a file of text notes;</li>
<li>using, changing, and creating master pages for slide decks;</li>
<li>adding a slide to an existing deck;</li>
<li>rearranging the slides in a deck;</li>
<li>appending two (or more) decks;</li>
<li>exporting a slide from a deck as an image;</li>
<li>extracting all the text from a slide deck.</li>
</ul>
<h2 id="1-building-a-deck-from-notes">1.  Building a Deck from Notes<a class="headerlink" href="#1-building-a-deck-from-notes" title="Permanent link">&para;</a></h2>
<p>With Draw methods such as titleSlide() and bulletsSlide() it's quite easy to write a
program that converts a set of notes in a text file into a slides deck. The
PointsBuilder.java example does just that, using textual input formatted as shown
below:</p>
<div class="highlight"><pre><span></span><code>What is a Algorithm?

&gt; An algorithm is a finite set of unambiguous instructions for
solving a problem.


&gt;&gt; An algorithm is correct if on all legitimate inputs, it outputs
the right answer in a finite amount of time

&gt; Can be expressed as
&gt;&gt;pseudocode
&gt;&gt;flow charts
&gt;&gt;text in a natural language (e.g. English)
&gt;&gt;computer code


Algorithm Design

&gt; The theoretical  study of how to solve  computational problems
&gt;&gt;sorting a list of numbers
&gt;&gt;   finding a shortest route on a map
&gt;&gt; scheduling when to work on homework
&gt;&gt; answering web search queries
&gt;&gt; and so on...
</code></pre></div>
<p>When PointsBuilder reads this text, it generates three slides, and saves them to
"points.odp" which is shown in Figure 1.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-1.png" /></p>
<p>Figure 1. Slides Generated by PointsBuilder.java</p>
<p>The title slide in Figure 1 is generated automatically, but the other slides are created
from the input text by calling Draw.bulletsSlide() and Draw.addBullet().</p>
<p>The reason the output looks so good is that PointsBuilder.java uses one of Impress'
templates, "Inspiration.otp". These files are listed in Impress when you open the
"Master Pages" section of the Tasks pane, part of which is shown in Figure 2.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-2.jpg" /></p>
<p>Figure 2. The List of Master Pages in Impress.</p>
<p>If you move the cursor over the thumbnail images, the name of the template file is
displayed as a tooltip.</p>
<p>The main() function of PointsBuilder.java starts by printing the names of all the
available templates, before using "Inspiration.otp" to create a new presentation
document:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: PointsBuilder &lt;points fnm&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">reportTemplates</span><span class="p">();</span>

  <span class="n">String</span> <span class="n">templateFnm</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideTemplatePath</span><span class="p">()</span> <span class="o">+</span>
                                       <span class="s">&quot;Inspiration.otp&quot;</span><span class="p">;</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createDocFromTemplate</span><span class="p">(</span><span class="n">templateFnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Impress doc creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">readPoints</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Total no. of slides: &quot;</span> <span class="o">+</span>
                              <span class="n">Draw</span><span class="p">.</span><span class="na">getSlidesCount</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;points.odp&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>reportTemplates() uses Info.getDirs("Template") to retrieve a list of all the directories
examined by Office when looking for templates. It also calls
Draw.getSlideTemplatePath() to retrieve the default slide template directory, and
prints the names of the files in that folder:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in PointsBuilder.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reportTemplates</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">templateDirs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getDirs</span><span class="p">(</span><span class="s">&quot;Template&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Templates dirs:&quot;</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">dir</span> <span class="p">:</span> <span class="n">templateDirs</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">dir</span><span class="p">);</span>

  <span class="n">String</span> <span class="n">templateDir</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideTemplatePath</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nTemplates files in \&quot;&quot;</span> <span class="o">+</span>
                                       <span class="n">templateDir</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">templatesFnms</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">getFileNames</span><span class="p">(</span><span class="n">templateDir</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span> <span class="p">:</span> <span class="n">templatesFnms</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of reportTemplates()</span>
</code></pre></div>
<p>reportTemplates()'s output:</p>
<div class="highlight"><pre><span></span><code>Templates dirs:
  C:\Program Files\LibreOffice 4\share\template\en-US
  C:\Program Files\LibreOffice 4\share\template\common
  C:\Users\Ad\Desktop\LibreOffice Tests\
       Draw Tests\$BUNDLED_EXTENSIONS\wiki-publisher\templates
  C:\Users\Ad\AppData\Roaming\LibreOffice\4\user\template

Templates files in &quot;C:\Program Files\LibreOffice 4\
                           share/template/common/layout/&quot;
  AbstractGreen.otp
  AbstractRed.otp
  AbstractYellow.otp
  BrightBlue.otp
  DNA.otp
  Inspiration.otp
  LushGreen.otp
  Metropolis.otp
  Sunset.otp
  Vintage.otp
</code></pre></div>
<p>PointsBuilder employs the "Inspiration.otp" template, via the call:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">templateFnm</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideTemplatePath</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;Inspiration.otp&quot;</span><span class="p">;</span>
<span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createDocFromTemplate</span><span class="p">(</span><span class="n">templateFnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
</code></pre></div>
<p>Lo.createDocFromTemplate() is a variant of  Lo.createDoc() which specifies a
template for the new document. It calls
XComponentLoader.loadComponentFromURL() with the template file as an
argument, and sets the "AsTemplate" property:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="c1">// global</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiServiceFactory</span> <span class="n">msFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XComponent</span> <span class="nf">createDocFromTemplate</span><span class="p">(</span><span class="n">String</span> <span class="n">templatePath</span><span class="p">,</span>
                                      <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="c1">// create a new document using the specified template</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">FileIO</span><span class="p">.</span><span class="na">isOpenable</span><span class="p">(</span><span class="n">templatePath</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Opening template &quot;</span> <span class="o">+</span> <span class="n">templatePath</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">templateURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">templatePath</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">templateURL</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span>
      <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;Hidden&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="s">&quot;AsTemplate&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="na">loadComponentFromURL</span><span class="p">(</span><span class="n">templateURL</span><span class="p">,</span><span class="s">&quot;_blank&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">props</span><span class="p">);</span>
    <span class="n">msFactory</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMultiServiceFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create doc from template: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">doc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of createDocFromTemplate()</span>
</code></pre></div>
<p>The readPoints() method in PointsBuilder.java loads the text points file line-by-line. It
ignores blank lines and lines starting with "//", and examines the first character on
each line:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in PointsBuilder.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">readPoints</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XDrawPage</span> <span class="n">currSlide</span>  <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">titleSlide</span><span class="p">(</span><span class="n">currSlide</span><span class="p">,</span> <span class="s">&quot;Java-Generated Slides&quot;</span><span class="p">,</span>
                             <span class="s">&quot;Using LibreOffice&quot;</span><span class="p">);</span>
  <span class="n">XText</span> <span class="n">body</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="p">(</span> <span class="k">new</span> <span class="n">FileReader</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>
    <span class="n">String</span> <span class="n">line</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="k">while</span><span class="p">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">// blank line</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">))</span>   <span class="c1">// comment</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="n">ch</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;&gt;&#39;</span><span class="p">)</span>  <span class="c1">// a bullet with some indentation</span>
        <span class="n">processBullet</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
      <span class="k">else</span> <span class="p">{</span>  <span class="c1">// a title for a new slide</span>
        <span class="n">currSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">addSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">bulletsSlide</span><span class="p">(</span><span class="n">currSlide</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">br</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Read in points file: &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Error reading points file: &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of readPoints()</span>
</code></pre></div>
<p>If the line starts with a '&gt;', then processBullet() is called to determine how many '&gt;'s
start the line. Depending on the number, Draw.addBullet() is called with a different
bullet indentation level value. If the line doesn't start with a '&gt;', then it's assumed to be
the title line of a new slide, and Draw.addSlide() and Draw.bulletsSlide() create a new
bullets-based slide.</p>
<h2 id="2-master-pages">2.  Master Pages<a class="headerlink" href="#2-master-pages" title="Permanent link">&para;</a></h2>
<p>When a new slide deck is created it always has a single slide and a default master
page, and every slide created subsequently will use this master page to format its
background. The easiest way to view the master page is through the Impress GUI – by
clicking on the View, Master, Slide Master menu, which displays something like
Figure 3.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-3.png" /></p>
<p>Figure 3. The Default Master Page.</p>
<p>There are five presentation shapes in Figure 3. From top-to-bottom, left-to-right, they
are TitleTextShape, OutlinerShape , DateTimeShape. FooterShape, and
SlideNumberShape.</p>
<p>Even though a new slide links to this master page, the date/time, footer, and slide
number text are not automatically displayed on the slide; their rendering must be
turned on.</p>
<p>It's possible to create more master pages in addition to the default one in Figure 3, and
link a slide to one of those.</p>
<p>The MastersUse.java example illustrates a number of master page features: the default
master page has text added to its footer section, and a shape and text are placed in its
top-left corner. The slide deck holds four slides – three of them link to the default
master page, and are set to display its footer and slide number. However, the third
slide in the deck links to a second master page with a slightly different appearance.</p>
<p>Figure 4 shows the all the slides in the deck.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-4.png" /></p>
<p>Figure 4. A Slide Deck with Two Master Pages.</p>
<p>Slides 1, 2, and 4 use the default master page, while slide 3 uses the new master.</p>
<p>The main() function for MastersUse.java is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">createImpressDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Impress doc creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// report the shapes on the default master page</span>
  <span class="n">XDrawPage</span> <span class="n">masterPage</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getMasterPage</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Default Master Page&quot;</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">showShapesInfo</span><span class="p">(</span><span class="n">masterPage</span><span class="p">);</span>

  <span class="c1">// set the master page&#39;s footer text</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">setMasterFooter</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="s">&quot;Master Use Slides&quot;</span><span class="p">);</span>

  <span class="c1">// add a rectangle and text to the default master page</span>
  <span class="c1">// at the top-left of the slide</span>
  <span class="n">Size</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideSize</span><span class="p">(</span><span class="n">masterPage</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">drawRectangle</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Width</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="o">/</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">drawText</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="s">&quot;Default Master Page&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>

  <span class="cm">/* set slide 1 to use the master page&#39;s slide number</span>
<span class="cm">     but its own footer text */</span>
  <span class="n">XDrawPage</span> <span class="n">slide1</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">titleSlide</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;Slide 1&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;IsPageNumberVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="c1">// use the master page&#39;s slide number</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;IsFooterVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;FooterText&quot;</span><span class="p">,</span> <span class="s">&quot;MU Slides&quot;</span><span class="p">);</span>
      <span class="c1">// change master page&#39;s footer for first slide (does not work)</span>

  <span class="cm">/* add three more slides, which use the master page&#39;s</span>
<span class="cm">     slide number and footer */</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">XDrawPage</span> <span class="n">slide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">insertSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">Draw</span><span class="p">.</span><span class="na">bulletsSlide</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="s">&quot;Slide &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="s">&quot;IsPageNumberVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="s">&quot;IsFooterVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// create master page 2</span>
  <span class="n">XDrawPage</span> <span class="n">masterPage2</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">insertMasterPage</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">addSlideNumber</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">);</span>   <span class="c1">// add slide number</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Master Page 2&quot;</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">showShapesInfo</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">);</span>

  <span class="c1">// link third slide to master page 2</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">setMasterPage</span><span class="p">(</span><span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">masterPage2</span><span class="p">);</span>

  <span class="c1">// put green ellipse and text on master page 2</span>
  <span class="n">XShape</span> <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">drawEllipse</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                   <span class="n">sz</span><span class="p">.</span><span class="na">Width</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="o">/</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="s">&quot;FillColor&quot;</span><span class="p">,</span> <span class="mh">0xCCFF33</span><span class="p">);</span>  <span class="c1">//neon green</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">drawText</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">,</span> <span class="s">&quot;Master Page 2&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;muSlides.odp&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<h3 id="21-accessing-a-master-page">2.1.  Accessing a Master Page<a class="headerlink" href="#21-accessing-a-master-page" title="Permanent link">&para;</a></h3>
<p>A presentation (or drawing) document can access its master pages through the
XMasterPagesSupplier interface in the GenericDrawingDocument service.
XMasterPagesSupplier.getMasterPages() returns a single XDrawPages object:</p>
<div class="highlight"><pre><span></span><code><span class="n">XMasterPagesSupplier</span> <span class="n">mpSupp</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMasterPagesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">XDrawPages</span> <span class="n">pgs</span> <span class="o">=</span> <span class="n">mpSupp</span><span class="p">.</span><span class="na">getMasterPages</span><span class="p">();</span>
</code></pre></div>
<p>The XDrawPages object is an indexed collection, with the default master page at
position 0:</p>
<div class="highlight"><pre><span></span><code><span class="n">XDrawPage</span> <span class="n">masterPage</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDrawPage</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">pgs</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div>
<p>Note that there's no "XMasterPage" interface – both slides and master pages are
manipulated using XDrawPage.</p>
<p>These preceding lines are packaged up as Draw.getMasterPage():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDrawPage</span> <span class="nf">getMasterPage</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="c1">// get master page by index</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XMasterPagesSupplier</span> <span class="n">mpSupp</span> <span class="o">=</span>
              <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMasterPagesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
    <span class="n">XDrawPages</span> <span class="n">pgs</span> <span class="o">=</span> <span class="n">mpSupp</span><span class="p">.</span><span class="na">getMasterPages</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDrawPage</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">pgs</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not find master slide &quot;</span> <span class="o">+</span> <span class="n">idx</span><span class="p">);</span>
     <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getMasterPage()</span>
</code></pre></div>
<p>There's a second way of obtaining a master page, via the link between a slide and its
master; the linked master is called a target. This is implemented by a second
Draw.getMasterPage() method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDrawPage</span> <span class="nf">getMasterPage</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">)</span>
<span class="c1">// return master page for the slide</span>
<span class="p">{</span>
  <span class="n">XMasterPageTarget</span> <span class="n">mpTarget</span> <span class="o">=</span>
                       <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMasterPageTarget</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">slide</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">mpTarget</span><span class="p">.</span><span class="na">getMasterPage</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getMasterPage()</span>
</code></pre></div>
<h3 id="22-whats-on-a-master-page">2.2.  What's on a Master Page?<a class="headerlink" href="#22-whats-on-a-master-page" title="Permanent link">&para;</a></h3>
<p>The default master page was shown in Figure 3, and its structure is confirmed in
MastersUse.java when Draw.showShapesInfo() is called:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in main() of MastersUse.java</span>
<span class="n">XDrawPage</span> <span class="n">masterPage</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getMasterPage</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Default Master Page&quot;</span><span class="p">);</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">showShapesInfo</span><span class="p">(</span><span class="n">masterPage</span><span class="p">);</span>
</code></pre></div>
<p>The output:</p>
<div class="highlight"><pre><span></span><code>Default Master Page
Draw Page shapes:
  Shape service: com.sun.star.presentation.TitleTextShape; z-order: 0
  Shape service: com.sun.star.presentation.OutlinerShape; z-order: 1
  Shape service: com.sun.star.presentation.DateTimeShape; z-order: 2
  Shape service: com.sun.star.presentation.FooterShape; z-order: 3
  Shape service: com.sun.star.presentation.SlideNumberShape;z-order:4
</code></pre></div>
<p>A new master page is created  by using XMasterPagesSupplier.getMasterPages() and
XDrawPages.insertNewByIndex(), as shown in Draw.insertMasterPage():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDrawPage</span> <span class="nf">insertMasterPage</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="c1">// creates new master page at the given index position,</span>
<span class="p">{</span>
  <span class="n">XMasterPagesSupplier</span> <span class="n">mpSupp</span> <span class="o">=</span>
                          <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMasterPagesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="n">XDrawPages</span> <span class="n">pgs</span> <span class="o">=</span> <span class="n">mpSupp</span><span class="p">.</span><span class="na">getMasterPages</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">pgs</span><span class="p">.</span><span class="na">insertNewByIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of insertMasterPage()</span>
</code></pre></div>
<p>The new master page contains no presentation shapes (unlike the default one). They
must be added separately.</p>
<h3 id="23-modifying-a-master-page">2.3.  Modifying a Master Page<a class="headerlink" href="#23-modifying-a-master-page" title="Permanent link">&para;</a></h3>
<p>MastersUse.java changes the default master page in three ways: it adds text to the
footer shape (which is empty by default), and places a blue rectangle and some text in
the top-left corner of the master:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in main() of MastersUse.java</span>
<span class="c1">// set the master page&#39;s footer text</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">setMasterFooter</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="s">&quot;Master Use Slides&quot;</span><span class="p">);</span>

<span class="c1">// add a rectangle and text to the default master page</span>
<span class="c1">// at the top-left of the slide</span>
<span class="n">Size</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideSize</span><span class="p">(</span><span class="n">masterPage</span><span class="p">);</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">drawRectangle</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Width</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="o">/</span><span class="mi">6</span><span class="p">);</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">drawText</span><span class="p">(</span><span class="n">masterPage</span><span class="p">,</span> <span class="s">&quot;Default Master Page&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
</code></pre></div>
<p>Draw.setMasterFooter() searches through the shapes on the page looking for a
FooterShape. The shape is cast to a text interface, and a string added:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in Draw</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setMasterFooter</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">master</span><span class="p">,</span> <span class="n">String</span> <span class="n">text</span><span class="p">)</span>
<span class="c1">// set the master page&#39;s footer text</span>
<span class="p">{</span>
  <span class="n">XShape</span> <span class="n">footerShape</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">findShapeByType</span><span class="p">(</span><span class="n">master</span><span class="p">,</span>
                          <span class="s">&quot;com.sun.star.presentation.FooterShape&quot;</span><span class="p">);</span>
  <span class="n">XText</span> <span class="n">textField</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XText</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">footerShape</span><span class="p">);</span>
  <span class="n">textField</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setMasterFooter()</span>
</code></pre></div>
<p>MastersUse's second master page contains no shapes initially. An ellipse and some
text are added to it in the same way as for the default master page:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in main() of MastersUse.java</span>
<span class="n">XDrawPage</span> <span class="n">masterPage2</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">insertMasterPage</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="p">:</span>
<span class="c1">// put ellipse and text on master page 2</span>
<span class="n">XShape</span> <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">drawEllipse</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                  <span class="n">sz</span><span class="p">.</span><span class="na">Width</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="o">/</span><span class="mi">6</span><span class="p">);</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="s">&quot;FillColor&quot;</span><span class="p">,</span> <span class="mh">0xCCFF33</span><span class="p">);</span> <span class="c1">// neon green</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">drawText</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">,</span> <span class="s">&quot;Master Page 2&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
</code></pre></div>
<p>Unlike the default master page, a number shape must be explicitly added to the
second master, by calling Draw.addSlideNumber():</p>
<div class="highlight"><pre><span></span><code><span class="n">Draw</span><span class="p">.</span><span class="na">addSlideNumber</span><span class="p">(</span><span class="n">masterPage2</span><span class="p">);</span>
</code></pre></div>
<p>It is implemented as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XShape</span> <span class="nf">addSlideNumber</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">)</span>
<span class="c1">// add slide number at bottom right (like on the default master)</span>
<span class="p">{</span>
  <span class="n">Size</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlideSize</span><span class="p">(</span><span class="n">slide</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">Draw</span><span class="p">.</span><span class="na">addPresShape</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="s">&quot;SlideNumberShape&quot;</span><span class="p">,</span>
          <span class="n">sz</span><span class="p">.</span><span class="na">Width</span><span class="o">-</span><span class="n">width</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="o">-</span><span class="n">height</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of addSlideNumber()</span>
</code></pre></div>
<p>Draw.addPresShape() creates a shape from the "com.sun.star.presentation" package:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XShape</span> <span class="nf">addPresShape</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">,</span>
                       <span class="n">String</span> <span class="n">shapeType</span><span class="p">,</span>
                       <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span> <span class="n">warnsPosition</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
  <span class="n">XShape</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                      <span class="s">&quot;com.sun.star.presentation.&quot;</span><span class="o">+</span><span class="n">shapeType</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">slide</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
    <span class="n">setPosition</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">setSize</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">shape</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addPresShape()</span>
</code></pre></div>
<h3 id="24-using-a-master-page">2.4.  Using a Master Page<a class="headerlink" href="#24-using-a-master-page" title="Permanent link">&para;</a></h3>
<p>New slides are automatically linked to the default master page, but properties must be
explicitly set in order for the master's date/time, footer, and page number to be visible
on the slide. For example, the footer and page number are drawn on a slide like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in main() of MastersUse.java</span>
<span class="n">XDrawPage</span> <span class="n">slide1</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
     <span class="p">:</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;IsPageNumberVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;IsFooterVisible&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>The relevant property for showing the date/time is "IsDateTimeVisible". All these
properties are define in the com.sun.star.presentation.DrawPage service.</p>
<p>A related property is "FooterText", which changes the footer text for a specific slide.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">slide1</span><span class="p">,</span> <span class="s">&quot;FooterText&quot;</span><span class="p">,</span> <span class="s">&quot;MU Slides&quot;</span><span class="p">);</span>
</code></pre></div>
<p>However, this only works if the linked master page doesn't have its own footer text.</p>
<p>A slide can be linked to a different master by calling Draw.setMasterPage():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in main() of MastersUse.java</span>
<span class="c1">// link third slide to second master</span>
<span class="n">XDrawPage</span> <span class="n">slide3</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">setMasterPage</span><span class="p">(</span><span class="n">slide3</span><span class="p">,</span> <span class="n">masterPage2</span><span class="p">);</span>
</code></pre></div>
<p>It uses the XMasterPageTarget interface to create the new link:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setMasterPage</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">,</span> <span class="n">XDrawPage</span> <span class="n">mPg</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XMasterPageTarget</span> <span class="n">mpTarget</span> <span class="o">=</span>
                <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMasterPageTarget</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">slide</span><span class="p">);</span>
  <span class="n">mpTarget</span><span class="p">.</span><span class="na">setMasterPage</span><span class="p">(</span><span class="n">mPg</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="3-adding-a-slide-to-a-deck">3.  Adding a Slide to a Deck<a class="headerlink" href="#3-adding-a-slide-to-a-deck" title="Permanent link">&para;</a></h2>
<p>The last section used XDrawPages.insertNewByIndex() to add a master page to the
deck The same method is more commonly employed to add an ordinary slide.</p>
<p>An example is shown in ModifySlides.java: its main() function opens a file, adds a
title-only slide at the end of the deck, and a title/subtitle slide at the beginning. It
finishes by saving the modified deck to a new file:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: ModifySlides fnm&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Info</span><span class="p">.</span><span class="na">isDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS_SERVICE</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;-- not a slides presentation&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XDrawPages</span> <span class="n">slides</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlides</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="c1">// add a title-only slide with a graphic at the end</span>
  <span class="n">XDrawPage</span> <span class="n">lastPage</span> <span class="o">=</span> <span class="n">slides</span><span class="p">.</span><span class="na">insertNewByIndex</span><span class="p">(</span><span class="n">numSlides</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">titleOnlySlide</span><span class="p">(</span><span class="n">lastPage</span><span class="p">,</span> <span class="s">&quot;Any Questions?&quot;</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">drawImage</span><span class="p">(</span><span class="n">lastPage</span><span class="p">,</span> <span class="s">&quot;questions.png&quot;</span><span class="p">);</span>

  <span class="c1">// add a title/subtitle slide at the start</span>
  <span class="n">XDrawPage</span> <span class="n">firstPage</span> <span class="o">=</span> <span class="n">slides</span><span class="p">.</span><span class="na">insertNewByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                            <span class="c1">// this is added after first slide!</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">titleSlide</span><span class="p">(</span><span class="n">firstPage</span><span class="p">,</span> <span class="s">&quot;Interesting Slides&quot;</span><span class="p">,</span> <span class="s">&quot;Andrew&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;_Mod.&quot;</span> <span class="o">+</span>
                                     <span class="n">Info</span><span class="p">.</span><span class="na">getExt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>But if you examine the new file, you'll see that the title/subtitle slide has become the
second slide in the deck. This highlights a restriction on
XDrawPages.insertNewByIndex(), which is that a new slide cannot be inserted at
index position 0. Instead, it will be inserted at the next spot, position 1.</p>
<h2 id="4-rearranging-a-slide-deck">4.  Rearranging a Slide Deck<a class="headerlink" href="#4-rearranging-a-slide-deck" title="Permanent link">&para;</a></h2>
<p>A surprising gap in the presentation API is the lack of a simple way  to rearrange
slides: for example, to move the second slide to the fifth position.</p>
<p>The closest the API comes is the ability to duplicate a slide, but the copy is always
inserted after the original, so isn't of much use. If you did want to do this, the code
would be something like:</p>
<div class="highlight"><pre><span></span><code><span class="n">XDrawPageDuplicator</span> <span class="n">dup</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDrawPageDuplicator</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">XDrawPage</span> <span class="n">dupSlide</span> <span class="o">=</span> <span class="n">dup</span><span class="p">.</span><span class="na">duplicate</span><span class="p">(</span><span class="n">slide</span><span class="p">);</span>
      <span class="c1">// dupSlide is located after original slide in the deck</span>
</code></pre></div>
<p>The only way to rearrange slides inside Office is with dispatch commands, in
particular with the "Copy" and "Paste" commands. This is complicated by the fact that
copying an entire slide is only possible when the deck is displayed in slide-sorter
mode.</p>
<p>The CopySlide.java example illustrates the technique but, as with most uses of
dispatching, is quite fragile. The better answer is to utilize a third-part API, the ODF
Toolkit, which is the topic of Chapter 51.</p>
<p>CopySlide.java is called with three arguments – the filename and two slide indices.</p>
<p>The first index is the source slide's position in the deck, and the second is the position
after which the copied slide will appear. For instance:</p>
<div class="highlight"><pre><span></span><code>&gt; run CopySlide points.odp 1 4
</code></pre></div>
<p>will copy the second slide of the deck to after the fifth slide.</p>
<p>The main() function of CopySlide.java:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: CopySlide fnm from-index to-index&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open the file: &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">fromIdx</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">toIdx</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">numSlides</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlidesCount</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">fromIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">toIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">fromIdx</span> <span class="o">&gt;=</span> <span class="n">numSlides</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">toIdx</span> <span class="o">&gt;=</span> <span class="n">numSlides</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;One or both indices are out of range&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="n">copyTo</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">fromIdx</span><span class="p">,</span> <span class="n">toIdx</span><span class="p">);</span>
  <span class="c1">// Draw.deleteSlide(doc, fromIdx);</span>
      <span class="c1">// a problem if the copying changes the indices</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>   <span class="c1">// overwrite</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>All the interesting stuff is performed by copyTo(). One minor thing to note is the call
to Lo.save() which causes the changed slide deck to be saved back to its original file.</p>
<p>It is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XStorable</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XStorable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">store</span><span class="p">.</span><span class="na">store</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saved the document by overwriting&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not save the document&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of save()</span>
</code></pre></div>
<p>I usually avoid calling Lo.save() due to the fact that it overwrites the input file; I
prefer to create a new file to hold changes.</p>
<p>I've commented out the call to Draw.deleteSlide() in main() due to its potential to
cause damage. The problem is that the new slide may cause the overall indexing of
the slide deck to change. For example, consider what happens if the fourth slide is
copied to after the second slide. This will create a new third slide, moving the old
third slide, and all later slides, to the right. If the program now deletes the fourth slide,
that's not the slide that's just been copied, but the repositioned third slide.</p>
<p>The copyTo() function in CopySlide.java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopySlide.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">copyTo</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fromIdx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">toIdx</span><span class="p">)</span>
<span class="cm">/* Copy fromIdx slide to the clipboard in slide-sorter mode,</span>
<span class="cm">   then paste it to after the toIdx slide.</span>

<span class="cm">*/</span>
<span class="p">{</span> <span class="n">XController</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DiaMode&quot;</span><span class="p">);</span>
      <span class="c1">// Switch to slide-sorter view so that slides can be copied</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>   <span class="c1">// give Office plenty of time to do it</span>

  <span class="n">XDrawPage</span> <span class="n">fromSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">fromIdx</span><span class="p">);</span>
  <span class="n">XDrawPage</span> <span class="n">toSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">toIdx</span><span class="p">);</span>

  <span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">fromSlide</span><span class="p">);</span>  <span class="c1">// select this slide</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Copied &quot;</span> <span class="o">+</span> <span class="n">fromIdx</span><span class="p">);</span>

  <span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">toSlide</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Paste&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Pasted to after &quot;</span> <span class="o">+</span> <span class="n">toIdx</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DrawingMode&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of copyTo()</span>
</code></pre></div>
<p>The method sends out four dispatches: the "DiaMode" command switches the
application into slide-sorter mode, and is followed by "Copy", "Paste", and finally
"DrawingMode" which switches the mode back to normal.</p>
<p>There are a few complications. One is that Draw.gotoPage() must be called twice. The
first call ensures that the source slide is the visible, active window before the "Copy"
is processed. The second Draw.gotoPage() call makes sure the destination slide is now
visible. This means that "Paste" will insert the copied slide after the destination slide,
as required.</p>
<p>I usually call Draw.gotoPage() with a document argument (e.g. Draw.gotoPage(doc,
fromSlide)). This does not work correctly for the pasting of the slide, for reasons I'm
unsure about. The solution is to use a reference to the document's controller, as shown
in copyTo():</p>
<div class="highlight"><pre><span></span><code><span class="n">XController</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="p">:</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">fromSlide</span><span class="p">);</span>
  <span class="p">:</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">toSlide</span><span class="p">);</span>
</code></pre></div>
<h2 id="5-appending-slide-decks-together">5.  Appending Slide Decks Together<a class="headerlink" href="#5-appending-slide-decks-together" title="Permanent link">&para;</a></h2>
<p>A common Office forum question is how to add the slides of one deck to the end of
another. One solution is to use "Copy" and "Paste" dispatches as in section 4, but in a
more complicated fashion. As you might guess, the ODF Toolkit library described in
Chapter 51 is a better solution, but I'll focus on using Office here.</p>
<p>This approach means that two application windows could be open at the same time:
one containing the deck that is being copied, and another for the destination slide
deck. This requires references to two different application views and frames, which
can be a problem because of the design of my utility classes.</p>
<p>Another problem is caused by the issue of master page copying. When a slide using a
different master page is copied to a deck, Impress will query the user with an
'Adaption' dialog asking if the copied slide's format (i.e. its master page) should be
copied over to the destination deck. The dialog looks like Figure 5.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-5.png" /></p>
<p>Figure 5. Adaption Dialog.</p>
<p>If you want the format of the copied deck to be retained in its new location, then you
have to click the "Yes" button.  Carrying out this clicking action programmatically
requires stepping outside the Office API, and using JNA to interact with the dialog
box.</p>
<p>The resulting code is in the AppendSlides.java example. The main() function mostly
processes the program's command line arguments, a list of filenames. The first file is
the destination deck for the slides copied from the other files:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// globals: controller and frame for the destination deck</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XController</span> <span class="n">toCtrl</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XFrame</span> <span class="n">toFrame</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: AppendSlides fnm1 fnm2 ...&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open first file: &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="c1">// controller and frame refs for the destination deck</span>
  <span class="n">toCtrl</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">toFrame</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getFrame</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">toFrame</span><span class="p">,</span> <span class="s">&quot;DiaMode&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="c1">// Switch to slide-sorter view so that slides can be pasted</span>

  <span class="n">XDrawPages</span> <span class="n">toSlides</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlides</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="c1">// process the other files on the command line</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// start at 1</span>
    <span class="n">XComponent</span> <span class="n">appDoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">appDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open the file: &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">appendDoc</span><span class="p">(</span><span class="n">toSlides</span><span class="p">,</span> <span class="n">appDoc</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;_Append.&quot;</span> <span class="o">+</span>
                                     <span class="n">Info</span><span class="p">.</span><span class="na">getExt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">toFrame</span><span class="p">,</span> <span class="s">&quot;PageMode&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
             <span class="c1">// back to normal mode (does not work)</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>Note that the controller and frame reference for the destination deck are saved as
globals. I've done this to reduce the number of arguments passed between the
functions.</p>
<p>The for-loop in the middle of main() processes each of the slide decks in turn,
appending their slides to the destination deck.</p>
<p>appendDoc() accesses a slide deck in a second Impress window, which means that a
second controller and frame reference are needed; they're stored in fromCtrl and
fromFrame:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in AppendSlides.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">appendDoc</span><span class="p">(</span><span class="n">XDrawPages</span> <span class="n">toSlides</span><span class="p">,</span> <span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="cm">/* Append doc to the end of toSlides.</span>

<span class="cm">   Access the slides in the document, and the</span>
<span class="cm">   document&#39;s controller and frame refs.</span>

<span class="cm">   Switch to slide-sorter view so that slides can be copied.</span>

<span class="cm">*/</span>
<span class="p">{</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="c1">// get this document&#39;s controller and frame refs</span>
  <span class="n">XController</span> <span class="n">fromCtrl</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">XFrame</span> <span class="n">fromFrame</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getFrame</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">fromFrame</span><span class="p">,</span> <span class="s">&quot;DiaMode&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
          <span class="c1">// switch this document to slide-sorter mode</span>

  <span class="n">XDrawPages</span> <span class="n">fromSlides</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlides</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">fromSlides</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;- No slides found&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;- Adding slides&quot;</span><span class="p">);</span>
    <span class="n">appendSlides</span><span class="p">(</span><span class="n">toSlides</span><span class="p">,</span> <span class="n">fromSlides</span><span class="p">,</span> <span class="n">fromCtrl</span><span class="p">,</span> <span class="n">fromFrame</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">fromFrame</span><span class="p">,</span> <span class="s">&quot;PageMode&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
       <span class="c1">// change back to normal slide view (does not work)</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of appendDoc()</span>
</code></pre></div>
<p>appendDoc() calls appendSlides() to cycle through the slides, copying each one to the
destination deck:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in AppendSlides.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">appendSlides</span><span class="p">(</span><span class="n">XDrawPages</span> <span class="n">toSlides</span><span class="p">,</span>
                                 <span class="n">XDrawPages</span> <span class="n">fromSlides</span><span class="p">,</span>
                    <span class="n">XController</span> <span class="n">fromCtrl</span><span class="p">,</span> <span class="n">XFrame</span> <span class="n">fromFrame</span><span class="p">)</span>
<span class="cm">/* Append fromSlides to the end of toSlides</span>
<span class="cm">   Loop through the fromSlides, copying each one.</span>

<span class="cm">*/</span>
<span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fromSlides</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">XDrawPage</span> <span class="n">fromSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">fromSlides</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">XDrawPage</span> <span class="n">toSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">toSlides</span><span class="p">,</span>
                                    <span class="n">toSlides</span><span class="p">.</span><span class="na">getCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
         <span class="c1">// the copy of fromSlide will be placed *after* toSlide</span>
    <span class="n">copyTo</span><span class="p">(</span><span class="n">fromSlide</span><span class="p">,</span><span class="n">fromCtrl</span><span class="p">,</span><span class="n">fromFrame</span><span class="p">,</span> <span class="n">toSlide</span><span class="p">,</span><span class="n">toCtrl</span><span class="p">,</span><span class="n">toFrame</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of appendSlides()</span>
</code></pre></div>
<p>The for-loop in appendSlides() calls copyTo() which copies and pastes a slide using
dispatch commands. In addition, it deals with the 'Adaption' dialog in Figure 5.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in AppendSlides.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">copyTo</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">fromSlide</span><span class="p">,</span>
                           <span class="n">XController</span> <span class="n">fromCtrl</span><span class="p">,</span> <span class="n">XFrame</span> <span class="n">fromFrame</span><span class="p">,</span>
                           <span class="n">XDrawPage</span> <span class="n">toSlide</span><span class="p">,</span>
                           <span class="n">XController</span> <span class="n">toCtrl</span><span class="p">,</span> <span class="n">XFrame</span> <span class="n">toFrame</span><span class="p">)</span>
<span class="c1">// copy fromSlide to *after* toSlide</span>
<span class="p">{</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">fromCtrl</span><span class="p">,</span> <span class="n">fromSlide</span><span class="p">);</span>  <span class="c1">// select this slide</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;-- Copy --&gt; &quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">fromFrame</span><span class="p">,</span> <span class="s">&quot;Copy&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

  <span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">toCtrl</span><span class="p">,</span> <span class="n">toSlide</span><span class="p">);</span>   <span class="c1">// select this slide</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Paste&quot;</span><span class="p">);</span>

  <span class="c1">// wait for &quot;Adaption&quot; dialog and click it</span>
  <span class="n">Thread</span> <span class="n">monitorThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
      <span class="n">clickWindow</span><span class="p">(</span><span class="s">&quot;LibreOffice&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">monitorThread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">toFrame</span><span class="p">,</span> <span class="s">&quot;Paste&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of copyTo()</span>
</code></pre></div>
<p>The dialog is handled by starting a Java thread which executes clickWindow(). This
waits for the dialog by suspending until a window with a title starting with
"LibreOffice" appears. I chose this string since it's what appears at the start of the
dialog's title bar in Figure 5:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in AppendSlides.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">clickWindow</span><span class="p">(</span><span class="n">String</span> <span class="n">windowTitle</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">HWND</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">JNAUtils</span><span class="p">.</span><span class="na">findTitledWin</span><span class="p">(</span><span class="n">windowTitle</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">handle</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="n">Rectangle</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">JNAUtils</span><span class="p">.</span><span class="na">getBounds</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">xCenter</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="mi">64</span><span class="p">;</span>   <span class="c1">// hard-wired loc for &quot;Yes&quot;</span>
  <span class="kt">int</span> <span class="n">yCenter</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span> <span class="mi">91</span><span class="p">;</span>
  <span class="n">JNAUtils</span><span class="p">.</span><span class="na">doClick</span><span class="p">(</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="n">xCenter</span><span class="p">,</span> <span class="n">yCenter</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of clickWindow()</span>
</code></pre></div>
<p>JNAUtils.findTitledWin() returns a handle to the window it has detected. The bounds
of the window are obtained, and a click event is sent to the (64, 91) coordinate inside
that window. These 'magic' coordinates are the location of the "Yes" button in the
dialog. This is both ugly and fragile since the position is almost certain to change
across different platforms and versions of Office.</p>
<p>Let's also not forget that if the title of the "Adaption" dialog changes in a future
version of Office, then JNAUtils.findTitledWin() may end up looking forever for the
window.</p>
<p>The AppendSlides.java and CopySlide.java examples highlight important missing
features in the presentation API. Copying and pasting a slide in a deck should be
available as methods in XDrawPages.</p>
<p>If you need a robust way of doing these tasks, I suggest looking at the ODF Toolkit
library in Chapter 51.</p>
<h2 id="6-exporting-a-slide-as-an-image">6.  Exporting a Slide as an Image<a class="headerlink" href="#6-exporting-a-slide-as-an-image" title="Permanent link">&para;</a></h2>
<p>A drawing or slide can be exported as an image by using the GraphicExportFilter
service and its XGraphicExportFilter interface. The service is represented in Figure 6.</p>
<p><img alt="" src="images/17-Slide_Deck_Manipulation-6.png" /></p>
<p>Figure 6. The GraphicExportFilter Service, Interfaces, and Methods.</p>
<p>In older documentation, such as the Developer's Guide, there's no mention of
XGraphicExportFilter. The guide claims that GraphicExportFilter directly supports
XExporter, XFilter, and XMimeTypeInfo. Use <code>lodoc XGraphicExportFilter</code> to
access the online documentation for the interface.</p>
<p>The Slides2Image.java example reads three arguments from the command line: the
filename of the slide deck, the index number of the slide, and the format used for
saving the slide's image. For example:</p>
<div class="highlight"><pre><span></span><code>&gt; run Slide2Image algs.ppt 2 png
</code></pre></div>
<p>The index number value may be a source of confusion since slides are numbered from
1 inside Impress' GUI, but from 0 in the API. In this case, '2' means the third slide in
the deck.</p>
<p>The main() function for Slide2Image.java:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: Slide2Image fnm index imageFormat&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">String</span> <span class="n">fnm</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">imFormat</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XDrawPage</span> <span class="n">slide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">slide</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">getMimeTypes</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Known GraphicExportFilter mime types:&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">names</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>

  <span class="n">String</span> <span class="n">outFnm</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">fnm</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">imFormat</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving page &quot;</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">+</span> <span class="s">&quot; to \&quot;&quot;</span> <span class="o">+</span><span class="n">outFnm</span><span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">mime</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">changeToMime</span><span class="p">(</span><span class="n">imFormat</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">savePage</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="n">outFnm</span><span class="p">,</span> <span class="n">mime</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>The example uses two mime functions: Images.getMimeTypes() and
Images.changeToMime(). The first returns an array of all the mime types supported
by GraphicExportFilter by calling XMimeTypeInfo.getSupportedMimeTypeNames():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Images class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getMimeTypes</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XMimeTypeInfo</span> <span class="n">mi</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XMimeTypeInfo</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
             <span class="s">&quot;com.sun.star.drawing.GraphicExportFilter&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">mi</span><span class="p">.</span><span class="na">getSupportedMimeTypeNames</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>The printed array is:</p>
<div class="highlight"><pre><span></span><code>Known GraphicExportFilter mime types:
  image/x-MS-bmp
  image/x-emf
  image/x-eps
  image/gif
  image/jpeg
  image/x-met
  image/x-portable-bitmap
  image/x-pict
  image/x-portable-graymap
  image/png
  image/x-portable-pixmap
  image/x-cmu-raster
  image/svg+xml
  image/x-svm
  image/tiff
  image/x-wmf
  image/x-xpixmap
</code></pre></div>
<p>Images.changeToMime() looks through the mime array for a type that contains the
supplied format as a substring:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Images class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">changeToMime</span><span class="p">(</span><span class="n">String</span> <span class="n">imFormat</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">getMimeTypes</span><span class="p">();</span>
  <span class="n">String</span> <span class="n">imf</span> <span class="o">=</span> <span class="n">imFormat</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">names</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">imf</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Using mime type: &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No matching mime type, so using image/png&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="s">&quot;image/png&quot;</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of changeToMime()</span>
</code></pre></div>
<p>Draw.savePage() creates an XGraphicExportFilter object, configuring it with the page
to be exported and the mime type filter:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">savePage</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">page</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span>
                                         <span class="n">String</span> <span class="n">mimeType</span><span class="p">)</span>
<span class="p">{</span> <span class="n">String</span> <span class="n">saveFileURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">saveFileURL</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving page in &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>

  <span class="c1">// create graphics exporter</span>
  <span class="n">XGraphicExportFilter</span> <span class="n">gef</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XGraphicExportFilter</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                     <span class="s">&quot;com.sun.star.drawing.GraphicExportFilter&quot;</span><span class="p">);</span>

  <span class="c1">// set the output &#39;document&#39; to be specified page</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">page</span><span class="p">);</span>
  <span class="n">gef</span><span class="p">.</span><span class="na">setSourceDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>    <span class="c1">// link exporter to the document</span>

  <span class="c1">// export the page by converting to the specified mime type</span>
  <span class="n">PropertyValue</span> <span class="n">props</span><span class="o">[]</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;MediaType&quot;</span><span class="p">,</span> <span class="n">mimeType</span><span class="p">,</span>
                                          <span class="s">&quot;URL&quot;</span><span class="p">,</span> <span class="n">saveFileURL</span><span class="p">);</span>
  <span class="n">gef</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Export completed&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of savePage()</span>
</code></pre></div>
<p>The name of the XExporter.setSourceDocument() method is a bit misleading since its
input argument should either be an XDrawPage (a slide, as here), XShape (a shape on
the slide), or an XShapes object (a collection of shapes on a slide).</p>
<p>XFilter.filter() exports the slide (or shape), based on values supplied in a properties
array. The array should contain the mime type and the URL of the output file.</p>
<h2 id="7-extracting-the-text-from-a-slide-deck">7.  Extracting the Text from a Slide Deck<a class="headerlink" href="#7-extracting-the-text-from-a-slide-deck" title="Permanent link">&para;</a></h2>
<p>Draw.getShapesText() supports the fairly common task of extracting all the text from
a presentation. It is used by the ExtractText.java example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// from ExtractText.java</span>
     <span class="p">:</span>
<span class="k">if</span> <span class="p">(</span><span class="n">Draw</span><span class="p">.</span><span class="na">isShapesBased</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getShapesText</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;----- Text Content -----&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;------------------------&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Extraction unsupported&quot;</span><span class="p">);</span>
    <span class="p">:</span>
</code></pre></div>
<p>Draw.getShapesText() calls getOrderedShapes() to collect all the shapes from all the
slides in the document. It then iterates over the shapes list, converting each shape to
text and adding it to a StringBuffer:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getShapesText</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">xShapes</span> <span class="o">=</span> <span class="n">getOrderedShapes</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XShape</span> <span class="n">xShape</span> <span class="p">:</span> <span class="n">xShapes</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">getShapeText</span><span class="p">(</span><span class="n">xShape</span><span class="p">);</span>
    <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getShapeText()</span>
</code></pre></div>
<p>Draw.getShapeText() pulls the text from a shape by casting it to a text interface, then
uses a cursor to select the text:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getShapeText</span><span class="p">(</span><span class="n">XShape</span> <span class="n">xShape</span><span class="p">)</span>
<span class="c1">// get text from inside a shape</span>
<span class="p">{</span>
  <span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XText</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xShape</span><span class="p">);</span>
  <span class="n">XTextCursor</span> <span class="n">xTextCursor</span> <span class="o">=</span> <span class="n">xText</span><span class="p">.</span><span class="na">createTextCursor</span><span class="p">();</span>
  <span class="n">XTextRange</span> <span class="n">xTextRange</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextRange</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xTextCursor</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">xTextRange</span><span class="p">.</span><span class="na">getString</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getShapeText()</span>
</code></pre></div>
<p>getOrderedShapes() iterates over each slide in the document calling another version of
itself to extract the shapes from a slide:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="nf">getOrderedShapes</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="c1">//  get shapes from all pages of the doc</span>
<span class="p">{</span>
  <span class="n">XDrawPage</span><span class="o">[]</span> <span class="n">slides</span> <span class="o">=</span> <span class="n">getSlidesArr</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">slides</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span> <span class="p">:</span> <span class="n">slides</span><span class="p">)</span>
    <span class="n">shapes</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span> <span class="n">getOrderedShapes</span><span class="p">(</span><span class="n">slide</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">shapes</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getOrderedShapes()</span>
</code></pre></div>
<p>The ordering of the shapes in a slide may not match their reading order  (i.e. top-
down, left-to-right). For example, I read a slide by first looking at the text in the
TitleShape, before reading the bullets below in the OutlinerShape. However,
TitleShape may be stored at the end of the slide's container.</p>
<p>getOrderedShapes() deals with the problem by extracting all the shapes from the slide
into a list, and then sorting it based on each shape's z-order. A shape with z-order 0
will be moved before a shape with z-order 1. This almost always corresponds to the
user's reading order of the shapes. For example, TitleShape usually has a z-order of 0.</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="nf">getOrderedShapes</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">)</span>
<span class="c1">//  get all the shapes on the slide in increasing z-order</span>
<span class="p">{</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">getShapes</span><span class="p">(</span><span class="n">slide</span><span class="p">);</span>
  <span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="n">XShape</span> <span class="n">s1</span><span class="p">,</span> <span class="n">XShape</span> <span class="n">s2</span><span class="p">)</span>
     <span class="p">{</span>  <span class="k">return</span> <span class="p">(</span><span class="n">getZOrder</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">getZOrder</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>  <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="n">shapes</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getOrderedShapes()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getZOrder</span><span class="p">(</span><span class="n">XShape</span> <span class="n">shape</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="p">(</span><span class="n">Integer</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s">&quot;ZOrder&quot;</span><span class="p">);</span>  <span class="p">}</span>
</code></pre></div>
<p>getShapes() extracts all the shapes from a slide as a list:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="nf">getShapes</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">slide</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">slide</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Slide is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">slide</span><span class="p">.</span><span class="na">getCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Slide does not contain any shapes&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">slide</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">shapes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">slide</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Shapes extraction error in slide&quot;</span><span class="p">);</span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">shapes</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getShapes()</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="16-Making_Slides.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 16. Making Slides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 16. Making Slides
            </div>
          </div>
        </a>
      
      
        
        <a href="18-Slide_Shows.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 18. Slide Shows" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 18. Slide Shows
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>