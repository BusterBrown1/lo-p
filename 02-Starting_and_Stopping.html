
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 2. Starting and Stopping - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-2-starting-and-stopping" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 2. Starting and Stopping
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 2. Starting and Stopping
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="02-Starting_and_Stopping.html" class="md-nav__link md-nav__link--active">
        Chapter 2. Starting and Stopping
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-starting-office" class="md-nav__link">
    1.  Starting Office
  </a>
  
    <nav class="md-nav" aria-label="1.  Starting Office">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick-look-at-sockets" class="md-nav__link">
    A Quick Look at Sockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-closing-downkilling-office" class="md-nav__link">
    2.  Closing Down/Killing Office
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-opening-a-document" class="md-nav__link">
    3.  Opening a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-document" class="md-nav__link">
    4.  Creating a Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-second-service-manager" class="md-nav__link">
    A Second Service Manager
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-saving-a-document" class="md-nav__link">
    5.  Saving a Document
  </a>
  
    <nav class="md-nav" aria-label="5.  Saving a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-a-filter-name" class="md-nav__link">
    What's a Filter Name?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-closing-a-document" class="md-nav__link">
    6.  Closing a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-a-general-purpose-converter" class="md-nav__link">
    7.  A General Purpose Converter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bug-detection-and-reporting" class="md-nav__link">
    8.  Bug Detection and Reporting
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-starting-office" class="md-nav__link">
    1.  Starting Office
  </a>
  
    <nav class="md-nav" aria-label="1.  Starting Office">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick-look-at-sockets" class="md-nav__link">
    A Quick Look at Sockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-closing-downkilling-office" class="md-nav__link">
    2.  Closing Down/Killing Office
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-opening-a-document" class="md-nav__link">
    3.  Opening a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-document" class="md-nav__link">
    4.  Creating a Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-second-service-manager" class="md-nav__link">
    A Second Service Manager
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-saving-a-document" class="md-nav__link">
    5.  Saving a Document
  </a>
  
    <nav class="md-nav" aria-label="5.  Saving a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-a-filter-name" class="md-nav__link">
    What's a Filter Name?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-closing-a-document" class="md-nav__link">
    6.  Closing a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-a-general-purpose-converter" class="md-nav__link">
    7.  A General Purpose Converter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bug-detection-and-reporting" class="md-nav__link">
    8.  Bug Detection and Reporting
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/02-Starting_and_Stopping.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-2-starting-and-stopping">Chapter 2. Starting and Stopping<a class="headerlink" href="#chapter-2-starting-and-stopping" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Starting Office;
Closing Down/Killing
Office; Opening a
Document; Creating a
Document; Saving;
Closing; Document
Conversion; Bug
Detection and Reporting</p>
<p>Example folders: "Office
Tests" and "Utils"</p>
</div>
<p>Chapter 1 introduced some of the core ideas of Office.
Now it's time to show how these data structures and
relationships (e.g. service, interfaces, FCM, inheritance)
are programmed in Office's Java API.</p>
<p>This chapter will focus on the most fundamental tasks:
starting Office, loading (or creating) a document, saving
and closing the document, and shutting down Office. The
DocConverter.java example at the end pulls these together to show how to convert a
document into another format.</p>
<p>All the examples come from the "Office Tests" directory in the code download
associated with this book, and make liberal use of the classes in the "Utils" directory.
For details please visit <a href="http://fivedots.coe.psu.ac.th/~ad/jlop/">http://fivedots.coe.psu.ac.th/~ad/jlop/</a>.</p>
<p>My aim with these utilities is to hide some of the verbiage of Office. When (if?) a
programmer feels ready for more detail, then my code is documented. I'll only explain
functions here that illustrate Office ideas, such as service managers and components.</p>
<p>This is the first chapter with code, and so the first where programs could crash!
Section 8 gives a few tips on bug detection and reporting.</p>
<h2 id="1-starting-office">1.  Starting Office<a class="headerlink" href="#1-starting-office" title="Permanent link">&para;</a></h2>
<p>Every program must load Office before working with a document, and shut it down
before exiting. These tasks are handled by loadOffice() and closeOffice() from the Lo
utility class. A typical program will look like the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sun.star.uno.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.lang.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.frame.*</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OfficeInfo</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

    <span class="c1">// load, manipulate and close a document</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span> <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of OfficeInfo class</span>
</code></pre></div>
<p>Lo.loadOffice() invokes Office and sets up a UNO bridge using named pipes. There's
also a Lo.loadSocketOffice() which uses sockets instead of pipes. Both functions
return a reference to a component loader which can be used to load a document.</p>
<p>loadOffice() and loadSocketOffice() call a one-argument version of loadOffice()
which uses a boolean to decide whether to use pipes or sockets to link to Office. In
both cases, a remote component context is created on the Java side (see Chapter 1,
Figure 2) and then a service manager, Desktop object, and component loader are
initialized. The code below shows some details:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XComponentContext</span> <span class="n">xcc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XDesktop</span> <span class="n">xDesktop</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiComponentFactory</span> <span class="n">mcFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XComponentLoader</span> <span class="nf">loadOffice</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">usingPipes</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Loading Office...&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">usingPipes</span><span class="p">)</span>
    <span class="n">xcc</span> <span class="o">=</span> <span class="n">bootstrapContext</span><span class="p">();</span> <span class="c1">// connects to office via pipes</span>
  <span class="k">else</span>
    <span class="n">xcc</span> <span class="o">=</span> <span class="n">socketContext</span><span class="p">();</span>    <span class="c1">// connects to office via a socket</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xcc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Office context could not be created&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// get the remote office service manager</span>
  <span class="n">mcFactory</span> <span class="o">=</span> <span class="n">xcc</span><span class="p">.</span><span class="na">getServiceManager</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mcFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Office Service Manager is unavailable&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// desktop service handles application windows and documents</span>
  <span class="n">xDesktop</span> <span class="o">=</span> <span class="n">createInstanceMCF</span><span class="p">(</span><span class="n">XDesktop</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                               <span class="s">&quot;com.sun.star.frame.Desktop&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xDesktop</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a desktop service&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// XComponentLoader provides ability to load components</span>
  <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponentLoader</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xDesktop</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of loadOffice()</span>
</code></pre></div>
<p>loadOffice() probably illustrates my most significant coding decisions – the use of
global static variables inside the Lo class. In particular, the XComponentContext,
XDesktop, and XMultiComponentFactory objects created by loadOffice() are stored
globally for later use. I chose this approach since it allows other support functions to
be called with simpler arguments because the objects can be accessed without the user
having to explicitly pass around references to them. The main drawback is that
loadOffice() cannot be safely called more than once (i.e. it is non-reentrant) since a
second call will overwrite the globals set during the first call.</p>
<p>The creation of the XDesktop interface object uses createInstanceMCF():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">createInstanceMCF</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">aType</span><span class="p">,</span>
                                            <span class="n">String</span> <span class="n">serviceName</span><span class="p">)</span>
<span class="p">{</span> <span class="k">if</span> <span class="p">((</span><span class="n">xcc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">mcFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No office connection found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">T</span> <span class="n">interfaceObj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>   <span class="c1">// get service, then interface</span>
    <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">mcFactory</span><span class="p">.</span><span class="na">createInstanceWithContext</span><span class="p">(</span><span class="n">serviceName</span><span class="p">,</span> <span class="n">xcc</span><span class="p">);</span>
    <span class="n">interfaceObj</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">aType</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t create interface for \&quot;&quot;</span> <span class="o">+</span>
                                      <span class="n">serviceName</span> <span class="o">+</span> <span class="s">&quot;\&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">interfaceObj</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of createInstanceMCF()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">qi</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">aType</span><span class="p">,</span> <span class="n">Object</span> <span class="n">o</span><span class="p">)</span>
<span class="c1">// the &quot;Loki&quot; function -- reduces typing</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">UnoRuntime</span><span class="p">.</span><span class="na">queryInterface</span><span class="p">(</span><span class="n">aType</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>  <span class="p">}</span>
</code></pre></div>
<p>If you ignore the error-checking, createInstanceMCF() does two things. The call to
XMultiComponentFactory.createInstanceWithContext() asks the service manager
(mcFactory) to create a service object inside the remote component context (xcc).
Then the call to UnoRuntime.queryInterface() looks inside the service instance for the
specified interface (aType), returning an instance of the interface as its result.</p>
<p>My Lo.qi() function's only purpose is to reduce programmer typing, since calls to
UnoRuntime.queryInterface() are very common.</p>
<p>The use of generics makes createInstanceMCF() useful for creating any type of
interface object. Unfortunately, generics aren't utilized in the Office API, which relies
instead on Object, Office's Any class, or the XInterface class which is inherited by all
interfaces.</p>
<h4 id="a-quick-look-at-sockets">A Quick Look at Sockets<a class="headerlink" href="#a-quick-look-at-sockets" title="Permanent link">&para;</a></h4>
<p>Note: you can skip this section if socket communication with Office isn't of interest.</p>
<p>loadOffice() starts by calling bootstrapContext() or socketContext() to create a remote
component context. bootstrapContext() is very short since it build a UNO bridge
based on named pipes using Office's Bootstrap class. However, I also implemented a
socket-based bridge, in Lo.socketContext(). The steps it performs are:
* invoke Office as a process using sockets;
* create a local component context and service manager (local in the sense of
being in the Java process);
* connect to Office via its socket. I use the Connector service, but another
approach is to employ the UnoUrlResolver service;
* layer a UNO bridge on top of the socket link;
* retrieve a reference to the remote component context via the UNO bridge
(remote in the sense that it refers across process boundaries to Office).</p>
<p>Office's own Bootstrap class implements a similar sequence of steps for linking to
Office via pipes. It starts Office by calling Java's Runtime.exec(), and I've used the
same approach, but assumed that soffice.exe is part of Window's PATH environment
variable. The relevant code fragment is:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span><span class="o">[]</span> <span class="n">cmdArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>
<span class="n">cmdArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;soffice&quot;</span><span class="p">;</span>
<span class="n">cmdArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;-headless&quot;</span><span class="p">;</span>
<span class="n">cmdArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;-accept=socket,host=localhost,port=&quot;</span> <span class="o">+</span>
                                       <span class="n">SOCKET_PORT</span> <span class="o">+</span> <span class="s">&quot;;urp;&quot;</span><span class="p">;</span>
<span class="n">Process</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">exec</span><span class="p">(</span><span class="n">cmdArray</span><span class="p">);</span>
</code></pre></div>
<p>SOCKET_PORT has the value 8100. Since this port number is fixed, it’s possible to
check the socket’s status outside Office. For example, on Windows, I type:
<code>netstat | grep 8100</code>
If you wondering where grep comes from, I got it from gow
(<a href="https://github.com/bmatzelle/gow">https://github.com/bmatzelle/gow</a>), a light-weight installer of UNIX command line
utilities for Windows.</p>
<h2 id="2-closing-downkilling-office">2.  Closing Down/Killing Office<a class="headerlink" href="#2-closing-downkilling-office" title="Permanent link">&para;</a></h2>
<p>Lo.closeOffice() shuts down Office by calling terminate() on the XDesktop instance
created inside loadOffice():
<code>boolean isDead = xDesktop.terminate()</code>
This is usually sufficient but occasionally I've found it necessary to delay the
terminate() call for a few milliseconds in order to give Office components time to
finish. I noticed this especially when using an OfficeBean panel for displaying
documents (which I'll describe much later in Chapter 44). As a consequence,
Lo.closeDown() may actually call terminate() a few times, until it returns true.</p>
<p>While developing/debugging code, it's quite easy to inadvertently trigger a runtime
exception in the Office API. In the worst case, this can cause your program to exit
without calling Lo.closeDown(). This will leave an extraneous Office process running
in the OS, which should be killed. The easiest way is with a Windows batch file
containing:
<code>taskkill /f /t /im soffice.exe</code></p>
<p>This uses the fact that the office process is called soffice.exe. Another useful batch
script is one that checks only if the process is running:
<code>tasklist /FI "IMAGENAME eq soffice.exe"</code></p>
<p>These are packaged up as lokill.bat and lolist.bat in my code. So if you're unsure if
Office is really dead, type:
<code>lokill</code>
at a command prompt.</p>
<p>The Unix shell script versions of these files could use killall, pkill, ps, or kill.</p>
<p>Lo.killOffice() inelegantly terminates Office by calling the lokill.bat script from
inside Java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">killOffice</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;cmd /c lokill.bat&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Killed Office&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to kill Office: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of killOffice()</span>
</code></pre></div>
<p>The code is nasty since it relies on there being a cmd.exe OS tool and a lokill.bat
batch file in the current directory.</p>
<h2 id="3-opening-a-document">3.  Opening a Document<a class="headerlink" href="#3-opening-a-document" title="Permanent link">&para;</a></h2>
<p>The general format of a program that opens a document, manipulates it in some way,
and then saves it, is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// use the Office API to manipulate doc...</span>


  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;foo.docx&quot;</span><span class="p">);</span>  <span class="c1">// save as a Word file</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>The new methods are Lo.openDoc(), Lo.saveDoc(), and Lo.closeDoc().</p>
<p>openDoc() calls XComponentLoader.loadComponentFromURL(), which requires a
document URL, the type of Office frame used to display the document, optional
search flags, and an array of document properties. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">fileURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
<span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;Hidden&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span>
         <span class="n">loader</span><span class="p">.</span><span class="na">loadComponentFromURL</span><span class="p">(</span><span class="n">fileURL</span><span class="p">,</span> <span class="s">&quot;_blank&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
</code></pre></div>
<p>The frame type is almost always "_blank" which indicates that a new window will be
created for the newly loaded document. (Other possibilities are listed in the
XComponentLoader documentation which you can access with <code>lodoc XComponentLoader</code>.)
The search flags are usually set to 0, and document properties
are stored in the PropertyValue array, props.</p>
<p>loadComponentFromURL()'s return type is XComponent, which refers to the
document.</p>
<p>FileIO.fnmToURL() converts an ordinary filename (e.g. “foo.doc”) into a URL (a full
path prefixed with file:///).</p>
<p>Props.makeProps() takes a property name and value and returns a PropertyValue
array; there are several variants which accept different numbers of property name-
value pairs.</p>
<p>A complete list of document properties can be found in the MediaDescriptor
documentation (accessed with <code>lodoc MediaDescriptor service</code>), but some of the
important ones are listed in Table 1.</p>
<table>
<thead>
<tr>
<th>Property Name</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>AsTemplate</td>
<td>Creates a new document using a specified template</td>
</tr>
<tr>
<td>Hidden</td>
<td>Determines if the document is invisible after being loaded</td>
</tr>
<tr>
<td>ReadOnly</td>
<td>Opens the document read-only</td>
</tr>
<tr>
<td>StartPresentation</td>
<td>Starts showing a slide presentation immediately after loading the document</td>
</tr>
</tbody>
</table>
<p>Table 1. Some Document Properties.</p>
<h2 id="4-creating-a-document">4.  Creating a Document<a class="headerlink" href="#4-creating-a-document" title="Permanent link">&para;</a></h2>
<p>A new document is created by calling
XComponentLoader.loadComponentFromURL() with a special URL string for the
document type. The possible strings are listed in Table 2.</p>
<table>
<thead>
<tr>
<th>URL String</th>
<th>Document Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>"private:factory/swriter"</td>
<td>Writer</td>
</tr>
<tr>
<td>"private:factory/sdraw"</td>
<td>Draw</td>
</tr>
<tr>
<td>"private:factory/simpress"</td>
<td>Impress</td>
</tr>
<tr>
<td>"private:factory/scalc"</td>
<td>Calc</td>
</tr>
<tr>
<td>"private:factory/sdatabase"</td>
<td>Base</td>
</tr>
<tr>
<td>"private:factory/swriter/web"</td>
<td>HTML document in Writer</td>
</tr>
<tr>
<td>"private:factory/swriter/GlobalDocument"</td>
<td>A Master document in Writer</td>
</tr>
<tr>
<td>"private:factory/schart"</td>
<td>Chart</td>
</tr>
<tr>
<td>"private:factory/smath"</td>
<td>Math Formulae</td>
</tr>
<tr>
<td>".component:Bibliography/View1"</td>
<td>Bibliography Entries</td>
</tr>
<tr>
<td>".component:DB/QueryDesign"</td>
<td>Database User Interfaces</td>
</tr>
<tr>
<td>".component:DB/TableDesign"</td>
<td></td>
</tr>
<tr>
<td>".component:DB/RelationDesign"</td>
<td></td>
</tr>
<tr>
<td>".component:DB/DataSourceBrowser"</td>
<td></td>
</tr>
<tr>
<td>".component:DB/FormGridView"</td>
<td></td>
</tr>
</tbody>
</table>
<p>Table 2. URLs for Creating New Documents.</p>
<p>For instance, a Writer document is created by:</p>
<div class="highlight"><pre><span></span><code><span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span>
     <span class="n">loader</span><span class="p">.</span><span class="na">loadComponentFromURL</span><span class="p">(</span><span class="s">&quot;private:factory/swriter&quot;</span><span class="p">,</span>
                                 <span class="s">&quot;_blank&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
</code></pre></div>
<p>The utility classes include code for simplifying the creation of Writer, Draw, Impress,
Calc, and Base documents, which I'll be looking at in later chapters.</p>
<h5 id="a-second-service-manager">A Second Service Manager<a class="headerlink" href="#a-second-service-manager" title="Permanent link">&para;</a></h5>
<p>Lo.loadDoc() and Lo.createDoc() do a bit of additional work after document
loading/creation – they instantiate a XMultiServiceFactory service manager which is
stored in the Lo class. This is done by applying Lo.qi() to the document:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// global in Lo.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiServiceFactory</span> <span class="n">msFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// in loadDoc()</span>
<span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span>
      <span class="n">loader</span><span class="p">.</span><span class="na">loadComponentFromURL</span><span class="p">(</span><span class="n">fileURL</span><span class="p">,</span> <span class="s">&quot;_blank&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
<span class="n">msFactory</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMultiServiceFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
</code></pre></div>
<p>I first employed Lo.qi() in createInstanceMCF() to access an interface inside a
service. This time qi() is casting one interface (XComponent) to another
(XMultiServiceFactory).</p>
<p>The XMultiServiceFactory object is the second service manager we've encountered;
the first was an XMultiComponentFactory instance, created during Office's loading.</p>
<p>The reasons for Office having two service managers are historical: the
XMultiServiceFactory manager is older, and creates a service object without the need
for an explicit reference to the remote component context.</p>
<p>As Office developed, it was decided that service object creation should always be
relative to an explicit component context, and so the newer XMultiComponentFactory
service manager came into being. A lot of older code still uses the
XMultiServiceFactory service manager, so both are supported in the Lo class.</p>
<p>Another difference between the managers is that the XMultiComponentFactory
manager is available as soon as Office is loaded, while the XMultiServiceFactory
manager is initialized only when a document is loaded or created.</p>
<h2 id="5-saving-a-document">5.  Saving a Document<a class="headerlink" href="#5-saving-a-document" title="Permanent link">&para;</a></h2>
<p>One of the great strengths of Office is that it can export a document in a vast number
of formats, but the programmer must specify the output format (which is called a filter
in the Office documentation).</p>
<p>XStorable.storeToURL() takes the name of the output file (in URL format), and an
array of properties, one of which should be "FilterName". Two other useful output
properties are "Overwrite" and "Password". Input and output document properties are
listed in the MediaDescriptor service documentation (<code>lodoc MediaDescriptor service</code>).</p>
<p>If "Overwrite" is set to true then the file will be saved without prompting the user if
the file already exists. The "Password" property contains a string which must be
entered into an Office dialog by the user before the file can be opened again.</p>
<p>The steps in saving a file are:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">saveFileURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">nms</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="p">{</span><span class="s">&quot;Overwrite&quot;</span><span class="p">,</span> <span class="s">&quot;FilterName&quot;</span><span class="p">,</span> <span class="s">&quot;Password&quot;</span><span class="p">};</span>
<span class="n">Object</span><span class="o">[]</span> <span class="n">vals</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="kc">true</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">password</span><span class="p">};</span>
<span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">storeProps</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="n">nms</span><span class="p">,</span> <span class="n">vals</span><span class="p">);</span>

<span class="n">XStorable</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XStorable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">store</span><span class="p">.</span><span class="na">storeToURL</span><span class="p">(</span><span class="n">saveFileURL</span><span class="p">,</span> <span class="n">storeProps</span><span class="p">);</span>
</code></pre></div>
<p>I've used a variant of the Props.makeProps() method to create an array of three
properties. If you don't want a password, then the third property should be left out.</p>
<p>Lo.qi() is used again to cast an interface, this time from XComponent to XStoreable.</p>
<p>Figure 5 in Chapter 1 shows that XStoreable is part of the OfficeDocument service,
which means that it's inherited by all Office document types.</p>
<h4 id="whats-a-filter-name">What's a Filter Name?<a class="headerlink" href="#whats-a-filter-name" title="Permanent link">&para;</a></h4>
<p>XStorable.storeToURL() needs a "FilterName" property value, but what should the
string be to export the document in Word format for example?</p>
<p>Info.getFilterNames() returns an array of all the filter names supported by Office.</p>
<p>There's an example call in OfficeInfo.java, but is commented out because it returns a
250+ element list!</p>
<p>Rather than force a programmer to search through this list for the correct name,
Lo.saveDoc() allows him to supply just the name and extension of the output file. For
example, in section 3, Lo.saveDoc() was called like so:</p>
<div class="highlight"><pre><span></span><code><span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;foo.docx&quot;</span><span class="p">);</span>
</code></pre></div>
<p>saveDoc() extracts the file extension (i.e. "docx") and maps it to a corresponding filter
name in Office (in this case, "Office Open XML Text"). One concern is that it's not
always clear which extension-to-filter mapping should be utilized. For instance,
another suitable filter name for "docx" is "MS Word 2007 XML". I've essentially
ignored this problem, by hardwiring a fixed selection into saveDoc().</p>
<p>Another issue is that the choice of filter sometimes depends on the extension and the
document type. For example, a Writer document saved as a PDF file should use the
filter "writer_pdf_Export", but if the document is a spreadsheet then
"calc_pdf_Export" is the correct choice. Consequently, saveDoc() examines both the
extension and the document's service name, which is accessed via the XServiceInfo
interface:</p>
<div class="highlight"><pre><span></span><code><span class="n">XServiceInfo</span> <span class="n">xInfo</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XServiceInfo</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="kt">boolean</span> <span class="n">isWriter</span> <span class="o">=</span>     <span class="c1">// is it a Writer doc?</span>
        <span class="n">xInfo</span><span class="p">.</span><span class="na">supportsService</span><span class="p">(</span><span class="s">&quot;com.sun.star.text.TextDocument&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The main document service names are listed in Table 3.</p>
<table>
<thead>
<tr>
<th>Document</th>
<th>Type Service Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Writer</td>
<td>com.sun.star.text.TextDocument</td>
</tr>
<tr>
<td>Draw</td>
<td>com.sun.star.drawing.DrawingDocument</td>
</tr>
<tr>
<td>Impress</td>
<td>com.sun.star.presentation.PresentationDocument</td>
</tr>
<tr>
<td>Calc</td>
<td>com.sun.star.sheet.SpreadsheetDocument</td>
</tr>
<tr>
<td>Base</td>
<td>com.sun.star.sdb.OfficeDatabaseDocument</td>
</tr>
</tbody>
</table>
<p>Table 3. Document Service Names.</p>
<p>We encountered these service names back in Chapter 1, Figure 8 – they're subclasses
of the OfficeDocument service.</p>
<p>A third problem is incompletness; I've only implemented saveDoc() mappings for a
small subset of Office's 250+ filter names, so if you try to save a file with an exotic
extension then my code will most likely break.</p>
<p>If you want to study the details, start with Lo.saveDoc(), and burrow down; the
trickiest part is Lo.ext2Format().</p>
<h2 id="6-closing-a-document">6.  Closing a Document<a class="headerlink" href="#6-closing-a-document" title="Permanent link">&para;</a></h2>
<p>Closing a document is a pain if you want to check with the user beforehand: should a
modified file be saved, thereby overwriting the old version? My solution is not to
bother the user, so the file is closed without saving, irrespective of any modifications.
In other words, it's essential to explicitly save a changed document with
Lo.saveDoc() before calling Lo.closeDoc().</p>
<p>The code for closing employs Lo.qi() to cast the document's XComponent interface to
XCloseable:</p>
<div class="highlight"><pre><span></span><code><span class="n">XCloseable</span> <span class="n">closeable</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XCloseable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">closeable</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>   <span class="c1">// doc. closed without saving</span>
</code></pre></div>
<h2 id="7-a-general-purpose-converter">7.  A General Purpose Converter<a class="headerlink" href="#7-a-general-purpose-converter" title="Permanent link">&para;</a></h2>
<p>The DocConverter.java example in "Office Tests/" takes two command line
arguments: the name of an input file and the extension that should be used when
saving the loaded document. For instance:</p>
<div class="highlight"><pre><span></span><code><span class="n">run</span> <span class="n">DocConverter</span> <span class="n">points</span><span class="p">.</span><span class="na">ppt</span> <span class="n">odp</span>
</code></pre></div>
<p>will save slides in MS PowerPoint format as an Impress presentation. The following
converts a JPEG image into PNG:
<div class="highlight"><pre><span></span><code><span class="n">run</span> <span class="n">DocConverter</span> <span class="n">skinner</span><span class="p">.</span><span class="na">jpg</span> <span class="n">png</span>
</code></pre></div></p>
<p>The code for DocConverter is short:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sun.star.uno.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.lang.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.frame.*</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocConverter</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: DocConverter fnm extension&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span> <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of DocConverter class</span>
</code></pre></div>
<h2 id="8-bug-detection-and-reporting">8.  Bug Detection and Reporting<a class="headerlink" href="#8-bug-detection-and-reporting" title="Permanent link">&para;</a></h2>
<p>This chapter began our coding with the Office API, and so the possibility of bugs also
becomes an issue. If you find a problem with one of my support classes (e.g. in
Lo.java) or one of my examples (e.g. in DocConverter.java), then please contact me at
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#64;&#102;&#105;&#118;&#101;&#100;&#111;&#116;&#115;&#46;&#99;&#111;&#101;&#46;&#112;&#115;&#117;&#46;&#97;&#99;&#46;&#116;&#104;">&#97;&#100;&#64;&#102;&#105;&#118;&#101;&#100;&#111;&#116;&#115;&#46;&#99;&#111;&#101;&#46;&#112;&#115;&#117;&#46;&#97;&#99;&#46;&#116;&#104;</a>, supplying as much detail as possible.</p>
<p>Another source of bugs is the LibreOffice API itself, which is hardly a surprise
considering its complexity and age. If you find a problem, then you should first search
LibreOffice's Bugzilla site at <a href="https://bugs.documentfoundation.org/">https://bugs.documentfoundation.org/</a> to see if the
problem has been reported previously (it probably has). Various types of search are
explained in the Bugzilla documentation at
<a href="https://bugs.documentfoundation.org/docs/en/html/using/">https://bugs.documentfoundation.org/docs/en/html/using/</a>
If you want to report a new bug, then you'll need to set up an account, which is quite
simple, and also explained by the documentation.</p>
<p>Often when people report bugs they don't include enough information, perhaps
because the error window displayed by Windows is somewhat lacking. For example, a
typical crash report window  is shown in Figure 1.</p>
<p><img alt="" src="images/02-Starting_and_Stopping-1.png" /></p>
<p>Figure 1. The LibreOffice Crash Reported by Windows 7.</p>
<p>If you're going to make an official report, you should first read the article "How to
Report Bugs in LibreOffice" (<a href="https://wiki.documentfoundation.org/QA/BugReport">https://wiki.documentfoundation.org/QA/BugReport</a>).</p>
<p>Expert forum members and Bugzilla maintainers sometimes point people towards
WinDbg for Windows as a tool for producing good debugging details. The wiki has a
detailed explanation of how to install and use it
(<a href="https://wiki.documentfoundation.org/How_to_get_a_backtrace_with_WinDbg">https://wiki.documentfoundation.org/How_to_get_a_backtrace_with_WinDbg</a>),
which is a bit scary in its complexity.</p>
<p>A much easier alternative is the <code>WinCrashReport</code> application from NirSoft
(<a href="http://www.nirsoft.net/utils/application_crash_report.html">http://www.nirsoft.net/utils/application_crash_report.html</a>). It presents the Windows
Error Reporting (WER) data generated by a crash in a readable form.</p>
<p>When a crash window appears (like the one in Figure 1), start WinCrashReport to
examine the automatically-generated error report, as in Figure 2.</p>
<p><img alt="" src="images/02-Starting_and_Stopping-2.png" /></p>
<p>Figure 2. WinCrashReport GUI</p>
<p>Figure 2 indicates that the problem lies inside mergedlo.dll, an access violation (the
exception code 0xC0000005) to a memory address.</p>
<p>mergedlo.dll is part of LibreOffice which probably means that you can find the DLL
in <OFFICE>/program. Most Office DLLs are located in that directory, but it's useful
to have a fast file search utility on your machine to find files that might be in third-
party libraries or in Windows. I use <code>SwiftSearch</code>
(<a href="https://sourceforge.net/projects/swiftsearch/">https://sourceforge.net/projects/swiftsearch/</a>).</p>
<p>WinCrashReport generates two alternative call stacks, with slightly more information
in the second in this case. mergedlo.dll is called by the uno_getCurrentEnvironment()
function in cppu3.dll, as indicated in Figure 3.</p>
<p><img alt="" src="images/02-Starting_and_Stopping-3.png" /></p>
<p>Figure 3. The Second Call Stack in WinCrashReport.</p>
<p>This narrows the problem to a specific function and two DLLs, which is very helpful.</p>
<p>If you want to better understand the DLLs, they can be examined using <code>DLL Export
Viewer</code>, another NirSoft tool (<a href="http://www.nirsoft.net/utils/dll_export_viewer.html">http://www.nirsoft.net/utils/dll_export_viewer.html</a>),
which lists a DLL's exported functions. Running it on mergedlo.dll turns up nothing,
but the details for cppu3.dll are shown in Figure 4.</p>
<p><img alt="" src="images/02-Starting_and_Stopping-4.png" /></p>
<p>Figure 4. DLL Export Viewer's view of cppu3.dll</p>
<p>mergedlo.dll appears to be empty inside DLL Export Viewer because it exports no
functions. That probably means it's being used as a store for resources, such as icons,
cursors, and images. There's another NirSoft tool for looking at DLL resources, called
ResourcesExtract (<a href="http://www.nirsoft.net/utils/resources_extract.html">http://www.nirsoft.net/utils/resources_extract.html</a>).</p>
<p>The offending function must be uno_getCurrentEnvironment() which Figure 4
confirms to be in cppu3.dll.</p>
<p>Looking at the Source Code
You might want to narrow the problem down further by looking at
uno_getCurrentEnvironment()'s source. This is easy with  the "OpenGrok for
LibreOffice" website (<a href="http://opengrok.libreoffice.org/">http://opengrok.libreoffice.org/</a>) for searching the gigantic code
base. Figure 5 shows the results for an "uno_getCurrentEnvironment" search.</p>
<p><img alt="" src="images/02-Starting_and_Stopping-5.png" /></p>
<p>Figure 5. OpenGrok Results for "uno_getCurrentEnvironment"</p>
<p>The function's code is in EnvStack.cxx, which can be examined by clicking on the
linked function name shown at the bottom of Figure 5.</p>
<p>If you're interested in exploring the code base more widely, there are some very good
blog posts about it by Eilidh McAdam: "Exploring the LibreOffice code base"
(<a href="http://www.lanedo.com/exploring-the-libreoffice-code-base/">http://www.lanedo.com/exploring-the-libreoffice-code-base/</a>) and "LibreOffice
Development Howto" (<a href="http://www.lanedo.com/libreoffice-development-howto/">http://www.lanedo.com/libreoffice-development-howto/</a>).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="01-Concepts.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 1. LibreOffice API Concepts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 1. LibreOffice API Concepts
            </div>
          </div>
        </a>
      
      
        
        <a href="03-Examining.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 3. Examining" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 3. Examining
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>