
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/43-Using_the_Clipboard.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 43. Using the Clipboard - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-43-using-the-clipboard" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 43. Using the Clipboard
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 43. Using the Clipboard
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="43-Using_the_Clipboard.html" class="md-nav__link md-nav__link--active">
        Chapter 43. Using the Clipboard
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-office-clipboard-api" class="md-nav__link">
    1.  The Office Clipboard API
  </a>
  
    <nav class="md-nav" aria-label="1.  The Office Clipboard API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-adding-data-to-the-clipboard" class="md-nav__link">
    1.1.  Adding Data to the Clipboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-retrieving-data-from-the-clipboard" class="md-nav__link">
    1.2.  Retrieving Data from the Clipboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-adding-and-retrieving-text" class="md-nav__link">
    1.3.  Adding and Retrieving Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-adding-and-retrieving-an-image" class="md-nav__link">
    1.3.  Adding and Retrieving an Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-adding-and-retrieving-an-image-from-a-file" class="md-nav__link">
    1.4.  Adding and Retrieving an Image from a File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-javas-clipboard-api" class="md-nav__link">
    2.  Java's Clipboard API
  </a>
  
    <nav class="md-nav" aria-label="2.  Java's Clipboard API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-adding-and-retrieving-text" class="md-nav__link">
    2.1.  Adding and Retrieving Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-adding-and-retrieving-an-image" class="md-nav__link">
    2.2.  Adding and Retrieving an Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-adding-and-retrieving-a-2d-array" class="md-nav__link">
    2.3.  Adding and Retrieving a 2D Array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-more-details-on-the-java-clipboard-api" class="md-nav__link">
    2.4.  More Details on the Java Clipboard API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-copy-and-pasting-in-an-office-document" class="md-nav__link">
    3.  Copy and Pasting in an Office Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-copy-and-pasting-in-a-writer-document" class="md-nav__link">
    4.  Copy and Pasting in a Writer Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Copy and Pasting in a Writer Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visible-cut-and-paste-of-text" class="md-nav__link">
    Visible Cut-and-Paste of Text
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-copy-and-pasting-in-a-calc-document" class="md-nav__link">
    5.  Copy and Pasting in a Calc Document
  </a>
  
    <nav class="md-nav" aria-label="5.  Copy and Pasting in a Calc Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visible-cut-and-paste-of-cells" class="md-nav__link">
    Visible Cut-and-Paste of Cells
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-copy-and-pasting-in-an-impress-document" class="md-nav__link">
    5.  Copy and Pasting in an Impress Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-copy-and-pasting-in-base-data" class="md-nav__link">
    6.  Copy and Pasting in Base Data
  </a>
  
    <nav class="md-nav" aria-label="6.  Copy and Pasting in Base Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-invisible-cut-and-paste-of-data" class="md-nav__link">
    The Invisible Cut-and-Paste of Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-office-clipboard-api" class="md-nav__link">
    1.  The Office Clipboard API
  </a>
  
    <nav class="md-nav" aria-label="1.  The Office Clipboard API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-adding-data-to-the-clipboard" class="md-nav__link">
    1.1.  Adding Data to the Clipboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-retrieving-data-from-the-clipboard" class="md-nav__link">
    1.2.  Retrieving Data from the Clipboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-adding-and-retrieving-text" class="md-nav__link">
    1.3.  Adding and Retrieving Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-adding-and-retrieving-an-image" class="md-nav__link">
    1.3.  Adding and Retrieving an Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-adding-and-retrieving-an-image-from-a-file" class="md-nav__link">
    1.4.  Adding and Retrieving an Image from a File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-javas-clipboard-api" class="md-nav__link">
    2.  Java's Clipboard API
  </a>
  
    <nav class="md-nav" aria-label="2.  Java's Clipboard API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-adding-and-retrieving-text" class="md-nav__link">
    2.1.  Adding and Retrieving Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-adding-and-retrieving-an-image" class="md-nav__link">
    2.2.  Adding and Retrieving an Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-adding-and-retrieving-a-2d-array" class="md-nav__link">
    2.3.  Adding and Retrieving a 2D Array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-more-details-on-the-java-clipboard-api" class="md-nav__link">
    2.4.  More Details on the Java Clipboard API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-copy-and-pasting-in-an-office-document" class="md-nav__link">
    3.  Copy and Pasting in an Office Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-copy-and-pasting-in-a-writer-document" class="md-nav__link">
    4.  Copy and Pasting in a Writer Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Copy and Pasting in a Writer Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visible-cut-and-paste-of-text" class="md-nav__link">
    Visible Cut-and-Paste of Text
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-copy-and-pasting-in-a-calc-document" class="md-nav__link">
    5.  Copy and Pasting in a Calc Document
  </a>
  
    <nav class="md-nav" aria-label="5.  Copy and Pasting in a Calc Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visible-cut-and-paste-of-cells" class="md-nav__link">
    Visible Cut-and-Paste of Cells
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-copy-and-pasting-in-an-impress-document" class="md-nav__link">
    5.  Copy and Pasting in an Impress Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-copy-and-pasting-in-base-data" class="md-nav__link">
    6.  Copy and Pasting in Base Data
  </a>
  
    <nav class="md-nav" aria-label="6.  Copy and Pasting in Base Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-invisible-cut-and-paste-of-data" class="md-nav__link">
    The Invisible Cut-and-Paste of Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/main/docs/43-Using_the_Clipboard.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-43-using-the-clipboard">Chapter 43. Using the Clipboard<a class="headerlink" href="#chapter-43-using-the-clipboard" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>The Office
Clipboard API: adding,
retrieving, text, images;
Java's Clipboard API
adding, retrieving, text,
images, 2D arrays;
Copy and Pasting in an
Office Document:
Writer, Calc, Impress,
Base</p>
<p>Example folders:
"Clipboard Tests" and
"Utils"</p>
</div>
<p>The clipboard has appeared a few times in previous
chapters, notably in the CopySlide.java example of
Chapter 17, section 4 – I used Lo.dispatchCmd("Copy") to
copy a slide, then a "Paste" dispatch to add it to the slide
deck in a different position. The example in section 5 of
Chapter 17 (AppendSlides.java) is even hackier since it
employs "Copy" and "Paste" dispatches and JNA to click
on a dialog box.</p>
<p>The programs are "hacky" because they interact with the
OSes windows and dialogs. The "Copy" dispatch asks the OS to copy the highlighted
data in the currently active window into the clipboard. My code precedes the dispatch
by bringing the necessary window to the front on the desktop, but there's no way for
Office to force that selection to be honored. For example, in the short interval before
the "Copy" dispatch is sent, it's possible for the user to click the mouse in a different
window, making it the active window rather than the one containing the slide.</p>
<p>Another issue with this approach is timing – a dispatchCmd() call from the Office API
returns as soon as the message is passed to the OS, but that's not the same as the
message being processed by the OS. The dispatch has to be routed back to the
application and executed, which may take many milliseconds. For instance, changing
Impress from drawing mode (the default) to slide sorter mode can sometimes take
over a second, especially the first time the mode is used. In the meantime, my code
will continue executing, assuming that Office is in a state that it hasn’t yet reached.</p>
<p>The only simple solution is the liberal scattering of Lo.wait() calls after dispatches to
hopefully slow the API's execution enough so that the dispatches have been
processed.</p>
<p>You may be wondering why I use "Copy" and "Paste" dispatches when they're so
bothersome.</p>
<p>One reason is that there may be no other way of achieving the required result, as in
the Impress examples. (However, if you don’t mind using a third-party library, then
Apache ODF Toolkit offers a better solution; see Chapter 51, section 4.)
Another reason is that "Copy" automatically converts copied data into several useful
formats, which would require a lot of coding to duplicate. For example, a copied
block of spreadsheet cells is available through the clipboard as plain text, different
types of images, in two kinds of spreadsheet exchange format, and as an ODS file!
Nevertheless, it's best to avoid "Copy" and "Paste" dispatches where possible, and one
alternative is Office's clipboard API. Most (but not all) dispatch-based uses of copy
and paste can be replaced by the clipboard API which means that there's no need to
rely on OS-level windows being active and on Lo.wait() calls.</p>
<p>Office's clipboard API is modelled on Java's clipboard classes, and there are
advantages to using the Java API instead of Office when manipulating complex data.</p>
<p>As a consequence, I've developed two support classes, in Clip.java and JClip.java,
which contain helpful functions for using the Office clipboard API and the Java
version respectively.</p>
<p>After some short examples of manipulating the clipboard using the Office API and the
Java API, I'll look at four slightly longer programs that illustrate how the clipboard
can be utilized with a Writer document, a spreadsheet, slides, and a database.</p>
<p>One thing you might want to install before starting any clipboard programming is a
decent clipboard viewer. It's helpful for observing the data being copied and pasted by
the Office/Java code; I employ ClCl (
<a href="https://nakka.com/soft/clcl/index_eng.html">https://nakka.com/soft/clcl/index_eng.html</a>).</p>
<h2 id="1-the-office-clipboard-api">1.  The Office Clipboard API<a class="headerlink" href="#1-the-office-clipboard-api" title="Permanent link">&para;</a></h2>
<p>Office's clipboard API is located in the clipboard sub-module inside
com.sun.star.datatransfer, and utilizes several services and interfaces from its
datatransfer parent. Figure 1 shows the SystemClipboard service and its main
interfaces.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-1.png" /></p>
<p>Figure 1. The SystemClipboard Services and Interfaces.</p>
<p>If you browse the clipboard module, several classes, such as ClipboardManager,
XClipboardManager, and XClipboardFactory, suggest the possibility of creating local
clipboards that aren't accessible OS-wide like the system clipboard. Unfortunately, I
was unable to figure out how to create one, which parallels the problem that Java
programmers have creating local clipboards using the Java API.</p>
<p>Programming details about using the clipboard in Office can be found in chapter 6 of
the Development Guide in the section "Common Application Features". The guide
can be downloaded from
<a href="https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf">https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf</a>, or the
relevant section begins online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Common_Application_Features">https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Common_Application_Features</a>
(or use <code>loGuide "Common Application Features"</code>).</p>
<p>My Clip.getClip() support method illustrates how to get a reference to the system
clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="c1">//global</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XSystemClipboard</span> <span class="n">cb</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="c1">// used to store clipboard ref, so only one is created</span>
        <span class="c1">// by the methods here</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XSystemClipboard</span> <span class="nf">getClip</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cb</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">SystemClipboard</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">Lo</span><span class="p">.</span><span class="na">getContext</span><span class="p">());</span>
<span class="cm">/*</span>
<span class="cm">    cb.addClipboardListener( new XClipboardListener() {</span>
<span class="cm">      public void disposing(EventObject e) { }</span>

<span class="cm">      public void changedContents(ClipboardEvent e)</span>
<span class="cm">      { System.out.println(&quot;&gt;&gt;Clipboard has been updated&quot;);  }</span>
<span class="cm">    });</span>
<span class="cm">*/</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">cb</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getClip()</span>
</code></pre></div>
<p>A call to SystemClipboard.create() with the current context instantiates the
XSystemClipboard interface. It's possible to attach a XClipboardListener at this stage,
which will be triggered whenever the clipboard is updated. I didn't find that capability
useful in my examples, so commented it out.</p>
<p>The Clip class stores the clipboard reference as a static variable so multiple calls to
Clip.getClip() reuse the same reference.</p>
<h3 id="11-adding-data-to-the-clipboard">1.1.  Adding Data to the Clipboard<a class="headerlink" href="#11-adding-data-to-the-clipboard" title="Permanent link">&para;</a></h3>
<p>Data is added to and retrieved from the clipboard using XClipboard.setContents() and
XClipboard.getContents(), with the data represented by objects implementing the
XTransferable interface. My utilities include three concrete transferable classes:
TextTransferable, ImageTransferable, and FileTransferable, which I'll explain shortly.</p>
<p>The Clip class offers an addContents() method for adding transferable data to the
clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_TRIES</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">addContents</span><span class="p">(</span><span class="n">XTransferable</span> <span class="n">trf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_TRIES</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">getClip</span><span class="p">().</span><span class="na">setContents</span><span class="p">(</span><span class="n">trf</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">IllegalStateException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Problem accessing clipboard...&quot;</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to add contents&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addContents()</span>
</code></pre></div>
<p>The function attempts to add the transferable data to the clipboard three times before
returning false.</p>
<p>I've coded addContents() like this so that it matches the addContents() function in the
JClip class. One difference between the Office and Java clipboard APIs is that the
Java version of setContents() can raise an exception, and quite often fails when first
asked to write something large to the clipboard (see the next section). However,
repeating the request, after a short wait, succeeds. It felt prudent to use the same
defensive programming in the Office API even though the Office documentation
makes no mention of setContents() being able to raise an exception. In other words,
Clip.addContents() is a prime example of paranoid programming.</p>
<p>The clipboard remembers ownership, which is changed when data is added by a
different user or process. This can be employed at the programming level by attaching
an XClipboardOwner listener to the clipboard when XClipboard.setContents() adds
data. The listener will be triggered when data which changes the ownership is copied
to the clipboard. The following code fragment illustrates the technique:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// add data to the clipboard, and monitor ownership</span>
<span class="c1">// XSystemClipboard cb = ...</span>
<span class="n">cb</span><span class="p">.</span><span class="na">setContents</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">new</span> <span class="n">XClipboardOwner</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lostOwnership</span><span class="p">(</span><span class="n">XClipboard</span> <span class="n">board</span><span class="p">,</span>
                                  <span class="n">XTransferable</span> <span class="n">contents</span><span class="p">)</span>
       <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ownership is lost&quot;</span><span class="p">);</span>   <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The  lostOwnership() method is called with the clipboard reference and the tranferable
data just overwritten by the new owner. I didn't use this feature in my addContents()
function.</p>
<h3 id="12-retrieving-data-from-the-clipboard">1.2.  Retrieving Data from the Clipboard<a class="headerlink" href="#12-retrieving-data-from-the-clipboard" title="Permanent link">&para;</a></h3>
<p>XClipboard.getContents() copies data from the clipboard as an XTransferable
instance. One of the surprising, and useful, features of clipboard data is that it can
usually be manipulated in several different forms, such as plain text or a bitmap. This
means that the XTransferable extraction must state the required data format, which is
encoded as a DataFlavor object. The following code fragment illustrates the idea:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// XSystemClipboard cb = ...</span>
<span class="n">XTransferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">cb</span><span class="p">.</span><span class="na">getContents</span><span class="p">();</span>  <span class="c1">// get transferable</span>
<span class="n">DataFlavor</span> <span class="n">df</span> <span class="o">=</span> <span class="c1">// dataflavor for type of data required</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">df</span><span class="p">);</span>
</code></pre></div>
<p>A DataFlavor object is a mapping between a mime type string and an Office type. The
following example maps the "text/plain" mime type to Office's String class:</p>
<div class="highlight"><pre><span></span><code><span class="n">DataFlavor</span> <span class="n">df</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="s">&quot;text/plain;charset=utf-16&quot;</span><span class="p">,</span>
                       <span class="s">&quot;Unicode Text&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">Type</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">))</span>
</code></pre></div>
<p>The second argument of the DataFlavor constructor is a 'human representable' string
for the mime type.</p>
<h3 id="13-adding-and-retrieving-text">1.3.  Adding and Retrieving Text<a class="headerlink" href="#13-adding-and-retrieving-text" title="Permanent link">&para;</a></h3>
<p>My TextTransferable class implements the XTransferable interface for storing
Unicode data. It defines three methods from XTransferable:</p>
<ul>
<li>getTransferData(): this returns the data for a specified DataFlavor</li>
<li>getTransferDataFlavors(): this returns an array of DataFlavors representing the
data formats supported by this transferable</li>
<li>isDataFlavorSupported(): this returns true or false depending of if the supplied
DataFlavor is amongst those supported by the transferable</li>
</ul>
<p>The TextTransferable class:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Utils/ folder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextTransferable</span> <span class="kd">implements</span> <span class="n">XTransferable</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UNICODE_MIMETYPE</span> <span class="o">=</span>
                                <span class="s">&quot;text/plain;charset=utf-16&quot;</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">text</span><span class="p">;</span>


  <span class="kd">public</span> <span class="nf">TextTransferable</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
                                  <span class="kd">throws</span> <span class="n">UnsupportedFlavorException</span>
  <span class="c1">// return the data matching the df DataFlavor</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">UNICODE_MIMETYPE</span><span class="p">))</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedFlavorException</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">text</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="p">()</span>
  <span class="c1">// return an array of all the dataflavors supported</span>
  <span class="p">{</span>
    <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">dfs</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">UNICODE_MIMETYPE</span><span class="p">,</span> <span class="s">&quot;Unicode Text&quot;</span><span class="p">,</span>
                                       <span class="k">new</span> <span class="n">Type</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">dfs</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
  <span class="c1">// is the df DataFlavor supported by this transferable?</span>
  <span class="p">{</span>  <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">UNICODE_MIMETYPE</span><span class="p">);</span>  <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// end of TextTransferable class</span>
</code></pre></div>
<p>TextTransferable supports only the Unicode data format; its flavor maps the
"text/plain;charset=utf-16" mime type string to the String class.</p>
<p>The Clip support class has setText() and getText() methods for simplifying the use of
TextTransferable:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setText</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span> <span class="k">new</span> <span class="n">TextTransferable</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getText</span><span class="p">()</span>
<span class="p">{</span>  <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span><span class="s">&quot;text/plain;charset=utf-16&quot;</span><span class="p">);</span>  <span class="p">}</span>

<span class="n">The</span> <span class="nf">setText</span><span class="p">()</span> <span class="n">method</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">TextTransferable</span> <span class="n">constructor</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">a</span> <span class="n">string</span> <span class="n">into</span> <span class="n">a</span>
<span class="n">transferable</span> <span class="n">that</span> <span class="n">is</span> <span class="n">placed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">clipboard</span> <span class="n">by</span> <span class="n">my</span> <span class="nf">addContents</span><span class="p">()</span> <span class="n">method</span> <span class="n">from</span> <span class="n">above</span><span class="p">.</span>

<span class="nf">getText</span><span class="p">()</span> <span class="n">passes</span> <span class="n">a</span> <span class="n">mime</span> <span class="n">type</span> <span class="n">string</span> <span class="n">to</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span> <span class="n">which</span> <span class="n">copies</span> <span class="n">the</span> <span class="n">transferable</span>
<span class="n">from</span> <span class="n">the</span> <span class="n">clipboard</span><span class="p">,</span> <span class="n">and</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">mime</span> <span class="n">type</span> <span class="n">to</span> <span class="n">decide</span> <span class="n">which</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">data</span> <span class="n">format</span> <span class="n">to</span> <span class="n">use</span>
<span class="k">for</span> <span class="n">the</span> <span class="n">returned</span> <span class="n">data</span><span class="p">:</span>

<span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">getData</span><span class="p">(</span><span class="n">String</span> <span class="n">mimeStr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTransferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No transferable found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="n">DataFlavor</span> <span class="n">df</span> <span class="o">=</span> <span class="n">findFlavor</span><span class="p">(</span><span class="n">trf</span><span class="p">,</span> <span class="n">mimeStr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">df</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mime \&quot;&quot;</span> <span class="o">+</span> <span class="n">mimeStr</span> <span class="o">+</span> <span class="s">&quot;\&quot; not found&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not read clipboard: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getData()</span>
</code></pre></div>
<p>Clip.findFlavor() searches through the flavors associated with the transferable looking
for the mime type string supplied by the user:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">DataFlavor</span> <span class="nf">findFlavor</span><span class="p">(</span><span class="n">XTransferable</span> <span class="n">trf</span><span class="p">,</span>
                                    <span class="n">String</span> <span class="n">mimeStr</span><span class="p">)</span>
<span class="p">{</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferDataFlavors</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dfs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dfs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">mimeStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">dfs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Clip does not support mime: &quot;</span> <span class="o">+</span> <span class="n">mimeStr</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of findFlavor()</span>
</code></pre></div>
<p>The CPTests.java file shows an example of how to add and retrieve text from the
clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of CPTests.java...</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
   <span class="p">:</span>
<span class="n">Clip</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">Lo</span><span class="p">.</span><span class="na">getTimeStamp</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added text to clipboard&quot;</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Read clipboard: &quot;</span> <span class="o">+</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>
   <span class="p">:</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
</code></pre></div>
<h3 id="13-adding-and-retrieving-an-image">1.3.  Adding and Retrieving an Image<a class="headerlink" href="#13-adding-and-retrieving-an-image" title="Permanent link">&para;</a></h3>
<p>My ImageTransferable class implements XTransferable so a BufferedImage can be
stored on the clipboard. It defines the same three methods as TextTransferable, but its
data flavor maps the mime type "application/x-openoffice-
bitmap;windows_formatname="Bitmap"" to a byte array.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Utils/ folder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageTransferable</span> <span class="kd">implements</span> <span class="n">XTransferable</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">BITMAP_CLIP</span> <span class="o">=</span>
   <span class="s">&quot;application/x-openoffice-bitmap;windows_formatname=\&quot;Bitmap\&quot;&quot;</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">imBytes</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">ImageTransferable</span><span class="p">(</span><span class="n">BufferedImage</span> <span class="n">im</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">imBytes</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">im2bytes</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>   <span class="p">}</span>


  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
                          <span class="kd">throws</span> <span class="n">UnsupportedFlavorException</span>
  <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">BITMAP_CLIP</span><span class="p">))</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedFlavorException</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">imBytes</span><span class="p">;</span>
  <span class="p">}</span>  <span class="c1">// end of getTransferData()</span>


  <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="p">()</span>
  <span class="p">{</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">dfs</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">BITMAP_CLIP</span><span class="p">,</span> <span class="s">&quot;Bitmap&quot;</span><span class="p">,</span>
                                  <span class="k">new</span> <span class="n">Type</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">dfs</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
  <span class="p">{</span>  <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">BITMAP_CLIP</span><span class="p">);</span>  <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// end of ImageTransferable class</span>
</code></pre></div>
<p>My choice of mapping to a byte array may seem a bit strange, since it would make
more sense to associate the "bitmap" string with a BufferedImage. Unfortunately,
Office only supports String (used in TextTransferable) and byte[] (used here). This
contrasts with the greater flexibility of Java's clipboard API which allows any
serializable type to be used in a flavor. This will motivate my use of Java to transfer
2D arrays to and from the clipboard, as described in section 2.3.</p>
<p>I hide the use of ImageTransferable inside two Clip.java methods, setImage() and
getImage():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setImage</span><span class="p">(</span><span class="n">BufferedImage</span> <span class="n">im</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span><span class="k">new</span> <span class="n">ImageTransferable</span><span class="p">(</span><span class="n">im</span><span class="p">));</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedImage</span> <span class="nf">getImage</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XTransferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No transferable found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">DataFlavor</span> <span class="n">df</span> <span class="o">=</span> <span class="n">findImageFlavor</span><span class="p">(</span><span class="n">trf</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Images</span><span class="p">.</span><span class="na">bytes2im</span><span class="p">(</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span><span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not retrieve image: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getImage()</span>
</code></pre></div>
<p>getImage() transforms the byte array returned by
ImageTransferable.getTransferData() into a BufferedImage. Clip.findImageFlavor()
does a slightly more sophisticated lookup than the earlier findFlavor(), searching for a
suitable flavor for an image mime type.</p>
<p>The CPTests.java file shows how to add and retrieve an image from the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of CPTests.java...</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
   <span class="p">:</span>
<span class="n">BufferedImage</span> <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">loadImage</span><span class="p">(</span><span class="s">&quot;skinner.png&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image (w,h): &quot;</span> <span class="o">+</span> <span class="n">im</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>
                                     <span class="n">im</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
<span class="n">Clip</span><span class="p">.</span><span class="na">setImage</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added image to clipboard&quot;</span><span class="p">);</span>

<span class="n">BufferedImage</span> <span class="n">imCopy</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">imCopy</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image (w,h): &quot;</span> <span class="o">+</span> <span class="n">imCopy</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>
                                       <span class="n">imCopy</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
   <span class="p">:</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
</code></pre></div>
<h3 id="14-adding-and-retrieving-an-image-from-a-file">1.4.  Adding and Retrieving an Image from a File<a class="headerlink" href="#14-adding-and-retrieving-an-image-from-a-file" title="Permanent link">&para;</a></h3>
<p>FileTransferable is the third transferable class in my utilities; a filename is passed to
the constructor, and the contents of the file are stored on the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Utils/ folder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileTransferable</span> <span class="kd">implements</span> <span class="n">XTransferable</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="s">&quot;application/octet-stream&quot;</span><span class="p">;</span>
                                 <span class="c1">// good default</span>
  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">fileData</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


  <span class="kd">public</span> <span class="nf">FileTransferable</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">mimeType</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getMIMEType</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">fileData</span> <span class="o">=</span> <span class="n">Files</span><span class="p">.</span><span class="na">readAllBytes</span><span class="p">(</span> <span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not read bytes from &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>  <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of FileTransferable()</span>


  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
                         <span class="kd">throws</span> <span class="n">UnsupportedFlavorException</span>
  <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">mimeType</span><span class="p">))</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedFlavorException</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">fileData</span><span class="p">;</span>
  <span class="p">}</span>  <span class="c1">// end of getTransferData()</span>


  <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="p">()</span>
  <span class="p">{</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">flavors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">flavors</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">mimeType</span><span class="p">,</span> <span class="n">mimeType</span><span class="p">,</span>
                                     <span class="k">new</span> <span class="n">Type</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">flavors</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
  <span class="p">{</span>  <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="na">MimeType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">mimeType</span><span class="p">);</span>  <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// end of FileTransferable class</span>
</code></pre></div>
<p>Java's Files.readAllBytes() reads in the file's contents as a bytes array. The
transferable also stores the mime type string for the data, which it obtains by calling
Info.getMIMEType().</p>
<p>The Clip class has setFile() and getFile() for using FileTransferable:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setFile</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span><span class="k">new</span> <span class="n">FileTransferable</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getFile</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span> <span class="n">String</span> <span class="n">mimeStr</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getMIMEType</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span><span class="n">mimeStr</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>getFile() shows why it's necessary to store the the data's mime type in the transferable
– it's used as an argument to Clip.getData() to extract the byte array from the
clipboard in the correct data format.</p>
<p>CPTests.java shows how to add and retrieve the contents of a file from the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of CPTests.java...</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
   <span class="p">:</span>
<span class="n">Clip</span><span class="p">.</span><span class="na">setFile</span><span class="p">(</span><span class="s">&quot;skinner.jpg&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added file to clipboard&quot;</span><span class="p">);</span>

<span class="kt">byte</span><span class="o">[]</span> <span class="n">imData</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getFile</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image byte length: &quot;</span> <span class="o">+</span> <span class="n">imData</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>

<span class="n">BufferedImage</span> <span class="n">imCopy</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">imCopy</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image (w,h): &quot;</span> <span class="o">+</span> <span class="n">imCopy</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>
                                       <span class="n">imCopy</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
   <span class="p">:</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
</code></pre></div>
<p>It's possible to read the file's contents from the clipboard in two ways. Clip.getFile()
returns it as a byte array, while Clip.getImage() attempts to convert it to a
BufferedImage.</p>
<h2 id="2-javas-clipboard-api">2.  Java's Clipboard API<a class="headerlink" href="#2-javas-clipboard-api" title="Permanent link">&para;</a></h2>
<p>Office's clipboard API is closely related to Java's clipboard API, so I had high hopes
of not needing Java's API in this chapter. However, Java's ability to pass serializable
objects to the clipboard is very useful when copying and pasting spreadsheet cells and
database result sets. It's natural to encode them both as 2D arrays which, because
they're serializable, can be more easily manipulated with Java than Office.</p>
<p>In the end, I coded a JClip.java support class (note the "J") which duplicates a lot of
the code in Clip.java, but using Java classes for the clipboard, transferables, and
flavors rather than the Office ones. It's easy to get the two APIs confused, so Table 1
shows their main correspondences.</p>
<table>
<thead>
<tr>
<th>Office</th>
<th>Java</th>
</tr>
</thead>
<tbody>
<tr>
<td>SystemClipboard.create()</td>
<td>Toolkit.getDefaultToolkit().</td>
</tr>
<tr>
<td></td>
<td>getSystemClipboard()</td>
</tr>
<tr>
<td>XSystemClipboard inherits</td>
<td>Clipboard;</td>
</tr>
<tr>
<td>XClipboard, and others</td>
<td></td>
</tr>
<tr>
<td>(see Fig. 1);</td>
<td></td>
</tr>
<tr>
<td>getContents() never fails (?);</td>
<td>getContents() can fail;</td>
</tr>
<tr>
<td></td>
<td>Can handle serializable objects;</td>
</tr>
<tr>
<td>Can handle String or byte[]</td>
<td>More methods</td>
</tr>
<tr>
<td>XClipboardListener</td>
<td>FlavorListener</td>
</tr>
<tr>
<td>XClipboardOwner</td>
<td>ClipboardOwner</td>
</tr>
<tr>
<td>XTransferable</td>
<td>Transferable</td>
</tr>
<tr>
<td>DataFlavor</td>
<td>DataFlavor; many predefined constants</td>
</tr>
<tr>
<td>TextTransferable (my class)</td>
<td>StringSelection (in the JDK)</td>
</tr>
</tbody>
</table>
<p>Table 1. Corresponding Clipboard Services, Interfaces, and Classes in the Office and Java APIs.</p>
<p>The JClip class uses a similar approach to the Clip class for creating a clipboard
reference:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the JClip class</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Clipboard</span> <span class="n">cb</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="c1">// used to store clipboard ref, so only one is created</span>
      <span class="c1">// by the methods here</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">Clipboard</span> <span class="nf">getClip</span><span class="p">()</span>
<span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">cb</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">getSystemClipboard</span><span class="p">();</span>
<span class="cm">/*</span>
<span class="cm">    cb.addFlavorListener( new FlavorListener() {</span>
<span class="cm">      public void flavorsChanged(FlavorEvent e)</span>
<span class="cm">      {  System.out.println(&quot;&gt;&gt;Flavor change detected&quot;);  }</span>
<span class="cm">    });</span>
<span class="cm">*/</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">cb</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The reference is stored in a static variable so the same instance is used when getClip()
is called more than once. The Java version of Office's XClipboardListener is
FlavorListener, but is triggered only when the type of flavor changes on the clipboard
not when the contents change.</p>
<p>JClip.java contains an addContents() method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the JClip class</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_TRIES</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">addContents</span><span class="p">(</span><span class="n">Transferable</span> <span class="n">trf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_TRIES</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">getClip</span><span class="p">().</span><span class="na">setContents</span><span class="p">(</span><span class="n">trf</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">IllegalStateException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Problem accessing clipboard...&quot;</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to add contents&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addContents()</span>
</code></pre></div>
<p>Java's Clipboard.setContents() can throw an IllegalStateException. However,
exceptions occur infrequently, and my solution of retrying the method three times,
after a short wait, deals with the problem.</p>
<h3 id="21-adding-and-retrieving-text">2.1.  Adding and Retrieving Text<a class="headerlink" href="#21-adding-and-retrieving-text" title="Permanent link">&para;</a></h3>
<p>Java's API includes several predefined flavors, including one for strings
(DataFlavor.stringFlavor), and a Transferable class for strings called StringSelection,
which makes it unnecessary to code a TextTransferable class.</p>
<p>The JClip support class has setText() and getText() methods:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the JClip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setText</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span> <span class="k">new</span> <span class="n">StringSelection</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getText</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Transferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
        <span class="n">trf</span><span class="p">.</span><span class="na">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">stringFlavor</span><span class="p">))</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">stringFlavor</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">UnsupportedFlavorException</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getText()</span>
</code></pre></div>
<p>JCPTests.java shows how to add and retrieve text from the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of JCPTests.java...</span>
<span class="n">JClip</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">Lo</span><span class="p">.</span><span class="na">getTimeStamp</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added text to clipboard&quot;</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Read clipboard: &quot;</span> <span class="o">+</span> <span class="n">JClip</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>
</code></pre></div>
<p>Unlike the Office examples, there's no need to start with a Lo.loadOffice() and end
with Lo.closeOffice().</p>
<h3 id="22-adding-and-retrieving-an-image">2.2.  Adding and Retrieving an Image<a class="headerlink" href="#22-adding-and-retrieving-an-image" title="Permanent link">&para;</a></h3>
<p>Java's API has a predefined flavor for images (DataFlavor.imageFlavor), but no
Transferable class. My JImageTransferable is comparable with the earlier
ImageTransferable class that used the Office API, but returns a BufferedImage from
getTransferData() instead of a byte array:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Utils/ folder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JImageTransferable</span> <span class="kd">implements</span> <span class="n">Transferable</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="n">Image</span> <span class="n">im</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">JImageTransferable</span><span class="p">(</span><span class="n">Image</span> <span class="n">im</span><span class="p">)</span>
  <span class="p">{</span>  <span class="k">this</span><span class="p">.</span><span class="na">im</span> <span class="o">=</span> <span class="n">im</span><span class="p">;</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
                <span class="kd">throws</span> <span class="n">UnsupportedFlavorException</span><span class="p">,</span> <span class="n">IOException</span>
  <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">imageFlavor</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">im</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">im</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedFlavorException</span><span class="p">(</span><span class="n">df</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="p">()</span>
  <span class="p">{</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">dfs</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">DataFlavor</span><span class="p">.</span><span class="na">imageFlavor</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">dfs</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">getTransferDataFlavors</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dfs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">dfs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// end of JImageTransferable class</span>

<span class="n">The</span> <span class="n">JClip</span> <span class="n">support</span> <span class="kd">class</span> <span class="nc">has</span> <span class="nf">setImage</span><span class="p">()</span> <span class="n">and</span> <span class="nf">getImage</span><span class="p">()</span> <span class="n">methods</span><span class="p">:</span>

<span class="c1">// in the JClip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setImage</span><span class="p">(</span><span class="n">BufferedImage</span> <span class="n">im</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span><span class="k">new</span> <span class="n">JImageTransferable</span><span class="p">(</span><span class="n">im</span><span class="p">));</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedImage</span> <span class="nf">getImage</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Transferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
      <span class="n">trf</span><span class="p">.</span><span class="na">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">imageFlavor</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">BufferedImage</span><span class="p">)</span>
            <span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">imageFlavor</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getImage()</span>
</code></pre></div>
<p>JClip.getImage() is simpler than the version in the Clip class since it doesn't have to
convert a byte array to a BufferedImage.</p>
<p>JCPTests.java shows how to add and retrieve an image from the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of JCPTests.java...</span>
<span class="n">BufferedImage</span> <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">loadImage</span><span class="p">(</span><span class="s">&quot;skinner.png&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image (w,h): &quot;</span> <span class="o">+</span> <span class="n">im</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>
                                     <span class="n">im</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
<span class="n">JClip</span><span class="p">.</span><span class="na">setImage</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added image to clipboard&quot;</span><span class="p">);</span>

<span class="n">BufferedImage</span> <span class="n">imCopy</span> <span class="o">=</span> <span class="n">JClip</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">imCopy</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image (w,h): &quot;</span> <span class="o">+</span> <span class="n">imCopy</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>
                                       <span class="n">imCopy</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
</code></pre></div>
<p>It's no different from the example in CPTest.java, except for the use of JClip.</p>
<h3 id="23-adding-and-retrieving-a-2d-array">2.3.  Adding and Retrieving a 2D Array<a class="headerlink" href="#23-adding-and-retrieving-a-2d-array" title="Permanent link">&para;</a></h3>
<p>As I mentioned above, I'm using the Java API because of the simplicity of copying
2D arrays to and from the clipboard.</p>
<p>JArrayTransferable is an implementation of Transferable that stores a 2D array of
objects on the clipboard:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Utils/ folder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JArrayTransferable</span> <span class="kd">implements</span> <span class="n">Transferable</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">vals</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">DataFlavor</span> <span class="n">arrDF</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">JArrayTransferable</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span> <span class="n">vals</span><span class="p">)</span>
  <span class="p">{</span>  <span class="k">this</span><span class="p">.</span><span class="na">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">;</span>
     <span class="n">arrDF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="s">&quot;2D Object Array&quot;</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
                <span class="kd">throws</span> <span class="n">UnsupportedFlavorException</span><span class="p">,</span> <span class="n">IOException</span>
  <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arrDF</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">vals</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">vals</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedFlavorException</span><span class="p">(</span><span class="n">df</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="p">()</span>
  <span class="p">{</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">dfs</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">arrDF</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">dfs</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="p">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">getTransferDataFlavors</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dfs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">dfs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// end of JArrayTransferable class</span>
</code></pre></div>
<p>JArrayTransferable defines a flavor for the array type:</p>
<div class="highlight"><pre><span></span><code><span class="n">DataFlavor</span> <span class="n">arrDF</span> <span class="o">=</span>
       <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="s">&quot;2D Object Array&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The string argument is a 'human presentable name' rather than a mime type, since
there's no good mime type match.</p>
<p>In JClip.java, the set and get methods for an array are:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the JClip class</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">DataFlavor</span> <span class="n">ARRAY_DF</span> <span class="o">=</span>
           <span class="k">new</span> <span class="n">DataFlavor</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="s">&quot;2D Object Array&quot;</span><span class="p">);</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setArray</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span> <span class="n">vals</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addContents</span><span class="p">(</span><span class="k">new</span> <span class="n">JArrayTransferable</span><span class="p">(</span><span class="n">vals</span><span class="p">));</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getArray</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Transferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">trf</span><span class="p">.</span><span class="na">isDataFlavorSupported</span><span class="p">(</span><span class="n">ARRAY_DF</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">)</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">ARRAY_DF</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getArray()</span>
</code></pre></div>
<p>JCPTests.java shows how to store and retrieve an array:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of JCPTests.java...</span>
<span class="n">Object</span><span class="o">[][]</span> <span class="n">marks</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">70</span><span class="p">},</span>
                    <span class="p">{</span><span class="mi">62</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">81</span><span class="p">},</span>
                    <span class="p">{</span><span class="mi">72</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">69</span><span class="p">}</span> <span class="p">};</span>    <span class="c1">// no generics used</span>
<span class="n">JClip</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">marks</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Added 2D array to clipboard&quot;</span><span class="p">);</span>

<span class="n">Object</span><span class="o">[][]</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">JClip</span><span class="p">.</span><span class="na">getArray</span><span class="p">();</span>
</code></pre></div>
<p>I'll be using JClip.setArray() and JClip.getArray() later in this chapter for clipboard
copying of spreadsheet cells and database query results (sections 5 and 7).</p>
<h3 id="24-more-details-on-the-java-clipboard-api">2.4.  More Details on the Java Clipboard API<a class="headerlink" href="#24-more-details-on-the-java-clipboard-api" title="Permanent link">&para;</a></h3>
<p>If you'd like a slower, more detailed, explanation of Java's clipboard features, two
good sources are:</p>
<ul>
<li>Pro Java 8 Programming
Terrill Brett Spell
Apress, 2015, 3<sup>rd</sup> ed.</li>
</ul>
<p><a href="https://apress.com/9781484206423/">https://apress.com/9781484206423/</a>
Chapter 9 is about the clipboard.</p>
<ul>
<li>Core Java, Volume II -- Advanced Features
Cay S. Horstmann; Gary Cornell
Prentice Hall, 2016, 10<sup>th</sup> ed.</li>
</ul>
<p><a href="https://horstmann.com/corejava.html">https://horstmann.com/corejava.html</a>
Chapter 7 includes a clipboard section.</p>
<h2 id="3-copy-and-pasting-in-an-office-document">3.  Copy and Pasting in an Office Document<a class="headerlink" href="#3-copy-and-pasting-in-an-office-document" title="Permanent link">&para;</a></h2>
<p>The next four sections look at copying from and pasting to Office documents using
the clipboard. The techniques can be divided into two groups: those that use the
clipboard without requiring the copy selection to be visible in a window, and those
that do need a visible window.</p>
<p>The latter 'Visible' group utilize "Copy" and "Paste" dispatches, and suffer from the
problems I mentioned at the start of the chapter (i.e. selecting an active window and
timing). A problem I haven't mentioned before is how to programmatically select
data, which turns out to be different for each document type.</p>
<p>I'll look at how to use these techniques with four kinds of documents: Writer, Calc,
Impress, and Base, as summarized in Table 2.</p>
<table>
<thead>
<tr>
<th>Document</th>
<th>Invisible</th>
<th>Visible</th>
</tr>
</thead>
<tbody>
<tr>
<td>Copy-and-Paste Approach</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Writer</td>
<td>Copy/Paste:</td>
<td>Copy: XTextViewCursor</td>
</tr>
<tr>
<td>(CopyPasteText.java)</td>
<td>text</td>
<td>Paste: RTF, HTML, ODT</td>
</tr>
<tr>
<td>Calc</td>
<td>Copy/Paste:</td>
<td>Copy: XCellRange</td>
</tr>
<tr>
<td>(CopyPasteCalc.java)</td>
<td>2D array</td>
<td>Paste: SYLK, ODS</td>
</tr>
<tr>
<td>Impress</td>
<td>none</td>
<td>Copy: XDrawView</td>
</tr>
<tr>
<td>(CopySlide.java)</td>
<td></td>
<td>Paste: bitmap, PNG,</td>
</tr>
<tr>
<td>Base</td>
<td>Copy/Paste:</td>
<td>none</td>
</tr>
<tr>
<td>CopyResultSet.java)</td>
<td>2D array</td>
<td></td>
</tr>
</tbody>
</table>
<p>Table 2. Copy-and-Paste Techniques Applied to Office Documents.</p>
<p>The 'Visible' column shows the advantage and disadvantage of the approach.</p>
<p>The advantage is that pasting can use a range of data formats. For example, a selected
grid of cells from a spreadsheet can be saved as a Microsoft SYLK file (an ASCII
format for exchanging spreadsheet tables between applications) or as an ODS file.</p>
<p>The disadvantage is that copying involves a different interface for data selection in
each document type. For example, text copying employs a text cursor (the
XTextViewCursor interface), while the spreadsheet uses cell ranges (XCellRange).
The underlying reason is that each document has a different "view" service for how
it's drawn in a window, as illustrated by Figure 2.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-2.png" /></p>
<p>Figure 2. Different View Services in Office.</p>
<p>The display of a Writer document is managed by TextDocumentView, while a slide
presentation can use any one of PresentationView, HandoutView, NotesView,
OutlineView, and PreviewView. Most of these services implement selection using the
XSelectionSupplier.select() method, but the data that is passed to the select() call
depends on the document type.</p>
<h2 id="4-copy-and-pasting-in-a-writer-document">4.  Copy and Pasting in a Writer Document<a class="headerlink" href="#4-copy-and-pasting-in-a-writer-document" title="Permanent link">&para;</a></h2>
<p>The CopyPasteText.java example copies a sentence from the start of a document to
the clipboard, then pastes it back at the end. The program does this in two ways – the
'invisible' approach uses the Clip.java support functions without making Office
visible, and the 'visible' approach which visibly selects the sentence so a "Copy"
dispatch can copy it to the clipboard. A subsequent "Paste" dispatch places the
sentence at the end of the document, as before, but it's also possible to manipulate the
clip in formats other than just text.</p>
<p>The main() function of CopyPasteText.java loads startStory.doc, then calls either
useClipUtils() or useDispatches():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteText.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;storyStart.doc&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XTextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">FNM</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">useClipUtils</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>    <span class="c1">// invisible approach</span>
  <span class="c1">// useDispatches(doc, 4);  // visible</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>useClipUtils() is passed a reference to the document and an integer used to select a
sentence:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteText.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useClipUtils</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XSentenceCursor</span> <span class="n">senCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getSentenceCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">senCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>     <span class="c1">// start of text; no selection</span>
  <span class="n">gotoSentence</span><span class="p">(</span><span class="n">senCursor</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

  <span class="c1">// copy to clipboard</span>
  <span class="n">Clip</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">senCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">());</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Copied \&quot;&quot;</span> <span class="o">+</span> <span class="n">senCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>   <span class="c1">// go to end of doc</span>

  <span class="c1">// paste into doc</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>   <span class="c1">// so we can see change</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of useClipUtils()</span>


<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">gotoSentence</span><span class="p">(</span><span class="n">XSentenceCursor</span> <span class="n">senCursor</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">senCursor</span><span class="p">.</span><span class="na">gotoEndOfSentence</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>   <span class="c1">// select all of sentence</span>
    <span class="n">n</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">senCursor</span><span class="p">.</span><span class="na">gotoNextSentence</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of gotoSentence()</span>
</code></pre></div>
<p>Sentence selection in gotoSentence() is done with XSentenceCursor, which was
previously used in Chapter 5, section 6. The text covered by the cursor is copied to the
clipboard by Clip.setText() in useClipUtils().</p>
<p>useClipUtils() ends with a call to GUI.setVisible() so the user can see that the
sentence has been pasted at the end of the document.</p>
<h4 id="visible-cut-and-paste-of-text">Visible Cut-and-Paste of Text<a class="headerlink" href="#visible-cut-and-paste-of-text" title="Permanent link">&para;</a></h4>
<p>The hardest part about the 'visible' technique is data selection, which involves two
kinds of cursors: XSentenceCursor for moving through the document a sentence at a
time, and XTextViewCursor which represents the visible cursor in the Writer
window.</p>
<p>View cursors are used to visibly select text in Writer documents rather than the
XSelectionSupplier interface shown in Figure 2. Figure 3 shows how
XTextViewCursor is related to the TextDocumentView service.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-3.png" /></p>
<p>Figure 3. The TextDocumentView Service and XTextViewCursor.</p>
<p>Obtaining an XTextViewCursor involves some casting, which I've hidden inside
Writer.getViewCursor():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// the Writer class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XTextViewCursor</span> <span class="nf">getViewCursor</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textDoc</span><span class="p">);</span>
  <span class="n">XController</span> <span class="n">xController</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">();</span>

  <span class="c1">// the controller gives us the TextViewCursor</span>
  <span class="n">XTextViewCursorSupplier</span> <span class="n">supplier</span> <span class="o">=</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextViewCursorSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xController</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">supplier</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getViewCursor()</span>
</code></pre></div>
<p>The text document is cast to an XModel interface, which allows its corresponding
controller to be obtained. At that point we're positioned on the far right of Figure 2 in
XController. The second Lo.qi() cast is the big step, since it travels along the service
hierarchy all the way to the left and top of Figure 2. It stops at the
TextDocumentView service, and converts XController into
XTextViewCursorSupplier, one of the interfaces in Figure 3. The final line of
Write.getViewCursor() calls XTextViewCursorSupplier.getViewCursor() to obtain
the cursor.</p>
<p>useDispatches() calls Writer.getViewCursor() to get a view cursor, and
Write.getSentenceCursor() for a sentence cursor:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteText.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useDispatches</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>   <span class="c1">// *must* be made visible</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>   <span class="c1">// give Office time to appear</span>

  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">XSentenceCursor</span> <span class="n">senCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getSentenceCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">senCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
            <span class="c1">// go to start of text; no selection</span>
  <span class="n">gotoSentence</span><span class="p">(</span><span class="n">senCursor</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

  <span class="c1">// move the text view cursor to highlight the current paragraph</span>
  <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">senCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">senCursor</span><span class="p">.</span><span class="na">getEnd</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">);</span>
  <span class="n">Clip</span><span class="p">.</span><span class="na">listFlavors</span><span class="p">();</span>

  <span class="c1">// save copied text as RTF &amp; HTML</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="s">&quot;storyFrag.rtf&quot;</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getRTF</span><span class="p">());</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="s">&quot;storyFrag.html&quot;</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getHTML</span><span class="p">());</span>

  <span class="c1">// save embedded text fragment as ODT</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveBytes</span><span class="p">(</span><span class="s">&quot;storyFrag.odt&quot;</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getEmbedSource</span><span class="p">());</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="n">tvc</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>    <span class="c1">// go to end of doc</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Paste&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of useDispatches()</span>
</code></pre></div>
<p>The sentence cursor is moved as before, by calling gotoSentence(), but it doesn't
highlight the text in the window. XTextViewCursor is needed for this, by being
assigned the start and end positions of XSentenceCursor. The result is illustrated in
Figure 4.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-4.png" /></p>
<p>Figure 4. The Highlighted Sentence in the Writer window.</p>
<p>After the copy, the XTextViewCursor is moved to the end of the document and a
"Paste" dispatch adds the copied data back.</p>
<p>Just after the "Copy" dispatch, Clip.listFlavors() prints out the flavors (data types) that
have been copied to the clipboard. The output is:</p>
<div class="highlight"><pre><span></span><code>No of flavors: 6
1.  application/x-openoffice-embed-source-xml;windows_formatname=&quot;Star
Embed Source (XML)&quot;
2.  text/richtext
3.  text/html
4.  text/plain;charset=utf-16
5.  application/x-openoffice-link;windows_formatname=&quot;Link&quot;
6.  application/x-openoffice-objectdescriptor-xml;
windows_formatname=&quot;Star Object Descriptor (XML)&quot;;classname=&quot;8BC…&quot;
</code></pre></div>
<p>Plain text is listed as flavor no. 4, but the data is also available in HTML and RTF
formats. Flavor no. 1 ("application/x-openoffice-embed-source-xml") is ODF (Open
Document Format), which in this case is an ODT file.</p>
<p>Clip.listFlavors() prints this information by getting a copy of the current transferable
off the clipboard, and calling its getTransferDataFlavors() method to obtain favor
data:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">listFlavors</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XTransferable</span> <span class="n">trf</span> <span class="o">=</span> <span class="n">getClip</span><span class="p">().</span><span class="na">getContents</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">trf</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No transferable found&quot;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">listFlavors</span><span class="p">(</span><span class="n">trf</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of listFlavors()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">listFlavors</span><span class="p">(</span><span class="n">XTransferable</span> <span class="n">trf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">DataFlavor</span><span class="o">[]</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">trf</span><span class="p">.</span><span class="na">getTransferDataFlavors</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No of flavors: &quot;</span> <span class="o">+</span> <span class="n">dfs</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dfs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;. &quot;</span> <span class="o">+</span> <span class="n">dfs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">MimeType</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of listFlavors()</span>
</code></pre></div>
<p>The ClCl clipboard viewer (<a href="https://nakka.com/soft/clcl/index_eng.html">https://nakka.com/soft/clcl/index_eng.html</a>) is a
more graphical way of viewing this information. For example, the copied text is
displayed as in Figure 5.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-5.png" /></p>
<p>Figure 5. The ClCl View of the Writer Text.</p>
<p>The different formats are listed below the "Clipboard" node on the left of Figure 5,
and the data in a particular format is displayed by clicking on the format name, as in
Figure 6 for "Star Embed Source (XML)".</p>
<p><img alt="" src="images/43-Using_the_Clipboard-6.png" /></p>
<p>Figure 6. The ClCl "Star Embed Source (XML)" View of the Writer Text.</p>
<p>The advantage of using Clip.listFlavors() is that it displays the Office mime type
strings, which are used to select data from the transferable. These strings are
employed by the Clip.getXXX() methods:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getHTML</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span><span class="s">&quot;text/html&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getHTML()</span>



<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getRTF</span><span class="p">()</span>
<span class="c1">// text format used by MS</span>
<span class="p">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span><span class="s">&quot;text/richtext&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getRTF()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getEmbedSource</span><span class="p">()</span>
<span class="c1">// fragment in binary ODF</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span>
      <span class="s">&quot;application/x-openoffice-embed-source-xml;</span>
<span class="s">            windows_formatname=\&quot;Star Embed Source (XML)\&quot;&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getEmbedSource()</span>
</code></pre></div>
<p>Recall that I'm using the Office API, so Clip.getData() must return either a string or a
byte array.</p>
<p>These Clip.getXXX() methods are called in useDispatches() in CopyPasteText.java,
and the data is saved to a file using FileIO.saveString() or FileIO.saveBytes().</p>
<h2 id="5-copy-and-pasting-in-a-calc-document">5.  Copy and Pasting in a Calc Document<a class="headerlink" href="#5-copy-and-pasting-in-a-calc-document" title="Permanent link">&para;</a></h2>
<p>CopyPasteCalc.java copies the data in a block of spreadsheet cells to empty cells at
the bottom of the sheet. The main() function is similar to the Writer example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteCalc.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;Addresses.ods&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">FNM</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">useClipUtils</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>    <span class="c1">// invisible approach</span>
  <span class="c1">// useDispatches(doc);  // visible</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>useClipUtils() employs Clip support functions so the Calc window can remain hidden,
while useDispatches() needs the window to be visible so that "Copy" and "Paste"
dispatches can work.</p>
<p>useClipUtils() utilizes the SheetCellRange service which is inherited by the
Spreadsheet service (see Chapter 19, section 4, Figure 5). A block of cells is selected
by calling Calc.getCellRange() which returns an XCellRange instance. The data
covered by that range is extracted as a 2D array by Calc.getCellRangeArray(), and
stored on the clipboard by JClip.setArray():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteCalc.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useClipUtils</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//row 3</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRangeArray</span><span class="p">(</span><span class="n">cellRange</span><span class="p">);</span>
  <span class="n">JClip</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>   <span class="c1">// copy array to clipboard</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

  <span class="n">XCellRange</span> <span class="n">toCellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="c1">//row 9</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">cbData</span> <span class="o">=</span> <span class="n">JClip</span><span class="p">.</span><span class="na">getArray</span><span class="p">();</span>      <span class="c1">// paste in array</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setCellRangeArray</span><span class="p">(</span><span class="n">toCellRange</span><span class="p">,</span> <span class="n">cbData</span><span class="p">);</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>   <span class="c1">// so can see the paste</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of useClipUtils()</span>
</code></pre></div>
<p>Calc.getCellRangeArray() wraps the XCellRangeData interface, which was explained
in Chapter 20, section 2.3:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getCellRangeArray</span><span class="p">(</span><span class="n">XCellRange</span> <span class="n">cellRange</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XCellRangeData</span> <span class="n">crData</span>  <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XCellRangeData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cellRange</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">crData</span><span class="p">.</span><span class="na">getDataArray</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>The  process of pasting the cell range back into the sheet requires another call to
Calc.getCellRange() to select a new block of cells. Then the clip data as an array is
inserted with Calc.setCellRangeArray().</p>
<h4 id="visible-cut-and-paste-of-cells">Visible Cut-and-Paste of Cells<a class="headerlink" href="#visible-cut-and-paste-of-cells" title="Permanent link">&para;</a></h4>
<p>The 'visible' technique also uses XCellRange, but as an argument to
XSelectionSupplier.select() so the cells are highlighted in the Calc window. The
useDispatches() method is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyPasteCalc.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useDispatches</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>   <span class="c1">// Office *must* be visible</span>

  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// row 3</span>

  <span class="n">XSelectionSupplier</span> <span class="n">selSupp</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getSelectionSupplier</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">selSupp</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cellRange</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">);</span>

  <span class="n">Clip</span><span class="p">.</span><span class="na">listFlavors</span><span class="p">();</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

  <span class="c1">// save embedded cells as ODS</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveBytes</span><span class="p">(</span><span class="s">&quot;AddressesFrag.ods&quot;</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getEmbedSource</span><span class="p">());</span>

  <span class="c1">// save cells as SYLK file</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="s">&quot;AddressesFrag.slk&quot;</span><span class="p">,</span> <span class="n">Clip</span><span class="p">.</span><span class="na">getSylk</span><span class="p">());</span>

  <span class="n">XCellRange</span> <span class="n">toCellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="c1">// row 9</span>
         <span class="c1">// GUI dialog asks about insertion if range is too small</span>
         <span class="c1">// and data repeats if range is too big</span>
  <span class="n">selSupp</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">toCellRange</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Paste&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of useDispatches()</span>
</code></pre></div>
<p>The selection of cell ranges is done twice in useDispatches() – a cell range is required
for the block of cells being copied, and another range is necessary for the empty cell
block where the data will be pasted. Figure 7 shows the cells being selected, just prior
to their copying.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-7.png" /></p>
<p>Figure 7. The Highlighted Cells in the Calc Window.</p>
<p>The flavors list printed by Clip.listFlavors() is longer than the one for text:</p>
<div class="highlight"><pre><span></span><code>No of flavors: 14
1.  application/x-openoffice-embed-source-xml;windows_formatname=&quot;Star
Embed Source (XML)&quot;
2.  application/x-openoffice-objectdescriptor-xml;
windows_formatname=&quot;Star Object Descriptor (XML)&quot;;classname=&quot;47BB…&quot;
3.  application/x-openoffice-gdimetafile;
windows_formatname=&quot;GDIMetaFile&quot;
4.  application/x-openoffice-emf;windows_formatname=&quot;Image EMF&quot;
5.  application/x-openoffice-wmf;windows_formatname=&quot;Image WMF&quot;
6.  image/png
7.  application/x-openoffice-bitmap;windows_formatname=&quot;Bitmap&quot;
8.  image/bmp
9.  text/html
10. application/x-openoffice-sylk;windows_formatname=&quot;Sylk&quot;
11. application/x-openoffice-link;windows_formatname=&quot;Link&quot;
12. application/x-openoffice-dif;windows_formatname=&quot;DIF&quot;
13. text/plain;charset=utf-16
14. text/richtext
</code></pre></div>
<p>The additions are mostly graphic types, but "Sylk" and "DIF" are ASCII-based
formats for exchanging spreadsheets between applications. The corresponding ClCl
display is shown in Figure 8.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-8.png" /></p>
<p>Figure 8. The ClCl View of the Calc Cells.</p>
<p>Flavors numbers 1 and 10 in the list above allow the data to be saved as an ODS file
and as a SYLK file. Clip.getEmbedSource() is called in useDispatches() to return the
byte array holding the ODS data, and Clip.getSylk() returns the SYLK text. The code
for Clip.getSylk():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getSylk</span><span class="p">()</span>
<span class="c1">// text-based spreadsheet format used by MS</span>
<span class="p">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span>
      <span class="s">&quot;application/x-openoffice-sylk;windows_formatname=\&quot;Sylk\&quot;&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getSylk()</span>
</code></pre></div>
<h2 id="5-copy-and-pasting-in-an-impress-document">5.  Copy and Pasting in an Impress Document<a class="headerlink" href="#5-copy-and-pasting-in-an-impress-document" title="Permanent link">&para;</a></h2>
<p>Table 2 shows that the Office API has no 'invisible' way of copying a slide, so I have
to use "Copy" and "Paste" dispatches to a visible Impress window. I went through two
examples using this technique in Chapter 17, section 4 ("Rearranging a Slide Deck")
and section 5 ("Appending Slide Decks Together"). Both require Impress to be in
slide sorter mode so Draw.gotoPage() can select a slide.</p>
<p>The CopySlide.java example in this section is a simplified version of the deck
rearranger: the slide is copied without being pasted back. Instead, the contents of the
clipboard are saved in various formats.</p>
<p>The main() function loads a slide deck and calls copySave() to do the hard work:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopySlide.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;algs.odp&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open the file: &quot;</span> <span class="o">+</span> <span class="n">FNM</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

  <span class="n">copySave</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>   <span class="c1">// save copy of 4th slide</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>copySave() switches Office to slide sorter mode, goes to the specified slide, which
highlights it in the window. The "Copy" dispatch copies that slide to the clipboard.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopySlide.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">copySave</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fromIdx</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XController</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DiaMode&quot;</span><span class="p">);</span>
      <span class="c1">// Switch to slide sorter view</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>   <span class="c1">// give Office plenty of time to do it</span>

  <span class="n">XDrawPage</span> <span class="n">fromSlide</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlide</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">fromIdx</span><span class="p">);</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">gotoPage</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">fromSlide</span><span class="p">);</span>  <span class="c1">// select this slide</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Copied slide no. &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">fromIdx</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>

  <span class="n">Clip</span><span class="p">.</span><span class="na">listFlavors</span><span class="p">();</span>

  <span class="c1">// save embedded slide as ODP;</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveBytes</span><span class="p">(</span><span class="s">&quot;slide&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">fromIdx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.odp&quot;</span><span class="p">,</span>
                            <span class="n">Clip</span><span class="p">.</span><span class="na">getEmbedSource</span><span class="p">());</span>

  <span class="c1">// save slide as XML (&#39;flat&#39; ODP)</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="s">&quot;slide&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">fromIdx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.fodp&quot;</span><span class="p">,</span>
                            <span class="n">Clip</span><span class="p">.</span><span class="na">getXMLDraw</span><span class="p">());</span>

  <span class="c1">// save slide as PNG image</span>
  <span class="n">Images</span><span class="p">.</span><span class="na">saveImage</span><span class="p">(</span><span class="n">Clip</span><span class="p">.</span><span class="na">getImage</span><span class="p">(),</span> <span class="s">&quot;slide&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">fromIdx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.png&quot;</span><span class="p">);</span>
        <span class="c1">// for another approach see Slide2Image.java in Draw Tests/</span>

  <span class="c1">// save slide as a Bitmap</span>
  <span class="n">FileIO</span><span class="p">.</span><span class="na">saveBytes</span><span class="p">(</span><span class="s">&quot;slide&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">fromIdx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.bmp&quot;</span><span class="p">,</span>
                            <span class="n">Clip</span><span class="p">.</span><span class="na">getBitmap</span><span class="p">());</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DrawingMode&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of copySave()</span>
</code></pre></div>
<p>Clip.listFlavors() reports the data types that can be copied from the clipboard:</p>
<div class="highlight"><pre><span></span><code>No of flavors: 9
1.  application/x-openoffice-objectdescriptor-xml;
windows_formatname=&quot;Star Object Descriptor (XML)&quot;;classname=&quot;9176…&quot;
2.  application/x-openoffice-embed-source-xml;
windows_formatname=&quot;Star Embed Source (XML)&quot;
3.  application/x-openoffice-drawing;
windows_formatname=&quot;Drawing Format&quot;
4.  application/x-openoffice-gdimetafile;
windows_formatname=&quot;GDIMetaFile&quot;
5.  application/x-openoffice-emf;windows_formatname=&quot;Image EMF&quot;
6.  application/x-openoffice-wmf;windows_formatname=&quot;Image WMF&quot;
7.  image/png
8.  application/x-openoffice-bitmap;windows_formatname=&quot;Bitmap&quot;
9.  image/bmp
</code></pre></div>
<p>One of the new mime types is flavor no. 3, "application/x-openoffice-drawing", which
encodes an ODP file in XML.</p>
<p>The clipboard display in ClCl is shown in Figure 9.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-9.png" /></p>
<p>Figure 9. The ClCl View of the Impress Slide.</p>
<p>The code at the end of copySave() reads and saves the clipboard data in four ways.</p>
<p>Clip.getXMLDraw() retrieves the XML for the ODP file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Clip class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getXMLDraw</span><span class="p">()</span>
<span class="c1">// a &#39;flat&#39; XML version of the draw/slide copy</span>
<span class="p">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="p">)</span> <span class="n">getData</span><span class="p">(</span>
                 <span class="s">&quot;application/x-openoffice-drawing;</span>
<span class="s">                  windows_formatname=\&quot;Drawing Format\&quot;&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getXMLDraw()</span>
</code></pre></div>
<p>The text is saved to a file with the extension "fodp", indicating that it holds a 'flat'
XML version of the ODP document. This file can be opened in Office by double
clicking upon it.</p>
<p>copySave() also saves the slide as PNG and bitmap images. A better way to export an
image is explained in Chapter 17, section 6 ("Saving a Slide as an Image"); it's better
because it doesn't require the Office window to be visible.</p>
<h2 id="6-copy-and-pasting-in-base-data">6.  Copy and Pasting in Base Data<a class="headerlink" href="#6-copy-and-pasting-in-base-data" title="Permanent link">&para;</a></h2>
<p>Table 2 states that the Office API has no 'visible' way of copying a database, although
I suspect it may have. I've spent a long time trying to coax DefaultViewController
(see Figure 2), the view service for Base, into action. Since it supports the
XSelectionSupplier interface, it should be able to select things for copying. Another
of its tantalizing interfaces is XDatabaseDocumentUI which seems to offer the ability
to open a table window, but I couldn’t get that to work either. The closest I've got is
described in Chapter 35, section 3 ("Debugging Database Code") with
Base.showTables() which opens all the databases' tables using a "DBTableOpen"
dispatch.</p>
<p>It's interesting to investigate what I'm losing in terms of data formats by not utilizing a
"Copy" dispatch. It's possible to find out by manually copying a database table from
Base, then using ClCl to look at the clipboard. The result is shown in Figure 10.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-10.png" /></p>
<p>Figure 10. The ClCl View of a Copied Database Table.</p>
<p>It appears that the copied table could be saved in RTF and HTML formats. The
"SBA-DATAFORMAT' entry refers to the mime type "application/x-openoffice-sba-
dataexchange;windows_formatname=\"SBA-DATAFORMAT\"", but I've no idea
what SBA stands for. An online acronym finder site
(<a href="https://acronymfinder.com/">https://acronymfinder.com/</a>) suggests "Susan B. Anthony", but I doubt it.</p>
<h4 id="the-invisible-cut-and-paste-of-data">The Invisible Cut-and-Paste of Data<a class="headerlink" href="#the-invisible-cut-and-paste-of-data" title="Permanent link">&para;</a></h4>
<p>I've described the  'invisible' approach for databases previously, in Chapter 36, section
3 ("Copying Data From Base To Calc"), which converts a Base table into a
spreadsheet. SQL is used to generate a result set spanning the table, then
Base.getResultSetArr() converts the set into a 2D array of Objects. The array is
written into a new spreadsheet using XCellRangeData.setDataArray().</p>
<p>The same approach is used in CopyResultSet.java in this section, except that the array
is copied to the clipboard with JClip.setArray():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CopyResultSet.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;liangTables.odb&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">openBaseDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open database &quot;</span> <span class="o">+</span> <span class="n">FNM</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// no login/password</span>

    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
                        <span class="s">&quot;SELECT * FROM \&quot;Course\&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>

    <span class="c1">// BaseTablePrinter.printResultSet(rs);</span>
    <span class="c1">// rs.beforeFirst();  // fails if ResultSet is TYPE_FORWARD_ONLY,</span>
                          <span class="c1">// which is the default</span>
    <span class="n">Object</span><span class="o">[][]</span> <span class="n">rsArr</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">getResultSetArr</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">printResultSetArr</span><span class="p">(</span><span class="n">rsArr</span><span class="p">);</span>

    <span class="n">JClip</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">rsArr</span><span class="p">);</span>

    <span class="c1">// Clip.listFlavors();</span>
    <span class="n">JClip</span><span class="p">.</span><span class="na">listFlavors</span><span class="p">();</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving array from clipboard&quot;</span><span class="p">);</span>
    <span class="n">FileIO</span><span class="p">.</span><span class="na">saveArray</span><span class="p">(</span><span class="s">&quot;queryResults.txt&quot;</span><span class="p">,</span> <span class="n">JClip</span><span class="p">.</span><span class="na">getArray</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>As with previous examples, listFlavors() displays the flavors available to Office. The
Clip.java function reports no flavors since the serialized 2D array added to the
clipboard isn't an Office mime type. It's necessary to call the JClip.java version of the
function, which prints:</p>
<div class="highlight"><pre><span></span><code>No of flavors: 1
1.  application/x-java-serialized-object; class=&quot;[[Ljava.lang.Object;&quot;
</code></pre></div>
<p>The corresponding ClCl display is shown in Figure 11.</p>
<p><img alt="" src="images/43-Using_the_Clipboard-11.png" /></p>
<p>Figure 11. The ClCl View of the ResultSet Data.</p>
<p>When I was debugging the code, I initially printed the result set using
BaseTablePrinter.printResultSet(). Unfortunately, this would make the subsequent
call to Base.getResultSetArr() return an array containing only the column headers and
no data. BaseTablePrinter.printResultSet() moves the result set cursor through the
results, then returns after having moved the cursor to the end of the data.</p>
<p>Base.getResultSetArr() assumes the cursor is at the start of the data, and moves it
forward until it reaches the end of the data. This means that when it's passed a cursor
already at the end of the table, it generates no array data.</p>
<p>One solution is to reset the cursor to the start, using:</p>
<div class="highlight"><pre><span></span><code><span class="n">rs</span><span class="p">.</span><span class="na">beforeFirst</span><span class="p">();</span>
</code></pre></div>
<p>but this usually fails because most result sets use the default
TYPE_FORWARD_ONLY setting which restricts the cursor to only moving forward.</p>
<p>My solution is to extract the 2D array with Base.getResultSetArr(), and print the array
with Base.printResultSetArr(). Typical output is:</p>
<div class="highlight"><pre><span></span><code>Result set array size: 5 x 5
  courseId,  subjectId, courseNumber,      title, numOfCredits
--------------------------------------------------------------
     11111,       CSCI,       1301, Introduction to Java I,          4
     11112,       CSCI,       1302, Introduction to Java II,          3
     11113,       CSCI,       3720, Database Systems,          3
     11114,       CoE ,       3721, Algorithms,          3
</code></pre></div>
<p>It's not as pretty as BaseTablePrinter.printResultSet(), but avoids the cursor problem.</p>
<p>The array data retrieved from the clipboard is stored as text by calling
FileIO.saveArray(). The resulting queryResults.txt file contains:</p>
<div class="highlight"><pre><span></span><code>courseId subjectId courseNumber title numOfCredits
11111 CSCI 1301 Introduction to Java I 4
11112 CSCI 1302 Introduction to Java II 3
11113 CSCI 3720 Database Systems 3
11114 CoE  3721 Algorithms 3
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="42-Sending_E-mail.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 42. Sending E-mail" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 42. Sending E-mail
            </div>
          </div>
        </a>
      
      
        
        <a href="44-Office_as_GUI_Comp.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 44. Office as a GUI Component" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 44. Office as a GUI Component
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>