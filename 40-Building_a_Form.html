
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/40-Building_a_Form.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Chapter 40. Building a Form Programmatically - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-40-building-a-form-programmatically" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 40. Building a Form Programmatically
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 40. Building a Form Programmatically
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="40-Building_a_Form.html" class="md-nav__link md-nav__link--active">
        Chapter 40. Building a Form Programmatically
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-creating-controls" class="md-nav__link">
    1.  Creating Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-assigning-a-data-source-to-a-form" class="md-nav__link">
    2.  Assigning a Data Source to a Form
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-data-aware-controls" class="md-nav__link">
    3.  Creating Data-aware Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-initializing-the-gridcontrol" class="md-nav__link">
    4.  Initializing the GridControl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-attaching-listeners" class="md-nav__link">
    5.  Attaching Listeners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-listening-for-grid-control-selection-changes" class="md-nav__link">
    6.  Listening for Grid Control Selection Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-using-the-result-set" class="md-nav__link">
    7.  Using the Result Set
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-some-bugs" class="md-nav__link">
    8.  Some Bugs
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-creating-controls" class="md-nav__link">
    1.  Creating Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-assigning-a-data-source-to-a-form" class="md-nav__link">
    2.  Assigning a Data Source to a Form
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-data-aware-controls" class="md-nav__link">
    3.  Creating Data-aware Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-initializing-the-gridcontrol" class="md-nav__link">
    4.  Initializing the GridControl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-attaching-listeners" class="md-nav__link">
    5.  Attaching Listeners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-listening-for-grid-control-selection-changes" class="md-nav__link">
    6.  Listening for Grid Control Selection Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-using-the-result-set" class="md-nav__link">
    7.  Using the Result Set
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-some-bugs" class="md-nav__link">
    8.  Some Bugs
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/flywire/lo-p/edit/main/docs/40-Building_a_Form.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="chapter-40-building-a-form-programmatically">Chapter 40. Building a Form Programmatically<a class="headerlink" href="#chapter-40-building-a-form-programmatically" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Creating
Controls; Assigning a
Data Source to a Form;
Creating Data-aware
Controls; Attaching
Listeners</p>
<p>Example folders: "Forms
Tests" and "Utils"</p>
</div>
<p>BuildForm.java creates a text-based form at run-time, and
attaches listeners to the controls. Three of the controls
(two list boxes and a grid control) are "data aware" which
means that they obtain their data externally from a
database. Figure 1 shows a screenshot of the generated document, with the controls
and data sources labeled.</p>
<p><img alt="" src="images/40-Building_a_Form-1.png" /></p>
<p>Figure 1. The BuildForm.java Generated Document.</p>
<p>The document contains two forms: the default "Form", and "GridForm" holding a
single GridControl. "GridForm" employs the same database as "Form", but interacts
with it in a different way.</p>
<p>Table 1 summarizes which listeners are used with which controls. These are Office
listeners (i.e. subclasses of XEventListener) not Java classes.</p>
<table>
<thead>
<tr>
<th>Form Control</th>
<th>Listeners</th>
</tr>
</thead>
<tbody>
<tr>
<td>CommandButton</td>
<td>XActionListener, XMouseListener</td>
</tr>
<tr>
<td>Textfield</td>
<td>XTextListener, XFocusListener</td>
</tr>
<tr>
<td>RadioButton, CheckBox</td>
<td>XPropertyChangeListener</td>
</tr>
<tr>
<td>ListBox</td>
<td>XItemListener</td>
</tr>
<tr>
<td>GridControl</td>
<td>XSelectionChangeListener,</td>
</tr>
<tr>
<td></td>
<td>XGridColumnListener</td>
</tr>
</tbody>
</table>
<p>Table 1. Controls and Associated Listeners Used by BuildForm.java.</p>
<p>The finished form is saved in "build.odt", which retains the data links (since they're
stored as properties of the form controls), but the listeners are discarded.</p>
<p>The main() function of BuildForm.java creates a text document, and adds form
controls by calling createForm():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// globals</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DB_FNM</span> <span class="o">=</span> <span class="s">&quot;liang.odb&quot;</span><span class="p">;</span>    <span class="c1">// database</span>

<span class="kd">private</span> <span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">;</span>  <span class="c1">// for use by the listeners</span>

<span class="c1">// in BuildForm.java</span>
<span class="kd">public</span> <span class="nf">BuildForm</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Writer doc creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">doc</span><span class="p">.</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="c1">// for showing disposing of document (and controls)</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">tvc</span><span class="p">,</span> <span class="s">&quot;Building a Form\n&quot;</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">tvc</span><span class="p">);</span>

  <span class="n">createForm</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;SwitchControlDesignMode&quot;</span><span class="p">);</span>
    <span class="c1">// switch from form design/editing mode to live mode</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;build.odt&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of BuildForm()</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="1-creating-controls">1.  Creating Controls<a class="headerlink" href="#1-creating-controls" title="Permanent link">&para;</a></h2>
<p>createForm() makes many calls to Forms.addControl(), and other Forms.addXXX()
methods which indirectly use Forms.addControl(). For example, the call that creates
the "No automatic generation" radio button at the top of the form is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span>
     <span class="n">Forms</span><span class="p">.</span><span class="na">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;Option&quot;</span><span class="p">,</span>  <span class="s">&quot;No automatic generation&quot;</span><span class="p">,</span>
                      <span class="s">&quot;RadioButton&quot;</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>It returns the model's properties since additional values often need to be set after the
control has been created.</p>
<p>Forms.addControl() starts by creating the control's view, utilizing a subclass of the
Shape service, called ControlShape. The relevant part of the service hierarchy is
shown in Figure 2.</p>
<p><img alt="" src="images/40-Building_a_Form-2.png" /></p>
<p>Figure 2. The Shape and ControlShape Services.</p>
<p>Properties in the Shape service define the position, width, and height of the control
inside the form. In the call to Forms.addControl() above, the first pair of numbers,
(106,11), is the intended position, while its width and height are 50 x 6.</p>
<p>After the view has been initialized, the control's model is created by using the string
passed in the method call (e.g. "RadioButton" in this example).</p>
<p>The model and shape are linked together using XControlShape.setControl().</p>
<p>Forms.addControl() is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addControl</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
     <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">label</span><span class="p">,</span> <span class="n">String</span> <span class="n">compKind</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
                                        <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="c1">// use the default form, &quot;Form&quot;, for the control</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">compKind</span><span class="p">,</span>
                              <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>  <span class="p">}</span>



<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addControl</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
      <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">label</span><span class="p">,</span> <span class="n">String</span> <span class="n">compKind</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
      <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="n">XNameContainer</span> <span class="n">parentForm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XPropertySet</span> <span class="n">modelProps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// create a shape to represent the control&#39;s view</span>
    <span class="n">XControlShape</span> <span class="n">cShape</span> <span class="o">=</span>
        <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XControlShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                        <span class="s">&quot;com.sun.star.drawing.ControlShape&quot;</span><span class="p">);</span>

    <span class="c1">// position and size of the shape</span>
    <span class="n">cShape</span><span class="p">.</span><span class="na">setSize</span><span class="p">(</span><span class="k">new</span> <span class="n">Size</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">100</span><span class="p">));</span>
    <span class="n">cShape</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">100</span><span class="p">));</span>

    <span class="c1">// adjust the anchor so that the control is tied to the page</span>
    <span class="n">XPropertySet</span> <span class="n">shapeProps</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cShape</span><span class="p">);</span>
    <span class="n">TextContentAnchorType</span> <span class="n">eAnchorType</span> <span class="o">=</span>
                       <span class="n">TextContentAnchorType</span><span class="p">.</span><span class="na">AT_PARAGRAPH</span><span class="p">;</span>
    <span class="n">shapeProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;AnchorType&quot;</span><span class="p">,</span> <span class="n">eAnchorType</span><span class="p">);</span>

    <span class="c1">// create the control&#39;s model</span>
    <span class="n">XControlModel</span> <span class="n">cModel</span> <span class="o">=</span>
               <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XControlModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                   <span class="s">&quot;com.sun.star.form.component.&quot;</span> <span class="o">+</span> <span class="n">compKind</span><span class="p">);</span>

    <span class="c1">// insert the model into the form (or default to &quot;Form&quot;)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parentForm</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">parentForm</span><span class="p">.</span><span class="na">insertByName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cModel</span><span class="p">);</span>

    <span class="c1">// link model to the shape</span>
    <span class="n">cShape</span><span class="p">.</span><span class="na">setControl</span><span class="p">(</span><span class="n">cModel</span><span class="p">);</span>

    <span class="c1">// add shape to shapes collection of the doc&#39;s draw page</span>
    <span class="n">XDrawPage</span> <span class="n">drawPage</span> <span class="o">=</span> <span class="n">getDrawPage</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">XShapes</span> <span class="n">formShape</span> <span class="n">s</span><span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShapes</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">drawPage</span> <span class="p">);</span>
    <span class="n">formShapes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">cShape</span><span class="p">);</span>

    <span class="c1">// set Name and Label properties for the model</span>
    <span class="n">modelProps</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cModel</span><span class="p">);</span>
    <span class="n">modelProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">modelProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Label&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">modelProps</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addControl()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The control is added to the form in two ways: firstly the control model is placed in the
parent form with:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">parentForm</span><span class="p">.</span><span class="na">insertByName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cModel</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>then the control shape is inserted into the form's draw page:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XDrawPage</span> <span class="n">drawPage</span> <span class="o">=</span> <span class="n">getDrawPage</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">XShapes</span> <span class="n">formShape</span> <span class="n">s</span><span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShapes</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">drawPage</span> <span class="p">);</span>
<span class="n">formShapes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">cShape</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The Forms class contains several methods that call addControl() with fixed
arguments, and set various model properties. For example, Forms.addButton() makes
a CommandButton:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addButton</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
   <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XPropertySet</span> <span class="n">buttonProps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">buttonProps</span> <span class="o">=</span> <span class="n">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot;CommandButton&quot;</span><span class="p">,</span>
                             <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="n">buttonProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;HelpText&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>

    <span class="c1">// don&#39;t want button to be accessible by the &quot;tab&quot; key</span>
    <span class="n">buttonProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Tabstop&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

    <span class="c1">// the button should not steal focus when clicked</span>
    <span class="n">buttonProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;FocusOnClick&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">buttonProps</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addButton()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The "CommandButton" string passed to addControl() means that the model will be an
instance of "com.sun.star.form.component.CommandButton".</p>
<p>Another variant of addControl() is Forms.addLabelledControl() which calls
addControl() twice to attach a text label to the control. For instance, the
"FIRSTNAME" text field is created with:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>

<span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span>
    <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;FIRSTNAME&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>

<span class="n">The</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">()</span> <span class="n">code</span><span class="p">:</span>

<span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addLabelledControl</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
          <span class="n">String</span> <span class="n">label</span><span class="p">,</span> <span class="n">String</span> <span class="n">compKind</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">compKind</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addLabelledControl</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
        <span class="n">String</span> <span class="n">label</span><span class="p">,</span> <span class="n">String</span> <span class="n">compKind</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XPropertySet</span> <span class="n">ctrlProps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// create label (fixed text) control</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&quot;_Label&quot;</span><span class="p">;</span>
    <span class="n">XPropertySet</span> <span class="n">labelProps</span> <span class="o">=</span>
       <span class="n">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot;FixedText&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

    <span class="c1">// create data field control</span>
    <span class="n">ctrlProps</span> <span class="o">=</span> <span class="n">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">compKind</span><span class="p">,</span>
               <span class="n">x</span> <span class="o">+</span> <span class="mi">26</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>  <span class="c1">// to the right</span>
    <span class="n">ctrlProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;DataField&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>

    <span class="c1">// add label props to the control</span>
    <span class="n">ctrlProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;LabelControl&quot;</span><span class="p">,</span> <span class="n">labelProps</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">ctrlProps</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addLabelledControl()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The label is of type com.sun.star.form.component.FixedText, and linked to the text
field by setting its "DataField" and "LabelControl" properties.</p>
<h2 id="2-assigning-a-data-source-to-a-form">2.  Assigning a Data Source to a Form<a class="headerlink" href="#2-assigning-a-data-source-to-a-form" title="Permanent link">&para;</a></h2>
<p>The "Form" and "GridForm" forms are both 'data aware', which means they're
connected to external databases. Data awareness is supported by the DataForm
subclass of the Form service, which is also connected to the RowSet and ResultSet
services of Base, as in Figure 3.</p>
<p><img alt="" src="images/40-Building_a_Form-3.png" /></p>
<p>Figure 3. Part of the DataForm Service Hierarchy.</p>
<p>RowSet in the sdbc module supports the "DataSourceName", "Command", and
"CommandType" properties (amongst others). "DataSourceName" is set to the
database's URL, and "Command", and "CommandType" specify how the database
will be queried by the form's controls.</p>
<p>The "Form" form is attached to the "liang.odb" database by:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="n">XForm</span> <span class="n">defForm</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getForm</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;Form&quot;</span><span class="p">);</span>
<span class="n">Forms</span><span class="p">.</span><span class="na">bindFormToTable</span><span class="p">(</span><span class="n">defForm</span><span class="p">,</span>
                         <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="s">&quot;liang.odb&quot;</span><span class="p">),</span> <span class="s">&quot;Course&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code for Forms.bindFormToTable():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">bindFormToTable</span><span class="p">(</span><span class="n">XForm</span> <span class="n">xForm</span><span class="p">,</span>
                          <span class="n">String</span> <span class="n">sourceName</span><span class="p">,</span> <span class="n">String</span> <span class="n">tableName</span><span class="p">)</span>
<span class="p">{</span> <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;DataSourceName&quot;</span><span class="p">,</span> <span class="n">sourceName</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;Command&quot;</span><span class="p">,</span> <span class="n">tableName</span><span class="p">);</span> <span class="c1">// any table name</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;CommandType&quot;</span><span class="p">,</span> <span class="n">CommandType</span><span class="p">.</span><span class="na">TABLE</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of bindFormToTable()</span>
</code></pre></div>
</div>
</div>
</div>
<p>CommandType.TABLE permits SQL SELECT queries to be sent to the data source
by the controls. The "Command" setting can be the name of any table in the database
since the form's two list boxes (see Figure 1) send their own SELECT queries (see
below).</p>
<p>"GridForm" is set up by a call to Forms.bindFormToSQL() which sends a SQL query
to the database to obtain a result set for filling the GridControl table. The code
fragment in BuildForm.java is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="n">XNameContainer</span> <span class="n">gridCon</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">insertForm</span><span class="p">(</span><span class="s">&quot;GridForm&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">XForm</span> <span class="n">gridForm</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XForm</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gridCon</span><span class="p">);</span>

<span class="n">Forms</span><span class="p">.</span><span class="na">bindFormToSQL</span><span class="p">(</span><span class="n">gridForm</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">DB_FNM</span><span class="p">),</span>
         <span class="s">&quot;SELECT \&quot;firstName\&quot;, \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code for Forms.bindFormToSQL():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">bindFormToSQL</span><span class="p">(</span><span class="n">XForm</span> <span class="n">xForm</span><span class="p">,</span>
                                 <span class="n">String</span> <span class="n">sourceName</span><span class="p">,</span> <span class="n">String</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span> <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;DataSourceName&quot;</span><span class="p">,</span> <span class="n">sourceName</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;Command&quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>   <span class="c1">// SQL statement</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xForm</span><span class="p">,</span> <span class="s">&quot;CommandType&quot;</span><span class="p">,</span> <span class="n">CommandType</span><span class="p">.</span><span class="na">COMMAND</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of bindFormToSQL()</span>
</code></pre></div>
</div>
</div>
</div>
<p>It's not clear to me why the command type must be CommandType.COMMAND in
Forms.bindFormToSQL() since the SELECT query should be processable by
CommandType.TABLE, but using that type cause a run-time error.</p>
<h2 id="3-creating-data-aware-controls">3.  Creating Data-aware Controls<a class="headerlink" href="#3-creating-data-aware-controls" title="Permanent link">&para;</a></h2>
<p>Some control models have subclasses that support data-awareness, which means they
can access the form's data source using SELECT queries. The different types are
shown in Table 2.</p>
<table>
<thead>
<tr>
<th>Control Models</th>
<th>Type of Access</th>
</tr>
</thead>
<tbody>
<tr>
<td>GridControl</td>
<td>Fill a table (grid) with data</td>
</tr>
<tr>
<td>DatabaseListBox,</td>
<td>Fill a list with data</td>
</tr>
<tr>
<td>DatabaseComboBox</td>
<td></td>
</tr>
<tr>
<td>DatabaseTextField,</td>
<td>Fill a text field</td>
</tr>
<tr>
<td>DatabaseDateField,</td>
<td></td>
</tr>
<tr>
<td>DatabaseTimeField,</td>
<td></td>
</tr>
<tr>
<td>DatabaseNumericField,</td>
<td></td>
</tr>
<tr>
<td>DatabasePatternField,</td>
<td></td>
</tr>
<tr>
<td>DatabaseFormattedField,</td>
<td></td>
</tr>
<tr>
<td>DatabaseCurrencyField</td>
<td></td>
</tr>
<tr>
<td>DatabaseRadioButton,</td>
<td>Specify whether a box is selected</td>
</tr>
<tr>
<td>DatabaseCheckBox</td>
<td>or not.</td>
</tr>
<tr>
<td>DatabaseImageControl</td>
<td>Read an image</td>
</tr>
</tbody>
</table>
<p>Table 2. Data-aware Control Models.</p>
<p>The service hierarchy for these control models is similar to the hierarchy for
DatabaseListBox shown in Figure 4 (except for GridControl which I'll get to shortly).</p>
<p><img alt="" src="images/40-Building_a_Form-4.png" /></p>
<p>Figure 4. Part of the Service Hierarchy for DatabaseListBox.</p>
<p>Figure 4 should be compared with the service hierarchy for an non-data-aware model,
such as CommandButton in Figure 8 of Chapter 39.</p>
<p>The model is initialized by setting properties using the database associated with the
parent form. Exactly which properties should be set depends on the model, but
DatabaseListBox and DatabaseComboBox are fairly straightforward.
"ListSourceType" is set to ListSourceType.SQL, and "ListSource" assigned a string
array containing a SQL command. The command should be a SELECT query which
returns a single column result set.</p>
<p>The two DatabaseListBoxs in BuildForm.java (see Figure 1) are initialized by calling
Forms.addDatabaseList() like so:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>

<span class="n">Forms</span><span class="p">.</span><span class="na">addDatabaseList</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;CourseNames&quot;</span><span class="p">,</span>
          <span class="s">&quot;SELECT \&quot;title\&quot; FROM \&quot;Course\&quot;&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

<span class="n">Forms</span><span class="p">.</span><span class="na">addDatabaseList</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;StudNames&quot;</span><span class="p">,</span>
          <span class="s">&quot;SELECT \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">,</span>  <span class="mi">140</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>Forms.addDatabaseList() is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">addDatabaseList</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
                         <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">sqlCmd</span><span class="p">,</span>
                         <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XPropertySet</span> <span class="n">listProps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">listProps</span> <span class="o">=</span> <span class="n">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;DatabaseListBox&quot;</span><span class="p">,</span>
                           <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="c1">// listProps.setPropertyValue(&quot;DefaultSelection&quot;,</span>
    <span class="c1">//                        new short[]{0});  // hangs</span>
    <span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Dropdown&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;MultiSelection&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;BoundColumn&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// data-aware properties</span>
    <span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;ListSourceType&quot;</span><span class="p">,</span>
                                        <span class="n">ListSourceType</span><span class="p">.</span><span class="na">SQL</span><span class="p">);</span>
    <span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;ListSource&quot;</span><span class="p">,</span>
                                     <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="p">{</span> <span class="n">sqlCmd</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">listProps</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of addDatabaseList()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The DatabaseListBox control is created by calling Forms.addControl(), and then the
model's properties are configured.</p>
<p>Setting the list's default selection to be its first value causes Office to hang, so I've
commented out that line in addDatabaseList() above. This means that the list boxes
appear to be empty until the user clicks on them.</p>
<h2 id="4-initializing-the-gridcontrol">4.  Initializing the GridControl<a class="headerlink" href="#4-initializing-the-gridcontrol" title="Permanent link">&para;</a></h2>
<p>The GridControl is created by calling Forms.addControl() with "GridControl" as the
model string. Also, since this is the only control not inside the "Form" default form,
it's necessary to include a reference to the nameContainer for "GridForm":</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="c1">// add &quot;GridForm&quot; to document</span>
<span class="n">XNameContainer</span> <span class="n">gridCon</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">insertForm</span><span class="p">(</span><span class="s">&quot;GridForm&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">XForm</span> <span class="n">gridForm</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XForm</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gridCon</span><span class="p">);</span>

<span class="c1">// &quot;GridForm&quot; uses an SQL query as its data source</span>
<span class="n">Forms</span><span class="p">.</span><span class="na">bindFormToSQL</span><span class="p">(</span><span class="n">gridForm</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">DB_FNM</span><span class="p">),</span>
          <span class="s">&quot;SELECT \&quot;firstName\&quot;, \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">);</span>

<span class="c1">// create grid control inside &quot;GridForm&quot;</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;SalesTable&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
                      <span class="s">&quot;GridControl&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">gridCon</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>"GridForm"s query generates a result set with two columns consisting of first and last
names from the Student table. For this information to be displayed by the grid, two of
the grid's columns must be attached to the two result set columns. This is done by
calling Forms.createGridColumn() twice:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="c1">// get grid control&#39;s model</span>
<span class="n">XControlModel</span> <span class="n">gridModel</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControlModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>

<span class="c1">// connect grid control&#39;s columns to result set</span>
<span class="n">Forms</span><span class="p">.</span><span class="na">createGridColumn</span><span class="p">(</span><span class="n">gridModel</span><span class="p">,</span> <span class="s">&quot;firstName&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="n">Forms</span><span class="p">.</span><span class="na">createGridColumn</span><span class="p">(</span><span class="n">gridModel</span><span class="p">,</span> <span class="s">&quot;lastName&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The main service for a grid control model is GridControl in the form.components
module. Part of its hierarchy is shown in Figure 5.</p>
<p><img alt="" src="images/40-Building_a_Form-5.png" /></p>
<p>Figure 5. Part of the GridControl Service Hierarchy.</p>
<p>If Figure 5's hierarchy is compared to those for other models, such as
CommandButton in Figure 8 of Chapter 39, there are some differences. GridControl
inherits the UnoControlModel service, but not through UnoControlGridModel in the
awt module. A search for such a service returns an entire awt.grid sub-module for grid
services, interfaces, and classes, but these aren't utilized by the form's grid control.</p>
<p>The consequence is that GridControl is initialized in a different way from other
models, and listener code becomes a little harder to implement (as we'll see in section
6).</p>
<p>Forms.createGridColumn() employs the XGridColumnFactory interface to link a grid
column to a result set column:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createGridColumn</span><span class="p">(</span><span class="n">XControlModel</span> <span class="n">gridModel</span><span class="p">,</span>
        <span class="n">String</span> <span class="n">dataField</span><span class="p">,</span> <span class="n">String</span> <span class="n">colKind</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// column container and factory</span>
    <span class="n">XIndexContainer</span> <span class="n">colContainer</span> <span class="o">=</span>
                    <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XIndexContainer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gridModel</span><span class="p">);</span>
    <span class="n">XGridColumnFactory</span> <span class="n">colFactory</span> <span class="o">=</span>
                    <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XGridColumnFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gridModel</span><span class="p">);</span>

    <span class="c1">// create the column</span>
    <span class="n">XPropertySet</span> <span class="n">colProps</span> <span class="o">=</span> <span class="n">colFactory</span><span class="p">.</span><span class="na">createColumn</span><span class="p">(</span><span class="n">colKind</span><span class="p">);</span>
    <span class="n">colProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;DataField&quot;</span><span class="p">,</span> <span class="n">dataField</span><span class="p">);</span>
                <span class="c1">// connect column to this result set column</span>
    <span class="n">colProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Label&quot;</span><span class="p">,</span> <span class="n">dataField</span><span class="p">);</span>
    <span class="n">colProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">dataField</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">colProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Width&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">Integer</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mi">10</span><span class="p">));</span>

    <span class="c1">// add properties column to container</span>
    <span class="n">colContainer</span><span class="p">.</span><span class="na">insertByIndex</span><span class="p">(</span><span class="n">colContainer</span><span class="p">.</span><span class="na">getCount</span><span class="p">(),</span> <span class="n">colProps</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of createGridColumn()</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="5-attaching-listeners">5.  Attaching Listeners<a class="headerlink" href="#5-attaching-listeners" title="Permanent link">&para;</a></h2>
<p>Table 1 shows that nine Office  listeners are used with the controls. To reduce coding,
BuildForm implements their methods:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildForm.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuildForm</span> <span class="kd">implements</span> <span class="n">XEventListener</span><span class="p">,</span>
                   <span class="n">XActionListener</span><span class="p">,</span> <span class="n">XPropertyChangeListener</span><span class="p">,</span>
                   <span class="n">XTextListener</span><span class="p">,</span> <span class="n">XFocusListener</span><span class="p">,</span> <span class="n">XItemListener</span><span class="p">,</span>
                   <span class="n">XMouseListener</span><span class="p">,</span> <span class="n">XSelectionChangeListener</span><span class="p">,</span>
                   <span class="n">XGridColumnListener</span>
<span class="p">{</span>
  <span class="p">:</span>  <span class="c1">// methods for creating the controls ...</span>


  <span class="p">:</span>  <span class="c1">// methods for attaching listeners to the controls ...</span>


  <span class="c1">// listener methods for ...</span>


  <span class="c1">// XEventListener</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disposing</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">ev</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">String</span> <span class="n">implName</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getImplementationName</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Disposing: &quot;</span> <span class="o">+</span> <span class="n">implName</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="c1">// XActionListener</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="p">(</span><span class="n">ActionEvent</span> <span class="n">ev</span><span class="p">)</span>
  <span class="c1">// called when a button has been pressed</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Pressed \&quot;&quot;</span> <span class="o">+</span> <span class="n">ev</span><span class="p">.</span><span class="na">ActionCommand</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>  <span class="p">}</span>


  <span class="p">:</span> <span class="c1">// many more listener methods</span>

<span class="p">}</span>  <span class="c1">// end of BuildForm class</span>
</code></pre></div>
</div>
</div>
</div>
<p>The listener methods are fairly simple, except for the XSelectionChangeListener
attached to the grid control. A button control is attached to a listener like so:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:1"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of createForm() in BuildForm.java...</span>
<span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;&lt;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="n">listenToButton</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code in listenToButton() is depicted by Figure 6. All the other "listener attacher"
functions in BuildForm.java work in a similar way.</p>
<p><img alt="" src="images/40-Building_a_Form-6.png" /></p>
<p>Figure 6. Attaching a Listener to a Button Control.</p>
<p>The property set passed to listenToButton() is cast to XControlModel, and then
converted into a view using Forms.getControl(). The control is cast to an interface
(such as XButton or XTextComponent) which offers an addXXXListener() method.</p>
<p>The listenToButton() method is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:1"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildForm.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">listenToButton</span><span class="p">(</span><span class="n">XPropertySet</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XControlModel</span> <span class="n">cModel</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControlModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
  <span class="n">XControl</span> <span class="n">control</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">cModel</span><span class="p">);</span>
  <span class="n">XButton</span> <span class="n">xButton</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XButton</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">control</span><span class="p">);</span>

  <span class="n">xButton</span><span class="p">.</span><span class="na">setActionCommand</span><span class="p">(</span><span class="n">Forms</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">cModel</span><span class="p">));</span>
  <span class="n">xButton</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>  <span class="c1">// use BuildForms as the listener</span>
<span class="p">}</span>  <span class="c1">// end of listenToButton()</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="6-listening-for-grid-control-selection-changes">6.  Listening for Grid Control Selection Changes<a class="headerlink" href="#6-listening-for-grid-control-selection-changes" title="Permanent link">&para;</a></h2>
<p>Grid selection changes occur when the user clicks on a cell in the table, as in Figure 7.</p>
<p><img alt="" src="images/40-Building_a_Form-7.png" /></p>
<p>Figure 7. Grid Control Selection Change.</p>
<p>Figure 8 shows the grid model and control hierarchy.</p>
<p><img alt="" src="images/40-Building_a_Form-8.png" /></p>
<p>Figure 8. Attaching a Listener to a Grid Control.</p>
<p>The grid model inherits UnoControlModel via FormControlModel. On the control
side, GridControl in the form.control module inherits UnoControl directly.</p>
<p>GridControl supports two listener interfaces – XSelectionSupplier and XGridControl.</p>
<p>Their attachment is handled by listenToGrid(), which is called after the control has
been initialized by createForm():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:1"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in createForm() in BuildForm.java...</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;SalesTable&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
                   <span class="s">&quot;GridControl&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">gridCon</span><span class="p">);</span>
<span class="n">XControlModel</span> <span class="n">gridModel</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControlModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>

<span class="n">Forms</span><span class="p">.</span><span class="na">createGridColumn</span><span class="p">(</span><span class="n">gridModel</span><span class="p">,</span> <span class="s">&quot;firstName&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="n">Forms</span><span class="p">.</span><span class="na">createGridColumn</span><span class="p">(</span><span class="n">gridModel</span><span class="p">,</span> <span class="s">&quot;lastName&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="n">listenToGrid</span><span class="p">(</span><span class="n">gridModel</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>listenToGrid() is defined as:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:1"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildForm.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">listenToGrid</span><span class="p">(</span><span class="n">XControlModel</span> <span class="n">gridModel</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XControl</span> <span class="n">control</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">gridModel</span><span class="p">);</span>
  <span class="n">XGridControl</span> <span class="n">gc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XGridControl</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">control</span><span class="p">);</span>
  <span class="n">gc</span><span class="p">.</span><span class="na">addGridControlListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="n">XSelectionSupplier</span> <span class="n">gridSelection</span> <span class="o">=</span>
                      <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSelectionSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gc</span><span class="p">);</span>
  <span class="n">gridSelection</span><span class="p">.</span><span class="na">addSelectionChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of listenToGrid()</span>
</code></pre></div>
</div>
</div>
</div>
<p>There's no point using XGridControlListener in this example because its
columnChanged() method is only triggered when the data in a column changes, which
never occurs. However, XSelectionChangeListener.selectionChanged() is sent an
event whenever the user's selection changes, which is what we're interested in
reporting.</p>
<h2 id="7-using-the-result-set">7.  Using the Result Set<a class="headerlink" href="#7-using-the-result-set" title="Permanent link">&para;</a></h2>
<p>The XGridControl interface for GridControl doesn't offer all the methods I need for
announcing selection changes.</p>
<p>XGridControl inherits XGrid and XGridFieldDataSupplier. XGrid can retrieve the
currently selected column, while XGridFieldDataSupplier provides access to the data,
but neither of them offer a way to find the currently selected row. That requires the
result set for the table, which can only be examined by starting from the form level.</p>
<p>Getting to the result set requires a number of casts, the first being from the event
object arriving at the listener to the model that sent it. Forms.getEventControlModel()
does that job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:1"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XControlModel</span> <span class="nf">getEventControlModel</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">ev</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XControl</span> <span class="n">xControl</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XControl</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">ev</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">xControl</span><span class="p">.</span><span class="na">getModel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Another conversion step is from control model to the parent form, which is carried out
by Forms.getFormName():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:1"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getFormName</span><span class="p">(</span><span class="n">XControlModel</span> <span class="n">cModel</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XChild</span> <span class="n">xChild</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XChild</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cModel</span><span class="p">);</span>
  <span class="n">XNamed</span> <span class="n">xNamed</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XNamed</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xChild</span><span class="p">.</span><span class="na">getParent</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">xNamed</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>selectionChanged() utilizes getEventControlModel() and getFormName() to convert
an event object to a form. Finally, XForm is cast to a result set using the hierarchy in</p>
<p><img alt="" src="images/40-Building_a_Form-3.png" /></p>
<p>Figure 3.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:1"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildForm.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">selectionChanged</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">ev</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XControlModel</span> <span class="n">cModel</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getEventControlModel</span><span class="p">(</span><span class="n">ev</span><span class="p">);</span>
  <span class="n">XGridControl</span> <span class="n">gc</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XGridControl</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">ev</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Grid &quot;</span> <span class="o">+</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">cModel</span><span class="p">)</span> <span class="o">+</span>
                     <span class="s">&quot; column: &quot;</span> <span class="o">+</span> <span class="n">gc</span><span class="p">.</span><span class="na">getCurrentColumnPosition</span><span class="p">());</span>

  <span class="n">String</span> <span class="n">formName</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getFormName</span><span class="p">(</span><span class="n">cModel</span><span class="p">);</span>
  <span class="n">XForm</span> <span class="n">gForm</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">getForm</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">formName</span><span class="p">);</span>
  <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gForm</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;    row: &quot;</span> <span class="o">+</span> <span class="n">rs</span><span class="p">.</span><span class="na">getRow</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of selectionChanged()</span>
</code></pre></div>
</div>
</div>
</div>
<p>selectionChanged() jumps through these hoops in order to print the currently selected
column and row in the table. The selected column is obtained by calling
XGridControl.getCurrentColumnPosition(), and the current row comes from
XResultSet.getRow().</p>
<h2 id="8-some-bugs">8.  Some Bugs<a class="headerlink" href="#8-some-bugs" title="Permanent link">&para;</a></h2>
<p>My first version of BuildForm.java had a few problems which caused it to hang.</p>
<p>The most serious occurred when I tried to include an image button in the form. The
relevant lines in createForm() in BuildForm.java were:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:1"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in createForm() in BuildForm.java...</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;Smiley&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
                                 <span class="s">&quot;ImageButton&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;ImageURL&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="s">&quot;smiley.png&quot;</span><span class="p">));</span>
</code></pre></div>
</div>
</div>
</div>
<p>The button would sometimes appear at the correct position, but cause Office to hang
when pressed, and sometimes the button wouldn't appear at all. After failing to find an
answer online, I commented out the above lines. If anyone knows of a solution please
contact me.</p>
<p>A more minor issue is the initial lack of text in the DatabaseListBoxs. In the original
Forms.addDatabaseList(), the list text was set with:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:1"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">listProps</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;DefaultSelection&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="kt">short</span><span class="o">[]</span><span class="p">{</span><span class="mi">0</span><span class="p">});</span>
</code></pre></div>
</div>
</div>
</div>
<p>This line caused Office to hang, and once again I 'solved' the problem by commenting
out the code. The unfortunate side-effect is that now the list box's text is blank until
the user clicks on the list.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="39-Forms_API_Overview.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 39. Forms API Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 39. Forms API Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="41-Printing.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 41. Printing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 41. Printing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>