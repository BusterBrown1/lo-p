
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 8. Graphic Content - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-8-graphic-content" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 8. Graphic Content
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 8. Graphic Content
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="08-Graphic_Content.html" class="md-nav__link md-nav__link--active">
        Chapter 8. Graphic Content
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-linking-a-graphic-object-to-a-document" class="md-nav__link">
    1.  Linking a Graphic Object to a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-adding-a-graphic-to-a-document-as-a-shape" class="md-nav__link">
    2.  Adding a Graphic to a Document as a Shape
  </a>
  
    <nav class="md-nav" aria-label="2.  Adding a Graphic to a Document as a Shape">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-creating-an-image-shape" class="md-nav__link">
    2.1.  Creating an Image Shape
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-adding-other-graphics-to-the-document" class="md-nav__link">
    2.2.  Adding Other Graphics to the Document
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-accessing-linked-images-and-shapes" class="md-nav__link">
    3.  Accessing Linked Images and Shapes
  </a>
  
    <nav class="md-nav" aria-label="3.  Accessing Linked Images and Shapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-finding-and-saving-text-graphics-in-a-document" class="md-nav__link">
    3.1.  Finding and Saving Text Graphics in a Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-finding-the-shapes-in-a-document" class="md-nav__link">
    3.2.  Finding the Shapes in a Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-another-way-of-accessing-drawing-shapes" class="md-nav__link">
    3.3.  Another Way of Accessing Drawing Shapes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-linking-a-graphic-object-to-a-document" class="md-nav__link">
    1.  Linking a Graphic Object to a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-adding-a-graphic-to-a-document-as-a-shape" class="md-nav__link">
    2.  Adding a Graphic to a Document as a Shape
  </a>
  
    <nav class="md-nav" aria-label="2.  Adding a Graphic to a Document as a Shape">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-creating-an-image-shape" class="md-nav__link">
    2.1.  Creating an Image Shape
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-adding-other-graphics-to-the-document" class="md-nav__link">
    2.2.  Adding Other Graphics to the Document
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-accessing-linked-images-and-shapes" class="md-nav__link">
    3.  Accessing Linked Images and Shapes
  </a>
  
    <nav class="md-nav" aria-label="3.  Accessing Linked Images and Shapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-finding-and-saving-text-graphics-in-a-document" class="md-nav__link">
    3.1.  Finding and Saving Text Graphics in a Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-finding-the-shapes-in-a-document" class="md-nav__link">
    3.2.  Finding the Shapes in a Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-another-way-of-accessing-drawing-shapes" class="md-nav__link">
    3.3.  Another Way of Accessing Drawing Shapes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/08-Graphic_Content.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-8-graphic-content">Chapter 8. Graphic Content<a class="headerlink" href="#chapter-8-graphic-content" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Graphics;
Linked Images/Shapes</p>
<p>Example folders: "Text
Tests" and "Utils"</p>
</div>
<p>Chapter 7 looked at several forms of text document
content (e.g. text frames, math formulae, text fields and
tables, and bookmarks), as indicated by Figure 1. However
the different ways of adding graphical content (corresponding to the services
highlighted in orange) are the focus of this chapter</p>
<p><img alt="" src="images/08-Graphic_Content-1.png" /></p>
<p>Figure 1. The TextContent Service and Some Subclasses.</p>
<h2 id="1-linking-a-graphic-object-to-a-document">1.  Linking a Graphic Object to a Document<a class="headerlink" href="#1-linking-a-graphic-object-to-a-document" title="Permanent link">&para;</a></h2>
<p>Adding an image to a text document follows the same steps as other text content, as
shown in Write.addImageLink():</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addImageLink</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span>
                             <span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">addImageLink</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">fnm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="p">}</span>
                     <span class="c1">// 0, 0 means use image&#39;s size as width &amp; height</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addImageLink</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span>
                           <span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span>
                           <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span> <span class="k">try</span> <span class="p">{</span>

    <span class="c1">// create TextContent for graphic</span>
    <span class="n">XTextContent</span> <span class="n">tgo</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                             <span class="s">&quot;com.sun.star.text.TextGraphicObject&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tgo</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a text graphic object&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// set anchor and URL properties</span>
    <span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span> <span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">tgo</span><span class="p">);</span>
    <span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;AnchorType&quot;</span><span class="p">,</span>
                           <span class="n">TextContentAnchorType</span><span class="p">.</span><span class="na">AS_CHARACTER</span><span class="p">);</span>
    <span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;GraphicURL&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>

    <span class="c1">// optionally set the width and height</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Width&quot;</span><span class="p">,</span> <span class="n">width</span><span class="p">);</span>
      <span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Height&quot;</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// append image to document, followed by a newline</span>
    <span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">tgo</span><span class="p">);</span>
    <span class="n">endLine</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Insert of \&quot;&quot;</span> <span class="o">+</span> <span class="n">fnm</span> <span class="o">+</span> <span class="s">&quot;\&quot; failed: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of addImageLink()</span>
</code></pre></div>
<p>The TextGraphicObject service doesn't offer a XTextGraphicObject interface, so
Lo.createInstanceMSF() returns an XTextContext.</p>
<p>The interface is also converted to XPropertySet because several properties need to be
set. The frame is anchored, and the image's filename is assigned to "GraphicURL"
(after being changed into a URL).</p>
<p>The image's size on the page depends on the dimensions of its enclosing frame, which
are set in the "Width" and "Height" properties:</p>
<div class="highlight"><pre><span></span><code><span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Width&quot;</span><span class="p">,</span> <span class="mi">4500</span><span class="p">);</span>   <span class="c1">// 45 mm width</span>
<span class="n">props</span><span class="p">.</span><span class="na">setPropertyValue</span><span class="p">(</span><span class="s">&quot;Height&quot;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>  <span class="c1">// 40 mm height</span>
</code></pre></div>
<p>The values are in 1/100 mm units, so 4500 is 45 mm or 4.5 cm.</p>
<p>If these properties aren't explicitly set then the frame size defaults to being the width
and height of the image.</p>
<p>In more realistic code, the width and height properties would be calculated as some
scale factor of the image's size, as measured in 1/100 mm units not pixels. These
dimensions are available if the image file is loaded as an XGraphic object, as shown
in Images.getSize100mm():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Images class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Size</span> <span class="nf">getSize100mm</span><span class="p">(</span><span class="n">String</span> <span class="n">imFnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XGraphic</span> <span class="n">graphic</span> <span class="o">=</span> <span class="n">loadGraphicFile</span><span class="p">(</span><span class="n">imFnm</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">graphic</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">Size</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">graphic</span><span class="p">,</span> <span class="s">&quot;Size100thMM&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getSize100mm()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XGraphic</span> <span class="nf">loadGraphicFile</span><span class="p">(</span><span class="n">String</span> <span class="n">imFnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// create graphics provider</span>
  <span class="n">XGraphicProvider</span> <span class="n">gProvider</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span>
                    <span class="n">XGraphicProvider</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                    <span class="s">&quot;com.sun.star.graphic.GraphicProvider&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Graphic Provider could not be found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// set URL property and query it for XGraphic</span>
  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">fileProps</span> <span class="o">=</span>
            <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;URL&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">imFnm</span><span class="p">));</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">gProvider</span><span class="p">.</span><span class="na">queryGraphic</span><span class="p">(</span><span class="n">fileProps</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not load XGraphic from &quot;</span> <span class="o">+</span> <span class="n">imFnm</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of loadGraphicFile()</span>
</code></pre></div>
<p>Displaying the image at a scaled size is possible by combining
Images.getSize100mm() and Write.addImageLink():</p>
<div class="highlight"><pre><span></span><code><span class="n">Size</span> <span class="n">imSize</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">getSize100mm</span><span class="p">(</span><span class="n">imFnm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">round</span><span class="p">(</span><span class="n">imSize</span><span class="p">.</span><span class="na">Width</span><span class="o">*</span><span class="mf">1.5</span><span class="p">);</span>   <span class="c1">// enlarge by 1.5x</span>
<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">round</span><span class="p">(</span><span class="n">imSize</span><span class="p">.</span><span class="na">Height</span><span class="o">*</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">Write</span><span class="p">.</span><span class="na">addImageLink</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">imFnm</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
</code></pre></div>
<p>A possible drawback of Write.addImageLink() is that the document only contains a
link to the image. This becomes an issue if you save the document in a format other
than ".odt". In particular, when saved as a Word ".doc" file, the link is lost.</p>
<h2 id="2-adding-a-graphic-to-a-document-as-a-shape">2.  Adding a Graphic to a Document as a Shape<a class="headerlink" href="#2-adding-a-graphic-to-a-document-as-a-shape" title="Permanent link">&para;</a></h2>
<p>An alternative to inserting a graphic as a link is to treat it as a shape. Shapes will be
discussed at length in Part 3, so I won't go into much detail about them here. One
difference between a graphic link and shape is that shapes can be rotated.</p>
<p>Shapes can be created using the com.sun.star.text.Shape service,
com.sun.star.drawing.Shape, or one of its subclasses, while
XDrawPageSupplier.getDrawPage() accesses the shapes in a document.</p>
<p>The shape hierarchy is quite extensive (i.e. there are many kinds of shape), so only the
parts used here are shown in Figure 2:</p>
<p><img alt="" src="images/08-Graphic_Content-2.png" /></p>
<p>Figure 2. Part of the Shape Hierarchy.</p>
<p>In Figure 2, "(text) Shape" refers to the com.sun.star.text.Shape service, while
"(drawing) Shape" is com.sun.star.drawing.Shape.</p>
<p>My examples use GraphicObjectShape to create a shape containing an image, and
LineShape to add a line to the document.</p>
<p>The XShapeDescriptor interface in com.sun.star.drawing.Shape is a useful way to
obtain the name of a shape service.</p>
<h3 id="21-creating-an-image-shape">2.1.  Creating an Image Shape<a class="headerlink" href="#21-creating-an-image-shape" title="Permanent link">&para;</a></h3>
<p>The BuildDoc.java example adds an image shape to the document by calling
Write.addImageShape():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// code fragment in BuildDoc.java</span>
<span class="n">Write</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;Image as a shape: &quot;</span><span class="p">);</span>
<span class="n">Write</span><span class="p">.</span><span class="na">addImageShape</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">imFnm</span><span class="p">);</span> <span class="c1">// image filename</span>
<span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
</code></pre></div>
<p>Write.addImageShape() comes in two versions: with and without width and height
arguments. A shape with no explicitly set width and height properties is rendered as a
miniscule image (about 1 mm wide). Call me old-fashioned, but I want to see the
graphic, so Write.addImageShape() calculates the picture's dimensions if none are
supplied by the user.</p>
<p>Another difference between image shape and image link is how the content's
"GraphicURL" property is employed. The image link version contains its URL, while
the image shape's "GraphicURL" stores its bitmap as a string.</p>
<p>The code for Write.addImageShape():</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addImageShape</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span>
                            <span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">addImageShape</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">fnm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="p">}</span>
              <span class="cm">/* 0, 0 means that the method must calculate</span>
<span class="cm">                 the image&#39;s size */</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addImageShape</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span>
           <span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Size</span> <span class="n">imSize</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">imSize</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Size</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">imSize</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">getSize100mm</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">imSize</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// create TextContent for the graphic shape</span>
    <span class="n">XTextContent</span> <span class="n">gos</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span>
              <span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
              <span class="s">&quot;com.sun.star.drawing.GraphicObjectShape&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gos</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a graphic shape&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// store the image&#39;s bitmap in the &quot;GraphicURL&quot; property</span>
    <span class="n">String</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">getBitmap</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">gos</span><span class="p">,</span> <span class="s">&quot;GraphicURL&quot;</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">);</span>

    <span class="c1">// set the shape&#39;s size</span>
    <span class="n">XShape</span> <span class="n">xDrawShape</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">gos</span><span class="p">);</span>
    <span class="n">xDrawShape</span><span class="p">.</span><span class="na">setSize</span><span class="p">(</span><span class="n">imSize</span><span class="p">);</span>  <span class="c1">// must be set, or image is tiny</span>

    <span class="c1">// insert image shape into the document, followed by newline</span>
    <span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">gos</span><span class="p">);</span>
    <span class="n">endLine</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Insert of \&quot;&quot;</span> <span class="o">+</span> <span class="n">fnm</span> <span class="o">+</span> <span class="s">&quot;\&quot; failed: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of addImageShape()</span>
</code></pre></div>
<p>The image's size is calculated using Images.getSize100mm() if the user doesn't supply
a width and height, and is used towards the end of the method.</p>
<p>An image shape is created using the GraphicObjectShape service, and its
XTextContent interface is converted to XPropertySet for assigning its properties, and
to XShape for setting its size (see Figure 2). XShape includes a setSize() method.</p>
<p>Images.getBitmap() converts the graphic into a bitmap string.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Images utility class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getBitmap</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// create a BitmapTable service and named container</span>
    <span class="n">XNameContainer</span> <span class="n">bitmapContainer</span> <span class="o">=</span>
         <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XNameContainer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                       <span class="s">&quot;com.sun.star.drawing.BitmapTable&quot;</span><span class="p">);</span>

    <span class="c1">// insert image into container</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">FileIO</span><span class="p">.</span><span class="na">isOpenable</span><span class="p">(</span><span class="n">fnm</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="n">String</span> <span class="n">picURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">picURL</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="n">bitmapContainer</span><span class="p">.</span><span class="na">insertByName</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">picURL</span><span class="p">);</span>
            <span class="c1">// use the filename as the name of the bitmap</span>

    <span class="c1">// return the bitmap as a string</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">bitmapContainer</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create bitmap for &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getBitmap()</span>
</code></pre></div>
<p>getBitmap() uses a BitmapTable service to store the image's file in an
XNameContainer. When the bitmap value is retrieved from the container, it can be
cast to a string.</p>
<p>A named container requires a name be assigned to the bitmap value; I use the image's
filename, but any unique string would do.</p>
<h3 id="22-adding-other-graphics-to-the-document">2.2.  Adding Other Graphics to the Document<a class="headerlink" href="#22-adding-other-graphics-to-the-document" title="Permanent link">&para;</a></h3>
<p>The graphic text content can be any subclass of Shape. In the last section I created a
GraphicObjectShape service, and accessed its XTextContent interface:</p>
<div class="highlight"><pre><span></span><code><span class="n">XTextContent</span> <span class="n">gos</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                        <span class="s">&quot;com.sun.star.drawing.GraphicObjectShape&quot;</span><span class="p">);</span>
</code></pre></div>
<p>In this section I'll use LineShape:</p>
<div class="highlight"><pre><span></span><code><span class="n">XTextContent</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span><span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                       <span class="s">&quot;com.sun.star.drawing.LineShape&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The aim is to draw an horizontal line in the document, to act as a divider between
paragraphs. The line will be half-a-page wide and centered, like the one in Figure 3</p>
<p><img alt="" src="images/08-Graphic_Content-3.png" /></p>
<p>Figure 3. A Graphical Line Divider.</p>
<p>The difficult part is calculating the width of the line, which should only extend across
half the writing width. This isn't the same as the page width because it doesn't include
the left and right margins.</p>
<p>The page and margin dimensions are accessible through the "Standard" page style, as
implemented in Write.getPageTextWidth():</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getPageTextWidth</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="c1">// get the page&#39;s writing width</span>
<span class="p">{</span>
  <span class="c1">// access the &quot;standard&quot; style in the pages style family</span>
  <span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span>
         <span class="n">Info</span><span class="p">.</span><span class="na">getStyleProps</span><span class="p">(</span><span class="n">textDoc</span><span class="p">,</span> <span class="s">&quot;PageStyles&quot;</span><span class="p">,</span> <span class="s">&quot;Standard&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">props</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access the standard page style&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// lookup the page and margin widths</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="n">props</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span>
                                      <span class="s">&quot;Width&quot;</span><span class="p">)).</span><span class="na">intValue</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">leftMargin</span> <span class="o">=</span> <span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="n">props</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span>
                                      <span class="s">&quot;LeftMargin&quot;</span><span class="p">)).</span><span class="na">intValue</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">rightMargin</span> <span class="o">=</span> <span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="n">props</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span>
                                     <span class="s">&quot;RightMargin&quot;</span><span class="p">)).</span><span class="na">intValue</span><span class="p">();</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">leftMargin</span> <span class="o">+</span> <span class="n">rightMargin</span><span class="p">));</span>  <span class="c1">// writing width</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access page dimensions: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getPageTextWidth()</span>
</code></pre></div>
<p>getPageTextWidth() returns the writing width in 1/100 mm units, which is scaled,
then passed to Write.addLineDivider():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// code fragment in BuildDoc,java</span>
<span class="kt">int</span> <span class="n">textWidth</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getPageTextWidth</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">Write</span><span class="p">.</span><span class="na">addLineDivider</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">round</span><span class="p">(</span><span class="n">textWidth</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">);</span>
                                     <span class="c1">// scale width by 0.5</span>
</code></pre></div>
<p>addLineDivider() creates a LineShape service with an XTextContent interface (see
Figure 2). This is converted to XShape so its setSize() method can be passed the line
width:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addLineDivider</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span>
                                             <span class="kt">int</span> <span class="n">lineWidth</span><span class="p">)</span>
<span class="c1">// in the Writer class</span>
<span class="p">{</span> <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// create TextContent for a line</span>
    <span class="n">XTextContent</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMSF</span><span class="p">(</span>
                       <span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                       <span class="s">&quot;com.sun.star.drawing.LineShape&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ls</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a line shape&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// set line size</span>
    <span class="n">XShape</span> <span class="n">lineShape</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">ls</span><span class="p">);</span>
    <span class="n">lineShape</span><span class="p">.</span><span class="na">setSize</span><span class="p">(</span> <span class="k">new</span> <span class="n">Size</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

    <span class="n">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
    <span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">ls</span><span class="p">);</span>   <span class="c1">// put line in its own paragraph</span>
    <span class="n">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>

    <span class="c1">// center the line paragraph</span>
    <span class="n">stylePrevParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;ParaAdjust&quot;</span><span class="p">,</span>
             <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">style</span><span class="p">.</span><span class="na">ParagraphAdjust</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>

    <span class="n">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Insertion of graphic line failed&quot;</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of addLineDivider()</span>
</code></pre></div>
<p>The centering of the line is achieved by placing the shape in its own paragraph, then
using Write.stylePrevParagraph() to center it.</p>
<h2 id="3-accessing-linked-images-and-shapes">3.  Accessing Linked Images and Shapes<a class="headerlink" href="#3-accessing-linked-images-and-shapes" title="Permanent link">&para;</a></h2>
<p>The outcome of running BuildDoc.java is a "build.odt" file containing four graphics –
two are linked images, one is an image shape, and the other a line shape.</p>
<p>The ExtractGraphics.java example extracts linked graphics from a document, saving
them as PNG files. It also prints information about the shapes in the document.</p>
<p>When ExtractGraphics is passed "build.odt", the following is output:</p>
<div class="highlight"><pre><span></span><code>Num. of text graphics: 2
Saving graphic in graphics1.png
Image size in pixels: 319 x 274
Saving graphic in graphics2.png
Image size in pixels: 319 x 274

Num. of draw shapes: 3
  Shape service: FrameShape; z-order: 0
  Shape service: com.sun.star.drawing.GraphicObjectShape; z-order: 1
  Shape service: com.sun.star.drawing.LineShape; z-order: 2
</code></pre></div>
<p>A user who looked at "build.odt" for themselves might say that it contains three
images not the two reported by ExtractGraphics. Why the discrepancy?
ExtractGraphics.java only saves linked graphics, and only two were added by
Write.addImageLink(). The other image was inserted using Write.addImageShape()
which creates an image shape.</p>
<p>The number of shapes reported by ExtractGraphics.java may also confuse the user –
why are there three rather than two? The only shapes added to the document were an
image and a line.</p>
<p>The names of the services gives a clue: the second and third shapes are the expected
GraphicObjectShape and LineShape, but the first is a text frame (FrameShape) added
by Write.addTextFrame(). Although this frame is an instance of the TextFrame
service, it's reported as a FrameShape. That's a bit mysterious because there's no
FrameShape service in the Office documentation.</p>
<p>The main() function of ExtractGraphics.java:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

  <span class="n">XTextDocument</span> <span class="n">textDoc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">textDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// save text graphics to files</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XGraphic</span><span class="o">&gt;</span> <span class="n">pics</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getTextGraphics</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pics</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nNum. of text graphics: &quot;</span> <span class="o">+</span> <span class="n">pics</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XGraphic</span> <span class="n">pic</span> <span class="p">:</span> <span class="n">pics</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Images</span><span class="p">.</span><span class="na">saveGraphic</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="s">&quot;graphics&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span><span class="p">,</span> <span class="s">&quot;png&quot;</span><span class="p">);</span>
    <span class="n">Size</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Size</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="s">&quot;SizePixel&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image size in pixels: &quot;</span> <span class="o">+</span>
                                <span class="n">sz</span><span class="p">.</span><span class="na">Width</span> <span class="o">+</span> <span class="s">&quot; x &quot;</span> <span class="o">+</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="p">);</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

  <span class="c1">// report on shapes in the document</span>
  <span class="n">XDrawPage</span> <span class="n">drawPage</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getShapes</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getShapes</span><span class="p">(</span><span class="n">drawPage</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">shapes</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nNum. of draw shapes: &quot;</span> <span class="o">+</span> <span class="n">shapes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XShape</span> <span class="n">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span>
    <span class="n">Draw</span><span class="p">.</span><span class="na">printShapeInfo</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>The first block of code saves text graphic objects as PNGs, and the second reports on
shapes.</p>
<h3 id="31-finding-and-saving-text-graphics-in-a-document">3.1.  Finding and Saving Text Graphics in a Document<a class="headerlink" href="#31-finding-and-saving-text-graphics-in-a-document" title="Permanent link">&para;</a></h3>
<p>Write.getTextGraphics() returns a list of XGraphic objects: first it retrieves a
collection of the graphic links in the document, then iterates through them creating an
XGraphic object for each one:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Write class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XGraphic</span><span class="o">&gt;</span> <span class="nf">getTextGraphics</span><span class="p">(</span>
                                    <span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">// get all the graphic links</span>
  <span class="n">XNameAccess</span> <span class="n">xNameAccess</span> <span class="o">=</span> <span class="n">getGraphicLinks</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xNameAccess</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">xNameAccess</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Number of graphics found: &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>

  <span class="c1">// build a list of XGraphic objects, one for each link</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XGraphic</span><span class="o">&gt;</span> <span class="n">pics</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XGraphic</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">names</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Object</span> <span class="n">graphicLink</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">graphicLink</span> <span class="o">=</span> <span class="n">xNameAccess</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">graphicLink</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No graphic found for &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">XGraphic</span> <span class="n">xGraphic</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">loadGraphicLink</span><span class="p">(</span><span class="n">graphicLink</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xGraphic</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
        <span class="n">pics</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">xGraphic</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">names</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; could not be accessed&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">pics</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getTextGraphics()</span>
</code></pre></div>
<p>Graphic objects are accessed with XTextGraphicObjectsSupplier, as implemented by
Write.getGraphicLinks():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Write class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XNameAccess</span> <span class="nf">getGraphicLinks</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTextGraphicObjectsSupplier</span> <span class="n">imsSupplier</span> <span class="o">=</span>
                  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextGraphicObjectsSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">imsSupplier</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Supplier could not be created&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XNameAccess</span> <span class="n">xNameAccess</span> <span class="o">=</span> <span class="n">imsSupplier</span><span class="p">.</span><span class="na">getGraphicObjects</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xNameAccess</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>  <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Name access to graphics not possible&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">xNameAccess</span><span class="p">.</span><span class="na">hasElements</span><span class="p">())</span>  <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No graphics elements found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">xNameAccess</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getGraphicLinks()</span>
</code></pre></div>
<p>Back in Write.getTextGraphics, each graphic is loaded by calling
Images.loadGraphicLink(). It loads an image from the URL associated with a link:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Images class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XGraphic</span> <span class="nf">loadGraphicLink</span><span class="p">(</span><span class="n">Object</span> <span class="n">graphicLink</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// create graphic provider</span>
  <span class="n">XGraphicProvider</span> <span class="n">gProvider</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span>
                        <span class="n">XGraphicProvider</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                       <span class="s">&quot;com.sun.star.graphic.GraphicProvider&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Graphic Provider could not be found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// set up URL property then load as an XGraphic</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XPropertySet</span> <span class="n">xprops</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">graphicLink</span><span class="p">);</span>
    <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">gProps</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;URL&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">xprops</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="s">&quot;GraphicURL&quot;</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">gProvider</span><span class="p">.</span><span class="na">queryGraphic</span><span class="p">(</span><span class="n">gProps</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to retrieve graphic&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of loadGraphicLink()</span>
</code></pre></div>
<p>Note that the XGraphic is not extracted from the document but loaded from a URL.</p>
<p>Back in ExtractGraphics.java, the XGraphic objects are saved as PNG files, and their
pixel sizes reported:</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">savePics</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="c1">// method in ExtractGraphics.java</span>
<span class="p">{</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XGraphic</span><span class="o">&gt;</span> <span class="n">pics</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getTextGraphics</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pics</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No. of graphic retrieved: &quot;</span> <span class="o">+</span>  <span class="n">pics</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XGraphic</span> <span class="n">pic</span> <span class="p">:</span> <span class="n">pics</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Images</span><span class="p">.</span><span class="na">saveGraphic</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="s">&quot;graphics&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span><span class="p">,</span> <span class="s">&quot;png&quot;</span><span class="p">);</span>
    <span class="n">Size</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Size</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="s">&quot;SizePixel&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Image Pixel size: &quot;</span> <span class="o">+</span>
                             <span class="n">sz</span><span class="p">.</span><span class="na">Width</span> <span class="o">+</span> <span class="s">&quot; x &quot;</span> <span class="o">+</span> <span class="n">sz</span><span class="p">.</span><span class="na">Height</span><span class="p">);</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of savePics()</span>
</code></pre></div>
<p>Images.saveGraphic() utilizes the graphic provider's XGraphicProvider.storeGraphic()
method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in XGraphicProvider</span>
<span class="kt">void</span> <span class="nf">storeGraphic</span><span class="p">(</span><span class="n">XGraphic</span> <span class="n">g</span><span class="p">,</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
<p>Its second argument is an array of PropertyValue objects, not a PropertySet. My
Props.java utility class provides several functions for creating PropertyValue
instances, which are a variant of the {name=value} pair idea, but with extra data
fields. One such function is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in Props.java</span>
<span class="n">PropertyValue</span><span class="o">[]</span> <span class="nf">makeProps</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">nms</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">vals</span><span class="p">)</span>
<span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
<p>It's passed an array of names and values, which are paired up as PropertyValue
objects, and returned in an array.</p>
<p>In saveGraphic(), these methods are used like so:</p>
<div class="highlight"><pre><span></span><code><span class="n">XGraphicProvider</span> <span class="n">gProvider</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span>
                      <span class="n">XGraphicProvider</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                     <span class="s">&quot;com.sun.star.graphic.GraphicProvider&quot;</span><span class="p">);</span>

<span class="c1">// set up properties for storing the graphic</span>
<span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span>
                           <span class="s">&quot;URL&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">),</span>
                           <span class="s">&quot;MimeType&quot;</span><span class="p">,</span> <span class="s">&quot;image/&quot;</span> <span class="o">+</span> <span class="n">imFormat</span><span class="p">);</span>

<span class="n">gProvider</span><span class="p">.</span><span class="na">storeGraphic</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
</code></pre></div>
<p>The idea is to call XGraphicProvider.saveGraphics() with the "URL" and
"MimeType" properties set – the URL is for the image file, and the mimetype is an
image type (e.g. "image/png").</p>
<p>saveGraphic() is coded as:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveGraphic</span><span class="p">(</span><span class="n">XGraphic</span> <span class="n">pic</span><span class="p">,</span>
                                <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">String</span> <span class="n">imFormat</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">// create graphic provider</span>
  <span class="n">XGraphicProvider</span> <span class="n">gProvider</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span>
                       <span class="n">XGraphicProvider</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                       <span class="s">&quot;com.sun.star.graphic.GraphicProvider&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Graphic Provider could not be found&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">pic</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Supplied image is null&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// set up properties for storing the graphic</span>
  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">pngProps</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span>
                           <span class="s">&quot;URL&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">),</span>
                           <span class="s">&quot;MimeType&quot;</span><span class="p">,</span> <span class="s">&quot;image/&quot;</span> <span class="o">+</span> <span class="n">imFormat</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">gProvider</span><span class="p">.</span><span class="na">storeGraphic</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="n">pngProps</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to save graphic&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of saveGraphic()</span>
</code></pre></div>
<p>Other possible image MIME types include "gif", "jpeg", "wmf", and "bmp". For
instance, this call will save the image as a GIF:
Images.saveGraphic(pic, "graphics" + i + ".gif", "gif");
The printed output from saveGraphic() contains another surprise:</p>
<div class="highlight"><pre><span></span><code>Num. of text graphics: 2
Saving graphic in graphics1.png
Image size in pixels: 319 x 274
Saving graphic in graphics2.png
Image size in pixels: 319 x 274
</code></pre></div>
<p>The two saved graphics are the same size, but the second image is bigger inside the
document. The discrepancy is because the rendering of the image in the document is
bigger, scaled up to fit the enclosing frame; the original image is unchanged.</p>
<h3 id="32-finding-the-shapes-in-a-document">3.2.  Finding the Shapes in a Document<a class="headerlink" href="#32-finding-the-shapes-in-a-document" title="Permanent link">&para;</a></h3>
<p>The second block of code in ExtractGraphics reports on the shapes found in the
document. The relevant code fragment is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// code fragment from ExtractGraphics.java</span>
<span class="n">XDrawPage</span> <span class="n">drawPage</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getShapes</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getShapes</span><span class="p">(</span><span class="n">drawPage</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">shapes</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nNum. of draw shapes: &quot;</span> <span class="o">+</span> <span class="n">shapes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<span class="k">for</span><span class="p">(</span><span class="n">XShape</span> <span class="n">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">Draw</span><span class="p">.</span><span class="na">printShapeInfo</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
</code></pre></div>
<p>Shapes are accessed with the XDrawPageSupplier.getDrawPage() method, which
returns a single XDrawPage:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">XDrawPage</span> <span class="nf">getShapes</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XDrawPageSupplier</span> <span class="n">drawPageSupplier</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                           <span class="n">XDrawPageSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">drawPageSupplier</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Draw page supplier could not be created&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">drawPageSupplier</span><span class="p">.</span><span class="na">getDrawPage</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getShapes()</span>
</code></pre></div>
<p>XDrawPage's usual role is to represent the canvas in Office's Draw, or a slide in
Impress, and so plays an important role in Part 3. Several support functions inside that
part's Draw utility class will be used here.</p>
<p>XDrawPageSupplier.getDrawPage() returns a single XDrawPage for the entire text
document. That doesn't mean that the shapes all have to occur on a single text page,
but rather that all the shapes spread across multiple text pages are collected into a
single draw page.</p>
<p>XDrawPage inherits from XShapes and XindexAccess, as shown in Figure 4, which
means that a page can be viewed as a indexed collection of shapes.</p>
<p><img alt="" src="images/08-Graphic_Content-4.png" /></p>
<p>Figure 4. Partial Inheritance Hierarchy for XDrawPage.</p>
<p>Draw.getShapes() uses this idea to iterate through the draw page and store the shapes
in a list:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Draw class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="nf">getShapes</span><span class="p">(</span><span class="n">XDrawPage</span> <span class="n">dp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dp</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Draw page is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">dp</span><span class="p">.</span><span class="na">getCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Draw page does not contain any shapes&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// create a shapes list</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span> <span class="n">xShapesList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">XShape</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dp</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">xShapesList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XShape</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dp</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Extraction error in draw page&quot;</span><span class="p">);</span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">xShapesList</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getShapes()</span>
</code></pre></div>
<p>XShape is part of the Shape service, which contains many shape-related properties.</p>
<p>XShape inherits XShapeDescriptor, which includes a getShapeType() method for
returning the shape type as a string. Figure 5 summarizes these details.</p>
<p><img alt="" src="images/08-Graphic_Content-5.png" /></p>
<p>Figure 5. The Shape Service and XShape Interface</p>
<p>Draw.printShapeInfo() accesses the Shape service associated with an XShape
reference, and prints its "XOrder" property. This number indicates the order that the
shapes were added to the document.</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printShapeInfo</span><span class="p">(</span><span class="n">XShape</span> <span class="n">xShape</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Integer</span> <span class="n">nZOrder</span> <span class="o">=</span> <span class="p">(</span><span class="n">Integer</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">xShape</span><span class="p">,</span> <span class="s">&quot;ZOrder&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Shape service: &quot;</span> <span class="o">+</span> <span class="n">xShape</span><span class="p">.</span><span class="na">getShapeType</span><span class="p">()</span> <span class="o">+</span>
                     <span class="s">&quot;; z-order: &quot;</span> <span class="o">+</span> <span class="n">nZOrder</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>printShapeInfo() also calls the inherited XShapeDescriptor.getShapeType() method to
report the shape's service name.</p>
<h3 id="33-another-way-of-accessing-drawing-shapes">3.3.  Another Way of Accessing Drawing Shapes<a class="headerlink" href="#33-another-way-of-accessing-drawing-shapes" title="Permanent link">&para;</a></h3>
<p>The XDrawPageSupplier documentation states that this interface is deprecated,
although what's meant to replace it isn't clear. My guess is
com.sun.star.text.XTextShapesSupplier, although I wasn't able to get it to supply
anything. For example, the following always reports that the supplier is null:</p>
<div class="highlight"><pre><span></span><code><span class="n">XTextShapesSupplier</span> <span class="n">shpsSupplier</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                              <span class="n">XTextShapesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textDoc</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">shpsSupplier</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not obtain text shapes supplier&quot;</span><span class="p">);</span>
<span class="k">else</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Num. of text shapes: &quot;</span> <span class="o">+</span>
                        <span class="n">shpsSupplier</span><span class="p">.</span><span class="na">getShapes</span><span class="p">().</span><span class="na">getCount</span><span class="p">());</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="07-Non-text_Content.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 7. Text Content Other than Strings" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 7. Text Content Other than Strings
            </div>
          </div>
        </a>
      
      
        
        <a href="09-Text_Search.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 9. Text Search and Replace" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 9. Text Search and Replace
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>