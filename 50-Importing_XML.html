
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 50. Importing XML - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-50-importing-xml" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 50. Importing XML
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 50. Importing XML
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="50-Importing_XML.html" class="md-nav__link md-nav__link--active">
        Chapter 50. Importing XML
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-filters-to-the-rescue" class="md-nav__link">
    1.  Filters to the Rescue
  </a>
  
    <nav class="md-nav" aria-label="1.  Filters to the Rescue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-the-clubs-example" class="md-nav__link">
    1.1.  The Clubs Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-command-line-importing-and-exporting" class="md-nav__link">
    1.2.  Command Line Importing (and Exporting)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-finding-a-filter-name" class="md-nav__link">
    1.3.  Finding a Filter Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-filters-with-java" class="md-nav__link">
    2.  Using Filters with Java
  </a>
  
    <nav class="md-nav" aria-label="2.  Using Filters with Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-importing-xml-with-java" class="md-nav__link">
    2.1.  Importing XML with Java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-exporting-xml-with-java" class="md-nav__link">
    2.2.  Exporting XML with Java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-alternatives-to-xslt-filters" class="md-nav__link">
    3.  Alternatives to XSLT Filters
  </a>
  
    <nav class="md-nav" aria-label="3.  Alternatives to XSLT Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-data-extraction-by-dom-parsing" class="md-nav__link">
    3.1.  Data Extraction by DOM Parsing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-node-and-attribute-data-extraction-as-labeled-strings" class="md-nav__link">
    3.2.  Node and Attribute Data Extraction as Labeled Strings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-jaxb-conversion-of-xml-to-java-objects" class="md-nav__link">
    3.3.  JAXB Conversion of XML to Java Objects
  </a>
  
    <nav class="md-nav" aria-label="3.3.  JAXB Conversion of XML to Java Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clubsxml-as-java-code" class="md-nav__link">
    clubs.xml as Java Code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-conflicts" class="md-nav__link">
    Naming Conflicts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-filters-to-the-rescue" class="md-nav__link">
    1.  Filters to the Rescue
  </a>
  
    <nav class="md-nav" aria-label="1.  Filters to the Rescue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-the-clubs-example" class="md-nav__link">
    1.1.  The Clubs Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-command-line-importing-and-exporting" class="md-nav__link">
    1.2.  Command Line Importing (and Exporting)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-finding-a-filter-name" class="md-nav__link">
    1.3.  Finding a Filter Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-filters-with-java" class="md-nav__link">
    2.  Using Filters with Java
  </a>
  
    <nav class="md-nav" aria-label="2.  Using Filters with Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-importing-xml-with-java" class="md-nav__link">
    2.1.  Importing XML with Java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-exporting-xml-with-java" class="md-nav__link">
    2.2.  Exporting XML with Java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-alternatives-to-xslt-filters" class="md-nav__link">
    3.  Alternatives to XSLT Filters
  </a>
  
    <nav class="md-nav" aria-label="3.  Alternatives to XSLT Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-data-extraction-by-dom-parsing" class="md-nav__link">
    3.1.  Data Extraction by DOM Parsing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-node-and-attribute-data-extraction-as-labeled-strings" class="md-nav__link">
    3.2.  Node and Attribute Data Extraction as Labeled Strings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-jaxb-conversion-of-xml-to-java-objects" class="md-nav__link">
    3.3.  JAXB Conversion of XML to Java Objects
  </a>
  
    <nav class="md-nav" aria-label="3.3.  JAXB Conversion of XML to Java Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clubsxml-as-java-code" class="md-nav__link">
    clubs.xml as Java Code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-conflicts" class="md-nav__link">
    Naming Conflicts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/50-Importing_XML.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-50-importing-xml">Chapter 50. Importing XML<a class="headerlink" href="#chapter-50-importing-xml" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>XSLT Filters;
Using Filters with Java;
Alternatives to XSLT
Filters: DOM Parsing,
Node and Attribute Data
Extraction, JAXB
Conversion</p>
<p>Example folders: "Filter
Tests" and "Utils"</p>
</div>
<p>This chapter is mostly about importing XML data into
Office. I start by looking at XSLT import (and export)
filters, which give the best results but require the
programmer to know a great deal about XML and the
ODF file format.</p>
<p>The second half of the chapter is about three simpler
techniques for importing XML which require less comprehensive XML skills and no
knowledge of ODF. The drawback is that the resulting document may be less
'beautiful', often requiring some manual post-processing to remove unnecessary white
space and data.</p>
<p>You'd be correct in thinking that Office can already import XML, but you may be
disappointed with the results: a simple XML file, such as pay.xml shown below, is
imported unchanged, as plain text:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;payments&gt;
  &lt;payment&gt;
    &lt;purpose&gt;CD&lt;/purpose&gt;
    &lt;amount&gt;12.95&lt;/amount&gt;
    &lt;tax&gt;19.1234&lt;/tax&gt;
    &lt;maturity&gt;2008-03-01&lt;/maturity&gt;
  &lt;/payment&gt;
  &lt;payment&gt;
    &lt;purpose&gt;DVD&lt;/purpose&gt;
    &lt;amount&gt;19.95&lt;/amount&gt;
    &lt;tax&gt;19.4321&lt;/tax&gt;
    &lt;maturity&gt;2008-03-02&lt;/maturity&gt;
  &lt;/payment&gt;
  &lt;payment&gt;
    &lt;purpose&gt;Clothes&lt;/purpose&gt;
    &lt;amount&gt;99.95&lt;/amount&gt;
    &lt;tax&gt;18.5678&lt;/tax&gt;
    &lt;maturity&gt;2008-03-03&lt;/maturity&gt;
  &lt;/payment&gt;
  &lt;payment&gt;
    &lt;purpose&gt;Book&lt;/purpose&gt;
    &lt;amount&gt;9.49&lt;/amount&gt;
    &lt;tax&gt;18.9876&lt;/tax&gt;
    &lt;maturity&gt;2008-03-04&lt;/maturity&gt;
  &lt;/payment&gt;
&lt;/payments&gt;
</code></pre></div>
<p>Office offers many ways of loading XML through the "All files (<em>.</em>)" popdown list in
the Open dialog. Figure 1 shows my selection of "Flat XML ODF Spreadsheet":</p>
<p><img alt="" src="images/50-Importing_XML-1.png" /></p>
<p>Figure 1. Selecting an XML Import Format.</p>
<p>Unfortunately, the result isn't a nice spreadsheet of the payments, but a Writer
document containing all the data and XML tags.</p>
<p>Flat XML is for encoding an OpenDocument format (ODF) document as a single text
file, which contrasts with how it's usually stored as a zipped folder of several files and
sub-folders. pay.xml isn't a Flat XML file, and so Office drops back to treating it as
plain text, and uses Writer to display it.</p>
<p>Incidentally, there are several Flat XML formats aimed at the different Office
applications, Writer, Calc, Draw, and Impress.</p>
<h2 id="1-filters-to-the-rescue">1.  Filters to the Rescue<a class="headerlink" href="#1-filters-to-the-rescue" title="Permanent link">&para;</a></h2>
<p>pay.xml can be opened as a spreadsheet with the help of an input filter. There are a
few ways of writing these, as explained by Fridrich Strba in his blog post "Extending
the Swiss Army knife - an overview about writing of filters for LibreOffice"
(<a href="http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html">http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html</a>).</p>
<p>The easiest way of implementing an XML input filter is with XSLT (eXtensible
Stylesheet Language: Transformations). The filter is utilized by the XSLT processor
inside Office to load and transform the XML, as illustrated in Figure 2.</p>
<p><img alt="" src="images/50-Importing_XML-2.png" /></p>
<p>Figure 2. Using an XSLT filter.</p>
<p>XSLT is designed for transforming XML into other textual formats; in this case, it
will convert the simple XML used by pay.xml into the Flat XML used by Calc.</p>
<p>Office's  XSLT processor used to be Saxon (<a href="http://saxon.sourceforge.net/">http://saxon.sourceforge.net/</a>), a Java
API, but was replaced in 2012 by the libxslt C library (<a href="http://xmlsoft.org/libxslt/">http://xmlsoft.org/libxslt/</a>).
This implements XSLT 1.0 with some extensions, so it's best to avoid using features
from the newer XSLT 2.0.</p>
<p>One source for learning XLST in the context of ODF is:</p>
<p>OASIS OpenDocument Essentials
J. David Eisenberg, 2005
http:// books.evc-cit.info/
The book includes a chapter on filters, and an appendix that overviews XSLT and
XPath (XPath is used for locating parts of the input document for processing).</p>
<p>Eisenberg's website has a free draft of the text, and all the examples and support code.
The site often seems to be offline, but the book can be found elsewhere, including at
Lulu: <a href="http://www.lulu.com/shop/j-david-eisenberg/oasis-opendocument-essentials/paperback/product-392512.html">http://www.lulu.com/shop/j-david-eisenberg/oasis-opendocument-essentials/paperback/product-392512.html</a></p>
<p>If you feel the need for more information on XSLT, a good text by the developer of
Saxon is:</p>
<p>XSLT 2.0 and XPath 2.0 Programmer's Reference
Michael Kay
Wrox Pub., May 2008, 4<sup>th</sup> Ed.</p>
<p>There's a somewhat shorter XSLT tutorial at W3Schools:
<a href="http://www.w3schools.com/xml/xsl_intro.asp">http://www.w3schools.com/xml/xsl_intro.asp</a></p>
<p>A useful forum post, "Create XSLT filters for import and export"
(<a href="https://forum.openoffice.org/en/forum/viewtopic.php?t=3490">https://forum.openoffice.org/en/forum/viewtopic.php?t=3490</a>), by user hol.sten
contains XSLT import and export filters for pay.xml (in fact, it's his example). The
filters are installed via Office's Tools &gt; "XML Filter Settings" menu item. Clicking on
the "New" button of the filter settings window brings up a dialog containing two tabs
shown in Figure 3.</p>
<p><img alt="" src="images/50-Importing_XML-3.png" /></p>
<p>Figure 3.  The XML Filter Settings Dialog Tabs.</p>
<p>Figure 3 shows that I've created a "Pay" filter set containing hol.sten's import and
export filters stored in payImport.xsl and payExport.xsl. The import filter will convert
XML to Flat XML for Calc, as stated in the "Application" field of the General tab.</p>
<p>After clicking "Ok", the Pay filter set is added to the settings window in Figure 4.</p>
<p><img alt="" src="images/50-Importing_XML-4.png" /></p>
<p>Figure 4. The Pay Filter in the Settings Window.</p>
<p>When pay.xml is opened, the Pay import filter appears in the Calc section of the "All
Files (<em>.</em>) popdown list, as seen in Figure 5.</p>
<p><img alt="" src="images/50-Importing_XML-5.png" /></p>
<p>Figure 5. The Calc Pay Import Filter.</p>
<p>The "XML Payments" text in Figure 5 comes from the "Name of file type" textfield in
the General tab of the dialog in Figure 3.</p>
<p>The resulting Calc document is shown in Figure 6.</p>
<p><img alt="" src="images/50-Importing_XML-6.png" /></p>
<p>Figure 6. Pay.xml Imported as a Spreadsheet.</p>
<h3 id="11-the-clubs-example">1.1.  The Clubs Example<a class="headerlink" href="#11-the-clubs-example" title="Permanent link">&para;</a></h3>
<p>There's another nice XSLT import and export filter set in chapter 9 of Eisenberg's
book. clubs.xml consists of a sequence of associations, each one made up of a
sequence of clubs. A typical club entry looks like:</p>
<div class="highlight"><pre><span></span><code>&lt;club id=&quot;Q21&quot; charter=&quot;2002&quot;&gt;
  &lt;name&gt;Castro Valley Wrestling Club&lt;/name&gt;
  &lt;contact&gt;Ron Maes&lt;/contact&gt;
  &lt;location&gt;Castro Valley&lt;/location&gt;
  &lt;phone&gt;510-555-1491&lt;/phone&gt;
  &lt;email&gt;cvwcron@example.com&lt;/email&gt;
  &lt;age-groups type=&quot;KCJOW&quot;/&gt;
  &lt;info&gt;Practices every Tuesday and Thursday at 5:00 P.M.

        at Castro Valley High School mat room.&lt;/info&gt;
&lt;/club&gt;
</code></pre></div>
<p>A helpful way of visualizing this information is with the XML editor at
<a href="http://xmlgrid.net/">http://xmlgrid.net/</a>, which renders it as in Figure 7.</p>
<p><img alt="" src="images/50-Importing_XML-7.png" /></p>
<p>Figure 7. Visualization of clubs.xml.</p>
<p>There are 17 associations; the first is called "BAWA" and contains 11 clubs
Eisenberg's clubsImport.xsl and clubsExport.xsl filters are imported into Office using
the "XML Filter Settings" dialog in Figure 8.</p>
<p><img alt="" src="images/50-Importing_XML-8.png" /></p>
<p>Figure 8. The XML Filter Settings Dialog Again.</p>
<p>I've called the filter set "Clubs", and it uses clubsImport.xsl to produce Flat XML for
Writer. There's also a Writer template called clubsTemplate.ott, which applies styles
to the imported data.</p>
<p>When clubs.xml is opened, the Clubs import filter appears in the Writer section of the
"All Files (<em>.</em>) popdown list, as in Figure 9.</p>
<p><img alt="" src="images/50-Importing_XML-9.png" /></p>
<p>Figure 9. The Writer Clubs Import Filter.</p>
<p>The start of the resulting Writer document looks like Figure 10.</p>
<p><img alt="" src="images/50-Importing_XML-10.png" /></p>
<p>Figure 10. Clubs.xml as a Writer Document.</p>
<h3 id="12-command-line-importing-and-exporting">1.2.  Command Line Importing (and Exporting)<a class="headerlink" href="#12-command-line-importing-and-exporting" title="Permanent link">&para;</a></h3>
<p>Import filter selection can be time-consuming because of the large number listed in
"Open"s popdown list. A quicker approach is to call Office from the command line,
supplying the filename and filter name as arguments.</p>
<p>Most of Office's command line arguments are listed at
<a href="https://help.libreoffice.org/Common/Starting_the_Software_With_Parameters">https://help.libreoffice.org/Common/Starting_the_Software_With_Parameters</a>, and a
few others when office.exe is invoked with the -h option. The filter commands are --
infilter and --convert-to, which I've wrapped up in two batch scripts called infilter.bat
and convert.bat.</p>
<p>The hardest part of using these commands is the need to supply a filter name, which
corresponds to the "Filter name" textfield string in the General tab of the XML Filter
Settings dialog. The pay.xml import filter is "Pay", as shown in the left hand window
in Figure 3; the clubs.xml filter is "Clubs", as in Figure 8.</p>
<p>The infilter.bat script takes a filename and input filter name argument:</p>
<div class="highlight"><pre><span></span><code>infilter pay.xml &quot;Pay&quot;
</code></pre></div>
<p>This causes Office to open pay.xml using the "Pay" import filter, creating the
spreadsheet shown in Figure 6.</p>
<p>The convert.bat script takes an Office filename and conversion string as arguments. In
the simple case, the string is the extension of the exported file. For example, the
following exports the Writer document as XML:</p>
<div class="highlight"><pre><span></span><code>convert simpleText.odt xml
</code></pre></div>
<p>If there are several filters to choose from (as there are for XML), then the default one
is used; for this example the Flat XML exporter for Writer will be employed. If a
different export filter is required then its name must be appended to the conversion
string after a ":". For instance:</p>
<div class="highlight"><pre><span></span><code>convert payment.ods &quot;xml:Pay&quot;
</code></pre></div>
<p>This exports the payments spreadsheet using the "Pay" filter, resulting in a file called
payment.xml which has the same format as the original example at the start of the
chapter.</p>
<h3 id="13-finding-a-filter-name">1.3.  Finding a Filter Name<a class="headerlink" href="#13-finding-a-filter-name" title="Permanent link">&para;</a></h3>
<p>The calls to infilter.bat and convert.bat rely on the user knowing a filter's name (e.g.</p>
<p>"Pay" or "Clubs"). I knew these because I installed them, but what about the names of
other filters in Office?</p>
<p>A list of filters present in OpenOffice in 2007 can be found at
<a href="https://wiki.openoffice.org/wiki/Framework/Article/Filter/FilterList_OOo_3_0">https://wiki.openoffice.org/wiki/Framework/Article/Filter/FilterList_OOo_3_0</a>.
However, a better approach is to call my FiltersInfo.java example which prints all the
filters currently installed in Office, and some extra details about the "AbiWord",
"Pay", and "Clubs" filters:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FiltersInfo.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FiltersInfo</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

    <span class="c1">// print the names of all the filters in Office</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">filterNms</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getFilterNames</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Filter Names&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">printNames</span><span class="p">(</span><span class="n">filterNms</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

    <span class="c1">// print some extra info on 3 filters</span>
    <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getFilterProps</span><span class="p">(</span><span class="s">&quot;AbiWord&quot;</span><span class="p">);</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">showProps</span><span class="p">(</span><span class="s">&quot;AbiWord Filter&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getFilterProps</span><span class="p">(</span><span class="s">&quot;Pay&quot;</span><span class="p">);</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">showProps</span><span class="p">(</span><span class="s">&quot;Pay Filter&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getFilterProps</span><span class="p">(</span><span class="s">&quot;Clubs&quot;</span><span class="p">);</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">showProps</span><span class="p">(</span><span class="s">&quot;Clubs Filter&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="s">&quot;Flags&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Filter flags: &quot;</span> <span class="o">+</span>
                           <span class="n">Integer</span><span class="p">.</span><span class="na">toHexString</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Import: &quot;</span> <span class="o">+</span> <span class="n">Info</span><span class="p">.</span><span class="na">isImport</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Export: &quot;</span> <span class="o">+</span> <span class="n">Info</span><span class="p">.</span><span class="na">isExport</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>   <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of FiltersInfo class</span>
</code></pre></div>
<p>The output from FiltersInfo starts with a long list of  filter names:</p>
<div class="highlight"><pre><span></span><code>Filter Names
No. of names: 235
  &quot;AbiWord&quot;  &quot;Apple Keynote&quot;  &quot;Apple Numbers&quot;
  &quot;Apple Pages&quot;  &quot;BMP - MS Windows&quot;  &quot;BroadBand eBook&quot;
  &quot;Calc MS Excel 2007 Binary&quot;  &quot;Calc MS Excel 2007 VBA XML&quot;
     :
  &quot;ClarisWorks_Draw&quot;  &quot;ClarisWorks_Impress&quot;  &quot;Clubs&quot;
     :
  &quot;Palm_Text_Document&quot;  &quot;PalmDoc&quot;  &quot;Pay&quot;
     :
     :
  &quot;XHTML Draw File&quot;  &quot;XHTML Impress File&quot;  &quot;XHTML Writer File&quot;
  &quot;XPM&quot;
</code></pre></div>
<p>In the above list, I've included the lines that include the "Pay" and "Clubs" filter
names.</p>
<p>The names are obtained by Info.getFilterNames(), which utilizes the FilterFactory
service:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Info class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getFilterNames</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XNameAccess</span> <span class="n">na</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XNameAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                        <span class="s">&quot;com.sun.star.document.FilterFactory&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">na</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No Filter factory found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">na</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getFilterNames()</span>
</code></pre></div>
<p>Sometimes it's useful to know more about a filter than just it's name, such as whether
it's for importing, exporting, or both. Additional information is available as an array
of properties, by calling Info.getFilterProps() with the filter's name:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Info class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="nf">getFilterProps</span><span class="p">(</span><span class="n">String</span> <span class="n">filterNm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XNameAccess</span> <span class="n">na</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XNameAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                           <span class="s">&quot;com.sun.star.document.FilterFactory&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">na</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No Filter factory found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">(</span><span class="n">PropertyValue</span><span class="o">[]</span><span class="p">)</span> <span class="n">na</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="n">filterNm</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not find filter for &quot;</span> <span class="o">+</span> <span class="n">filterNm</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getFilterProps()</span>
</code></pre></div>
<p>getFilterProps() is called three times in FiltersInfo.java to retrieve details about the
"AbiWord", "Pay", and "Clubs" filters. The output for "Clubs" is:</p>
<div class="highlight"><pre><span></span><code>Properties for &quot;Clubs Filter&quot;:
  UserData: [com.sun.star.documentconversion.XSLTFilter, false,
com.sun.star.comp.Writer.XMLOasisImporter,
com.sun.star.comp.Writer.XMLOasisExporter,
file:///C:/Users/Dell/Desktop/LibreOffice%20Tests/Filter%20Tests/club
sImport.xsl,
file:///C:/Users/Dell/Desktop/LibreOffice%20Tests/Filter%20Tests/club
sExport.xsl, , ]
  TemplateName:
file:///C:/Users/Dell/AppData/Roaming/LibreOffice/4/user/template/Clu
bs/clubsTemplate.ott
  Name: Clubs
  Type: Clubs
  UIComponent:
  FileFormatVersion: 0
  FilterService: com.sun.star.comp.Writer.XmlFilterAdaptor
  DocumentService: com.sun.star.text.TextDocument
  Flags: 524355
  UINames: [    en-US = XML Clubs  ]
  UIName: XML Clubs
  Finalized: false
  Mandatory: false
</code></pre></div>
<p>The UserData and TemplateName properties indicate that "Clubs" contains an import
and export filter for Writer's Flat XML, and also a template.</p>
<p>Filter properties are explained in the online documentation for the FilterFactory
service (use <code>lodoc FilterFactory</code> to access it), and also in the "Properties of a
Filter" subsection of the "Integrating Import and Export Filters" section of chapter 6
of the Developer's Guide (online at:
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Properties_of_a_Filter">https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Properties_of_a_Filter</a>,
or use <code>loGuide "Properties of a Filter"</code>).</p>
<p>The most cryptic of the properties is the filter flags integer (524355 in the example
above). It's actually a collection of bitwise OR'ed hexadecimals, and FiltersInfo.java
shows how they can be accessed:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of FiltersInfo.java...</span>

<span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="s">&quot;Flags&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Filter flags: &quot;</span> <span class="o">+</span> <span class="n">Integer</span><span class="p">.</span><span class="na">toHexString</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
           <span class="c1">// print as a hexadecimal string</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Import: &quot;</span> <span class="o">+</span> <span class="n">Info</span><span class="p">.</span><span class="na">isImport</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Export: &quot;</span> <span class="o">+</span> <span class="n">Info</span><span class="p">.</span><span class="na">isExport</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
</code></pre></div>
<p>The output is:</p>
<div class="highlight"><pre><span></span><code>Filter flags: 80043
 Import: true
 Export: true
</code></pre></div>
<p>The hexadecimals that might appear in the flag are listed in the online "Properties of a
Filter" subsection
(<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Properties_of_a_Filter">https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Properties_of_a_Filter</a>).
I've included a few isXXX() methods in the Info utilities class for testing for
their presence. The above example reports that the "Clubs" filter contains both an
import and export filter.</p>
<h2 id="2-using-filters-with-java">2.  Using Filters with Java<a class="headerlink" href="#2-using-filters-with-java" title="Permanent link">&para;</a></h2>
<p>Java contains an assortment of XML processing capabilities, grouped under the JAXP
(Java API for XML Processing) heading. They include DOM and SAX parsing, XML
schema validation, and XSLT transformation. The JDK's XSLT processor is Xalan
(<a href="https://xml.apache.org/xalan-j/">https://xml.apache.org/xalan-j/</a>), which supports XSLT 1.0, and so is roughly
equivalent to Office's libxslt library. This means that I can use the "Pay" and "Clubs"
filters outside of Office by passing them to Java's Xalan processor.</p>
<p>There's a lot of information about JAXP online, including in Oracle's tutorial at
<a href="https://docs.oracle.com/javase/tutorial/jaxp/">https://docs.oracle.com/javase/tutorial/jaxp/</a>. Also "XSLT 2.0 and XPath 2.0
Programmer's Reference" by Michael Kay, which I mentioned earlier, includes an
appendix on JAXP.</p>
<h3 id="21-importing-xml-with-java">2.1.  Importing XML with Java<a class="headerlink" href="#21-importing-xml-with-java" title="Permanent link">&para;</a></h3>
<p>My ApplyInFilter.java example converts an XML file into an Office document in two
steps. First it uses an XSLT import filter to generate Flat XML which it saves to a
temporary file. The program then loads that file into Office with one of its Flat XML
filters. The correct one is chosen by looking at the filename extension supplied for the
final document. For example:</p>
<div class="highlight"><pre><span></span><code>run ApplyInFilter pay.xml payImport.xsl payment.ods
</code></pre></div>
<p>pay.xml is transformed into Flat XML with payImport.xsl. Office isn't used since
Java's XSLT processor is sufficient. However, at the next step the temporary file is
loaded using Office's "Flat XML for Spreadsheets" filter. This filter is selected by
noting the "ods" extension of payment.ods.</p>
<p>Another example:</p>
<div class="highlight"><pre><span></span><code>run ApplyInFilter clubs.xml clubsImport.xsl clubs.odt
</code></pre></div>
<p>This converts clubs.xml into a Writer document stored in clubs.odt using the "Clubs"
import filter. ApplyInFilter.java doesn't support templates, so the data saved to
clubs.odt isn't nicely formatted like Figure 10.</p>
<p>The ApplyInFilter program:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplyInFilter</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: java ApplyInFilter</span>
<span class="s">                &lt;XML fnm&gt; &lt;Flat XML import filter&gt; &lt;new ODF&gt;&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// convert the data to Flat XML</span>
    <span class="n">String</span> <span class="n">xmlStr</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">applyXSLT</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xmlStr</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Filtering failed&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// save flat XML data in a temp file</span>
    <span class="n">String</span> <span class="n">flatFnm</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">createTempFile</span><span class="p">(</span><span class="s">&quot;xml&quot;</span><span class="p">);</span>
    <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="n">flatFnm</span><span class="p">,</span> <span class="n">xmlStr</span><span class="p">);</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

    <span class="c1">// get the type of the output file</span>
    <span class="n">String</span> <span class="n">odfFnm</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">ext2DocType</span><span class="p">(</span> <span class="n">Info</span><span class="p">.</span><span class="na">getExt</span><span class="p">(</span><span class="n">odfFnm</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Doc type: &quot;</span> <span class="o">+</span> <span class="n">docType</span><span class="p">);</span>

    <span class="c1">// open temp file using the correct Flat XML filter</span>
    <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openFlatDoc</span><span class="p">(</span><span class="n">flatFnm</span><span class="p">,</span> <span class="n">docType</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">odfFnm</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>   <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of ApplyInFilter class</span>

<span class="n">Java</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">XSLT</span> <span class="n">processor</span> <span class="n">is</span> <span class="n">called</span> <span class="n">by</span> <span class="n">XML</span><span class="p">.</span><span class="na">applyXSLT</span><span class="p">():</span>

<span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">applyXSLT</span><span class="p">(</span><span class="n">String</span> <span class="n">xmlFnm</span><span class="p">,</span> <span class="n">String</span> <span class="n">xslFnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">TransformerFactory</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">TransformerFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
    <span class="n">Source</span> <span class="n">xslt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="p">(</span><span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">xslFnm</span><span class="p">));</span>
    <span class="n">Transformer</span> <span class="n">t</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="na">newTransformer</span><span class="p">(</span><span class="n">xslt</span><span class="p">);</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Applying filter &quot;</span> <span class="o">+</span> <span class="n">xslFnm</span> <span class="o">+</span>
                                            <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="n">xmlFnm</span><span class="p">);</span>
    <span class="n">Source</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="p">(</span><span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">xmlFnm</span><span class="p">));</span>
    <span class="n">StreamResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamResult</span><span class="p">(</span><span class="k">new</span> <span class="n">StringWriter</span><span class="p">());</span>

    <span class="n">t</span><span class="p">.</span><span class="na">transform</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to transform &quot;</span> <span class="o">+</span> <span class="n">xmlFnm</span> <span class="o">+</span>
                        <span class="s">&quot; with &quot;</span> <span class="o">+</span> <span class="n">xslFnm</span><span class="p">);</span>
     <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
     <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>   <span class="c1">// end of applyXSLT()</span>
</code></pre></div>
<p>The resulting Flat XML is saved to a temporary file by ApplyInFilter.java, and then
the document type of the output file is obtained:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of ApplyInFilter.java...</span>
<span class="n">String</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">ext2DocType</span><span class="p">(</span> <span class="n">Info</span><span class="p">.</span><span class="na">getExt</span><span class="p">(</span><span class="n">odfFnm</span><span class="p">));</span>
</code></pre></div>
<p>The docType string is "scalc" when the ODT file is payment.ods, and "swriter" for
clubs.odt.</p>
<p>Lo.openFlatDoc() uses the document type to select the correct Flat XML filter, and
passes it to Lo.openDoc() as the "FilterName" property:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XComponent</span> <span class="nf">openFlatDoc</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">String</span> <span class="n">docType</span><span class="p">,</span>
                                       <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span> <span class="n">String</span> <span class="n">nm</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getFlatFilterName</span><span class="p">(</span><span class="n">docType</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">openDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;FilterName&quot;</span><span class="p">,</span> <span class="n">nm</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>XML.getFlatFilterName() maps a document type to an appropriate Flat XML filter
name:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getFlatFilterName</span><span class="p">(</span><span class="n">String</span> <span class="n">docType</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER_STR</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;OpenDocument Text Flat XML&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">CALC_STR</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;OpenDocument Spreadsheet Flat XML&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">DRAW_STR</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;OpenDocument Drawing Flat XML&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS_STR</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;OpenDocument Presentation Flat XML&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No Flat XML filter for this</span>
<span class="s">                        document type; using Flat text&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;OpenDocument Text Flat XML&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getFlatFilterName()</span>
</code></pre></div>
<h3 id="22-exporting-xml-with-java">2.2.  Exporting XML with Java<a class="headerlink" href="#22-exporting-xml-with-java" title="Permanent link">&para;</a></h3>
<p>My ApplyOutFilter.java example saves the specified document in Flat XML form to a
temporary file. Then it applies an XSLT output filter to transform it into simple XML,
which is saved in a new file. For example:</p>
<div class="highlight"><pre><span></span><code>run ApplyOutFilter payment.ods payExport.xsl payEx.xml
</code></pre></div>
<p>payment.ods contains the spreadsheet shown in Figure 6, and the transformation fills
payEx.xml with text almost identical to that on the first page of the chapter.</p>
<p>Another example:</p>
<div class="highlight"><pre><span></span><code>run ApplyOutFilter clubs.odt clubsExport.xsl clubsEx.xml
</code></pre></div>
<p>clubs.odt must contain data formatted by the clubs template (i.e. like the example in
Figure 10). This is necessary because clubsExport.xsl utilizes paragraph styles to
decide how to change the text.</p>
<p>I had to slightly modify the style names used in Eisenberg's export filter. He utilized
names containing spaces (e.g. "Club Name", "Club Code", "Age Groups", and "Club
Info"), but Office automatically changes spaces inside names to "<em>20</em>". So I had to
change the XSLT rules to refer to these names (i.e.  "Club_20_Name",
"Club_20_Code", "Age_20_Groups", and "Club_20_Info").</p>
<div class="highlight"><pre><span></span><code><span class="n">The</span> <span class="n">ApplyOutFilter</span> <span class="n">program</span><span class="p">:</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplyOutFilter</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: java ApplyOutFilter &lt;XML file&gt;</span>
<span class="s">                        &lt;Flat XML export filter&gt; &lt;new XML file&gt;&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open document: &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// save flat XML data</span>
    <span class="n">String</span> <span class="n">flatFnm</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">createTempFile</span><span class="p">(</span><span class="s">&quot;xml&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">flatFnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

    <span class="c1">// use XSLT to convert Flat XML into simple XML</span>
    <span class="n">String</span> <span class="n">filteredXML</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">applyXSLT</span><span class="p">(</span><span class="n">flatFnm</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">filteredXML</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Filtering failed&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// indent, print, and save</span>
      <span class="n">String</span> <span class="n">xmlStr</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">indent2Str</span><span class="p">(</span><span class="n">filteredXML</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">xmlStr</span><span class="p">);</span>
      <span class="n">FileIO</span><span class="p">.</span><span class="na">saveString</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="n">xmlStr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>   <span class="c1">// end of main()</span>


<span class="p">}</span>  <span class="c1">// end of ApplyOutFilter class</span>
</code></pre></div>
<p>At the end of ApplyOutFilter.java, the XML text in xmlStr is indented and printed.
The indention is carried out by XML.indent2Str() which calls XML.applyXSLT2str()
with an indenting transformation loaded from indent.xsl:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="c1">// global</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">INDENT_FNM</span> <span class="o">=</span> <span class="s">&quot;indent.xsl&quot;</span><span class="p">;</span>
  <span class="c1">// for indenting XML tags, and adding newlines between tags</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">indent2Str</span><span class="p">(</span><span class="n">String</span> <span class="n">xmlStr</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">applyXSLT2str</span><span class="p">(</span><span class="n">xmlStr</span><span class="p">,</span>
                    <span class="n">FileIO</span><span class="p">.</span><span class="na">getUtilsFolder</span><span class="p">()</span><span class="o">+</span><span class="n">INDENT_FNM</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>applyXSLT2str() is a variant of XML.applyXSLT() which reads XML from a string
rather than a file.</p>
<h2 id="3-alternatives-to-xslt-filters">3.  Alternatives to XSLT Filters<a class="headerlink" href="#3-alternatives-to-xslt-filters" title="Permanent link">&para;</a></h2>
<p>The obvious drawback of the XSLT filter approach is that filter writing requires the
programmer to be knowledgable about XSLT, XPath, and the details of the Flat XML
format.</p>
<p>Another way to write import and export filter is to utilize the ImportFilter and
ExportFilter services in the com.sun.star.document module, which are shown in
Figure 11.</p>
<p><img alt="" src="images/50-Importing_XML-11.png" /></p>
<p>Figure 11. The ImportFilter and ExportFilter Services.</p>
<p>These services allow the implementation of non-XML based transformations by
utilizing the ImportFilter and ExportFilter services rather than their XMLImportFilter
and XMLExportFilter subclasses. The subclasses employ SAX, an event-driven way
of parsing XML.</p>
<p>If you're interested in using ImportFilter and ExportFilter, the Developer's guide gives
some details in the "Integrating Import and Export Filters" section of chapter 6 on
"Office Development". The information is also online, starting at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Integrating_Import_and_Export_Filters">https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Integrating_Import_and_Export_Filters</a>,
or use loGuide "Import and Export Filters".</p>
<p>But I'm not going to use these services due to their complexity, and I'm about to stop
using XSLT as well. Instead I'm going to look at three easier ways to import XML
into Office:</p>
<ol>
<li>Data extraction by DOM parsing;</li>
<li>Node and attribute data extraction as labeled strings;</li>
<li>JAXB conversion of XML to Java objects.</li>
</ol>
<p>The drawback of these simpler approaches is that the imported data will usually need
some post-processing to make it look as good as import filter results.</p>
<h3 id="31-data-extraction-by-dom-parsing">3.1.  Data Extraction by DOM Parsing<a class="headerlink" href="#31-data-extraction-by-dom-parsing" title="Permanent link">&para;</a></h3>
<p>Document Object Model (DOM) parsing converts an XML document into a tree of
nodes; the three main types are:</p>
<ul>
<li>Elements;</li>
<li>Attributes;</li>
<li>The data/values held by the elements and attributes.</li>
</ul>
<p>The DOM API is quite low-level, supporting functions such as getFirstChild() and
getNextSibling() in Java's Node class. This motivated the introduction of XPath, and
other tree models such as JDOM. Fortunately, I won't be needing those more
advanced features.</p>
<p>Nodes are found by searching for their name. When a possible match is discovered,
the node's children usually need to be examined to determine the node type. For
instance, node data has the type Node.TEXT_NODE, while an attribute has the type
Node.ATTRIBUTE.</p>
<p>There are many online tutorials on Java and DOM, such as Oracle's at
<a href="https://docs.oracle.com/javase/tutorial/jaxp/dom">https://docs.oracle.com/javase/tutorial/jaxp/dom</a>. Two other good ones are mkyong's
starting at <a href="http://www.mkyong.com/tutorials/java-xml-tutorials/">http://www.mkyong.com/tutorials/java-xml-tutorials/</a> and "Easy DOM
Parsing in Java" by Eric Bruno at <a href="http://www.drdobbs.com/jvm/easy-dom-parsing-in-java/231002580">http://www.drdobbs.com/jvm/easy-dom-parsing-in-java/231002580</a>.
I've 'borrowed' some of Bruno's DOM functions for my XML.java
support class, and his company.xml example.</p>
<p>A textbook on Java and XML:</p>
<p>Pro XML Development with Java Technology
Ajay and Deepak Vohra
Apress, 2006</p>
<p>The company.xml file contains details about three companies:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Companies&gt;
  &lt;Company&gt;
    &lt;Name&gt;ABC&lt;/Name&gt;
    &lt;Executive type=&quot;CEO&quot;&gt;
        &lt;LastName&gt;Smith&lt;/LastName&gt;
        &lt;FirstName&gt;Jim&lt;/FirstName&gt;
        &lt;street&gt;123 Broad Street&lt;/street&gt;
        &lt;city&gt;Manchester&lt;/city&gt;
        &lt;state&gt;Cheshire&lt;/state&gt;
        &lt;zip&gt;11234&lt;/zip&gt;
    &lt;/Executive&gt;
  &lt;/Company&gt;

  &lt;Company&gt;
    &lt;Name&gt;NBC&lt;/Name&gt;
    &lt;Executive type=&quot;President&quot;&gt;
        &lt;LastName&gt;Jones&lt;/LastName&gt;
        &lt;FirstName&gt;Lucy&lt;/FirstName&gt;
        &lt;street&gt;23 Bradford St&lt;/street&gt;
        &lt;city&gt;Asbury&lt;/city&gt;
        &lt;state&gt;Lincs&lt;/state&gt;
        &lt;zip&gt;33451&lt;/zip&gt;
    &lt;/Executive&gt;
  &lt;/Company&gt;

  &lt;Company&gt;
    &lt;Name&gt;BBC&lt;/Name&gt;
    &lt;Executive type=&quot;Boss&quot;&gt;
        &lt;LastName&gt;Singh&lt;/LastName&gt;
        &lt;FirstName&gt;Oxley&lt;/FirstName&gt;
        &lt;street&gt;16d Towers&lt;/street&gt;
        &lt;city&gt;Wimbledon&lt;/city&gt;
        &lt;state&gt;London&lt;/state&gt;
        &lt;zip&gt;77392&lt;/zip&gt;
    &lt;/Executive&gt;
  &lt;/Company&gt;
&lt;/Companies&gt;
</code></pre></div>
<p>When writing DOM code, it helps to visualize its structure. One way is to load the file
into the editor at <a href="http://xmlgrid.net/">http://xmlgrid.net/</a>, which displays the tree-like structure in Figure
12.</p>
<p><img alt="" src="images/50-Importing_XML-12.png" /></p>
<p>Figure 12. The Tree Structure of company.xml.</p>
<p>Clicking on the arrow heads expand or contract the tree view.</p>
<p>My ExamineCompany.java example loads this data as a DOM tree, and extracts
various information:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ExamineCompany.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExamineCompany</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
  <span class="p">{</span>
    <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">loadDoc</span><span class="p">(</span><span class="s">&quot;company.xml&quot;</span><span class="p">);</span>
    <span class="n">NodeList</span> <span class="n">root</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>  <span class="c1">// get the document&#39;s root</span>

    <span class="c1">// move down the tree to the executive in the first company node</span>
    <span class="n">Node</span> <span class="n">comps</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNode</span><span class="p">(</span><span class="s">&quot;Companies&quot;</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
    <span class="n">Node</span> <span class="n">comp</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNode</span><span class="p">(</span><span class="s">&quot;Company&quot;</span><span class="p">,</span> <span class="n">comps</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">());</span>
    <span class="n">Node</span> <span class="n">exec</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNode</span><span class="p">(</span><span class="s">&quot;Executive&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">());</span>

    <span class="c1">// print the executive&#39;s data</span>
    <span class="n">String</span> <span class="n">execType</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeAttr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="n">exec</span><span class="p">);</span>
    <span class="n">NodeList</span> <span class="n">exNodes</span> <span class="o">=</span> <span class="n">exec</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
    <span class="n">String</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;LastName&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;FirstName&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">street</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;street&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">city</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;state&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">zip</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">(</span><span class="s">&quot;zip&quot;</span><span class="p">,</span> <span class="n">exNodes</span><span class="p">);</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">execType</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">lastName</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">firstName</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">street</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">city</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zip</span><span class="p">);</span>

    <span class="c1">// get all the data in the tree for a given node/tag name</span>
    <span class="n">NodeList</span> <span class="n">lnNodes</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;LastName&quot;</span><span class="p">);</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lastnames</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNodeValues</span><span class="p">(</span><span class="n">lnNodes</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;All lastnames:&quot;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">lastname</span><span class="p">:</span> <span class="n">lastnames</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">lastname</span><span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>
<span class="p">}</span>  <span class="c1">// end of ExamineCompany class</span>
</code></pre></div>
<p>The program outputs details about the first company, and the lastnames of all the
company bosses:</p>
<div class="highlight"><pre><span></span><code>CEO
Smith, Jim
123 Broad Street
Manchester, Cheshire 11234
All lastnames:
  Smith
  Jones
  Singh
</code></pre></div>
<p>XML.getNode() searches through a list of nodes, and returns the first with the
specified tag name:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Node</span> <span class="nf">getNode</span><span class="p">(</span><span class="n">String</span> <span class="n">tagName</span><span class="p">,</span> <span class="n">NodeList</span> <span class="n">nodes</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">().</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">tagName</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">node</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getNode()</span>
</code></pre></div>
<p>XML.getNodeValue() looks for a node in a list based on its tag name, and extracts the
data stored beneath that node.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getNodeValue</span><span class="p">(</span><span class="n">String</span> <span class="n">tagName</span><span class="p">,</span> <span class="n">NodeList</span> <span class="n">nodes</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">().</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">tagName</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">getNodeValue</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getNodeValue()</span>
</code></pre></div>
<p>The second version of XML.getNodeValue() retrieves the text from a node's
TEXT_NODE child (if there is one):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getNodeValue</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="n">NodeList</span> <span class="n">childNodes</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childNodes</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span> <span class="n">n</span> <span class="o">=</span> <span class="n">childNodes</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="na">getNodeType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Node</span><span class="p">.</span><span class="na">TEXT_NODE</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">n</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getNodeValue()</span>
</code></pre></div>
<p>XML.getNodeValues() constructs a list of the data stored in all the supplied nodes:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getNodeValues</span><span class="p">(</span><span class="n">NodeList</span> <span class="n">nodes</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vals</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">String</span> <span class="n">val</span> <span class="o">=</span> <span class="n">getNodeValue</span><span class="p">(</span><span class="n">nodes</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
       <span class="n">vals</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">vals</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getNodeValues()</span>
</code></pre></div>
<p>XML.getNodeAttr() extracts data from a node's attribute:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getNodeAttr</span><span class="p">(</span><span class="n">String</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">Node</span> <span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="n">NamedNodeMap</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="na">getAttributes</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">attrs</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">attrs</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">().</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">attrName</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">attr</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getNodeAttr()</span>
</code></pre></div>
<p>Converting XML to Spreadsheet Data
It's fairly easy to map XML data into a spreadsheet format of rows and columns.</p>
<p>Consider pay.xml from earlier:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;payments&gt;
  &lt;payment&gt;
    &lt;purpose&gt;CD&lt;/purpose&gt;
    &lt;amount&gt;12.95&lt;/amount&gt;
    &lt;tax&gt;19.1234&lt;/tax&gt;
    &lt;maturity&gt;2008-03-01&lt;/maturity&gt;
  &lt;/payment&gt;

  &lt;payment&gt;
    &lt;purpose&gt;DVD&lt;/purpose&gt;
    &lt;amount&gt;19.95&lt;/amount&gt;
    &lt;tax&gt;19.4321&lt;/tax&gt;
    &lt;maturity&gt;2008-03-02&lt;/maturity&gt;
  &lt;/payment&gt;

  &lt;payment&gt;
    &lt;purpose&gt;Clothes&lt;/purpose&gt;
    &lt;amount&gt;99.95&lt;/amount&gt;
    &lt;tax&gt;18.5678&lt;/tax&gt;
    &lt;maturity&gt;2008-03-03&lt;/maturity&gt;
  &lt;/payment&gt;

  &lt;payment&gt;
    &lt;purpose&gt;Book&lt;/purpose&gt;
    &lt;amount&gt;9.49&lt;/amount&gt;
    &lt;tax&gt;18.9876&lt;/tax&gt;
    &lt;maturity&gt;2008-03-04&lt;/maturity&gt;
  &lt;/payment&gt;
&lt;/payments&gt;
</code></pre></div>
<p>It can be viewed as a sequence of payment objects, each containing four fields
(purpose, amount, tax, and maturity). Each  payment object can be mapped to a
spreadsheet row, and its fields to four columns in that row. This format can be
represented by a 2D array, which is easily constructed using the DOM API.</p>
<p>My CreatePay.java example utilizes XML.getAllNodeValues() to build a 2D array
from the pay.xml data, and calls Calc.setArray() to add the data to a new Calc
document:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CreatePay.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreatePay</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Document</span> <span class="n">xdoc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">loadDoc</span><span class="p">(</span><span class="s">&quot;pay.xml&quot;</span><span class="p">);</span>
    <span class="n">NodeList</span> <span class="n">pays</span> <span class="o">=</span> <span class="n">xdoc</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;payment&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pays</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>

    <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getAllNodeValues</span><span class="p">(</span><span class="n">pays</span><span class="p">,</span>
             <span class="k">new</span> <span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;purpose&quot;</span><span class="p">,</span> <span class="s">&quot;amount&quot;</span><span class="p">,</span> <span class="s">&quot;tax&quot;</span><span class="p">,</span> <span class="s">&quot;maturity&quot;</span><span class="p">});</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">printTable</span><span class="p">(</span><span class="s">&quot;payments&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

    <span class="c1">// Lo.saveDoc(doc, &quot;payCreated.ods&quot;);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of CreatePay class</span>
</code></pre></div>
<p>The list of payment nodes is obtained using:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of CreatePay.java...</span>

<span class="n">NodeList</span> <span class="n">pays</span> <span class="o">=</span> <span class="n">xdoc</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;payment&quot;</span><span class="p">);</span>
<span class="n">The</span> <span class="mf">2D</span> <span class="n">array</span> <span class="n">of</span> <span class="n">payment</span> <span class="n">data</span> <span class="n">is</span> <span class="n">constructed</span> <span class="n">by</span><span class="p">:</span>

<span class="c1">// part of CreatePay.java...</span>

<span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getAllNodeValues</span><span class="p">(</span><span class="n">pays</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;purpose&quot;</span><span class="p">,</span> <span class="s">&quot;amount&quot;</span><span class="p">,</span> <span class="s">&quot;tax&quot;</span><span class="p">,</span> <span class="s">&quot;maturity&quot;</span><span class="p">});</span>
</code></pre></div>
<p>The first argument of getAllNodeValues() is the list of nodes to be scanned, and the
second parameter is an array of tag names. The named nodes are assumed to be
children of each  node in the list, and their data becomes one row in the 2D array. The
method's code:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the XML class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getAllNodeValues</span><span class="p">(</span><span class="n">NodeList</span> <span class="n">rowNodes</span><span class="p">,</span>
                                          <span class="n">String</span><span class="o">[]</span> <span class="n">colIDs</span><span class="p">)</span>
<span class="p">{</span> <span class="kt">int</span> <span class="n">numRows</span> <span class="o">=</span> <span class="n">rowNodes</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">numCols</span> <span class="o">=</span> <span class="n">colIDs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">numRows</span><span class="o">+</span><span class="mi">1</span><span class="o">][</span><span class="n">numCols</span><span class="o">]</span><span class="p">;</span>

  <span class="c1">// put column names in first row of array</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">col</span><span class="o">++</span><span class="p">)</span>
    <span class="n">data</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">col</span><span class="o">]</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">capitalize</span><span class="p">(</span> <span class="n">colIDs</span><span class="o">[</span><span class="n">col</span><span class="o">]</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numRows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// extract column data for ith row</span>
    <span class="n">NodeList</span> <span class="n">colNodes</span> <span class="o">=</span> <span class="n">rowNodes</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">getChildNodes</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">col</span><span class="o">++</span><span class="p">)</span>
       <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">][</span><span class="n">col</span><span class="o">]</span> <span class="o">=</span> <span class="n">getNodeValue</span><span class="p">(</span><span class="n">colIDs</span><span class="o">[</span><span class="n">col</span><span class="o">]</span><span class="p">,</span> <span class="n">colNodes</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getAllNodeValues()</span>
</code></pre></div>
<p>XML.getAllNodeValues() also adds a header row to the array made up of the tag
names.</p>
<p>The resulting table is printing by Lo.printTables():</p>
<div class="highlight"><pre><span></span><code>-- payments ----------------
  Purpose  Amount  Tax  Maturity
  CD  12.95  19.1234  2008-03-01
  DVD  19.95  19.4321  2008-03-02
  Clothes  99.95  18.5678  2008-03-03
  Book  9.49  18.9876  2008-03-04
-----------------------------
</code></pre></div>
<p>Calc.setArray() adds the table to the spreadsheet, which ends up like Figure 13.</p>
<p><img alt="" src="images/50-Importing_XML-13.png" /></p>
<p>Figure 13. The Spreadsheet Generated by CreatePay.java.</p>
<p>XML.getAllNodeValues() doesn't always produce such good results, as illustrated by
the CreateAssoc.java example which converts part of clubs.xml into a spreadsheet.</p>
<p>As explained earlier, clubs.xml consists of a sequence of associations, with each one
made up of a sequence of clubs. The most natural spreadsheet mapping would be to
assign each association to its own sheet, and convert each club into a row on that
sheet.</p>
<p>A club consists of seven elements and two attributes, as seen in the following
example:</p>
<div class="highlight"><pre><span></span><code>&lt;club id=&quot;Q21&quot; charter=&quot;2002&quot;&gt;
  &lt;name&gt;Castro Valley Wrestling Club&lt;/name&gt;
  &lt;contact&gt;Ron Maes&lt;/contact&gt;
  &lt;location&gt;Castro Valley&lt;/location&gt;
  &lt;phone&gt;510-555-1491&lt;/phone&gt;
  &lt;email&gt;cvwcron@example.com&lt;/email&gt;
  &lt;age-groups type=&quot;KCJOW&quot;/&gt;
  &lt;info&gt;Practices every Tuesday and Thursday at 5:00 P.M.

        at Castro Valley High School mat room.&lt;/info&gt;
&lt;/club&gt;
</code></pre></div>
<p>Probably the best spreadsheet representation would be to use nine columns, so the
attributes could be listed. This approach is employed by the xmlgrid.net website as
shown in Figure 14.</p>
<p><img alt="" src="images/50-Importing_XML-14.png" /></p>
<p>Figure 14. Part of the Clubs Information.</p>
<p>Unfortunately, XML.getAllNodeValues() as currently coded doesn't extract attribute
information, so the id and charter data will be missed.</p>
<p>The CreateAssoc.java example loads clubs.xml, and selects the first association. Its
list of clubs is passed to XML.getAllNodeValues() for conversion into an array. The
complete program is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in CreateAssoc.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreateAssoc</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Document</span> <span class="n">xdoc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">loadDoc</span><span class="p">(</span><span class="s">&quot;clubs.xml&quot;</span><span class="p">);</span>
    <span class="n">NodeList</span> <span class="n">root</span> <span class="o">=</span> <span class="n">xdoc</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>

    <span class="c1">// get the first association</span>
    <span class="n">Node</span> <span class="n">cdb</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNode</span><span class="p">(</span><span class="s">&quot;club-database&quot;</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
    <span class="n">Node</span> <span class="n">assoc1</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getNode</span><span class="p">(</span><span class="s">&quot;association&quot;</span><span class="p">,</span> <span class="n">cdb</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">());</span>
    <span class="n">NodeList</span> <span class="n">clubs</span> <span class="o">=</span> <span class="n">assoc1</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>

    <span class="c1">// convert clubs information into an array</span>
    <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">getAllNodeValues</span><span class="p">(</span><span class="n">clubs</span><span class="p">,</span>
      <span class="k">new</span> <span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;contact&quot;</span><span class="p">,</span> <span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="s">&quot;phone&quot;</span><span class="p">,</span> <span class="s">&quot;email&quot;</span><span class="p">});</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">printTable</span><span class="p">(</span><span class="s">&quot;clubs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

    <span class="c1">// Lo.saveDoc(doc, &quot;clubsCreated.ods&quot;);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of CreateAssoc class</span>
</code></pre></div>
<p>XML.getAllNodeValues() only requests data for five of the seven elements ("name",
"contact", "location", "phone", "email") to reduce the information returned. The
resulting spreadsheet is shown in Figure 15.</p>
<p><img alt="" src="images/50-Importing_XML-15.png" /></p>
<p>Figure 15. Part of the Spreadsheet Generated by CreateAssoc.java.</p>
<p>An obvious issue is the empty rows between the clubs data, caused by the simple
XML.getAllNodeValues() implementation. It assumes that every node supplies one
row of data because of its data element child. Howevere, each club also contains
attributes which adds an extra empty row to the output.</p>
<h3 id="32-node-and-attribute-data-extraction-as-labeled-strings">3.2.  Node and Attribute Data Extraction as Labeled Strings<a class="headerlink" href="#32-node-and-attribute-data-extraction-as-labeled-strings" title="Permanent link">&para;</a></h3>
<p>Not all XML data can be so easily mapped to a 2D format, especially collections such
as weather.xml:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;current&gt;
    &lt;city id=&quot;1610780&quot; name=&quot;Hat Yai&quot;&gt;
        &lt;coord lat=&quot;7.01&quot; lon=&quot;100.48&quot;/&gt;
        &lt;country&gt;TH&lt;/country&gt;
        &lt;sun rise=&quot;2017-01-01T23:30:31&quot; set=&quot;2017-01-02T11:14:18&quot;/&gt;
    &lt;/city&gt;
    &lt;temperature max=&quot;25&quot; min=&quot;25&quot; unit=&quot;metric&quot; value=&quot;25&quot;/&gt;
    &lt;humidity unit=&quot;%&quot; value=&quot;94&quot;/&gt;
    &lt;pressure unit=&quot;hPa&quot; value=&quot;1011&quot;/&gt;
    &lt;wind&gt;
        &lt;speed name=&quot;Gentle Breeze&quot; value=&quot;3.6&quot;/&gt;
        &lt;gusts/&gt;
        &lt;direction code=&quot;NNE&quot; name=&quot;North-northeast&quot; value=&quot;30&quot;/&gt;
    &lt;/wind&gt;
    &lt;clouds name=&quot;broken clouds&quot; value=&quot;75&quot;/&gt;
    &lt;visibility value=&quot;5000&quot;/&gt;
    &lt;precipitation mode=&quot;no&quot;/&gt;
    &lt;weather icon=&quot;10n&quot; number=&quot;501&quot; value=&quot;moderate rain&quot;/&gt;
    &lt;lastupdate value=&quot;2017-01-02T15:30:00&quot;/&gt;
&lt;/current&gt;
</code></pre></div>
<p>This data was downloaded from OpenWeatherMap using the API at
<a href="http://api.openweathermap.org">http://api.openweathermap.org</a>. Unlike pay.xml or clubs.xml there's no sequence of
objects that would naturally become rows of a spreadsheet. In addition, the data is
mostly represented by attributes rather than text nodes.</p>
<p>In situations like this, a good general approach is to convert the XML to simpler text,
removing XML labels except for the element and attribute names. As a result, my
ExtractXMLInfo.java example produces the following output when applied to
weather.xml:</p>
<div class="highlight"><pre><span></span><code>current
  city  id= &quot;1610780&quot;  name= &quot;Hat Yai&quot;
    coord  lat= &quot;7.01&quot;  lon= &quot;100.48&quot;
    country: &quot;TH&quot;
    sun  rise= &quot;2017-01-01T23:30:31&quot;  set= &quot;2017-01-02T11:14:18&quot;

  temperature  max= &quot;25&quot;  min= &quot;25&quot;  unit= &quot;metric&quot;  value= &quot;25&quot;
  humidity  unit= &quot;%&quot;  value= &quot;94&quot;
  pressure  unit= &quot;hPa&quot;  value= &quot;1011&quot;
  wind
    speed  name= &quot;Gentle Breeze&quot;  value= &quot;3.6&quot;
    gusts
    direction  code= &quot;NNE&quot;  name= &quot;North-northeast&quot;  value= &quot;30&quot;

  clouds  name= &quot;broken clouds&quot;  value= &quot;75&quot;
  visibility  value= &quot;5000&quot;
  precipitation  mode= &quot;no&quot;
  weather  icon= &quot;10n&quot;  number= &quot;501&quot;  value= &quot;moderate rain&quot;
  lastupdate  value= &quot;2017-01-02T15:30:00&quot;
</code></pre></div>
<p>Line indentation is retained, and is utilized when the data is loaded into Office.</p>
<p>As another example, consider pay.xml which ExtractXMLInfo.java converts into:</p>
<div class="highlight"><pre><span></span><code>payments
  payment
    purpose: &quot;CD&quot;
    amount: &quot;12.95&quot;
    tax: &quot;19.1234&quot;
    maturity: &quot;2008-03-01&quot;

  payment
    purpose: &quot;DVD&quot;
    amount: &quot;19.95&quot;
    tax: &quot;19.4321&quot;
    maturity: &quot;2008-03-02&quot;

  payment
    purpose: &quot;Clothes&quot;
    amount: &quot;99.95&quot;
    tax: &quot;18.5678&quot;
    maturity: &quot;2008-03-03&quot;

  payment
    purpose: &quot;Book&quot;
    amount: &quot;9.49&quot;
    tax: &quot;18.9876&quot;
    maturity: &quot;2008-03-04&quot;
</code></pre></div>
<p>The elements and attributes with data are highlighted by adding  a ":" or "=" after
their names. Also, the data is always doubly quoted.</p>
<p>ExtractXMLInfo.java travels over the DOM tree, printing what it finds to a text file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ExtractXMLInfo.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run ExtractXMLInfo &lt;XML file&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">.</span><span class="na">loadDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="n">String</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">outFnm</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;XML.txt&quot;</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Writing XML data from &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span>
                                           <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="n">outFnm</span><span class="p">);</span>
  <span class="n">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="p">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="p">(</span><span class="n">outFnm</span><span class="p">));</span>

  <span class="n">NodeList</span> <span class="n">root</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
  <span class="c1">// there may be multiple trees; visit each one</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">root</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">visitNode</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span> <span class="n">root</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="n">pw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">pw</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>visitNode() prints the node's tag, any attribute data, any text child node data, and
recursively visits the rest of the node's children:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of ExtractXMLInfo.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">visitNode</span><span class="p">(</span><span class="n">PrintWriter</span> <span class="n">pw</span><span class="p">,</span> <span class="n">Node</span> <span class="n">node</span><span class="p">,</span> <span class="n">String</span> <span class="n">ind</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">pw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">());</span>
  <span class="n">visitAttrs</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span> <span class="n">node</span><span class="p">);</span>

  <span class="c1">// examine all the child nodes</span>
  <span class="n">NodeList</span> <span class="n">nodeList</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodeList</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span> <span class="n">child</span> <span class="o">=</span> <span class="n">nodeList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="na">getNodeType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Node</span><span class="p">.</span><span class="na">TEXT_NODE</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">String</span> <span class="n">trimmedVal</span> <span class="o">=</span> <span class="n">child</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">trimmedVal</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="n">pw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="s">&quot;: \&quot;&quot;</span> <span class="o">+</span> <span class="n">trimmedVal</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
           <span class="c1">// element names with values end with &#39;:&#39;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="na">getNodeType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Node</span><span class="p">.</span><span class="na">ELEMENT_NODE</span><span class="p">)</span>
      <span class="n">visitNode</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">ind</span><span class="o">+</span><span class="s">&quot;  &quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end of visitNode()</span>
</code></pre></div>
<p>visitAttrs() prints attribute names and data:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of ExtractXMLInfo.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">visitAttrs</span><span class="p">(</span><span class="n">PrintWriter</span> <span class="n">pw</span><span class="p">,</span> <span class="n">Node</span> <span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NamedNodeMap</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="na">getAttributes</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">attrs</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">attrs</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Node</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="n">pw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">attr</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;= \&quot;&quot;</span> <span class="o">+</span>
                             <span class="n">attr</span><span class="p">.</span><span class="na">getNodeValue</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
           <span class="c1">// attribute names end with &#39;=&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of visitAttrs()</span>
</code></pre></div>
<p>When ExtractXMLInfo.java has finished stripping the XML, the next stage is to call
BuildXMLSheet.java to load the text into Office as a Calc sheet. This is done by
converting it into a 2D array which is added to the spreadsheet by Calc.setArray().</p>
<p>The main() function of BuildXMLSheet.java calls getData() to create the array:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildXMLSheet.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run BuildXMLSheet &lt;XML textfile&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">printTable</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

  <span class="c1">// Lo.saveDoc(doc, &quot;createdSS.ods&quot;);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>getData() builds the array in two steps: initially a list of differently sized arrays is
created, one for each input line. Then the list is converted into a 2D array where every
row has the same length.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of BuildXMLSheet.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getData</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">maxCols</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">// max number of columns across all rows</span>

  <span class="c1">// each input line is stored as an array inside a list</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="p">();</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Reading data from &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>
    <span class="n">String</span> <span class="n">line</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">Object</span><span class="o">[]</span> <span class="n">toks</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
           <span class="c1">// read a line as an array of tokens (strings)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">toks</span><span class="p">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">toks</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">toks</span><span class="p">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">maxCols</span><span class="p">)</span>
        <span class="n">maxCols</span> <span class="o">=</span> <span class="n">toks</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not read &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// convert list of different length arrays into a</span>
  <span class="c1">// fixed length 2D array</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">rows</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">][</span><span class="n">maxCols</span><span class="o">]</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rows</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">maxCols</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="n">row</span><span class="p">.</span><span class="na">length</span><span class="p">)</span>
        <span class="n">data</span><span class="o">[</span><span class="n">r</span><span class="o">][</span><span class="n">c</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>   <span class="c1">// pad out array row with empty strings</span>
      <span class="k">else</span>
        <span class="n">data</span><span class="o">[</span><span class="n">r</span><span class="o">][</span><span class="n">c</span><span class="o">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="n">c</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getData()</span>

<span class="n">splitLine</span><span class="p">()</span> <span class="n">converts</span> <span class="n">an</span> <span class="n">input</span> <span class="n">line</span> <span class="n">into</span> <span class="n">an</span> <span class="n">array</span> <span class="n">of</span> <span class="n">tokens</span><span class="p">.</span>


<span class="c1">// part of BuildXMLSheet.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">splitLine</span><span class="p">(</span><span class="n">String</span> <span class="n">ln</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ln</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span><span class="p">;</span> <span class="c1">// To detect last token when not quoted...</span>

  <span class="kt">boolean</span> <span class="n">inQuote</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kt">boolean</span> <span class="n">isIndenting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">numSpaces</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">StringBuilder</span> <span class="n">word</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">toks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
               <span class="c1">// used to store tokens for the final array</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ln</span><span class="p">.</span><span class="na">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">ln</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="n">isIndenting</span><span class="p">)</span>
      <span class="n">isIndenting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="n">isIndenting</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">numSpaces</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">numSpaces</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">toks</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>  <span class="c1">// convert two space indent into &quot;&quot;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\&quot;&#39;</span> <span class="o">||</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">inQuote</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// treat a double quoted string as one token</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\&quot;&#39;</span><span class="p">)</span>
        <span class="n">inQuote</span> <span class="o">=</span> <span class="o">!</span><span class="n">inQuote</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">inQuote</span> <span class="o">&amp;&amp;</span> <span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">lastCh</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lastCh</span> <span class="o">==</span> <span class="sc">&#39;:&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">lastCh</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">))</span>
          <span class="c1">// strip element and attribute assignment symbols</span>
          <span class="n">word</span><span class="p">.</span><span class="na">deleteCharAt</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">toks</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
        <span class="n">word</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
      <span class="n">word</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">toks</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">toks</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of splitLine()</span>
</code></pre></div>
<p>Every two spaces at the start of a line is stored as an empty string in the row array.
These strings will later occupy spreadsheet cells at the start of a row, causing the
actual data to be 'indented' to cells further to the right.</p>
<p>Special care is taken to treat a doubly quoted string as a single token, and any word
ending with ':' or '=' has that character stripped away. These characters signify that the
element or attribute name has associated data.</p>
<p>Figure 16 shows how the weather data is loaded as a spreadsheet by
BuildXMLSheet.java.</p>
<p><img alt="" src="images/50-Importing_XML-16.png" /></p>
<p>Figure 16. BuildXMLSheet Applied to Weather Data.</p>
<p>Figure 17 shows the results for the payments data.</p>
<p><img alt="" src="images/50-Importing_XML-17.png" /></p>
<p>Figure 17. BuildXMLSheet Applied to Payments Data.</p>
<h3 id="33-jaxb-conversion-of-xml-to-java-objects">3.3.  JAXB Conversion of XML to Java Objects<a class="headerlink" href="#33-jaxb-conversion-of-xml-to-java-objects" title="Permanent link">&para;</a></h3>
<p>Java Architecture for XML Binding (JAXB) provides methods for unmarshalling
(converting) XML documents into Java classes and objects, and for marshalling Java
objects back into XML documents. I'm interested in the unmarshalling parts so data
can be passed to Office as Java objects rather than as XML.</p>
<p>Most of the magic of the XML-to-Java conversion is performed by Java's xjc.exe tool
which comes as part of the JDK (you'll find it in %java_home%\bin on Windows).
xjc processes an XML schema (an XSD file)  rather than XML since the schema
contains information about the XML's underlying structure.</p>
<p>The good news is that there are websites, such as freeformatter.com, which can
generate XSD from supplied XML (<a href="http://www.freeformatter.com/xsd-generator.html">http://www.freeformatter.com/xsd-generator.html</a>).
I employed its "Salami slice" translator so that the Java code
generated later by xjc is a bit simpler to read. freeformatter.com converted pay.xml
into the following XSD:</p>
<div class="highlight"><pre><span></span><code>&lt;xs:schema attributeFormDefault=&quot;unqualified&quot;
elementFormDefault=&quot;qualified&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;xs:element name=&quot;purpose&quot; type=&quot;xs:string&quot;/&gt;
  &lt;xs:element name=&quot;amount&quot; type=&quot;xs:float&quot;/&gt;
  &lt;xs:element name=&quot;tax&quot; type=&quot;xs:float&quot;/&gt;
  &lt;xs:element name=&quot;maturity&quot; type=&quot;xs:date&quot;/&gt;
  &lt;xs:element name=&quot;payment&quot;&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref=&quot;purpose&quot;/&gt;
        &lt;xs:element ref=&quot;amount&quot;/&gt;
        &lt;xs:element ref=&quot;tax&quot;/&gt;
        &lt;xs:element ref=&quot;maturity&quot;/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:element name=&quot;payments&quot;&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref=&quot;payment&quot;
            maxOccurs=&quot;unbounded&quot; minOccurs=&quot;0&quot;/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</code></pre></div>
<p>The schema gives the names and types for each field in a payment object, and makes
payments a sequence of payment objects.</p>
<p>A good tutorial on XSD can be found at w3schools.com:
<a href="http://www.w3schools.com/Xml/schema_intro.asp">http://www.w3schools.com/Xml/schema_intro.asp</a></p>
<p>If the resulting schema is stored in pay.xsd, then xjc generates Java classes like so:</p>
<div class="highlight"><pre><span></span><code>xjc -p Pay pay.xsd
</code></pre></div>
<p>The –p option supplies a package name which causes the potentially numerous classes
to be stored in a folder of that name. Details about xjc can be found at
<a href="http://docs.oracle.com/javase/6/docs/technotes/tools/share/xjc.html">http://docs.oracle.com/javase/6/docs/technotes/tools/share/xjc.html</a>, or by calling xjc -
help.</p>
<p>Three classes are written to the Pay folder: Payments.java, Payment.java, and
ObjectFactory.java. The first two are Java version of the XML elements, while
ObjectFactory is used to create the Java objects at runtime. Figure 18 shows class
diagrams for the code.</p>
<p><img alt="" src="images/50-Importing_XML-18.png" /></p>
<p>Figure 18. The Payments Class Diagrams.</p>
<p>As you might expect, the XML sequence of Payment objects inside Payments is
implemented as a list in Java.</p>
<p>The details of the ObjectFactory aren't important, but the get/set methods in the
Payments and Payment classes will be useful. My UnmarshallPay.java example
shows how to use these classes:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in UnmarshallPay.java</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">Pay.*</span><span class="p">;</span>   <span class="c1">// the package for the Pay classes</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnmarshallPay</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// initialize the Payments objects using pay.xml</span>
      <span class="n">JAXBContext</span> <span class="n">jaxbContext</span> <span class="o">=</span>
               <span class="n">JAXBContext</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">Payments</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">Unmarshaller</span> <span class="n">jaxbUnmarshaller</span> <span class="o">=</span>
               <span class="n">jaxbContext</span><span class="p">.</span><span class="na">createUnmarshaller</span><span class="p">();</span>
      <span class="n">Payments</span> <span class="n">pays</span> <span class="o">=</span> <span class="p">(</span><span class="n">Payments</span><span class="p">)</span> <span class="n">jaxbUnmarshaller</span><span class="p">.</span><span class="na">unmarshal</span><span class="p">(</span>
                                     <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s">&quot;pay.xml&quot;</span><span class="p">));</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Payment</span><span class="o">&gt;</span> <span class="n">payList</span> <span class="o">=</span> <span class="n">pays</span><span class="p">.</span><span class="na">getPayment</span><span class="p">();</span>

      <span class="c1">// print payment names and amounts</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Payments&quot;</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="n">Payment</span> <span class="n">p</span> <span class="p">:</span> <span class="n">payList</span><span class="p">)</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="na">getPurpose</span><span class="p">()</span> <span class="o">+</span>
                           <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="na">getAmount</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">JAXBException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of UnmarshallPay class</span>
</code></pre></div>
<p>main() creates an Unmarshaller object for the Payments class, which is initialized
with data from pay.xml. It then iterates through the Payment objects and prints their
purpose and amount fields. The output is:</p>
<div class="highlight"><pre><span></span><code>Payments
  CD: 12.95
  DVD: 19.95
  Clothes: 99.95
  Book: 9.49
</code></pre></div>
<p>Now that the XML data is available through Java (using various get methods), it is
quite easy to extend UnmarshallPay.java to write it into an Office document.</p>
<h4 id="clubsxml-as-java-code">clubs.xml as Java Code<a class="headerlink" href="#clubsxml-as-java-code" title="Permanent link">&para;</a></h4>
<p>The JAXB manipulation of clubs.xml follows the same steps as used on pay.xml:</p>
<ol>
<li>Convert clubs.xml to XSD at freeformatter.com using the "Salami Slice" mapping.</li>
<li>Convert company.xsd into Java classes with xjc: <code>xjc -p Clubs clubs.xsd</code></li>
<li>Compile the Clubs package: <code>javac Clubs/*.java</code></li>
</ol>
<p>Figure 19 shows the Clubs class diagrams.</p>
<p><img alt="" src="images/50-Importing_XML-19.png" /></p>
<p>Figure 19. The Clubs Class Diagrams.</p>
<p>The top-level class is ClubDatabase which maintains a list of Association objects.</p>
<p>Each Association object holds a list of Club objects. Club contains get/set methods for
accessing its fields. My UnmarshallClubs.java example shows how to use these
classes:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in UnmarshallClubs.java</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">Clubs.*</span><span class="p">;</span>  <span class="c1">// the package for the Club classes</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnmarshallClubs</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// initialize the Clubs objects using clubs.xml</span>
      <span class="n">JAXBContext</span> <span class="n">jaxbContext</span> <span class="o">=</span>
               <span class="n">JAXBContext</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">ClubDatabase</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">Unmarshaller</span> <span class="n">jaxbUnmarshaller</span> <span class="o">=</span>
               <span class="n">jaxbContext</span><span class="p">.</span><span class="na">createUnmarshaller</span><span class="p">();</span>
      <span class="n">ClubDatabase</span> <span class="n">cd</span> <span class="o">=</span> <span class="p">(</span><span class="n">ClubDatabase</span><span class="p">)</span> <span class="n">jaxbUnmarshaller</span><span class="p">.</span><span class="na">unmarshal</span><span class="p">(</span>
                                 <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s">&quot;clubs.xml&quot;</span><span class="p">));</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Association</span><span class="o">&gt;</span> <span class="n">assocList</span> <span class="o">=</span> <span class="n">cd</span><span class="p">.</span><span class="na">getAssociation</span><span class="p">();</span>

      <span class="c1">// print club names for all the associations</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Associations&quot;</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="n">Association</span> <span class="n">assoc</span> <span class="p">:</span> <span class="n">assocList</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">assoc</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Club</span><span class="o">&gt;</span> <span class="n">clubs</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">.</span><span class="na">getClub</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="n">Club</span> <span class="n">club</span> <span class="p">:</span> <span class="n">clubs</span><span class="p">)</span>
          <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;    &quot;</span> <span class="o">+</span> <span class="n">club</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">JAXBException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of UnmarshallClubs class</span>
</code></pre></div>
<p>The unmarshalling is similar to before except that the ClubDatabase object is
initialized with data from clubs.xml. The code iterates through the clubs in each
association, printing their names:</p>
<div class="highlight"><pre><span></span><code>Associations
  BAWA
    Castro Valley Wrestling Club
    Coastside Grapplers
    Dixon Ram Wrestling
    East Bay Freestylers
    Fairfield WrestlingClub
    Godfather Wrestling Club
    Golden Gate Wrestling Club
    Mat Club USA
    Pirate Wrestling Club
    SF Elite Wrestling
    Titan Wrestling Club
  CAGWA
    Big Bear Grizzlies Wrestling Club
    California Grapplers Youth Wrestling
     :
     :
    South Coast Wrestling Club
    West Hills Hawks
</code></pre></div>
<h4 id="naming-conflicts">Naming Conflicts<a class="headerlink" href="#naming-conflicts" title="Permanent link">&para;</a></h4>
<p>The xjc tool works so well that a deep understanding of JAXB isn't usually needed.
The exception is when the XML contains a name conflict, which occurs if two or
more attributes have the same name.</p>
<p>There's a number of "value" name conflicts in weather.xml, which I've highlighted
below:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;current&gt;
    &lt;city id=&quot;1610780&quot; name=&quot;Hat Yai&quot;&gt;
        &lt;coord lat=&quot;7.01&quot; lon=&quot;100.48&quot;/&gt;
        &lt;country&gt;TH&lt;/country&gt;
        &lt;sun rise=&quot;2017-01-01T23:30:31&quot; set=&quot;2017-01-02T11:14:18&quot;/&gt;
    &lt;/city&gt;
    &lt;temperature max=&quot;25&quot; min=&quot;25&quot; unit=&quot;metric&quot; value=&quot;25&quot;/&gt;
    &lt;humidity unit=&quot;%&quot; value=&quot;94&quot;/&gt;
    &lt;pressure unit=&quot;hPa&quot; value=&quot;1011&quot;/&gt;
    &lt;wind&gt;
        &lt;speed name=&quot;Gentle Breeze&quot; value=&quot;3.6&quot;/&gt;
        &lt;gusts/&gt;
        &lt;direction code=&quot;NNE&quot; name=&quot;North-northeast&quot; value=&quot;30&quot;/&gt;
    &lt;/wind&gt;
    &lt;clouds name=&quot;broken clouds&quot; value=&quot;75&quot;/&gt;
    &lt;visibility value=&quot;5000&quot;/&gt;
    &lt;precipitation mode=&quot;no&quot;/&gt;
    &lt;weather icon=&quot;10n&quot; number=&quot;501&quot; value=&quot;moderate rain&quot;/&gt;
    &lt;lastupdate value=&quot;2017-01-02T15:30:00&quot;/&gt;
&lt;/current&gt;
</code></pre></div>
<p>The "value" attribute is used nine times in different contexts. This doesn't pose a
problem for freeformatter.com, which quietly generates weather.xsd. The name
conflict is only reported when xjc tries to generate Java classes:</p>
<div class="highlight"><pre><span></span><code>&gt;  xjc -p Weather weather.xsd
parsing a schema...

[ERROR] Property &quot;Value&quot; is already defined.

Use &lt;jaxb:property&gt; to resolve this conflict.

    :  // many more error messages …
</code></pre></div>
<p>As the error message advises, I need to add jaxb:property annotations to the XSD file
to allow xjc to correctly translate the attributes. For example, the first offender in
weather.xsd is:</p>
<div class="highlight"><pre><span></span><code>&lt;xs:attribute type=&quot;xs:float&quot; name=&quot;value&quot;/&gt;
Its jaxb:property annotation is:

&lt;xs:attribute type=&quot;xs:float&quot; name=&quot;value&quot;&gt;
    &lt;!-- avoid &quot;value&quot; name conflict --&gt;
    &lt;xs:annotation&gt;
        &lt;xs:appinfo&gt;
            &lt;jaxb:property name=&quot;valueAttribute&quot;/&gt;
        &lt;/xs:appinfo&gt;
    &lt;/xs:annotation&gt;
&lt;/xs:attribute&gt;
</code></pre></div>
<p>This same change is applied to all the other conflicting attribute names.</p>
<p>In addition, the new "jaxb" label must be linked to its JAXB schema at the start of the
XSD file:</p>
<div class="highlight"><pre><span></span><code>&lt;!-- in the xs:schema element --&gt;
xmlns:jaxb=&quot;http://java.sun.com/xml/ns/jaxb&quot;
jaxb:version=&quot;2.1&quot;
</code></pre></div>
<p>If you want to understand what's happening in more detail, the best place to start is the
tutorial at Oracle: <a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/">https://docs.oracle.com/javase/tutorial/jaxb/intro/</a>.</p>
<p>When xjc is passed this modified weather.xsd file, the Java classes are correctly
generated. Figure 20 shows only the class names to reduce the diagram's size.</p>
<p><img alt="" src="images/50-Importing_XML-20.png" /></p>
<p>Figure 20. The Weather Class Diagrams.</p>
<p>The top-level class is Current which stores the weather attributes as objects.</p>
<p>My UnmarshallWeather.java example examines weather.xml to report if it was
raining on the report day:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in UnmarshallWeather.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnmarshallWeather</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">JAXBContext</span> <span class="n">jaxbContext</span> <span class="o">=</span>
                    <span class="n">JAXBContext</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">Unmarshaller</span> <span class="n">jaxbUnmarshaller</span> <span class="o">=</span>
                    <span class="n">jaxbContext</span><span class="p">.</span><span class="na">createUnmarshaller</span><span class="p">();</span>
      <span class="n">Current</span> <span class="n">currWeather</span> <span class="o">=</span> <span class="p">(</span><span class="n">Current</span><span class="p">)</span> <span class="n">jaxbUnmarshaller</span><span class="p">.</span><span class="na">unmarshal</span><span class="p">(</span>
                                 <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s">&quot;weather.xml&quot;</span><span class="p">));</span>

      <span class="c1">// get precipitation as a boolean</span>
      <span class="n">String</span> <span class="n">rainingStatus</span> <span class="o">=</span>
                <span class="n">currWeather</span><span class="p">.</span><span class="na">getPrecipitation</span><span class="p">().</span><span class="na">getValue</span><span class="p">();</span>
      <span class="kt">boolean</span> <span class="n">isRaining</span> <span class="o">=</span> <span class="n">rainingStatus</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;yes&quot;</span><span class="p">);</span>

      <span class="c1">// get date in day/month/year format</span>
      <span class="n">XMLGregorianCalendar</span> <span class="n">gCal</span> <span class="o">=</span>
               <span class="n">currWeather</span><span class="p">.</span><span class="na">getLastupdate</span><span class="p">().</span><span class="na">getValueAttribute</span><span class="p">();</span>
      <span class="n">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="n">gCal</span><span class="p">.</span><span class="na">toGregorianCalendar</span><span class="p">();</span>

      <span class="n">SimpleDateFormat</span> <span class="n">formatter</span> <span class="o">=</span>
                          <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;dd/MM/yyyy&quot;</span><span class="p">);</span>
      <span class="n">formatter</span><span class="p">.</span><span class="na">setTimeZone</span><span class="p">(</span><span class="n">cal</span><span class="p">.</span><span class="na">getTimeZone</span><span class="p">());</span>
      <span class="n">String</span> <span class="n">dateStr</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">cal</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">isRaining</span><span class="p">)</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;It was raining on &quot;</span> <span class="o">+</span> <span class="n">dateStr</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;It was NOT raining on &quot;</span> <span class="o">+</span> <span class="n">dateStr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">JAXBException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of UnmarshallWeather class</span>
</code></pre></div>
<p>The output is:</p>
<div class="highlight"><pre><span></span><code>It was NOT raining on 02/01/2017
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 9 The ODF Format" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Part 9 The ODF Format
            </div>
          </div>
        </a>
      
      
        
        <a href="51-Simple_ODF.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 51. Simple ODF" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 51. Simple ODF
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>