
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/27-Funcs_Analysis.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 27. Functions and Data Analysis - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-27-functions-and-data-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 27. Functions and Data Analysis
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 27. Functions and Data Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="27-Funcs_Analysis.html" class="md-nav__link md-nav__link--active">
        Chapter 27. Functions and Data Analysis
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-calling-calc-functions-from-code" class="md-nav__link">
    1.  Calling Calc Functions from Code
  </a>
  
    <nav class="md-nav" aria-label="1.  Calling Calc Functions from Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functions-help" class="md-nav__link">
    Functions Help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pivot-tables" class="md-nav__link">
    2.  Pivot Tables
  </a>
  
    <nav class="md-nav" aria-label="2.  Pivot Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pivot-tables-in-the-api" class="md-nav__link">
    Pivot Tables in the API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-seeking-a-goal" class="md-nav__link">
    3.  Seeking a Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-linear-and-nonlinear-solving" class="md-nav__link">
    4.  Linear and Nonlinear Solving
  </a>
  
    <nav class="md-nav" aria-label="4.  Linear and Nonlinear Solving">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-a-linear-optimization-problem" class="md-nav__link">
    4.1.  A Linear Optimization Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-another-linear-problem-using-sco" class="md-nav__link">
    4.2.  Another Linear Problem (using SCO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-a-nonlinear-problem-using-deps-and-sco" class="md-nav__link">
    4.3.  A Nonlinear Problem (using DEPS and SCO)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-calling-calc-functions-from-code" class="md-nav__link">
    1.  Calling Calc Functions from Code
  </a>
  
    <nav class="md-nav" aria-label="1.  Calling Calc Functions from Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functions-help" class="md-nav__link">
    Functions Help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pivot-tables" class="md-nav__link">
    2.  Pivot Tables
  </a>
  
    <nav class="md-nav" aria-label="2.  Pivot Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pivot-tables-in-the-api" class="md-nav__link">
    Pivot Tables in the API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-seeking-a-goal" class="md-nav__link">
    3.  Seeking a Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-linear-and-nonlinear-solving" class="md-nav__link">
    4.  Linear and Nonlinear Solving
  </a>
  
    <nav class="md-nav" aria-label="4.  Linear and Nonlinear Solving">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-a-linear-optimization-problem" class="md-nav__link">
    4.1.  A Linear Optimization Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-another-linear-problem-using-sco" class="md-nav__link">
    4.2.  Another Linear Problem (using SCO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-a-nonlinear-problem-using-deps-and-sco" class="md-nav__link">
    4.3.  A Nonlinear Problem (using DEPS and SCO)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/main/docs/27-Funcs_Analysis.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-27-functions-and-data-analysis">Chapter 27. Functions and Data Analysis<a class="headerlink" href="#chapter-27-functions-and-data-analysis" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Calling Calc
Functions from Code;
Pivot Tables; Goal Seek;
Linear and Nonlinear
Solving (using SCO,
DEPS)</p>
<p>Example folders: "Calc
Tests" and "Utils"</p>
</div>
<p>This chapter looks at how to utilize Calc's spreadsheet
functions directly from Java, and then examines four of
Calc's data analysis features: pivot tables, goal seeking,
and linear and nonlinear solving. There are two nonlinear
examples, one using the SCO solver, the using employing
DEPS.</p>
<h2 id="1-calling-calc-functions-from-code">1.  Calling Calc Functions from Code<a class="headerlink" href="#1-calling-calc-functions-from-code" title="Permanent link">&para;</a></h2>
<p>Calc comes with an extensive set of functions, which are described in Appendix B of
the Calc User Guide, available from <a href="https://libreoffice.org/get-help/documentation">https://libreoffice.org/get-help/documentation</a>.
The information is also online at
<a href="https://help.libreoffice.org/Calc/Functions_by_Category">https://help.libreoffice.org/Calc/Functions_by_Category</a>, organized into 11 categories:</p>
<ol>
<li>Database: for extracting information from Calc tables, where the data is
organized into rows. The "Database" name is a little misleading, but the
documentation makes the point that Calc database functions have nothing to
do with Base databases.  Chapter 13 of the Calc User Guide ("Calc as a
Simple Database") explains the distinction in detail.</li>
<li>Date and Time; e.g. see the EASTERSUNDAY function below</li>
<li>Financial: for business calculations;</li>
<li>Information: many of these return boolean information about cells, such as
whether a cell contains text or a formula;</li>
<li>Logical: functions for boolean logic;</li>
<li>Mathematical: trigonometric, hyperbolic, logarithmic, and summation
functions; e.g. see ROUND, SIN, and RADIANS below;</li>
<li>Array: many of these operations treat cell ranges like 2D arrays; e.g. see
TRANSPOSE below;</li>
<li>Statistical: for statistical and probability calculations; e.g., see AVERAGE and
SLOPE below;</li>
<li>Spreadsheet: for finding values in tables, cell ranges, and cells;</li>
<li>Text: string manipulation functions;</li>
<li>Add-ins: a catch-all category that includes a lot of functions – extra data and
time operations, conversion functions between number bases, more statistics,
and complex numbers. See IMSUM and ROMAN below for examples. The
"Add-ins" documentation starts at
<a href="https://help.libreoffice.org/Calc/Add-in_Functions">https://help.libreoffice.org/Calc/Add-in_Functions</a>, and continues in
<a href="https://help.libreoffice.org/Calc/Add-in_Functions,_List_of_Analysis_Functions_Part_One">https://help.libreoffice.org/Calc/Add-in_Functions,_List_of_Analysis_Functions_Part_One</a> and
<a href="https://help.libreoffice.org/Calc/Add-in_Functions,_List_of_Analysis_Functions_Part_Two">https://help.libreoffice.org/Calc/Add-in_Functions,_List_of_Analysis_Functions_Part_Two</a>.</li>
</ol>
<p>A different organization for the functions documentation is used at the OpenOffice
site
(<a href="https://wiki.openoffice.org/wiki/Documentation/How_Tos/Calc:_Functions_listed_by_category">https://wiki.openoffice.org/wiki/Documentation/How_Tos/Calc:_Functions_listed_by_category</a>),
and is probably easy to use when browsing/searching for a suitable function.</p>
<p>If you know the name of the function, then a reasonably effective way of finding its
documentation is to search for "libreoffice calc function" + the function name.</p>
<p>The standard way of using these functions is, of course, inside cell formulae. But it's
also possible to call them from code via the XFunctionAccess interface.
XFunctionAccess only contains a single function, callFunction(), but it can be a bit
hard to use due to data typing issues.</p>
<p>Calc.callFun() creates an XFunctionAccess instance, and executes callFunction():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">callFun</span><span class="p">(</span><span class="n">String</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XFunctionAccess</span> <span class="n">fa</span> <span class="o">=</span>
          <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XFunctionAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                    <span class="s">&quot;com.sun.star.sheet.FunctionAccess&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">fa</span><span class="p">.</span><span class="na">callFunction</span><span class="p">(</span><span class="n">funcName</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not invoke \&quot;&quot;</span> <span class="o">+</span> <span class="n">funcName</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of callFun()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">callFun</span><span class="p">(</span><span class="n">String</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">Object</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">callFun</span><span class="p">(</span><span class="n">funcName</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">arg</span><span class="p">});</span>  <span class="p">}</span>
</code></pre></div>
<p>Calc.callFun() is passed the Calc function name and an array of arguments; the
function's result is returned as an Object instance. The second version of
Calc.callFun() is for calling functions that accept a single argument.</p>
<p>Several examples of how to use Calc.callFun() can be found in the FunctionsTest.java
example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argus</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

  <span class="c1">// round a double</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ROUND result for 1.999 is: &quot;</span> <span class="o">+</span>
                     <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;ROUND&quot;</span><span class="p">,</span> <span class="mf">1.999</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>

     <span class="p">:</span>  <span class="c1">// more examples, explained below</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>The value passed to Calc.callFun() in the code above is an ordinary double, but Java
autoboxes it to become a Double object. This is passed to the second version of
Calc.callFun() which handles a single Object input argument.</p>
<p>The printed result is:</p>
<div class="highlight"><pre><span></span><code>ROUND result for 1.999 is: 2.0
</code></pre></div>
<p>Java can be used to convert the returned Object value. For example, the value returned
by ROUND can be cast to a double:</p>
<div class="highlight"><pre><span></span><code><span class="kt">double</span> <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">Double</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;ROUND&quot;</span><span class="p">,</span> <span class="mf">1.999</span><span class="p">);</span>
</code></pre></div>
<p>The Object is cast to Double, and then Java unboxes the object, converting it to a
double.</p>
<p>Function calls can be nested, as in:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;SIN result for 30 degrees is: %.3f\n\n&quot;</span><span class="p">,</span>
         <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;SIN&quot;</span><span class="p">,</span>  <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;RADIANS&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)));</span>
</code></pre></div>
<p>The call to RADIANS converts 30 degrees to radians. The returned Object is accepted
by the SIN function as input. The output is:
SIN result for 30 degrees is: 0.500
Many functions require more than one argument. In that case, the sequence of
arguments must be stored in an Object[] array before passing them to Calc.callFun().</p>
<p>For instance:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>   <span class="c1">// five args</span>
<span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">Double</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;AVERAGE&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Average of the numbers is: &quot;</span> <span class="o">+</span><span class="n">avg</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>This reports the average to be 3.0.</p>
<p>When the Calc function documentation talks about an "array" or "matrix" argument,
then the data needs to be packaged as a 2D array. For example, the SLOPE function
takes two arrays of x and y coordinates as input, and calculates the slope of the line
through them. These two 1D arrays must be passed to Calc.callFun() as two 2D
arrays:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="kt">double</span><span class="o">[][]</span> <span class="n">xData</span> <span class="o">=</span> <span class="p">{{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">}};</span>
    <span class="c1">// a 2D array/matrix holding one row of data</span>
<span class="kt">double</span><span class="o">[][]</span> <span class="n">yData</span> <span class="o">=</span> <span class="p">{{</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">}};</span>

<span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">yData</span><span class="p">,</span> <span class="n">xData</span><span class="p">};</span>
<span class="kt">double</span> <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">Double</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;SLOPE&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;SLOPE of the line: &quot;</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The args array has to be built in stages so that the two arrays can be treated as two
Objects. The slope result is 3.0, as expected.</p>
<p>The functions in the "Array" category almost all use 2D arrays as arguments. For
example, the TRANSPOSE function is called like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="c1">// transpose a matrix</span>
<span class="kt">double</span><span class="o">[][]</span> <span class="n">arr</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">}};</span>
<span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">arr</span><span class="p">};</span>
<span class="n">Object</span><span class="o">[][]</span> <span class="n">transMat</span> <span class="o">=</span> <span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;TRANSPOSE&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">printArray</span><span class="p">(</span><span class="n">transMat</span><span class="p">);</span>
</code></pre></div>
<p>The input array is in row-order, so the array arr created above has two rows and three
columns. The printed transpose is:</p>
<div class="highlight"><pre><span></span><code>Row x Column size: 3 x 2
  1.0  4.0
  2.0  5.0
  3.0  6.0
</code></pre></div>
<p>Note that the result of this call to Calc.callFun() was not a double but a transposed 2D
array, which is why the Object result was cast to Object[][]. Unfortunately, Java's
typing does not allow the result to be cast to double[][]. The casting can be done using
Calc.convertToDoubles():</p>
<div class="highlight"><pre><span></span><code><span class="kt">double</span><span class="o">[][]</span> <span class="n">trans</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">convertToDoubles</span><span class="p">(</span><span class="n">transMat</span><span class="p">);</span>
</code></pre></div>
<p>The TRANSPOSE function only takes a single argument, so it's possible to use the
second version of Calc.callFun() which takes a single Object input argument. A slight
problem is caused by Java's type system; it's necessary to explicitly cast the double[][]
array to Object in the call:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="n">Object</span><span class="o">[][]</span> <span class="n">transMat</span> <span class="o">=</span>
   <span class="p">(</span><span class="n">Object</span><span class="o">[][]</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;TRANSPOSE&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Object</span><span class="p">)</span><span class="n">arr</span><span class="p">);</span>
</code></pre></div>
<p>If arr is not cast then Java will issue a runtime error.</p>
<p>There are several functions for manipulating imaginary numbers, which must be
written in the form of strings. For example, IMSUM sums a series of complex
numbers like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="c1">// sum two imaginary numbers: &quot;13+4j&quot; + &quot;5+3j&quot; returns 18+7j.</span>

<span class="n">String</span><span class="o">[][]</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">{{</span><span class="s">&quot;13+4j&quot;</span><span class="p">},{</span><span class="s">&quot;5+3j&quot;</span><span class="p">}};</span>
<span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">nums</span><span class="p">};</span>
<span class="n">String</span> <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;IMSUM&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;13+4j + 5+3j: &quot;</span><span class="o">+</span> <span class="n">sum</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Since IMSUM expects a series of complex numbers, Calc.callFun() must be passed a
2D array. Each row contains a single string argument representing a complex number.</p>
<p>The summed complex number is returned as the string "18+7j". This means that the
Calc.callFun() result is cast to String in this case.</p>
<p>The IMSUM function is only processing a single argument, and so the single
argument version of Calc.callFun() can be called. As with the TRANSPOSE function
example, the String[][] array must be expicitly cast to an Object:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;IMSUM&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Object</span><span class="p">)</span><span class="n">nums</span><span class="p">);</span>
</code></pre></div>
<h4 id="functions-help">Functions Help<a class="headerlink" href="#functions-help" title="Permanent link">&para;</a></h4>
<p>If you can't access the Calc documentation on functions, then Calc.java contains two
help functions: Calc.getFunctionNames() and Calc.printFunctionInfo(). The former
prints a very long list of function names:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Function names&quot;</span><span class="p">);</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">printNames</span><span class="p">(</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getFunctionNames</span><span class="p">(),</span> <span class="mi">6</span><span class="p">);</span>
</code></pre></div>
<p>The output begins like so:</p>
<div class="highlight"><pre><span></span><code>Function names
No. of names: 483
  &quot;ABS&quot;  &quot;ACCRINT&quot;  &quot;ACCRINTM&quot;  &quot;ACOS&quot;  &quot;ACOSH&quot;  &quot;ACOT&quot;
  &quot;ACOTH&quot;  &quot;ADDRESS&quot;  &quot;AGGREGATE&quot;  &quot;AMORDEGRC&quot;  &quot;AMORLINC&quot;  &quot;AND&quot;
  &quot;ARABIC&quot;  &quot;AREAS&quot;  &quot;ASC&quot;  &quot;ASIN&quot;  &quot;ASINH&quot;  &quot;ATAN&quot;
  &quot;ATAN2&quot;  &quot;ATANH&quot;  &quot;AVEDEV&quot;  &quot;AVERAGE&quot;  &quot;AVERAGEA&quot;  &quot;AVERAGEIF&quot;
  &quot;AVERAGEIFS&quot;  &quot;B&quot;  &quot;BAHTTEXT&quot;  &quot;BASE&quot;  &quot;BESSELI&quot;  &quot;BESSELJ&quot;
  &quot;BESSELK&quot;  &quot;BESSELY&quot;  &quot;BETA.DIST&quot;  &quot;BETA.INV&quot;  &quot;BETADIST&quot;  &quot;BETAINV&quot;
  &quot;BIN2DEC&quot;  &quot;BIN2HEX&quot;  &quot;BIN2OCT&quot;  &quot;BINOM.DIST&quot;  &quot;BINOM.INV&quot;  &quot;BINOMDIST&quot;
    :
</code></pre></div>
<p>If you know a function name, then Calc.printFunctionInfo() will print details about it.</p>
<p>For instance, information about the ROMAN function is obtained like so:
Calc.printFunctionInfo("ROMAN");
The output is:</p>
<div class="highlight"><pre><span></span><code>Properties for &quot;ROMAN&quot;:
  Id: 383
  Category: 10
  Name: ROMAN
  Description: Converts a number to a Roman numeral.

  Arguments: [Lcom.sun.star.sheet.FunctionArgument;@b3fc9e

No. of arguments: 2
1.  Argument name: Number

   Description: &quot;The number to be converted to a Roman numeral must
be in the 0 - 3999 range.&quot;
   Is optional?: false

2.  Argument name: Mode

   Description: &quot;The more this value increases, the more the Roman
numeral is simplified. The value must be in the 0 - 4 range.&quot;
   Is optional?: true
</code></pre></div>
<p>This output states that ROMAN can be called with one or two arguments, the first
being a decimal, and the second an optional argument for the amount of
'simplification' carried out on the Roman numeral. For example, here are two ways to
convert 999 into Roman form:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FunctionsTest.java</span>
<span class="n">String</span> <span class="n">roman</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;ROMAN&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">);</span>

<span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="mi">999</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>   <span class="c1">// use max simplification</span>
<span class="n">String</span> <span class="n">roman4</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">Calc</span><span class="p">.</span><span class="na">callFun</span><span class="p">(</span><span class="s">&quot;ROMAN&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;999 in Roman numerals: &quot;</span><span class="o">+</span>
                             <span class="n">roman</span> <span class="o">+</span> <span class="s">&quot; or &quot;</span> <span class="o">+</span> <span class="n">roman4</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The output is:</p>
<div class="highlight"><pre><span></span><code>999 in Roman numerals: CMXCIX or IM
</code></pre></div>
<p>Calc.getFunctionNames() and Calc.printFunctionInfo() utilize the
XFunctionDescriptions interface for retrieving an indexed container of function
descriptions. Each function description is an array of PropertyValue objects, which
contain a "Name" property. Calc.findFunction() uses this organization to return the
PropertyValue[] array for a given function name:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="nf">findFunction</span><span class="p">(</span><span class="n">String</span> <span class="n">funcNm</span><span class="p">)</span>
<span class="c1">// get the function description properties for funcNm</span>
<span class="p">{</span>
  <span class="c1">// get all the function descriptions</span>
  <span class="n">XFunctionDescriptions</span> <span class="n">funcsDesc</span> <span class="o">=</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XFunctionDescriptions</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
               <span class="s">&quot;com.sun.star.sheet.FunctionDescriptions&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">funcsDesc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No function descriptions were found&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// find the description whose fn name == funcNm</span>
  <span class="kt">int</span> <span class="n">numFuncs</span> <span class="o">=</span> <span class="n">funcsDesc</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numFuncs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span>
             <span class="p">(</span><span class="n">PropertyValue</span><span class="o">[]</span><span class="p">)</span> <span class="n">funcsDesc</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">props</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">props</span><span class="o">[</span><span class="n">p</span><span class="o">]</span><span class="p">.</span><span class="na">Name</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
            <span class="p">(</span><span class="n">props</span><span class="o">[</span><span class="n">p</span><span class="o">]</span><span class="p">.</span><span class="na">Value</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">funcNm</span><span class="p">)))</span>
          <span class="k">return</span> <span class="n">props</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Function \&quot;&quot;</span> <span class="o">+</span> <span class="n">funcNm</span> <span class="o">+</span> <span class="s">&quot;\&quot; not found&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of findFunction()</span>
</code></pre></div>
<p>The PropertyValue[] array contains five properties: "Name", "Description", "Id",
"Category", and "Arguments". The "Arguments" property stores an array of
FunctionArgument objects which contain information about each argument's name,
description, and whether it is optional. This information is printed by
Calc.printFunArguments():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printFunArguments</span><span class="p">(</span><span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">propVals</span><span class="p">)</span>
<span class="c1">// print the function argument info in propVals</span>
<span class="p">{</span>
  <span class="c1">// get the FunctionArgument property</span>
  <span class="n">FunctionArgument</span><span class="o">[]</span> <span class="n">fargs</span> <span class="o">=</span>  <span class="p">(</span><span class="n">FunctionArgument</span><span class="o">[]</span><span class="p">)</span>
                    <span class="n">Props</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="s">&quot;Arguments&quot;</span><span class="p">,</span> <span class="n">propVals</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">fargs</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No arguments found&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// print all the info</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No. of arguments: &quot;</span> <span class="o">+</span> <span class="n">fargs</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fargs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">printFunArgument</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fargs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of printFunArguments()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printFunArgument</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">FunctionArgument</span> <span class="n">fa</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;. Argument name: &quot;</span> <span class="o">+</span> <span class="n">fa</span><span class="p">.</span><span class="na">Name</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;   Description: \&quot;&quot;</span> <span class="o">+</span> <span class="n">fa</span><span class="p">.</span><span class="na">Description</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;   Is optional?: &quot;</span> <span class="o">+</span> <span class="n">fa</span><span class="p">.</span><span class="na">IsOptional</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>

<span class="p">}</span>  <span class="c1">// end of printFunArgument()</span>

<span class="n">Calc</span><span class="p">.</span><span class="na">printFunctionInfo</span><span class="p">()</span> <span class="n">calls</span> <span class="n">Calc</span><span class="p">.</span><span class="na">findFunction</span><span class="p">()</span> <span class="n">and</span> <span class="n">Calc</span><span class="p">.</span><span class="na">printFunArguments</span><span class="p">()</span> <span class="n">to</span>
<span class="n">report</span> <span class="n">on</span> <span class="n">a</span> <span class="n">complete</span> <span class="n">function</span><span class="p">:</span>

<span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printFunctionInfo</span><span class="p">(</span><span class="n">String</span> <span class="n">funcName</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">propVals</span> <span class="o">=</span> <span class="n">findFunction</span><span class="p">(</span><span class="n">funcName</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">showProps</span><span class="p">(</span><span class="n">funcName</span><span class="p">,</span> <span class="n">propVals</span><span class="p">);</span>
  <span class="n">printFunArguments</span><span class="p">(</span><span class="n">propVals</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of printFunctionInfo()</span>
</code></pre></div>
<h2 id="2-pivot-tables">2.  Pivot Tables<a class="headerlink" href="#2-pivot-tables" title="Permanent link">&para;</a></h2>
<p>Pivot tables are explained in detail in chapter 8 of the Calc User's Guide. They allow a
user to view a spreadsheet consisting of columns of data in a variety of table formats,
thereby highlighting the relationships between the columns. For example, Figure 1
shows the small spreadsheet in my "pivottable1.ods".</p>
<p><img alt="" src="images/27-Funcs_Analysis-1.png" /></p>
<p>Figure 1. The "pivottable1.ods" Spreadsheet.</p>
<p>The spreadsheet uses a database-like organization, with each row acting as a record,
and each column is a different type/kind of information. This formatting style is
described in chapter 13 "Calc as a Simple Database" in the User Guide.</p>
<p>The drawback of this kind of data structuring is that it can be difficult to see the
underlying relationships between the columns; this is where pivot tables can help.</p>
<p>For example, a pivot table can be generated showing how the "Category" column
affects "Revenue (see Figure 2).</p>
<p><img alt="" src="images/27-Funcs_Analysis-2.png" /></p>
<p>Figure 2. "Category" Affecting "Revenue".</p>
<p>Note that the pivot table shows the revenue sum in column B, since several revenue
entries in the original sheet are covered by each category.</p>
<p>Alternatively, it's possible to see how "Period" and "Category" interact to affect the
revenue, as in Figure 3.</p>
<p><img alt="" src="images/27-Funcs_Analysis-3.png" /></p>
<p>Figure 3. Period and Category Affect on "Revenue".</p>
<p>The ordering of the "Period" values can be changed by clicking on the arrow next to
the "Period" text in cell "A2", then selecting a custom sort (e.g. Jan, Feb, Mar, etc.).</p>
<p>The "Total Result" row and column are added automatically, and can be changed
easily. It's also possible to change the way that the revenue data is grouped (e.g. it can
be averaged instead of being summed).</p>
<p>Pivot tables are straightforward to create and modify via Calc's GUI, starting from the
Data, Pivot Table, Create menu item. Calc automatically selects all the cells used
in the database-like table like the one in Figure 1, and displays the layout dialog
shown in Figure 4.</p>
<p><img alt="" src="images/27-Funcs_Analysis-4.png" /></p>
<p>Figure 4. The Pivot Table Layout GUI.</p>
<p>The right-most "Available Fields" list contains the names of the columns in the sheet,
while the other four fields (Page, Column, Row, and Data) are empty. Figure 4 shows
a bug in the current version of the Pivot Table GUI – the addition of a "Data" name in
the "Column" fields list. This name cannot be removed from the layout dialog, but can
be ignored since it doesn't appear in the rendered pivot table.</p>
<p>The pivot table layout in Figure 5 is easily created by dragging the "Period" name to
the Row fields list, "Category to the Column fields list, and "Revenue" to the Data
fields list, where it's converted into "Sum – Revenue".</p>
<p><img alt="" src="images/27-Funcs_Analysis-5.png" /></p>
<p>Figure 5. The Layout for the Pivot Table in Figure 3.</p>
<h4 id="pivot-tables-in-the-api">Pivot Tables in the API<a class="headerlink" href="#pivot-tables-in-the-api" title="Permanent link">&para;</a></h4>
<p>The Calc API refers to pivot tables by their old Office name, DataPilot tables. The
relationships between the DataPilotservices and interfaces are shown in Figure 6.</p>
<p><img alt="" src="images/27-Funcs_Analysis-6.png" /></p>
<p>Figure 6. The DataPilot Services and Interfaces.</p>
<p>Figure 6 is best understood by reading downwards: a DataPilotTables service (note
the "s") is a sequence of DataPilotTable services. Each table contains a
DataPilotFields service (note the "s") which manages a sequence of DataPilotField
objects.</p>
<p>Each DataPilotField is a named property set, representing a column in the source
sheet. For example, in the following code, four pilot fields will be created for the
"pivottable1.ods" sheet shown in Figure 1, one each for the columns named Year,
Period, Category, and Revenue.</p>
<p>Figure 6 mentions one of the more important services – DataPilotDescriptor, which
does the hard work of converting sheet columns into pilot fields. DataPilotDescriptor
is also responsible for assigning each pilot field to one of the Page, Column, Row, or
Data field lists.</p>
<p>The PivotSheet1.java example illustrates how to create the pivot table shown in
Figure 3. The program begins by opening the "pivottable1.ods" file (Figure 1):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in PivotSheet1.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span>
               <span class="n">Calc</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="s">&quot;pivottable1.ods&quot;</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open pivottable1.ods&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">XSpreadsheet</span> <span class="n">dpSheet</span> <span class="o">=</span>
              <span class="n">Calc</span><span class="p">.</span><span class="na">insertSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;Pivot Table&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="mi">1</span><span class="p">);</span>

  <span class="n">createPivotTable</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">dpSheet</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setActiveSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">dpSheet</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;pivotExample1.ods&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>A second sheet (called dpSheet) is created to hold the generated pivot table, and
createPivotTable() is called:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in PivotSheet1.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createPivotTable</span><span class="p">(</span>
                  <span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">XSpreadsheet</span> <span class="n">dpSheet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">findUsedRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>
         <span class="c1">// find the table data on the sheet</span>

  <span class="n">XDataPilotTables</span> <span class="n">dpTables</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getPilotTables</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>

  <span class="cm">/* create a new pilot descriptor which will later be added</span>
<span class="cm">     as a new pilot table to the pilot tables */</span>
  <span class="n">XDataPilotDescriptor</span> <span class="n">dpDesc</span> <span class="o">=</span>
                   <span class="n">dpTables</span><span class="p">.</span><span class="na">createDataPilotDescriptor</span><span class="p">();</span>

  <span class="cm">/* add the sheet&#39;s column data to the descriptor;</span>
<span class="cm">     this causes the creation of pilot fields */</span>
  <span class="n">dpDesc</span><span class="p">.</span><span class="na">setSourceRange</span><span class="p">(</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getAddress</span><span class="p">(</span><span class="n">cellRange</span><span class="p">)</span> <span class="p">);</span>

  <span class="cm">/* assign &quot;Available&quot; (Hidden) pilot fields to the</span>
<span class="cm">     Page, Column, Row, and Data fields</span>
<span class="cm">  */</span>
  <span class="n">XIndexAccess</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">dpDesc</span><span class="p">.</span><span class="na">getHiddenFields</span><span class="p">();</span>
  <span class="n">XPropertySet</span> <span class="n">props</span><span class="p">;</span>

  <span class="c1">// set Page field; not used here</span>
  <span class="c1">//props = Lo.findContainerProps(fields, &quot;Year&quot;);</span>
  <span class="c1">//Props.setProperty(props, &quot;Orientation&quot;,</span>
  <span class="c1">//                            DataPilotFieldOrientation.PAGE);</span>

  <span class="c1">// set Column field</span>
  <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">findContainerProps</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s">&quot;Category&quot;</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;Orientation&quot;</span><span class="p">,</span>
                              <span class="n">DataPilotFieldOrientation</span><span class="p">.</span><span class="na">COLUMN</span><span class="p">);</span>

  <span class="c1">// set Row field</span>
  <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">findContainerProps</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s">&quot;Period&quot;</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;Orientation&quot;</span><span class="p">,</span>
                              <span class="n">DataPilotFieldOrientation</span><span class="p">.</span><span class="na">ROW</span><span class="p">);</span>

  <span class="c1">// set Data field, calculating the sum</span>
  <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">findContainerProps</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s">&quot;Revenue&quot;</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;Orientation&quot;</span><span class="p">,</span>
                              <span class="n">DataPilotFieldOrientation</span><span class="p">.</span><span class="na">DATA</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;Function&quot;</span><span class="p">,</span> <span class="n">GeneralFunction</span><span class="p">.</span><span class="na">SUM</span><span class="p">);</span>

  <span class="c1">// add new pivot table to other tables and to sheet at A1</span>
  <span class="n">CellAddress</span> <span class="n">destAddr</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">dpSheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">);</span>
  <span class="n">dpTables</span><span class="p">.</span><span class="na">insertNewByName</span><span class="p">(</span><span class="s">&quot;PivotTableExample&quot;</span><span class="p">,</span> <span class="n">destAddr</span><span class="p">,</span> <span class="n">dpDesc</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of createPivotTable()</span>
</code></pre></div>
<p>All the sheet's data is selected by calling Calc.findUsedRange(). Then
Calc.getPilotTables() obtains the DataPilotTables service:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDataPilotTables</span> <span class="nf">getPilotTables</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XDataPilotTablesSupplier</span> <span class="n">dpSupp</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDataPilotTablesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">sheet</span><span class="p">);</span>
  <span class="n">XDataPilotTables</span> <span class="n">dpTables</span> <span class="o">=</span> <span class="n">dpSupp</span><span class="p">.</span><span class="na">getDataPilotTables</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dpTables</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No data pilot tables found&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dpTables</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getPilotTables()</span>
</code></pre></div>
<p>Calc.getPilotTables() utilizes the XDataPilotTablesSupplier interface of the
Spreadsheet service to obtain the DataPilotTables service.</p>
<p>PivotSheet1.java's task is to create a new pilot table, which it does indirectly by
creating a new pilot description. After this pilot description has been initialized, it will 
be added to the DataPilotTables service as a new pilot table.</p>
<p>An empty pilot description is created by calling
XDataPilotTables.createDataPilotDescriptor():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in createPivotTable in PivotTable.java</span>
<span class="n">XDataPilotTables</span> <span class="n">dpTables</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getPilotTables</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>
<span class="n">XDataPilotDescriptor</span> <span class="n">dpDesc</span> <span class="o">=</span> <span class="n">dpTables</span><span class="p">.</span><span class="na">createDataPilotDescriptor</span><span class="p">();</span>
</code></pre></div>
<p>The new XDataPilotDescriptor reference (dpDesc) creates a pilot table by carrying
out two tasks – loading the sheet data into the pilot table, and assigning the resulting
pilot fields to the Page, Column, Row, and Data fields in the descriptor. This latter
task is similar to what the Calc user does in the GUI's layout window in Figure 5.</p>
<p>The descriptor is assigned a source range that spans all the data:</p>
<div class="highlight"><pre><span></span><code><span class="n">dpDesc</span><span class="p">.</span><span class="na">setSourceRange</span><span class="p">(</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getAddress</span><span class="p">(</span><span class="n">cellRange</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div>
<p>It converts each detected column into a DataPilotField service, which is a named
property set; the name is the column heading.</p>
<p>These pilot fields are conceptually stored in the "Available Fields" list shown in the
layout window in Figure 5, and are retrieved by calling
XDataPilotDescriptor.getHiddenFields():</p>
<div class="highlight"><pre><span></span><code><span class="n">XIndexAccess</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">dpDesc</span><span class="p">.</span><span class="na">getHiddenFields</span><span class="p">();</span>
</code></pre></div>
<p>It's useful to list the names of these pilot fields:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in createPivotTable() in PivotSheet1.java</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">fieldNames</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">getContainerNames</span><span class="p">(</span><span class="n">fields</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Field Names (&quot;</span> <span class="o">+</span> <span class="n">fieldNames</span><span class="p">.</span><span class="na">length</span> <span class="o">+</span> <span class="s">&quot;):&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span> <span class="p">:</span> <span class="n">fieldNames</span><span class="p">)</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">);</span>
</code></pre></div>
<p>The output for the spreadsheet in Figure 1 is:</p>
<div class="highlight"><pre><span></span><code>Field Names (5):
  Year
  Period
  Category
  Revenue
  Data
</code></pre></div>
<p>This list includes the strange "Data" pilot field which you may remember also
cropped up in the layout window in Figure 4.</p>
<p>The second task is to assign selected pilot fields to the Page, Column, Row, and Data
field lists. The standard way of doing this is illustrated below for the case of assigning
the "Category" pilot field to the Column field list:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in createPivotTable() in PivotSheet1.java</span>
<span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">findContainerProps</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s">&quot;Category&quot;</span><span class="p">);</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;Orientation&quot;</span><span class="p">,</span>
                            <span class="n">DataPilotFieldOrientation</span><span class="p">.</span><span class="na">COLUMN</span><span class="p">);</span>
</code></pre></div>
<p>The fields variable refers to all the pilot fields as an indexed container.</p>
<p>Lo.findContainerProps() searches through that container looking for the specified
field name.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XPropertySet</span> <span class="nf">findContainerProps</span><span class="p">(</span>
                                     <span class="n">XIndexAccess</span> <span class="n">con</span><span class="p">,</span> <span class="n">String</span> <span class="n">nm</span><span class="p">)</span>
<span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">con</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Container is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">con</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">Object</span> <span class="n">oElem</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="n">XNamed</span> <span class="n">named</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XNamed</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">oElem</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">named</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">nm</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">XPropertySet</span><span class="p">)</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">oElem</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access element &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>  <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not find a \&quot;&quot;</span> <span class="o">+</span> <span class="n">nm</span> <span class="o">+</span> <span class="s">&quot;\&quot; prop set&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of findContainerProps()</span>
</code></pre></div>
<p>The returned property set is an instance of the DataPilotField service, so a complete
list of all the properties can be found in its documentation (use
<code>lodoc datapilotfield</code>).</p>
<p>The important property for our needs is "Orientation" which can be assigned a
DataPilotFieldOrientation constant, whose values are HIDDEN, COLUMN, ROW,
PAGE, and DATA, representing the field lists in the layout window.</p>
<p>Once the required pilot fields have been assigned to field lists, the new pivot table is
added to the other tables and to the sheet by calling
XDataPilotTables.insertNewByName(). It takes three arguments: a unique name for
the table, the cell address where the table will be drawn, and the completed pilot
descriptor:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in createPivotTable() in PivotSheet1.java</span>
<span class="c1">// add new pivot table to other tables and to sheet at A1</span>
<span class="n">CellAddress</span> <span class="n">destAddr</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">dpSheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">);</span>
<span class="n">dpTables</span><span class="p">.</span><span class="na">insertNewByName</span><span class="p">(</span><span class="s">&quot;PivotTableExample&quot;</span><span class="p">,</span> <span class="n">destAddr</span><span class="p">,</span> <span class="n">dpDesc</span><span class="p">);</span>
</code></pre></div>
<p>This code should mark the end of the createPivotTable() method, but I found that
more complex pivot tables would often not be correctly drawn. The cells in the Data
field would be left containing the word "#VALUE!". This problem can be fixed by
explicitly requesting a refresh of the pivot table, using:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in createPivotTable() in PivotSheet1.java</span>
<span class="c1">// access pilot tables</span>
<span class="n">XDataPilotTables</span> <span class="n">dpTables2</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getPilotTables</span><span class="p">(</span><span class="n">dpSheet</span><span class="p">);</span>

<span class="c1">// find new table by name</span>
<span class="n">XDataPilotTable</span> <span class="n">dpTable</span> <span class="o">=</span>
           <span class="n">Calc</span><span class="p">.</span><span class="na">getPilotTable</span><span class="p">(</span><span class="n">dpTables2</span><span class="p">,</span> <span class="s">&quot;PivotTableExample&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">dpTable</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">dpTable</span><span class="p">.</span><span class="na">refresh</span><span class="p">();</span>   <span class="c1">// update the table entries</span>
</code></pre></div>
<p>Calc.getPilotTable() searches XDataPilotTables, which is a named container of
XDataPilotTable objects.</p>
<p>Oddly enough, it's not enough to call Calc.getPilotTable() on the current
XDataPilotTables reference (called dpTables in createPivotTable()), since the new
pivot table isn't found.</p>
<p>My "Calc Tests" folder contains two more pivot table examples, called
PivotSheet2.java and PivotTable.java. PivotSheet2.java creates a more complex pivot
table after reading in the spreadsheet stored in pivottable2.ods. PivotTable.java
creates its own spreadsheet before generating a table. Both examples only use the
methods in PivotSheet1.java, so won't be described here.</p>
<h2 id="3-seeking-a-goal">3.  Seeking a Goal<a class="headerlink" href="#3-seeking-a-goal" title="Permanent link">&para;</a></h2>
<p>The Tools, Goal Seek menu item in Calc allows a formula to be executed
'backwards'. Instead of supplying the input to a formula, and obtaining the formula's
result, the result is given and "goal seek" works backwards through the formula to
calculate the value that produces the result.</p>
<p>The GoalSeek.java example contains several uses of "goal seeking". It begins like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in GoalSeek.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">XGoalSeek</span> <span class="n">gs</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XGoalSeek</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;C1&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>    <span class="c1">// x-variable and starting value</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;C2&quot;</span><span class="p">,</span> <span class="s">&quot;=SQRT(C1)&quot;</span><span class="p">);</span>   <span class="c1">// formula</span>

  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">goalSeek</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;C1&quot;</span><span class="p">,</span> <span class="s">&quot;C2&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
                                 <span class="c1">// x-var, formula, result</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;x == &quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; when sqrt(x) == 4\n&quot;</span><span class="p">);</span>
                         <span class="c1">// x is 16</span>

       <span class="p">:</span>  <span class="c1">// more goal seek examples</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>Goal seek functionality is accessed via the XGoalSeek interface of the document.
Also, a spreadsheet is needed to hold an initial guess for the input value being
calculated  (which I'll call the x-variable), and for the formula. In the example above,
the x-variable is stored in cell "C1" with an initial value of 9, and its formula (sqrt(x))
in cell "C2".</p>
<p>Calc.goalSeek() is passed the cell names of the x-variable and formula, and the
formula's result, and  returns the x-value that produces that result. In the example
above, Calc.goalSeek() returns 16, because that's the input to sqrt() that results in 4.</p>
<p>Calc.goalSeek() is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">goalSeek</span><span class="p">(</span><span class="n">XGoalSeek</span> <span class="n">gs</span><span class="p">,</span> <span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
          <span class="n">String</span> <span class="n">xCellName</span><span class="p">,</span> <span class="n">String</span> <span class="n">formulaCellName</span><span class="p">,</span> <span class="kt">double</span> <span class="n">result</span><span class="p">)</span>
<span class="c1">// find x input to formula which produces result;</span>
<span class="c1">// use value in xCellName as a starting guess</span>
<span class="p">{</span>
  <span class="n">CellAddress</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">xCellName</span><span class="p">);</span>
  <span class="n">CellAddress</span> <span class="n">formulaPos</span> <span class="o">=</span>
                <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">formulaCellName</span><span class="p">);</span>

  <span class="n">GoalResult</span> <span class="n">goalResult</span> <span class="o">=</span> <span class="n">gs</span><span class="p">.</span><span class="na">seekGoal</span><span class="p">(</span><span class="n">formulaPos</span><span class="p">,</span> <span class="n">xPos</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">result</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">goalResult</span><span class="p">.</span><span class="na">Divergence</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;NO result; divergence: &quot;</span> <span class="o">+</span>
                               <span class="n">goalResult</span><span class="p">.</span><span class="na">Divergence</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">goalResult</span><span class="p">.</span><span class="na">Result</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of goalSeek()</span>
</code></pre></div>
<p>The heart of Calc.goalSeek() is a call to XGoalSeek.seekGoal() which requires three
arguments: the address of the x-variable cell, the address of the formula cell, and a
string representing the formula's result. The call returns a GoalResult object that
contains two fields: Result holds the calculated x-value, and Divergence measures the
accuracy of the x-value. If the goal seek has succeeded, then the Divergence value
should be very close to 0; if it failed to find an x-value then Divergence may be very
large since it measures the amount the x-value changed in the last iteration of the
"goal seek" algorithm.</p>
<p>I wasn't able to find out what algorithm "goal seek" employs, but it's most likely a
root-finding methods, such as Newton–Raphson or the secant method. These may fail
for a poor choice of starting x-value or if the formula function has a strange derivative
(an odd curvature). This can be demonstrated by asking "goal seek" to look for an
impossible x-value, such as the input that makes sqrt(x) == -4:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in GoalSeek.java</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">goalSeek</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;C1&quot;</span><span class="p">,</span> <span class="s">&quot;C2&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;x == &quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; when sqrt(x) == -4\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>There's no need to change the starting value in "C1" or the formula in "C2". The
output is:</p>
<div class="highlight"><pre><span></span><code>NO result; divergence: 1.7976931348623157E308
x == 3.2462079627414548E-6 when sqrt(x) == -4
</code></pre></div>
<p>"Goal seek" can be useful when examining complex equations, such as:</p>
<p>[*** missing formula ***]</p>
<p>What's the x-value that produces y == 2?</p>
<p>Actually, this equation is simple:        is factorized into           , and the
common       factor removed from the fraction; the equation becomes:</p>
<p>So when y == 2, x will be 1. But let's do things the number-crunching way, and
supply the original formula to "goal seek":</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in GoalSeek.java</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;D1&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>    <span class="c1">// x-variable and starting value</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;D2&quot;</span><span class="p">,</span> <span class="s">&quot;=(D1^2 - 1)/(D1 - 1)&quot;</span><span class="p">);</span>   <span class="c1">// formula</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">goalSeek</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;D1&quot;</span><span class="p">,</span> <span class="s">&quot;D2&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;x == &quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; when x+1 == 2\n&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The printed x-value is: 1.0000000000000053.</p>
<p>If a formula requires numerical values, they can be supplied as cell references, which
allows them to be adjusted easily. The next "goal seek" example employs an annual
interest formula, I = x*n*i, where I is the annual interest, x the capital, n the number
of years, and i the interest rate. As usual, the x-variable has a starting value in a cell,
but n and i are also represented by cells so that they can be changed. The code is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in GoalSeek.java</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>  <span class="c1">// x-variable; possible value</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>       <span class="c1">// n, no. of years</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">);</span>   <span class="c1">// i, interest rate (7.5%)</span>

<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;=B1*B2*B3&quot;</span><span class="p">);</span>   <span class="c1">// formula</span>
<span class="n">x</span><span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">goalSeek</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;x == &quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; when x*&quot;</span> <span class="o">+</span>
      <span class="n">Calc</span><span class="p">.</span><span class="na">getVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;*&quot;</span> <span class="o">+</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">)</span> <span class="o">+</span>
      <span class="s">&quot;  == 15000\n&quot;</span><span class="p">);</span>  <span class="c1">// x is 200,000</span>
</code></pre></div>
<p>"Goal seek" is being asked to determine the x-value when the annual return from the
formula is 20000. The values in the cells "B2" and "B3" are employed, and the printed
answer is:</p>
<div class="highlight"><pre><span></span><code>x == 200000.0 when x*1.0*0.075  == 15000
</code></pre></div>
<h2 id="4-linear-and-nonlinear-solving">4.  Linear and Nonlinear Solving<a class="headerlink" href="#4-linear-and-nonlinear-solving" title="Permanent link">&para;</a></h2>
<p>Calc supports both linear and nonlinear programming via its Tools  Solver menu
item. The name "linear programming" dates from just after World War II, and doesn't
mean programming in the modern sense; in fact, it's probably better to use its other
common name, "linear optimization".</p>
<p>Linear optimization starts with a series of linear equations involving inequalities, and
finds the best numerical values that satisfy the equations according to a 'profit'
equation that must be maximized (or minimized). Fortunately, this has a very nice
graphical representation when the equations only involve two unknowns: the
equations cam be drawn as lines crossing the x- and y- axes, and the best values will
be one of the points where the lines intersect.</p>
<p>As you might expect, nonlinear programming (optimization) is a generalization of the
linear case where some of the equations are non-linear (e.g. perhaps they involve
polynomials, logarithmic, or trigonometric functions).</p>
<p>A gentle introduction to linear optimization and its graphing can be found at
<a href="https://purplemath.com/modules/linprog.htm">https://purplemath.com/modules/linprog.htm</a>, or you can start at the Wikipedia
page, <a href="https://en.wikipedia.org/wiki/Linear_programming">https://en.wikipedia.org/wiki/Linear_programming</a>.</p>
<p>The Calc documentation on linear and nonlinear solving is rather minimal. There's no
mention of it in the Calc Developer's Guide, and just a brief section on its GUI at the
end of chapter 9 ("Data Analysis") of the Calc User guide.</p>
<p>The current version of LibreOffice (v. 5) offers four optimization tools (called
solvers) – two linear optimizers called "LibreOffice Linear Solver" and "LibreOffice
CoinMP Linear Solver", and two nonlinear ones called "DEPS Evolutionary
Algorithm" and "SCO Evolutionary Algorithm". The easiest way of checking the
current solver situation in your version of Office is to look at Calc's Solver dialog
window (by clicking on the Tools  Solver menu item), and click on the "Options"
button. The options dialog window lists all the installed solvers, and their numerous
parameters, as in Figure 8.</p>
<p><img alt="" src="images/27-Funcs_Analysis-8.png" /></p>
<p>Figure 8. The LibreOffice Solvers and their Parameters.</p>
<p>Another way of getting a list of the installed solvers, is to call Calc.listSolvers(),
which is demonstrated in the first example given below.</p>
<p>The two linear solvers are implemented as DLLs, located in the <OFFICE>\program
folder as lpsolve55.dll and CoinMP.dll. The source code for these libraries is online,
at <a href="https://docs.libreoffice.org/sccomp/html/files.html">https://docs.libreoffice.org/sccomp/html/files.html</a>, with the code (and graphs of the
code) accessible via the "Files" tab. The file names are LpsolveSolver.cxx and
CoinMPSolver.cxx.</p>
<p>The lpsolve55.dll filename strongly suggests that Office's basic linear solver is
lp_solve 5.5, which originates online at <a href="https://lpsolve.sourceforge.net/">https://lpsolve.sourceforge.net/</a>. That site has
extensive documentation, including a great introduction to linear optimization. The
first programming example below comes from one of the examples in its
documentation. One interesting possibility for the lpsolve library is that it can be
called directly from Java without the need for Calc. The necessary steps are described
on the "Using lp_solve 5.5 in Java programs" page for lp_solve 5.5 at
<a href="https://lpsolve.sourceforge.net/">https://lpsolve.sourceforge.net/</a>. The relevant download is lp_solve_5.5.2.0_java.zip
from <a href="https://sourceforge.net/projects/lpsolve/files/lpsolve/5.5.2.0/">https://sourceforge.net/projects/lpsolve/files/lpsolve/5.5.2.0/</a>.</p>
<p>Office's other linear optimizer, the CoinMP solver, comes from the COIN-OR
(Computational Infrastructure for Operations Research) open-source project which
started at IBM research (<a href="https://coin-or.org/">https://coin-or.org/</a>). According to
<a href="https://coin-or.org/projects/CoinMP.xml">https://coin-or.org/projects/CoinMP.xml</a>, CoinMP implements most of the functionality of three
other COIN-OR projects, called CLP (Coin LP), CBC (Coin Branch-and-Cut), and
CGL (Cut Generation Library). The CLP and CBC solvers are documented at
<a href="https://coin-or.org/projects/Clp.xml">https://coin-or.org/projects/Clp.xml</a> and
<a href="https://coin-or.org/projects/Cbc.xml">https://coin-or.org/projects/Cbc.xml</a>, and come with large user guides,
at <a href="https://coin-or.org/Clp/userguide/">https://coin-or.org/Clp/userguide/</a> and <a href="https://www.coin-or.org/Cbc/">https://www.coin-or.org/Cbc/</a>. The collection of cut
generators in the CGL library is used to speed up the execution of CLP and CBC (see
<a href="https://coin-or.org/projects/Cgl.xml">https://coin-or.org/projects/Cgl.xml</a>).</p>
<p>A good overview of COIN-OR can be found in a series of slides by Matthew
Saltzman at <a href="https://dimacs.rutgers.edu/Workshops/COIN/slides/saltzman.pdf">https://dimacs.rutgers.edu/Workshops/COIN/slides/saltzman.pdf</a>. There's
also a Wikipedia page about COIN-OR.</p>
<p>The two nonlinear solvers are known as DEPS and SCO for short, and are explained
in the OpenOffice wiki at <a href="https://wiki.openoffice.org/wiki/NLPSolver">https://wiki.openoffice.org/wiki/NLPSolver</a>, along with
descriptions of their extensive (and complicated) parameters. They're implemented as
JAR files, located in <OFFICE>\share\extensions\nlpsolver as nlpsolver.jar and
EvolutionarySolver.jar. Two of the examples below use these solvers.</p>
<h3 id="41-a-linear-optimization-problem">4.1.  A Linear Optimization Problem<a class="headerlink" href="#41-a-linear-optimization-problem" title="Permanent link">&para;</a></h3>
<p>The LinearSolverTest.java example shows how to use the basic linear solver, and also
CoinMP. It implements the following linear optimization problem, which comes from
<a href="https://lpsolve.sourceforge.net/5.1/formulate.htm">https://lpsolve.sourceforge.net/5.1/formulate.htm</a>. There are three constraint
inequalities:</p>
<p><div class="highlight"><pre><span></span><code>120x + 210y ≤ 15000
110x + 30y ≤ 4000
x + y ≤ 75
</code></pre></div>
The 'profit' expression to be maximized is:</p>
<div class="highlight"><pre><span></span><code>P = 143x + 60y
</code></pre></div>
<p>The maximum P value is 6315.625, when x == 21.875 and y == 53.125. Perhaps the
easiest way of calculating this outside of Office is via the  linear optimization tool at
<a href="https://zweigmedia.com/utilities/lpg/index.html?lang=en">https://zweigmedia.com/utilities/lpg/index.html?lang=en</a>. Its solution is shown in
Figure 9.</p>
<p><img alt="" src="images/27-Funcs_Analysis-9.png" /></p>
<p>Figure 9. Solved and Graphed Linear Optimization Problem.</p>
<p>Aside from giving the answer, the equations are graphed, which shows how the
maximum profit is one of the equation's intersection points.</p>
<p>The main() function for LinearSolverTest.java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">listSolvers</span><span class="p">();</span>

  <span class="c1">// specify the variable cells</span>
  <span class="n">CellAddress</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">);</span>   <span class="c1">// x</span>
  <span class="n">CellAddress</span> <span class="n">yPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">);</span>   <span class="c1">// y</span>
  <span class="n">CellAddress</span><span class="o">[]</span> <span class="n">vars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CellAddress</span><span class="o">[]</span><span class="p">{</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span> <span class="p">};</span>

  <span class="c1">// specify profit equation</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">,</span> <span class="s">&quot;=143*B1 + 60*B2&quot;</span><span class="p">);</span>
                       <span class="c1">// P = 143x + 60y, maximize</span>
  <span class="n">CellAddress</span> <span class="n">profitEqu</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">);</span>

  <span class="c1">// set up equation formulae without inequalities</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;=120*B1 + 210*B2&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B5&quot;</span><span class="p">,</span> <span class="s">&quot;=110*B1 + 30*B2&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B6&quot;</span><span class="p">,</span> <span class="s">&quot;=B1 + B2&quot;</span><span class="p">);</span>

  <span class="c1">// create the constraints</span>
  <span class="c1">// constraints are equations and their inequalities</span>
  <span class="n">SolverConstraint</span> <span class="n">sc1</span> <span class="o">=</span>
      <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span><span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">);</span>
                           <span class="c1">// 120x + 210y &lt;= 15000</span>
         <span class="c1">// B4 is the cell address that is constrained</span>

  <span class="n">SolverConstraint</span> <span class="n">sc2</span> <span class="o">=</span>
      <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B5&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>
                           <span class="c1">// 110x + 30y &lt;= 4000</span>

  <span class="n">SolverConstraint</span> <span class="n">sc3</span> <span class="o">=</span>
      <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B6&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">);</span>
                           <span class="c1">// x + y &lt;= 75</span>

  <span class="n">SolverConstraint</span><span class="o">[]</span> <span class="n">constraints</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">SolverConstraint</span><span class="o">[]</span><span class="p">{</span> <span class="n">sc1</span><span class="p">,</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">sc3</span> <span class="p">};</span>

  <span class="c1">// initialize the linear solver (basic linear or CoinMP)</span>
  <span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                <span class="s">&quot;com.sun.star.comp.Calc.LpsolveSolver&quot;</span><span class="p">);</span>
             <span class="c1">// &quot;com.sun.star.comp.Calc.CoinMPSolver&quot;);</span>

  <span class="c1">// System.out.println(&quot;Solver: &quot; + solver);</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">setDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">setObjective</span><span class="p">(</span><span class="n">profitEqu</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">setVariables</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">setConstraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">setMaximize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

  <span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Solver&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="s">&quot;NonNegative&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
     <span class="c1">// restrict the search to the top-right quadrant of the graph</span>

  <span class="c1">// execute the solver; print the result</span>
  <span class="n">solver</span><span class="p">.</span><span class="na">solve</span><span class="p">();</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">solverReport</span><span class="p">(</span><span class="n">solver</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>The call to Calc.listSolvers() isn't strictly necessary but it provides useful information
about the names of the solver services:</p>
<div class="highlight"><pre><span></span><code><span class="n">Services</span> <span class="n">offered</span> <span class="n">by</span> <span class="n">the</span> <span class="n">solver</span><span class="p">:</span>
  <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">comp</span><span class="p">.</span><span class="na">Calc</span><span class="p">.</span><span class="na">CoinMPSolver</span>
  <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">comp</span><span class="p">.</span><span class="na">Calc</span><span class="p">.</span><span class="na">LpsolveSolver</span>
  <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">comp</span><span class="p">.</span><span class="na">Calc</span><span class="p">.</span><span class="na">NLPSolver</span><span class="p">.</span><span class="na">DEPSSolverImpl</span>
  <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">comp</span><span class="p">.</span><span class="na">Calc</span><span class="p">.</span><span class="na">NLPSolver</span><span class="p">.</span><span class="na">SCOSolverImpl</span>
</code></pre></div>
<p>One of these names is needed when calling Lo.createInstanceMCF() to create a solver
instance.</p>
<p>Calc.listSolvers() is implemented as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">listSolvers</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Services offered by the solver:&quot;</span><span class="p">);</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">nms</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getServiceNames</span><span class="p">(</span><span class="s">&quot;com.sun.star.sheet.Solver&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nms</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  none&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">service</span> <span class="p">:</span> <span class="n">nms</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">service</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of listSolvers()</span>
</code></pre></div>
<p>The real work of listSolvers() is done by calling Info.getServiceNames() which finds
all the implementations that support "com.sun.star.sheet.Solver".</p>
<p>Back in LinearSolverTest.java, the inequality and profit equations are defined as
formulae in a sheet, and the variables in the equations are also assigned to cells.</p>
<p>The two variables in this problem (x and y) are assigned to the cells "B1" and "B2",
and the cell addresses are stored in an array for later:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="n">CellAddress</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">);</span>   <span class="c1">// x</span>
<span class="n">CellAddress</span> <span class="n">yPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">);</span>   <span class="c1">// y</span>
<span class="n">CellAddress</span><span class="o">[]</span> <span class="n">vars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CellAddress</span><span class="o">[]</span><span class="p">{</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span> <span class="p">};</span>
</code></pre></div>
<p>Next the equations are defined. Their formulae are assigned to cells without their
inequality parts:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="c1">// specify profit equation</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">,</span> <span class="s">&quot;=143*B1 + 60*B2&quot;</span><span class="p">);</span>
                     <span class="c1">// P = 143x + 60y, maximize</span>
<span class="n">CellAddress</span> <span class="n">profitEqu</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">);</span>

<span class="c1">// set up equation formulae without inequalities</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;=120*B1 + 210*B2&quot;</span><span class="p">);</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B5&quot;</span><span class="p">,</span> <span class="s">&quot;=110*B1 + 30*B2&quot;</span><span class="p">);</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B6&quot;</span><span class="p">,</span> <span class="s">&quot;=B1 + B2&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Now the three equation formulae are converted into SolverConstraint objects by
calling Calc.makeConstraint(), and the constraints are stored in an array for later use:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="c1">// create the constraints:</span>
<span class="c1">// constraints are equations and their inequalities</span>
<span class="n">SolverConstraint</span> <span class="n">sc1</span> <span class="o">=</span>
    <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span><span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">);</span>
                         <span class="c1">// 120x + 210y &lt;= 15000</span>
       <span class="c1">// B4 is the cell address that is constrained</span>

<span class="n">SolverConstraint</span> <span class="n">sc2</span> <span class="o">=</span>
    <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B5&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>
                         <span class="c1">// 110x + 30y &lt;= 4000</span>

<span class="n">SolverConstraint</span> <span class="n">sc3</span> <span class="o">=</span>
    <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B6&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">);</span>
                         <span class="c1">// x + y &lt;= 75</span>

<span class="n">SolverConstraint</span><span class="o">[]</span> <span class="n">constraints</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">SolverConstraint</span><span class="o">[]</span><span class="p">{</span> <span class="n">sc1</span><span class="p">,</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">sc3</span> <span class="p">};</span>
</code></pre></div>
<p>A constraint is the cell name where an equation is stored and an inequality.</p>
<p>Calc.makeConstraint() is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">SolverConstraint</span> <span class="nf">makeConstraint</span><span class="p">(</span>
                   <span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span>
                   <span class="n">String</span> <span class="n">op</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span> <span class="k">return</span> <span class="n">makeConstraint</span><span class="p">(</span><span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">cellName</span><span class="p">),</span><span class="n">op</span><span class="p">,</span><span class="n">d</span><span class="p">);</span> <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">SolverConstraint</span> <span class="nf">makeConstraint</span><span class="p">(</span>
                   <span class="n">CellAddress</span> <span class="n">addr</span><span class="p">,</span> <span class="n">String</span> <span class="n">op</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span> <span class="k">return</span> <span class="n">makeConstraint</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">toConstraintOp</span><span class="p">(</span><span class="n">op</span><span class="p">),</span> <span class="n">d</span><span class="p">);</span>   <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">SolverConstraint</span> <span class="nf">makeConstraint</span><span class="p">(</span>
                   <span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span>
                   <span class="n">SolverConstraintOperator</span> <span class="n">op</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">makeConstraint</span><span class="p">(</span><span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">cellName</span><span class="p">),</span><span class="n">op</span><span class="p">,</span><span class="n">d</span><span class="p">);}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">SolverConstraint</span> <span class="nf">makeConstraint</span><span class="p">(</span><span class="n">CellAddress</span> <span class="n">addr</span><span class="p">,</span>
                    <span class="n">SolverConstraintOperator</span> <span class="n">op</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span> <span class="n">SolverConstraint</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolverConstraint</span><span class="p">();</span>
  <span class="n">sc</span><span class="p">.</span><span class="na">Left</span> <span class="o">=</span> <span class="n">addr</span><span class="p">;</span>
  <span class="n">sc</span><span class="p">.</span><span class="na">Operator</span> <span class="o">=</span> <span class="n">op</span><span class="p">;</span>
  <span class="n">sc</span><span class="p">.</span><span class="na">Right</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of makeConstraint()</span>
</code></pre></div>
<p>That's a lot of functions to create a SolverConstraint object with four arguments.</p>
<p>Now the solver is created, and its parameters are set:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                      <span class="s">&quot;com.sun.star.comp.Calc.LpsolveSolver&quot;</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setObjective</span><span class="p">(</span><span class="n">profitEqu</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setVariables</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setConstraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setMaximize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="c1">// maximize the profit equ</span>
</code></pre></div>
<p>The XSolver interface is utilized by all the solvers, but the name of service can vary.
In the code above I'm using the basic linear solver. A CoinMP solver would be
created by changing "LpsolveSolver" to "CoinMPSolver":</p>
<div class="highlight"><pre><span></span><code><span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                      <span class="s">&quot;com.sun.star.comp.Calc.CoinMPSolver&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The various "set" methods are described in the XSolver documentation as public
variables (call <code>lodoc xsolver</code> to see the page). They load the profit equation,
constraints, and variables into the solver. It's also necessary to specify that the profit
equation be maximized, and link the solver to the Calc document.</p>
<p>These "set" methods are used in the same way no matter which of the four solvers is
employed. Where the solvers differ is in their service properties. As mentioned above,
there's a few sources of online information depending on which solver you're using, or
you could look at the options dialog window shown in Figure 8.</p>
<p>Another source is to call Props.showObjProps() on the solver, to list its property
names and current values:
Props.showObjProps("Solver", solver);
When the basic linear solver is being used, showObjProps()'s output is:</p>
<div class="highlight"><pre><span></span><code>EpsilonLevel == 0
Integer == false
LimitBBDepth == true
NonNegative == false
Timeout == 100
</code></pre></div>
<p>This corresponds to the information shown for the basic linear solver in the options
dialog in Figure 10.</p>
<p><img alt="" src="images/27-Funcs_Analysis-10.png" /></p>
<p>Figure 10. The Options Dialog for the Basic Linear Solver.</p>
<p>As to what these parameters actually mean, you'll have to look through the "lp_solve
API reference" section of the documentation at <a href="https://lpsolve.sourceforge.net/">https://lpsolve.sourceforge.net/</a>. For
example, the "epsilon level" is partly explained under the sub-heading "set_epslevel".</p>
<p>The only property I've changed in the LinearSolverTest.java example is
"NonNegative", which is set to true:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java ...</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="s">&quot;NonNegative&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>This restricts the search for intersection points to the top-right quadrant of the graph.
Alternatively I could have implemented two more constraints:</p>
<div class="highlight"><pre><span></span><code>x ≥ 0
y ≥ 0
</code></pre></div>
<p>The solver's results are printed by Calc.solverReport():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in LinearSolverTest.java</span>
<span class="n">solver</span><span class="p">.</span><span class="na">solve</span><span class="p">();</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">solverReport</span><span class="p">(</span><span class="n">solver</span><span class="p">);</span>
</code></pre></div>
<p>The output:</p>
<div class="highlight"><pre><span></span><code>Solver result:
  B3 == 6315.6250
Solver variables:
  B1 == 21.8750
  B2 == 53.1250
</code></pre></div>
<p>Calc.solverReport() is implemented as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">solverReport</span><span class="p">(</span><span class="n">XSolver</span> <span class="n">solver</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">boolean</span> <span class="n">isSuccessful</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="na">getSuccess</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">isSuccessful</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">cellName</span> <span class="o">=</span> <span class="n">getCellStr</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="na">getObjective</span><span class="p">());</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Solver result: &quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;  %s == %.4f\n&quot;</span><span class="p">,</span> <span class="n">cellName</span><span class="p">,</span>
                             <span class="n">solver</span><span class="p">.</span><span class="na">getResultValue</span><span class="p">());</span>

    <span class="n">CellAddress</span><span class="o">[]</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="na">getVariables</span><span class="p">();</span>
    <span class="kt">double</span><span class="o">[]</span> <span class="n">solns</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="na">getSolution</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Solver variables: &quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">solns</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cellName</span> <span class="o">=</span> <span class="n">getCellStr</span><span class="p">(</span><span class="n">addrs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;  %s == %.4f\n&quot;</span><span class="p">,</span> <span class="n">cellName</span><span class="p">,</span> <span class="n">solns</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Solver FAILED&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of solverReport()</span>
</code></pre></div>
<p>XSolver.getObjective() and XSolver.getVariables() return the cell addresses holding
the profit equation and the variables (x and y). In a corresponding fashion,
XSolver.getResultValue() and XSolver.getSolution() return the calculated values for
the profit equation and variables.</p>
<p>A solver may fail, and so solverReport() first calls XSolver.getSuccess().</p>
<h3 id="42-another-linear-problem-using-sco">4.2.  Another Linear Problem (using SCO)<a class="headerlink" href="#42-another-linear-problem-using-sco" title="Permanent link">&para;</a></h3>
<p>I've coded two examples using the nonlinear optimizers – SolverTest.java utilizes the
SCO solver, and SolverTest2.java employs DEPS. As I mentioned earlier, these two
solvers are explained at <a href="https://wiki.openoffice.org/wiki/NLPSolver">https://wiki.openoffice.org/wiki/NLPSolver</a>.</p>
<p>The SolverTest.java example solves a linear problem, but one involving three
unknowns. This means that graphically the equations define planes in a 3D space, and
solving the profit equation involves examining the corners of the volume defined by
how the planes intersect. Unfortunately, the
<a href="https://zweigmedia.com/utilities/lpg/index.html?lang=en">https://zweigmedia.com/utilities/lpg/index.html?lang=en</a> website cannot handle
linear optimizations involving more than two variables, but no such restriction applies
to Calc's solvers.</p>
<p>There are three constraint inequalities:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="err">≤</span> <span class="mi">6</span>
<span class="n">y</span> <span class="err">≤</span> <span class="mi">8</span>
<span class="n">z</span> <span class="err">≥</span> <span class="mi">4</span>
</code></pre></div>
<p>The 'profit' expression to be maximized is:</p>
<div class="highlight"><pre><span></span><code>P = x + y - z
The maximum P value is 10, when x == 6, y == 8, and z == 4.
</code></pre></div>
<p>Much of main() in SolverTest.java is very similar to LinearSolver.java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of main() in SolverTest.java</span>
     <span class="p">:</span>
<span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// specify the variable cells</span>
<span class="n">CellAddress</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">);</span>  <span class="c1">// x</span>
<span class="n">CellAddress</span> <span class="n">yPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">);</span>  <span class="c1">// y</span>
<span class="n">CellAddress</span> <span class="n">zPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">);</span>  <span class="c1">// z</span>

<span class="n">CellAddress</span><span class="o">[]</span> <span class="n">vars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CellAddress</span><span class="o">[]</span><span class="p">{</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span><span class="p">,</span> <span class="n">zPos</span> <span class="p">};</span>


<span class="c1">// only define the profit formula without inequality</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;=B1+B2-B3&quot;</span><span class="p">);</span>
<span class="n">CellAddress</span> <span class="n">objective</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">);</span>


<span class="c1">// create three constraints (using the 3 variables)</span>
<span class="n">SolverConstraint</span> <span class="n">sc1</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
                          <span class="c1">// x &lt;= 6</span>
<span class="n">SolverConstraint</span> <span class="n">sc2</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
                          <span class="c1">// y &lt;= 8</span>
<span class="n">SolverConstraint</span> <span class="n">sc3</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
                          <span class="c1">// z &gt;= 4</span>

<span class="n">SolverConstraint</span><span class="o">[]</span> <span class="n">constraints</span> <span class="o">=</span>
                         <span class="k">new</span> <span class="n">SolverConstraint</span><span class="o">[]</span><span class="p">{</span> <span class="n">sc1</span><span class="p">,</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">sc3</span> <span class="p">};</span>

<span class="c1">// initialize the SCO nonlinear solver</span>
<span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
               <span class="s">&quot;com.sun.star.comp.Calc.NLPSolver.SCOSolverImpl&quot;</span><span class="p">);</span>

<span class="n">solver</span><span class="p">.</span><span class="na">setDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setObjective</span><span class="p">(</span><span class="n">objective</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setVariables</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setConstraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setMaximize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Solver&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="p">);</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="s">&quot;EnhancedSolverStatus&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="c1">// switch off nonlinear dialog about current progress</span>

<span class="c1">// execute the solver</span>
<span class="n">solver</span><span class="p">.</span><span class="na">solve</span><span class="p">();</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">solverReport</span><span class="p">(</span><span class="n">solver</span><span class="p">);</span>
</code></pre></div>
<p>Only the profit formula needs to be assigned to a cell due to the simplicity of the
equation inequalities. Their constraints can use the cells containing the x, y, and z
variables rather than be defined as separate formulae.</p>
<p>The Solver is "com.sun.star.comp.Calc.NLPSolver.SCOSolverImpl", whose name I
found by listing the solver names with Calc.listSolvers().</p>
<p>The properties associated with the SCO solver are more extensive than for the linear
solvers. Props.showObjProps() reports:</p>
<div class="highlight"><pre><span></span><code>Solver Properties
  AssumeNonNegative == false
  EnhancedSolverStatus == true
  GuessVariableRange == true
  LearningCycles == 2000
  LibrarySize == 210
  StagnationLimit == 70
  SwarmSize == 70
  Tolerance == 1.0E-6
  UseACRComparator == false
  UseRandomStartingPoint == false
  VariableRangeThreshold == 3.0
</code></pre></div>
<p>These can also be viewed via the Options dialog in the Calc GUI, as in Figure 11.</p>
<p><img alt="" src="images/27-Funcs_Analysis-11.png" /></p>
<p>Figure 11. The Options Dialog for the SCO Solver.</p>
<p>These parameters, most of which apply to the DEPS solver as well, are explained at
<a href="https://wiki.openoffice.org/wiki/NLPSolver#Options_and_Parameters">https://wiki.openoffice.org/wiki/NLPSolver#Options_and_Parameters</a>.</p>
<p>The correct solution reported by Calc.solverReport() is:</p>
<div class="highlight"><pre><span></span><code>Solver result:
  B4 == 10.0000
Solver variables:
  B1 == 6.0000
  B2 == 8.0000
  B3 == 4.0000
</code></pre></div>
<h3 id="43-a-nonlinear-problem-using-deps-and-sco">4.3.  A Nonlinear Problem (using DEPS and SCO)<a class="headerlink" href="#43-a-nonlinear-problem-using-deps-and-sco" title="Permanent link">&para;</a></h3>
<p>SolverTest2.java defines a nonlinear optimization problem, so can only be solved by
the DEPS or SCO solver; I'll start with DEPS.</p>
<p>The problem comes from the Wikipedia page on nonlinear programming
(<a href="https://en.wikipedia.org/wiki/Nonlinear_programming">https://en.wikipedia.org/wiki/Nonlinear_programming</a>). There are four constraint
inequalities:</p>
<div class="highlight"><pre><span></span><code>x ≥ 0
y ≥ 0
x
2
 + y
2
 ≥ 1
x
2
 + y
2
 ≤ 2
</code></pre></div>
<p>The 'profit' expression to be maximized is:</p>
<div class="highlight"><pre><span></span><code>P = x + y
</code></pre></div>
<p>The maximum P value is 2, when x == 1 and y == 1, which can be represented
graphically in Figure 12 since we're once again using only two unknowns.</p>
<p><img alt="" src="images/27-Funcs_Analysis-12.png" /></p>
<p>Figure 12. Solution for the Nonlinear Optimization Problem.</p>
<p>The code in SolverTest2.java is only slightly different from the previous two
examples:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of main() in SolverTest2.java</span>
      <span class="p">:</span>
<span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// specify the variable cells</span>
<span class="n">CellAddress</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">);</span>  <span class="c1">// x</span>
<span class="n">CellAddress</span> <span class="n">yPos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">);</span>  <span class="c1">// y</span>
<span class="n">CellAddress</span><span class="o">[]</span> <span class="n">vars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CellAddress</span><span class="o">[]</span><span class="p">{</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span> <span class="p">};</span>

<span class="c1">// specify profit equation</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">,</span> <span class="s">&quot;=B1+B2&quot;</span><span class="p">);</span>    <span class="c1">// x + y</span>
<span class="n">CellAddress</span> <span class="n">objective</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B3&quot;</span><span class="p">);</span>

<span class="c1">// set up equation formula without inequality (only one needed)</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;=B1*B1 + B2*B2&quot;</span><span class="p">);</span>   <span class="c1">// x^2 + y^2</span>

<span class="c1">// create two constraints from one equation</span>
<span class="n">SolverConstraint</span> <span class="n">sc1</span> <span class="o">=</span>  <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                                    <span class="c1">// x^2 + y^2 &gt;= 1</span>
<span class="n">SolverConstraint</span> <span class="n">sc2</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
                                    <span class="c1">// x^2 + y^2 &lt;= 2</span>

<span class="n">SolverConstraint</span><span class="o">[]</span> <span class="n">constraints</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolverConstraint</span><span class="o">[]</span><span class="p">{</span> <span class="n">sc1</span><span class="p">,</span> <span class="n">sc2</span> <span class="p">};</span>

<span class="c1">// initialize DEPS  nonlinear solver</span>
<span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                             <span class="s">&quot;com.sun.star.sheet.Solver&quot;</span><span class="p">);</span>
        <span class="c1">// uses &quot;com.sun.star.comp.Calc.NLPSolver.DEPSSolverImpl&quot;</span>

<span class="n">solver</span><span class="p">.</span><span class="na">setDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setObjective</span><span class="p">(</span><span class="n">objective</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setVariables</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setConstraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="na">setMaximize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Solver&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="p">);</span>
<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="s">&quot;EnhancedSolverStatus&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="c1">// switch off nonlinear dialog about current progress</span>

<span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="s">&quot;AssumeNonNegative&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
         <span class="c1">// restrict search to the top-right quadrant of graph</span>

<span class="c1">// execute the solver; print the results</span>
<span class="n">solver</span><span class="p">.</span><span class="na">solve</span><span class="p">();</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">solverReport</span><span class="p">(</span><span class="n">solver</span><span class="p">);</span>
</code></pre></div>
<p>Only one inequality equation is defined:
Calc.setVal(sheet, "B4", "=B1*B1 + B2*B2");   // x^2 + y^2
because it can be used twice to define the nonlinear constraints:</p>
<div class="highlight"><pre><span></span><code><span class="n">SolverConstraint</span> <span class="n">sc1</span> <span class="o">=</span>  <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                                    <span class="c1">// x^2 + y^2 &gt;= 1</span>
<span class="n">SolverConstraint</span> <span class="n">sc2</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">makeConstraint</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B4&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
                                    <span class="c1">// x^2 + y^2 &lt;= 2</span>
</code></pre></div>
<p>No constraints are defined for x &gt;= 0 and y &gt;= 0. Instead, the solver's
"AssumeNonNegative" property is set to true, which achieves the same thing.</p>
<p>The DEPS solver is used by default when a nonlinear optimization needs to be solved,
so the solver is instantiated using the general Solver service name:
XSolver solver = Lo.createInstanceMCF(XSolver.class,
                             "com.sun.star.sheet.Solver");
Alternatively, it's possible to use the DEPS service name:</p>
<div class="highlight"><pre><span></span><code><span class="s">&quot;com.sun.star.comp.Calc.NLPSolver.DEPSSolverImpl&quot;</span><span class="p">.</span>
</code></pre></div>
<p>The results printed by Calc.solverReport() are:</p>
<div class="highlight"><pre><span></span><code>Solver result:
  B3 == 2.0000
Solver variables:
  B1 == 1.0001
  B2 == 0.9999
</code></pre></div>
<p>If DEPS is replaced by the SCO solver:</p>
<div class="highlight"><pre><span></span><code><span class="n">XSolver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSolver</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
          <span class="s">&quot;com.sun.star.comp.Calc.NLPSolver.SCOSolverImpl&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The printed result is slightly more accurate:</p>
<div class="highlight"><pre><span></span><code>Solver result:
  B3 == 2.0000
Solver variables:
  B1 == 1.0000
  B2 == 1.0000
</code></pre></div>
<p>but it takes a little bit longer to return.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="26-Search_Replace.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 26. Search and Replace" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 26. Search and Replace
            </div>
          </div>
        </a>
      
      
        
        <a href="28%20Part%205%20Chart.html" class="md-footer__link md-footer__link--next" aria-label="Next: Part 5 Chart" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Part 5 Chart
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>