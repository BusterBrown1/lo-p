
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/48-Event_Macros.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 48. Event Macros - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-48-event-macros" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 48. Event Macros
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 48. Event Macros
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="48-Event_Macros.html" class="md-nav__link md-nav__link--active">
        Chapter 48. Event Macros
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-fantastic-macros-and-where-to-find-them" class="md-nav__link">
    1.  Fantastic Macros and Where to Find Them
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-where-are-macros-stored" class="md-nav__link">
    2.  Where are Macros Stored?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-naming-macro-functions" class="md-nav__link">
    3.  Naming Macro Functions
  </a>
  
    <nav class="md-nav" aria-label="3.  Naming Macro Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-and-finding-macro-names" class="md-nav__link">
    Listing and Finding Macro Names
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-calling-the-hello-macros" class="md-nav__link">
    4.  Calling the "hello" Macros
  </a>
  
    <nav class="md-nav" aria-label="4.  Calling the "hello" Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-macro-security-levels" class="md-nav__link">
    4.1.  Macro Security Levels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-implementing-the-helloworld-java-macro" class="md-nav__link">
    4.2.  Implementing the HelloWorld Java Macro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-the-librelogo-macro" class="md-nav__link">
    5.  The LibreLogo Macro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-writing-a-simple-event-macro" class="md-nav__link">
    6.  Writing a Simple Event Macro
  </a>
  
    <nav class="md-nav" aria-label="6.  Writing a Simple Event Macro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-installing-a-simple-event-macro" class="md-nav__link">
    6.1.  Installing a Simple Event Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-using-showeventshow-in-a-form" class="md-nav__link">
    6.2.  Using ShowEvent.show in a Form
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-automating-the-assigning-of-event-macros" class="md-nav__link">
    7.  Automating the Assigning of Event Macros
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-fantastic-macros-and-where-to-find-them" class="md-nav__link">
    1.  Fantastic Macros and Where to Find Them
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-where-are-macros-stored" class="md-nav__link">
    2.  Where are Macros Stored?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-naming-macro-functions" class="md-nav__link">
    3.  Naming Macro Functions
  </a>
  
    <nav class="md-nav" aria-label="3.  Naming Macro Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-and-finding-macro-names" class="md-nav__link">
    Listing and Finding Macro Names
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-calling-the-hello-macros" class="md-nav__link">
    4.  Calling the "hello" Macros
  </a>
  
    <nav class="md-nav" aria-label="4.  Calling the "hello" Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-macro-security-levels" class="md-nav__link">
    4.1.  Macro Security Levels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-implementing-the-helloworld-java-macro" class="md-nav__link">
    4.2.  Implementing the HelloWorld Java Macro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-the-librelogo-macro" class="md-nav__link">
    5.  The LibreLogo Macro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-writing-a-simple-event-macro" class="md-nav__link">
    6.  Writing a Simple Event Macro
  </a>
  
    <nav class="md-nav" aria-label="6.  Writing a Simple Event Macro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-installing-a-simple-event-macro" class="md-nav__link">
    6.1.  Installing a Simple Event Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-using-showeventshow-in-a-form" class="md-nav__link">
    6.2.  Using ShowEvent.show in a Form
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-automating-the-assigning-of-event-macros" class="md-nav__link">
    7.  Automating the Assigning of Event Macros
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/main/docs/48-Event_Macros.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-48-event-macros">Chapter 48. Event Macros<a class="headerlink" href="#chapter-48-event-macros" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Macro Locations;
Naming Macro
Functions; Calling
Existing Macros; The
LibreLogo Macro;
Writing a Simple Event
Macro; Automating the
Assigning of Event
Macros</p>
<p>Example folders:
"EvMacro Tests" and
"Utils"</p>
</div>
<p>Event macros are functions triggered by the occurrence of
events, either within Office or in Office documents. I'll be
using event macros with forms, by attaching them to controls
such as buttons and textfields.</p>
<p>A key difference between event macros and Java listeners is
that macros are attached to Office or to documents rather
than being part of an external Java program. In practical
terms this means that the macro code becomes part of the
Office installation or is embedded inside a document's ODF file.</p>
<p>I'll spend two chapters discussing event macros: this chapter focuses on how to use
existing Office macros, and how to write a simple event macro that's installed by
copying it to a specific Office directory. This approach is obviously not ideal, and so
the next chapter looks at installing macros as extensions, and by attaching them to
documents.</p>
<p>The Developer's Guide discusses macros in chapter 18, "Scripting Framework", but
macro programming has changed since the guide was produced (e.g. macros can now
be written in Python), so it's better to read the more current OpenOffice wiki, starting
at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Scripting/Scripting_Framework/">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Scripting/Scripting_Framework/</a>
(or use <code>loGuide "Scripting Framework"</code>).</p>
<p>Most macro programming resources employ Office Basic, and Java rarely gets
mentioned, as in chapter 13, "Getting Started with Macros", of the "Getting Started
Guide" (available at <a href="https://libreoffice.org/get-help/documentation/">https://libreoffice.org/get-help/documentation/</a>). That
chapter ends with a useful list of online resources, and printed and eBook materials.</p>
<p>Probably the best source for Office Basic macro coding is Andrew Pitonyak's website
at <a href="https://pitonyak.org/oo.php">https://pitonyak.org/oo.php</a>; I recommend starting with his book,
"OpenOffice.org Macros Explained" (OOME), which is free to download. There's
also a separate book of collected macros, called AndrewMacros.pdf.</p>
<p>Another excellent introduction to Office Basic Macros (written in French) is:</p>
<ul>
<li>Programmation OpenOffice.org et LibreOffice: Macros OOoBasic et API
Bernard Marcelly and Laurent Godard
Eyrolles, 2011
<a href="https://editions-eyrolles.com/Livre/9782212132472/programmation-openoffice-org-et-libreoffice/">https://editions-eyrolles.com/Livre/9782212132472/programmation-openoffice-org-et-libreoffice/</a></li>
</ul>
<p>Two textbooks that focus on Office Basic macros in a particular Office application:</p>
<ul>
<li>Learn OpenOffice.org Spreadsheet Macro Programming: OOoBasic and Calc
Automation
Mark Alexander Bain
Packt Publishing, 2006
<a href="https://packtpub.com/hardware-and-creative/learn-openofficeorg-spreadsheet-macro-programming-ooobasic-and-calc-automation/">https://packtpub.com/hardware-and-creative/learn-openofficeorg-spreadsheet-macro-programming-ooobasic-and-calc-automation/</a></li>
<li>Database Programming with OpenOffice.org Base and Basic
Roberto Benitez
Lulu.com, 2011
<a href="https://lulu.com/shop/roberto-benitez/database-programming-with-openofficeorg-base-basic/paperback/product-3568728.html">https://lulu.com/shop/roberto-benitez/database-programming-with-openofficeorg-base-basic/paperback/product-3568728.html</a></li>
</ul>
<h2 id="1-fantastic-macros-and-where-to-find-them">1.  Fantastic Macros and Where to Find Them<a class="headerlink" href="#1-fantastic-macros-and-where-to-find-them" title="Permanent link">&para;</a></h2>
<p>There are four categories of macros:
* user: user macros are available only to the user who added them to Office;
* share: share macros can be called by all users of that copy of Office;
* extension: extension macros are added to office as an extension, and may be
available only to the user or be shared (these are discussed in the next chapter);
* document: these macros are added to a document rather than to Office, and so are
useable only in that document (see the next chapter).</p>
<p>These categories are reflected in how the Office GUI displays installed macros in the
Macro Selector dialog of Figure 1 (accessible via the Tools &gt; Macros &gt; "Run Macros"
menu item).</p>
<p><img alt="" src="images/48-Event_Macros-1.png" /></p>
<p>Figure 1. The "Tools &gt; Macros &gt; Run Macros" Dialog.</p>
<p>The top-level folders in Figure 1 are library containers: "My Macros" and
"LibreOffice Macros" are always present, and store user and share macros
respectively. If the currently loaded document contains document macros then there
will be a third container with the same name as the file (e.g. "build.odt" in Figure 1).
Extension macros are grouped under the name of the extension file (e.g.
"FormMacros.oxt"), and may occur in either "My Macros" or "LibreOffice Macros"
depending on if the extension contains user or share macros.</p>
<p>Each library container (e.g. "My Macros") can hold multiple libraries; each library
can contain multiple modules; each module can store multiple macros. For example,
Figure 1 shows that the "My Macros" container holds three libraries called
"FormMacros.oxt", "Standard", and "WikiEditor". The "FormMacros.oxt" library
(which holds extension macros) consists of a single "Utils" module with two macros
called "GetNumber.get" and "GetText.show". I'll be explaining how to create and
install this extension in the next chapter.</p>
<p>In addition, the Tools &gt; Macros &gt; "Organize Macros" menu gives access to macros
according to some of the programming languages supported by Office, but Java isn't
included (see Figure 2). As a consequence, I'll use the Macro Selector dialog of
Figure 1 from now on.</p>
<p><img alt="" src="images/48-Event_Macros-2.png" /></p>
<p>Figure 2. The Tools &gt; Macros &gt; "Organize Macros" Menu.</p>
<h2 id="2-where-are-macros-stored">2.  Where are Macros Stored?<a class="headerlink" href="#2-where-are-macros-stored" title="Permanent link">&para;</a></h2>
<p>Aside from accessing macros through the Office GUI, it's useful to know where
they're located in the directory structure. This is especially true for user and share
macros since the easiest way to install them is to copy them into Office's designated
folders. However, extension macros are installed using the extension manager, and
document macros are added to their document using unzipping and zipping.</p>
<p>Finding Office's macro folders can be a bit tricky, since their location varies
depending on if the macros are user or share, coded in Office Basic or another
language, and on the version of Office and OS.</p>
<p>The folders for share macros are probably the easiest to find – they're located inside
<OFFICE>\share (e.g. C:\Program Files\LibreOffice 5\share on my machine). Basic
macros are in share\basic while macros in other languages, such as Java, are in
subfolders of share\Scripts (e.g. see Figure 3).</p>
<p><img alt="" src="images/48-Event_Macros-3.png" /></p>
<p>Figure 3. The Non-Basic share\Scripts Macros Folders.</p>
<p>In other words, Java share macros will be in:</p>
<div class="highlight"><pre><span></span><code>C:\Program Files\LibreOffice 5\share\Scripts\java
</code></pre></div>
<p>User macros are stored in an 'application data' subfolder for LibreOffice. On
Windows, application data starts at the location stored in the APPDATA environment
variable, which you can print out:</p>
<div class="highlight"><pre><span></span><code>echo %APPDATA%
</code></pre></div>
<p>On my work test machine this prints "C:\Users\Ad\AppData\Roaming". You need to
locate the LibreOffice subdirectory in the Roaming folder and then its user\
subdirectory, which will be inside LibreOffice\5 or perhaps LibreOffice\4. For
instance, on one of my test machines the user folder is:</p>
<div class="highlight"><pre><span></span><code>C:\Users\Ad\AppData\Roaming\LibreOffice\4\user
</code></pre></div>
<p>If you haven't previously downloaded or created Java user macros, then you'll have to
create a Scripts folder inside user\, and a java folder inside Scripts. In other words,
the Java user macros will be in:</p>
<div class="highlight"><pre><span></span><code>C:\Users\Ad\AppData\Roaming\LibreOffice\4\user\Scripts\java
</code></pre></div>
<h2 id="3-naming-macro-functions">3.  Naming Macro Functions<a class="headerlink" href="#3-naming-macro-functions" title="Permanent link">&para;</a></h2>
<p>The "Macro Selector dialog displays a list of macros in its right hand window (e.g.</p>
<p>"GetNumber.get" and "GetText.show" in Figure 1), but more detailed function names
are required when calling macros from code.</p>
<p>A function name is specified as a URI of the form:</p>
<div class="highlight"><pre><span></span><code>vnd.sun.star.script:MACROPARAM?language=LANGPARAM
                              &amp;location=LOCPARAM
</code></pre></div>
<p>LANGPARAM identifies the macro's programming language, which may be "Basic",
"BeanShell", "Java", "JavaScript", or "Python".</p>
<p>LOCPARAM is the macro category, which for Java macros can be "user", "share", or
"document". Extension macros use the label "user:uno_packages/" or
"share:uno_packages/" followed by the name of the extension file (e.g.
"user:uno_packages/FormMacros.oxt").</p>
<p>MACROPARAM takes the form:</p>
<div class="highlight"><pre><span></span><code>FOLDER.[PACKAGE_NAME.]CLASS_NAME.FUNCTION_NAME
</code></pre></div>
<p>FOLDER is the subdirectory holding the compiled Java code in the user or share java\
folder, and the package name is optional. The class and function names are displayed
by the Macro Selector dialog (see Figure 1). For example, "GetNumber.get" refers to
the static function get() in the GetNumber class.</p>
<p>Information about the URI formats for other languages is given on the "Scripting
Framework URI Specification" page at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Scripting/Scripting_Framework_URI_Specification/">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Scripting/Scripting_Framework_URI_Specification/</a>
(or use <code>loGuide "Scripting Framework URI Specification"</code>).</p>
<h4 id="listing-and-finding-macro-names">Listing and Finding Macro Names<a class="headerlink" href="#listing-and-finding-macro-names" title="Permanent link">&para;</a></h4>
<p>Knowing a macro's full name is essential, so I've added some helper functions to the
Macros.java utilities class. The ListMacros.java and FindMacros.java examples show
how to use them.</p>
<p>ListMacros.java calls Macros.getLangScripts() to print the names of the macros
written in a given language:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ListMacros.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">lang</span> <span class="o">=</span> <span class="s">&quot;Java&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run ListMacros [Java | Python |</span>
<span class="s">                BeanShell | Basic | JavaScript]&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Using \&quot;Java\&quot;&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">lang</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scriptURIs</span> <span class="o">=</span> <span class="n">Macros</span><span class="p">.</span><span class="na">getLangScripts</span><span class="p">(</span><span class="n">lang</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">lang</span> <span class="o">+</span> <span class="s">&quot; Macros in Office: (&quot;</span> <span class="o">+</span>
                           <span class="n">scriptURIs</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">scriptURI</span> <span class="p">:</span> <span class="n">scriptURIs</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">scriptURI</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>

<span class="n">Macros</span><span class="p">.</span><span class="na">getLangScripts</span><span class="p">()</span> <span class="n">obtains</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">all</span> <span class="n">the</span> <span class="n">macro</span> <span class="n">names</span> <span class="n">by</span> <span class="n">calling</span>
<span class="n">Macros</span><span class="p">.</span><span class="na">getScripts</span><span class="p">(),</span> <span class="n">then</span> <span class="n">filters</span> <span class="n">out</span> <span class="n">names</span> <span class="n">based</span> <span class="n">on</span> <span class="n">a</span> <span class="s">&quot;language=LANGPARAM&amp;&quot;</span>
<span class="nl">substring</span><span class="p">:</span>

<span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLangScripts</span><span class="p">(</span><span class="n">String</span> <span class="n">lang</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isMacroLanguage</span><span class="p">(</span><span class="n">lang</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Not a Macro language; try \&quot;Java\&quot;&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fScripts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scriptURIs</span> <span class="o">=</span> <span class="n">getScripts</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">scriptURI</span> <span class="p">:</span> <span class="n">scriptURIs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scriptURI</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;language=&quot;</span> <span class="o">+</span> <span class="n">lang</span> <span class="o">+</span> <span class="s">&quot;&amp;&quot;</span><span class="p">))</span>
      <span class="n">fScripts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">scriptURI</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">fScripts</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// end of getLangScripts()</span>
</code></pre></div>
<p>Macros.getScripts() utilizes services and interfaces in the com.sun.star.script.browse
module to examine a scripts tree structure consisting of CONTAINER and SCRIPT
nodes – the CONTAINER nodes are the internal branches of the tree representing
libraries and modules, while SCRIPT nodes are the leaves holding macro information.</p>
<p>Macros.getScripts() accesses the root of the MACROORGANIZER tree, and collects
script names by having getLibScripts() recursively traverse the tree, adding names to
a scripts ArrayList:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getScripts</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scripts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="n">XComponentContext</span> <span class="n">xcc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">getContext</span><span class="p">();</span>
  <span class="n">XBrowseNodeFactory</span> <span class="n">bnf</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XBrowseNodeFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
           <span class="n">xcc</span><span class="p">.</span><span class="na">getValueByName</span><span class="p">(</span>
              <span class="s">&quot;/singletons/com.sun.star.script.</span>

<span class="s">                   browse.theBrowseNodeFactory&quot;</span><span class="p">));</span>

  <span class="n">XBrowseNode</span> <span class="n">rootNode</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XBrowseNode</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
     <span class="n">bnf</span><span class="p">.</span><span class="na">createView</span><span class="p">(</span> <span class="n">BrowseNodeFactoryViewTypes</span><span class="p">.</span><span class="na">MACROORGANIZER</span><span class="p">)</span> <span class="p">);</span>
                     <span class="c1">// for scripts</span>

  <span class="n">XBrowseNode</span><span class="o">[]</span> <span class="n">typeNodes</span> <span class="o">=</span> <span class="n">rootNode</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">typeNodes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">XBrowseNode</span> <span class="n">typeNode</span> <span class="o">=</span> <span class="n">typeNodes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
    <span class="n">XBrowseNode</span><span class="o">[]</span> <span class="n">libraryNodes</span> <span class="o">=</span> <span class="n">typeNode</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">libraryNodes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">getLibScripts</span><span class="p">(</span><span class="n">libraryNodes</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="n">typeNode</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span> <span class="n">scripts</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">scripts</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// end of getScripts()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">getLibScripts</span><span class="p">(</span><span class="n">XBrowseNode</span> <span class="n">browseNode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
                        <span class="n">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scripts</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XBrowseNode</span><span class="o">[]</span> <span class="n">scriptNodes</span> <span class="o">=</span> <span class="n">browseNode</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">scriptNodes</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">level</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1">// not a top-level library</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No scripts in &quot;</span> <span class="o">+</span> <span class="n">path</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scriptNodes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">XBrowseNode</span> <span class="n">scriptNode</span> <span class="o">=</span> <span class="n">scriptNodes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scriptNode</span><span class="p">.</span><span class="na">getType</span><span class="p">()</span> <span class="o">==</span> <span class="n">BrowseNodeTypes</span><span class="p">.</span><span class="na">SCRIPT</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">scriptNode</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">props</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="n">scripts</span><span class="p">.</span><span class="na">add</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="n">props</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="s">&quot;URI&quot;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No props for &quot;</span> <span class="o">+</span> <span class="n">scriptNode</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">scriptNode</span><span class="p">.</span><span class="na">getType</span><span class="p">()</span> <span class="o">==</span> <span class="n">BrowseNodeTypes</span><span class="p">.</span><span class="na">CONTAINER</span><span class="p">)</span>
      <span class="n">getLibScripts</span><span class="p">(</span><span class="n">scriptNode</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&quot;&gt;&quot;</span> <span class="o">+</span>
                                <span class="n">scriptNode</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span> <span class="n">scripts</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unknown node type&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getLibScripts()</span>
</code></pre></div>
<p>All the Java macros can be listed by calling:
run ListMacros Java
It will print something like:</p>
<div class="highlight"><pre><span></span><code>Java Macros in Office: (6)

vnd.sun.star.script:Utils.GetNumber.get?language=Java&amp;
                       location=user:uno_packages/FormMacros.oxt

vnd.sun.star.script:Utils.GetText.show?language=Java&amp;
                       location=user:uno_packages/FormMacros.oxt

vnd.sun.star.script:HelloWorld.org.libreoffice.example.java_scripts.

       HelloWorld.printHW?language=Java&amp;location=share

vnd.sun.star.script:Highlight.org.libreoffice.example.java_scripts.

       HighlightText.showForm?language=Java&amp;location=share

vnd.sun.star.script:MemoryUsage.org.libreoffice.example.java_scripts.

       MemoryUsage.updateMemoryUsage?language=Java&amp;location=share

vnd.sun.star.script:ShowEvent.ShowEvent.show?language=Java&amp;
                       location=share
</code></pre></div>
<p>Six Java macros were found: two are user macros from the FormMacros.oxt
extension, and four are share macros. The first three share macros
(HelloWorld.printHW, HighlightText.showForm, and
MemoryUsage.updateMemoryUsage) are LibreOffice examples; I'll explain the first
one:</p>
<div class="highlight"><pre><span></span><code><span class="n">vnd</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">script</span><span class="p">:</span><span class="n">HelloWorld</span><span class="p">.</span><span class="na">org</span><span class="p">.</span><span class="na">libreoffice</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">java_scripts</span><span class="p">.</span>
      <span class="n">HelloWorld</span><span class="p">.</span><span class="na">printHW</span><span class="o">?</span><span class="n">language</span><span class="o">=</span><span class="n">Java</span><span class="o">&amp;</span><span class="n">location</span><span class="o">=</span><span class="n">share</span>
</code></pre></div>
<p>The macro's location parameter is "location=share", which means that it appears in the
"LibreOffice Macros" section of the Macro Selector dialog in Figure 4.</p>
<p><img alt="" src="images/48-Event_Macros-4.png" /></p>
<p>Figure 4. The HelloWorld.printHW Macro.</p>
<p>The four components of
"HelloWorld.org.libreoffice.example.java_scripts.HelloWorld.printHW" are:</p>
<ul>
<li>folder: HelloWorld</li>
<li>package: org.libreoffice.example.java_scripts</li>
<li>class name: HelloWorld</li>
<li>function name: printHW</li>
</ul>
<p>The HelloWorld folder is inside C:\Program Files\LibreOffice 5\share\Scripts\java\,
as confirmed by Figure 5.</p>
<p><img alt="" src="images/48-Event_Macros-5.png" /></p>
<p>Figure 5. The HelloWorld Folder in share\Scripts\java.</p>
<p>Figure 5 also shows Highlight\, MemoryUsage and ShowEvent folders which hold
the other three share macros listed by ListMacros.java.</p>
<p>The HelloWorld folder contains the compiled HelloWorld class in a JAR file, and a
parcel-descriptor.xml configuration file, which I'll explain later. It also has the source
code for HelloWorld, which isn’t required by Office, but included as an example for
developers. Figure 6 shows the contents of HelloWorld.</p>
<p><img alt="" src="images/48-Event_Macros-6.png" /></p>
<p>Figure 6. The Contents of the HelloWorld Folder.</p>
<p>The format of the HelloWorld class in the JAR file is:</p>
<p>package org.libreoffice.example.java_scripts;</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printHW</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">xSc</span><span class="p">)</span>
  <span class="p">{</span>  <span class="cm">/* code not shown */</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>HelloWorld implements a single printHW() function.</p>
<p>My FindMacros.java example calls Macros.findScripts() with a substring, and all the
macro names containing that string are printed. For example, a search for "hello"
returns five matches:</p>
<div class="highlight"><pre><span></span><code>Matching Macros in Office: (5)

vnd.sun.star.script:Utils.HelloWorld.hello?
             language=Java&amp;location=user:uno_packages/FormMacros.oxt

vnd.sun.star.script:HelloWorld.helloworld.bsh?
             language=BeanShell&amp;location=share

vnd.sun.star.script:HelloWorld.org.libreoffice.example.java_scripts.

             HelloWorld.printHW?language=Java&amp;location=share

vnd.sun.star.script:HelloWorld.helloworld.js?
             language=JavaScript&amp;location=share

vnd.sun.star.script:HelloWorld.py$HelloWorldPython?
             language=Python&amp;location=share
</code></pre></div>
<p>Four of the hello-related scripts are share macros written in BeanShell, Java,
JavaScript, and Python.</p>
<h2 id="4-calling-the-hello-macros">4.  Calling the "hello" Macros<a class="headerlink" href="#4-calling-the-hello-macros" title="Permanent link">&para;</a></h2>
<p>The TextMacros.java example creates a text document, and calls the four "hello"
share macros listed above by FindMacros.java. They each add a short piece of text to
the document, as displayed on lines 2-5 in Figure 7.</p>
<p><img alt="" src="images/48-Event_Macros-7.png" /></p>
<p>Figure 7. A Document with "hello" Macros Text.</p>
<p>TextMacros.java utilizes Macros.execute() to call the macros:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in TextMacros.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XTextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Writer doc creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Macros</span><span class="p">.</span><span class="na">getSecurity</span><span class="p">()</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">LOW</span><span class="p">)</span>
    <span class="n">Macros</span><span class="p">.</span><span class="na">setSecurity</span><span class="p">(</span><span class="n">Macros</span><span class="p">.</span><span class="na">MEDIUM</span><span class="p">);</span>

  <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>   <span class="c1">// make sure the document is visible</span>
                   <span class="c1">// before sending it dispatches</span>

  <span class="n">Write</span><span class="p">.</span><span class="na">appendPara</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;Hello LibreOffice&quot;</span><span class="p">);</span>

  <span class="n">Macros</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;HelloWorld.helloworld.bsh&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;BeanShell&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>

  <span class="n">Macros</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;HelloWorld.py$HelloWorldPython&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;Python&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>

  <span class="n">Macros</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;HelloWorld.helloworld.js&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;JavaScript&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>

  <span class="n">Macros</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;HelloWorld.org.libreoffice.example.</span>

<span class="s">                                java_scripts.HelloWorld.printHW&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;Java&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">endParagraph</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
  <span class="n">Write</span><span class="p">.</span><span class="na">appendPara</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;Timestamp: &quot;</span> <span class="o">+</span> <span class="n">Lo</span><span class="p">.</span><span class="na">getTimeStamp</span><span class="p">());</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
<p>The arguments of Macros.execute() are the MACROPARAM, LANGPARAM, and
LOCPARAM parts of the macro's URI; they're separated out to make the macro's
name a little easier to read.</p>
<p>Macros.execute() uses the theMasterScriptProviderFactory service to obtain a
XScriptProviderFactory It creates a XScriptProvider which can load the named macro
as an XScript object; the script is executed by XScript.invoke():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">execute</span><span class="p">(</span><span class="n">String</span> <span class="n">macroName</span><span class="p">,</span> <span class="n">String</span> <span class="n">language</span><span class="p">,</span>
                                                  <span class="n">String</span> <span class="n">location</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">execute</span><span class="p">(</span><span class="n">macroName</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">location</span><span class="p">);</span>   <span class="p">}</span>



<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">execute</span><span class="p">(</span><span class="n">String</span> <span class="n">macroName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">params</span><span class="p">,</span>
                                 <span class="n">String</span> <span class="n">language</span><span class="p">,</span> <span class="n">String</span> <span class="n">location</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isMacroLanguage</span><span class="p">(</span><span class="n">language</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\&quot;&quot;</span> <span class="o">+</span> <span class="n">language</span> <span class="o">+</span>
                   <span class="s">&quot;\&quot; is not a macro language name&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/* deprecated approach</span>
<span class="cm">       XScriptProviderFactory spFactory =  Lo.createInstanceMCF(</span>
<span class="cm">                  XScriptProviderFactory.class,</span>
<span class="cm">        &quot;com.sun.star.script.provider.MasterScriptProviderFactory&quot;);</span>
<span class="cm">    */</span>
    <span class="n">XComponentContext</span> <span class="n">xcc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">getContext</span><span class="p">();</span>
    <span class="n">XScriptProviderFactory</span> <span class="n">spFactory</span> <span class="o">=</span>
        <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XScriptProviderFactory</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
            <span class="n">xcc</span><span class="p">.</span><span class="na">getValueByName</span><span class="p">(</span>
                  <span class="s">&quot;/singletons/com.sun.star.script.provider.</span>

<span class="s">                   theMasterScriptProviderFactory&quot;</span><span class="p">));</span>

    <span class="n">XScriptProvider</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">spFactory</span><span class="p">.</span><span class="na">createScriptProvider</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="n">XScript</span> <span class="n">xScript</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="na">getScript</span><span class="p">(</span><span class="s">&quot;vnd.sun.star.script:&quot;</span> <span class="o">+</span>
             <span class="n">macroName</span> <span class="o">+</span> <span class="s">&quot;?language=&quot;</span> <span class="o">+</span> <span class="n">language</span> <span class="o">+</span>
                         <span class="s">&quot;&amp;location=&quot;</span> <span class="o">+</span> <span class="n">location</span><span class="p">);</span>

    <span class="c1">// minimal inout/out parameters</span>
    <span class="kt">short</span><span class="o">[][]</span> <span class="n">outParamIndex</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">};</span>
    <span class="n">Object</span><span class="o">[][]</span> <span class="n">outParam</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="kc">null</span> <span class="p">}</span> <span class="p">};</span>
    <span class="k">return</span> <span class="n">xScript</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">outParamIndex</span><span class="p">,</span> <span class="n">outParam</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not execute macro &quot;</span> <span class="o">+</span>
                 <span class="n">macroName</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of execute()</span>
</code></pre></div>
<p>Input parameters can be passed to invoke(), but the three-argument version of
Macros.execute() sets them to null. It's also possible to have the script set output
parameters, but my call to XScript.invoke() doesn't use them either.</p>
<p>There's no need to pass Macros.execute() a reference to the document. An executing
script only requires Office's current context which is retrieved by Lo.getContext().</p>
<h3 id="41-macro-security-levels">4.1.  Macro Security Levels<a class="headerlink" href="#41-macro-security-levels" title="Permanent link">&para;</a></h3>
<p>Prior to the macro calls in TextMacros.java, there's a call to Macros.getSecurity(). It
reports Office's macro execution setting, which is changed to Macros.MEDIUM if the
current value is Macros.LOW:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of TextMacros.java...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">Macros</span><span class="p">.</span><span class="na">getSecurity</span><span class="p">()</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">LOW</span><span class="p">)</span>
  <span class="n">Macros</span><span class="p">.</span><span class="na">setSecurity</span><span class="p">(</span><span class="n">Macros</span><span class="p">.</span><span class="na">MEDIUM</span><span class="p">);</span>
</code></pre></div>
<p>The Macros class defines four security constants: LOW, MEDIUM, HIGH,
VERY_HIGH, which correspond to the levels used in Office's "Macro Security"
dialog shown in Figure 8. It is reached via Tools, Options, Security, and the
"Macro Security" button.</p>
<p><img alt="" src="images/48-Event_Macros-8.png" /></p>
<p>Figure 8. The Macro Security Dialog.</p>
<p>The Office API has a MacroExecMode class (see <code>lodoc MacroExecMode</code>) which
defines many more security levels, but the four levels in the GUI seem sufficient.</p>
<p>Macros.getSecurity() uses Info.getConfig() to access the
"/org.openoffice.Office.Common/Security/Scripting" configuration node, and look up
its "MacroSecurityLevel" property:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getSecurity</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Macro security level:&quot;</span><span class="p">);</span>
  <span class="n">Integer</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">Integer</span><span class="p">)</span> <span class="n">Info</span><span class="p">.</span><span class="na">getConfig</span><span class="p">(</span>
        <span class="s">&quot;/org.openoffice.Office.Common/Security/Scripting&quot;</span><span class="p">,</span>
        <span class="s">&quot;MacroSecurityLevel&quot;</span><span class="p">);</span>

  <span class="c1">// various tests of val, before returning its int value</span>
  <span class="c1">// :</span>
  <span class="k">return</span> <span class="n">val</span><span class="p">.</span><span class="na">intValue</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">Macros</span><span class="p">.</span><span class="na">setSecurity</span><span class="p">()</span> <span class="n">manipulates</span> <span class="n">the</span> <span class="n">same</span> <span class="n">configuration</span> <span class="n">node</span> <span class="n">but</span> <span class="n">supplies</span> <span class="n">a</span> <span class="k">new</span>
<span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="s">&quot;MacroSecurityLevel&quot;</span> <span class="n">property</span><span class="p">:</span>

<span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">setSecurity</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">level</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">LOW</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">MEDIUM</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">HIGH</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="n">Macros</span><span class="p">.</span><span class="na">VERY_HIGH</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Setting macro security level to &quot;</span> <span class="o">+</span> <span class="n">level</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Info</span><span class="p">.</span><span class="na">setConfig</span><span class="p">(</span>
                <span class="s">&quot;/org.openoffice.Office.Common/Security/Scripting&quot;</span><span class="p">,</span>
                <span class="s">&quot;MacroSecurityLevel&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">level</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Use Macros class constants:</span>
<span class="s">                           LOW, MEDIUM, HIGH, or VERY_HIGH&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of setSecurity()</span>
</code></pre></div>
<h3 id="42-implementing-the-helloworld-java-macro">4.2.  Implementing the HelloWorld Java Macro<a class="headerlink" href="#42-implementing-the-helloworld-java-macro" title="Permanent link">&para;</a></h3>
<p>The four macros called by TextMacros.java add text to the document, but how
exactly? The Java macro is called using:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of TextMacros.java...</span>
<span class="n">Macros</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;HelloWorld.org.libreoffice.example.</span>
<span class="s">                                java_scripts.HelloWorld.printHW&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;Java&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
</code></pre></div>
<p>This invokes the printHW() static method in the HelloWorld class in the
org.libreoffice.example.java_scripts package shown back in Figure 4. The complete
code for the class (minus some comments) is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// the HelloWorld class</span>
<span class="kn">package</span> <span class="nn">org.libreoffice.example.java_scripts</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.sun.star.script.provider.XScriptContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.uno.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sun.star.text.*</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printHW</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">xSc</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">XTextDocument</span> <span class="n">xtextdocument</span> <span class="o">=</span>
        <span class="p">(</span><span class="n">XTextDocument</span><span class="p">)</span> <span class="n">UnoRuntime</span><span class="p">.</span><span class="na">queryInterface</span><span class="p">(</span>
                <span class="n">XTextDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xSc</span><span class="p">.</span><span class="na">getDocument</span><span class="p">());</span>
    <span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">xtextdocument</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
    <span class="n">XTextRange</span> <span class="n">xTextRange</span> <span class="o">=</span> <span class="n">xText</span><span class="p">.</span><span class="na">getEnd</span><span class="p">();</span>
    <span class="n">xTextRange</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="s">&quot;Hello World (in Java)&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="c1">// end of printHW()</span>

<span class="p">}</span> <span class="c1">// end of HelloWorld class</span>
</code></pre></div>
<p>XScript.invoke() constructs a one-argument call to printHW(), passing it a
XScriptContext object. As we'll see later, a function can be called with different
arguments depending on what event triggers the macro.</p>
<p>The XScriptContext interface defines four methods which allow the current context,
the desktop, and document to be accessed (see lodoc XScriptContext). printHW()
utilizes XScriptContext.getDocument() to retrieve the document, and casts it to
XTextDocument. This allows the end of the text to be accessed with XTextRange, so
a string (""Hello World (in Java)") can be appended to it.</p>
<h2 id="5-the-librelogo-macro">5.  The LibreLogo Macro<a class="headerlink" href="#5-the-librelogo-macro" title="Permanent link">&para;</a></h2>
<p>HelloWorld isn't the most exciting of macro examples. LibreLogo is a fun (and
educational) share macro for LibreOffice (see Figure 9), which has been a standard
Office add-on since version 4.0.</p>
<p><img alt="" src="images/48-Event_Macros-9.png" /></p>
<p>Figure 9. The LibreLogo Macro Module.</p>
<p>Normally LibreLogo is accessed through its own View, Toolbars, Logo toolbar,
which is just as well since the Macro selector doesn't list any macros in the LibreLogo
module (see the empty area on the right of Figure 9). I had to examine the module's
Python code in <OFFICE>\share\Scripts\python\LibreLogo\LibreLogo.py to work out
how to call it as a function.</p>
<p>My UseLogo.java example creates a text document, writes the logo program text onto
the page, followed by LibreLogo's rendering of that program, as in Figure 10.</p>
<p><img alt="" src="images/48-Event_Macros-10.png" /></p>
<p>Figure 10. The Page Generated by UseLogo.java.</p>
<p>UseLogo.java is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UseLogo</span>
<span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XTextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Writer doc creation failed&quot;</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>   <span class="c1">// make sure doc is visible</span>

    <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

    <span class="n">String</span> <span class="n">logoCmds</span> <span class="o">=</span> <span class="s">&quot;repeat 88 [ fd 200 left 89 ] fill&quot;</span><span class="p">;</span>
    <span class="n">Write</span><span class="p">.</span><span class="na">appendPara</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">logoCmds</span><span class="p">);</span>
    <span class="n">Macros</span><span class="p">.</span><span class="na">executeLogoCmds</span><span class="p">(</span><span class="n">logoCmds</span><span class="p">);</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span> <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of UseLogo class</span>
</code></pre></div>
<p>Macros.executeLogoCmds() is a small wrapper around Macros.execute() which calls
the commandline() function inside LibreLogo.py:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Macros class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">executeLogoCmds</span><span class="p">(</span><span class="n">String</span> <span class="n">cmdsStr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Object</span><span class="o">[]</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
  <span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>        <span class="c1">// based on looking at commandline()</span>
  <span class="n">params</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">cmdsStr</span><span class="p">;</span>   <span class="c1">// in LibreLogo.py</span>
  <span class="k">return</span> <span class="n">execute</span><span class="p">(</span><span class="s">&quot;LibreLogo/LibreLogo.py$commandline&quot;</span><span class="p">,</span>
                               <span class="n">params</span><span class="p">,</span> <span class="s">&quot;Python&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The params[] array is treated as two arguments by XScript.invoke() and passed to
commandline().</p>
<p>The quick-start and resources pages at librelogo.org are the places to start learning
LibreLogo (<a href="https://librelogo.org/quick-start/">https://librelogo.org/quick-start/</a> and <a href="https://librelogo.org/resources/">https://librelogo.org/resources/</a>).
There's also a help page of commands at
<a href="https://help.libreoffice.org/Writer/LibreLogo_Toolbar/">https://help.libreoffice.org/Writer/LibreLogo_Toolbar/</a>.</p>
<p>A good source of examples, slides, and code is <a href="https://numbertext.org/logo/">https://numbertext.org/logo/</a>. The
best introductory talk at that site is "LibreLogo – Turtle vector graphics for
everybody" from 2012 (<a href="https://numbertext.org/logo/librelogo.pdf">https://numbertext.org/logo/librelogo.pdf</a>), and there are
more recent presentations which update the project. One of its aims was to create a
textbook for Hungarian primary and secondary schools (the project lead, László
Németh, is Hungarian), which is free to download from
<a href="https://szabadszoftver.kormany.hu/wp-content/uploads/librelogo_oktatasi_segedanyag_v4.pdf">https://szabadszoftver.kormany.hu/wp-content/uploads/librelogo_oktatasi_segedanyag_v4.pdf</a>.</p>
<h2 id="6-writing-a-simple-event-macro">6.  Writing a Simple Event Macro<a class="headerlink" href="#6-writing-a-simple-event-macro" title="Permanent link">&para;</a></h2>
<p>It's time to start coding our own macros. I'll start by writing a ShowEvent class which
reports when various events occur. It does this by implementing several versions of a
static show() method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ShowEvent.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShowEvent</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">ActionEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// triggered by a action event (usually a button press)</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;action&quot;</span><span class="p">,</span> <span class="n">getSource</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">TextEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// called when text changes inside a text component</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">getSource</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">FocusEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// called when the focus changes</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;focus&quot;</span><span class="p">);</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">Short</span> <span class="n">val</span><span class="p">)</span>
  <span class="c1">// called from a toolbar</span>
  <span class="p">{</span> <span class="n">display</span><span class="p">(</span><span class="s">&quot;toolbar (&quot;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// called because of a key</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;key &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyChar</span><span class="p">,</span> <span class="n">getSource</span><span class="p">(</span><span class="n">e</span><span class="p">));</span> <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">MouseEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// called because of the mouse</span>
  <span class="p">{</span> <span class="n">display</span><span class="p">(</span><span class="s">&quot;mouse&quot;</span><span class="p">);</span> <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span>
                        <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">document</span><span class="p">.</span><span class="na">DocumentEvent</span> <span class="n">e</span><span class="p">)</span>
  <span class="c1">// triggered by a document event</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;document&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">EventName</span><span class="p">);</span>  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">EventObject</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">display</span><span class="p">(</span><span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="n">getSource</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
    <span class="k">else</span>
      <span class="n">display</span><span class="p">(</span><span class="s">&quot;object ()&quot;</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">)</span>
  <span class="c1">// called from a menu or the &quot;Run Macro...&quot; menu</span>
  <span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;menu/run&quot;</span><span class="p">);</span>   <span class="p">}</span>

  <span class="c1">// support methods; explained shortly</span>
  <span class="c1">//   :</span>

<span class="p">}</span>  <span class="c1">// end of ShowEvent class</span>
</code></pre></div>
<p>A particular show() function is called depending on the event, and more versions of
show() could easily be added since Office supports a wide range of events. Probably
the best summary of them is in the online documentation for EventObject (see
<code>lodoc EventObject</code>); EventObject is the superclass for most event types.</p>
<p>When I first wrote ShowEvent, I mistakenly assumed that the show() function with
the EventObject argument (i.e. the second to last one in the code above) would be the
default method called when no other version of show() was suitable. That isn't the
case; instead, the single argument show() (i.e. the last function,
<code>show(XScriptContext sc)</code>) is executed.</p>
<p>The show() methods utilize display() and showDialog():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of the ShowEvent class...</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">display</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">showDialog</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s">&quot; event&quot;</span><span class="p">);</span>
  <span class="c1">// JOptionPane.showMessageDialog(null, msg + &quot; event&quot;);</span>
<span class="p">}</span>


<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">display</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">,</span> <span class="n">String</span> <span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">showDialog</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s">&quot; event: &quot;</span> <span class="o">+</span> <span class="n">info</span><span class="p">);</span>
  <span class="c1">// JOptionPane.showMessageDialog(null, msg + &quot; event: &quot; + info);</span>
<span class="p">}</span>


<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showDialog</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">JDialog</span> <span class="n">dlg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JDialog</span><span class="p">((</span><span class="n">java</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">Frame</span><span class="p">)</span><span class="kc">null</span><span class="p">,</span> <span class="s">&quot;Show Event&quot;</span><span class="p">);</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">getContentPane</span><span class="p">().</span><span class="na">setLayout</span><span class="p">(</span><span class="k">new</span> <span class="n">GridLayout</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">JLabel</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">));</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">JLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">SwingConstants</span><span class="p">.</span><span class="na">CENTER</span><span class="p">));</span> <span class="c1">// centered text</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">pack</span><span class="p">();</span>

  <span class="n">Random</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">();</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">setLocation</span><span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>

  <span class="n">dlg</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">setResizable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="n">dlg</span><span class="p">.</span><span class="na">setDefaultCloseOperation</span><span class="p">(</span><span class="n">WindowConstants</span><span class="p">.</span><span class="na">DISPOSE_ON_CLOSE</span><span class="p">);</span>
<span class="p">}</span>   <span class="c1">// end of showDialog()</span>
</code></pre></div>
<p>A modeless dialog is displayed using Java's JDialog rather than
JOptionPane.showMessageDialog(), which means that the dialog won't cause Office
to suspend until the user closes the window.</p>
<p>Each dialog is placed at a slightly random position, so that multiple dialogs created by
several events will all hopefully be visible. Another issue is that the dialog's parent is
null which means that the dialog may not appear in front of the Office window.</p>
<p>No use is made of my utility classes, such as Macros.java or GUI.java. Although this
makes the code longer, it also makes this example self-contained, and easier to install.</p>
<p>I'll use my support classes in the extension and document examples in the next
chapter.</p>
<p>Events which are usually triggered by GUI components, such as ActionEvent and
TextEvent, are passed to getSource() which attempts to find the name of the
component that sent the event:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of the ShowEvent class...</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getSource</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XControl</span> <span class="n">control</span> <span class="o">=</span> <span class="n">UnoRuntime</span><span class="p">.</span><span class="na">queryInterface</span><span class="p">(</span>
                             <span class="n">XControl</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>
  <span class="n">XPropertySet</span> <span class="n">xProps</span> <span class="o">=</span>  <span class="n">UnoRuntime</span><span class="p">.</span><span class="na">queryInterface</span><span class="p">(</span>
                  <span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">control</span><span class="p">.</span><span class="na">getModel</span><span class="p">());</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">xProps</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Exception?&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">RuntimeException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;RuntimeException?&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end of getSource()</span>
</code></pre></div>
<h3 id="61-installing-a-simple-event-macro">6.1.  Installing a Simple Event Macro<a class="headerlink" href="#61-installing-a-simple-event-macro" title="Permanent link">&para;</a></h3>
<p>A Java macro is installed as a JAR file, so ShowEvent.class is packaged as
ShowEvent.jar after compilation:</p>
<div class="highlight"><pre><span></span><code>compile ShowEvent.java
jar cvf ShowEvent.jar ShowEvent.class
</code></pre></div>
<p>The JAR is added to a new folder called ShowEvent beneath
<OFFICE>\share\Scripts\java\, thereby making it a share macro. It's also necessary to
include a parcel-descriptor.xml file:</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;parcel language=&quot;Java&quot; xmlns:parcel=&quot;scripting.dtd&quot;&gt;
    &lt;script language=&quot;Java&quot;&gt;

        &lt;locale lang=&quot;en&quot;&gt;
            &lt;displayname value=&quot;ShowEvent.show&quot;/&gt;
            &lt;description&gt;
                Shows a dialog with basic event information.

            &lt;/description&gt;
        &lt;/locale&gt;

        &lt;functionname value=&quot;ShowEvent.show&quot;/&gt;
        &lt;logicalname value=&quot;ShowEvent.show&quot;/&gt;
        &lt;languagedepprops&gt;
            &lt;prop name=&quot;classpath&quot; value=&quot;ShowEvent.jar&quot;/&gt;
        &lt;/languagedepprops&gt;
    &lt;/script&gt;
&lt;/parcel&gt;
</code></pre></div>
<p>Of the three 'name' attributes in the XML file, only <functionname> seems to be used
by Office. The <description> text appears in the Macro selector dialog (e.g. see
Figure 12 below) when the macro is selected, and <languagedepprops> adds the JAR
to Office's classpath.</p>
<p>The final contents of the ShowEvent folder are a JAR and XML file, as shown in
Figure 11.</p>
<p><img alt="" src="images/48-Event_Macros-11.png" /></p>
<p>Figure 11. The ShowEvent Share Macro Folder.</p>
<p>It's a good idea to check that this new macro can be seen by Office. Office should be
restarted and the "LibreOffice Macros" subsection of the Macro Selector dialog
examined. Figure 12 shows the ShowEvent.show macro in the ShowEvent module.</p>
<p><img alt="" src="images/48-Event_Macros-12.png" /></p>
<p>Figure 12. Checking for the Presence of ShowEvent.show.</p>
<h3 id="62-using-showeventshow-in-a-form">6.2.  Using ShowEvent.show in a Form<a class="headerlink" href="#62-using-showeventshow-in-a-form" title="Permanent link">&para;</a></h3>
<p>build.odt is a simple form using textfields and buttons shown in Figure 13.</p>
<p><img alt="" src="images/48-Event_Macros-13.png" /></p>
<p>Figure 13. The "build.odt" Form.</p>
<p>The event handling properties of a control are accessed by changing to form design
mode (click the "OK hand" icon, second from the left in the toolbar at the bottom of
Figure 13). Subsequently, the mouse is right-clicked over a control, such as the
FIRSTNAME textfield selected in Figure 13. The resulting pop-up menu includes a
"Control" menu item which displays the control's Properties dialog (see Figure 14).</p>
<p><img alt="" src="images/48-Event_Macros-14.png" /></p>
<p>Figure 14. The Properties Dialog for the FIRSTNAME Textfield Control.</p>
<p>The Events tab (shown in Figure 14) lists all the events associated with the control,
and a macro is attached by pressing on the right-hand "…" button for an event. An
"Assign Action" dialog appears, like the one in Figure 15.</p>
<p><img alt="" src="images/48-Event_Macros-15.png" /></p>
<p>Figure 15. The "Assign Action" Dialog.</p>
<p>Figure 15 shows that the user has selected the "Key pressed" event.
Clicking on the "Macro…" button brings forth the Macro Selector dialog, and a macro
can be chosen. Upon returning to the "Assign Action" dialog, the event will list the
macro in the "Assigned Action" column. Clicking "Ok" again returns to the properties
dialog which now shows the macro name next to the "Key pressed" event, as in
Figure 16.</p>
<p><img alt="" src="images/48-Event_Macros-16.png" /></p>
<p>Figure 16. The Properties Dialog with an Assigned Macro.</p>
<p>The macro's arguments ("share" and "Java") are its category and implementation
language.</p>
<p>The event/macro link can be tested by returning to the default mode in the form by
clicking the "Ok hand" icon again. When the user types three letters into the
FIRSTNAME textfield (e.g. "and"), three dialogs appear, as in Figure 17.</p>
<p><img alt="" src="images/48-Event_Macros-17.png" /></p>
<p>Figure 17. Reporting Key Events.</p>
<p>I've rearranged the three dialogs in Figure 17 so they're all visible. They're generated
by the KeyEvent version of ShowEvent.show:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of the ShowEvent class...</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">XScriptContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="c1">// Called from a key</span>
<span class="p">{</span>  <span class="n">display</span><span class="p">(</span><span class="s">&quot;key &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyChar</span><span class="p">,</span> <span class="n">getSource</span><span class="p">(</span><span class="n">e</span><span class="p">));</span> <span class="p">}</span>
</code></pre></div>
<p>As each letter ("a', 'n', and 'd') is typed, this version of show() is called.</p>
<h2 id="7-automating-the-assigning-of-event-macros">7.  Automating the Assigning of Event Macros<a class="headerlink" href="#7-automating-the-assigning-of-event-macros" title="Permanent link">&para;</a></h2>
<p>The preceding section illustrates that the assignment of macros to events is
straightforward, but time-consuming, especially if you have many controls in your
form. Fortunately, macros can be assigned programmatically.</p>
<p>I first used the "build.odt" form of Figure 13 back in Chapter 40 on forms; it wasn't
created by hand but generated by BuildForm.java. That program is extended in this
section with calls to Forms.assignScript() which assigns a macro to an event in a
control.</p>
<p>I'll employ Forms.assignScript() so that the FIRSTNAME textfield calls
ShowEvent.show whenever its text changes, focus is lost, or a key is pressed. Also,
the six buttons at the bottom of the form (see Figure 13) will execute
ShowEvent.show when they're pressed.</p>
<p>The new code is highlighted in bold in createForm():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of BuildForm.java...</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">createForm</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span>
       <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;FIRSTNAME&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
  <span class="n">textEvents</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>  <span class="c1">// only the FIRSTNAME textfield has a listener</span>

  <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;LASTNAME&quot;</span><span class="p">,</span> <span class="s">&quot;TextField&quot;</span><span class="p">,</span>  <span class="mi">19</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;AGE&quot;</span><span class="p">,</span> <span class="s">&quot;NumericField&quot;</span><span class="p">,</span> <span class="mi">43</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;DecimalAccuracy&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">Forms</span><span class="p">.</span><span class="na">addLabelledControl</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;BIRTHDATE&quot;</span><span class="p">,</span> <span class="s">&quot;FormattedField&quot;</span><span class="p">,</span> <span class="mi">51</span><span class="p">);</span>


  <span class="c1">// buttons, all with listeners</span>
  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;&lt;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;prev&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;next&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;last&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;*&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>

  <span class="n">props</span> <span class="o">=</span> <span class="n">Forms</span><span class="p">.</span><span class="na">addButton</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;reload&quot;</span><span class="p">,</span> <span class="s">&quot;reload&quot;</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
  <span class="n">buttonEvent</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of createForm()</span>
</code></pre></div>
<p>The property set for the FIRSTNAME textfield is passed to textEvents(), which calls
Forms.assignScript() three times:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of BuildForm.java...</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">textEvents</span><span class="p">(</span><span class="n">XPropertySet</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// listen for text change</span>
  <span class="n">Forms</span><span class="p">.</span><span class="na">assignScript</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;XTextListener&quot;</span><span class="p">,</span> <span class="s">&quot;textChanged&quot;</span><span class="p">,</span>
                       <span class="s">&quot;ShowEvent.ShowEvent.show&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>

  <span class="c1">// listen for focus loss</span>
  <span class="n">Forms</span><span class="p">.</span><span class="na">assignScript</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;XFocusListener&quot;</span><span class="p">,</span> <span class="s">&quot;focusLost&quot;</span><span class="p">,</span>
                       <span class="s">&quot;ShowEvent.ShowEvent.show&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>

  <span class="c1">// listen for a key press</span>
  <span class="n">Forms</span><span class="p">.</span><span class="na">assignScript</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;XKeyListener&quot;</span><span class="p">,</span> <span class="s">&quot;keyPressed&quot;</span><span class="p">,</span>
                       <span class="s">&quot;ShowEvent.ShowEvent.show&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of textEvents()</span>

<span class="n">The</span> <span class="nf">buttonEvent</span><span class="p">()</span> <span class="n">method</span> <span class="n">is</span> <span class="nf">a</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">one</span><span class="o">-</span><span class="n">liner</span><span class="p">:</span>

<span class="c1">// part of BuildForm.java...</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">buttonEvent</span><span class="p">(</span><span class="n">XPropertySet</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Forms</span><span class="p">.</span><span class="na">assignScript</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s">&quot;XActionListener&quot;</span><span class="p">,</span> <span class="s">&quot;actionPerformed&quot;</span><span class="p">,</span>
                      <span class="s">&quot;ShowEvent.ShowEvent.show&quot;</span><span class="p">,</span> <span class="s">&quot;share&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>It's surprisingly tricky to decide which class and method names should be passed to
Forms.assignScript() since the only information about control events are the labels in
the Properties dialog (e.g. "Key pressed" in Figure 16). It can be hard to map these
labels onto suitable class and method names, especially since Office supports so many
event types. The best source for suitable listener classes is the online documentation
for XEventListener (see lodoc XEventListener); XEventListener is the superclass
of most listeners.</p>
<p>After the generated form has been saved, it should be opened in Office so its controls'
properties can be inspected. For example, the FIRSTNAME textfield's event
properties are now as in Figure 18.</p>
<p><img alt="" src="images/48-Event_Macros-18.png" /></p>
<p>Figure 18. The Properties Dialog for the FIRSTNAME textfield.</p>
<p>Figure 18 confirms that the class/method names used in textEvents() are correct.</p>
<p>Forms.assignScript() utilizes the XEventAttacherManager interface which offers
multiple methods for attaching and removing scripts from events. The code for
Forms.assignScript():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Forms class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assignScript</span><span class="p">(</span><span class="n">XPropertySet</span> <span class="n">controlProps</span><span class="p">,</span>
                    <span class="n">String</span> <span class="n">interfaceName</span><span class="p">,</span> <span class="n">String</span> <span class="n">methodName</span><span class="p">,</span>
                    <span class="n">String</span> <span class="n">scriptName</span><span class="p">,</span> <span class="n">String</span> <span class="n">loc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XChild</span> <span class="n">propsChild</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XChild</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">controlProps</span><span class="p">);</span>
    <span class="n">XIndexContainer</span> <span class="n">parentForm</span> <span class="o">=</span>
       <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XIndexContainer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">propsChild</span><span class="p">.</span><span class="na">getParent</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parentForm</span><span class="p">.</span><span class="na">getCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">XPropertySet</span> <span class="n">child</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                              <span class="n">parentForm</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">UnoRuntime</span><span class="p">.</span><span class="na">areSame</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">controlProps</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not find contol&#39;s pos in form&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">XEventAttacherManager</span> <span class="n">manager</span> <span class="o">=</span>
            <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XEventAttacherManager</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">parentForm</span><span class="p">);</span>
      <span class="n">manager</span><span class="p">.</span><span class="na">registerScriptEvent</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span>
           <span class="k">new</span> <span class="n">ScriptEventDescriptor</span><span class="p">(</span><span class="n">interfaceName</span><span class="p">,</span> <span class="n">methodName</span><span class="p">,</span>
                   <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;Script&quot;</span><span class="p">,</span>
                   <span class="s">&quot;vnd.sun.star.script:&quot;</span><span class="o">+</span><span class="n">scriptName</span> <span class="o">+</span>
                       <span class="s">&quot;?language=Java&amp;location=&quot;</span> <span class="o">+</span> <span class="n">loc</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span> <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span> <span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of assignScript()</span>
</code></pre></div>
<p>The first half of assignScript() calculates the control's index position inside the
parent's form. An index is used by most XEventAttacherManager methods to refer to
a control.</p>
<p>The last part of assignScript() uses XEventAttacherManager.registerScriptEvent() to
attach the script to the control's event. A ScriptEventDescriptor object is constructed
from five arguments: the listener's class name, the method to be called in the listener,
any extra data for the method (which is "" here), the script type (which can be "Script"
or "Basic"), and the macro's full name.</p>
<p>If you're unsure about the full name, then use my ListMacros.java or FindMacros.java
to display macro details. For example:</p>
<div class="highlight"><pre><span></span><code>run FindMacros ShowEvent
</code></pre></div>
<p>produces:</p>
<div class="highlight"><pre><span></span><code><span class="n">Matching</span> <span class="n">Macros</span> <span class="n">in</span> <span class="n">Office</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">vnd</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">script</span><span class="p">:</span><span class="n">ShowEvent</span><span class="p">.</span><span class="na">ShowEvent</span><span class="p">.</span><span class="na">show</span><span class="o">?</span>
                                <span class="n">language</span><span class="o">=</span><span class="n">Java</span><span class="o">&amp;</span><span class="n">location</span><span class="o">=</span><span class="n">share</span>
</code></pre></div>
<p>"ShowEvent.ShowEvent.show" and "share" are passed to Forms.assignScript() as its
last two arguments:</p>
<p><code>java
// part of BuildForm.java...
Forms.assignScript(props, "XTextListener", "textChanged",
                       "ShowEvent.ShowEvent.show", "share");</code></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="47-Calc_Add-ins.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 47. Calc Add-ins" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 47. Calc Add-ins
            </div>
          </div>
        </a>
      
      
        
        <a href="49-Ext_Doc_Event_Macros.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 49. Extension and Document Event Macros" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 49. Extension and Document Event Macros
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>