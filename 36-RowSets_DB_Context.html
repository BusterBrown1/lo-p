
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/36-RowSets_DB_Context.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Chapter 36. Using RowSets and Database Context - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-36-using-rowsets-and-database-context" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 36. Using RowSets and Database Context
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 36. Using RowSets and Database Context
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="36-RowSets_DB_Context.html" class="md-nav__link md-nav__link--active">
        Chapter 36. Using RowSets and Database Context
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-using-rowsets" class="md-nav__link">
    1.  Using RowSets
  </a>
  
    <nav class="md-nav" aria-label="1.  Using RowSets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-to-the-row-set" class="md-nav__link">
    Listening to the Row Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#termination-problem-after-closing-a-row-set" class="md-nav__link">
    Termination Problem after Closing a Row Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-the-database-context" class="md-nav__link">
    2.  Using the Database Context
  </a>
  
    <nav class="md-nav" aria-label="2.  Using the Database Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-registered-data-sources" class="md-nav__link">
    2.1.  Registered Data Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-accessing-a-file-using-a-data-source" class="md-nav__link">
    2.2.  Accessing a File Using a Data Source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-copying-data-from-base-to-calc" class="md-nav__link">
    3.  Copying Data From Base To Calc
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-using-rowsets" class="md-nav__link">
    1.  Using RowSets
  </a>
  
    <nav class="md-nav" aria-label="1.  Using RowSets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-to-the-row-set" class="md-nav__link">
    Listening to the Row Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#termination-problem-after-closing-a-row-set" class="md-nav__link">
    Termination Problem after Closing a Row Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-the-database-context" class="md-nav__link">
    2.  Using the Database Context
  </a>
  
    <nav class="md-nav" aria-label="2.  Using the Database Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-registered-data-sources" class="md-nav__link">
    2.1.  Registered Data Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-accessing-a-file-using-a-data-source" class="md-nav__link">
    2.2.  Accessing a File Using a Data Source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-copying-data-from-base-to-calc" class="md-nav__link">
    3.  Copying Data From Base To Calc
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/flywire/lo-p/edit/main/docs/36-RowSets_DB_Context.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="chapter-36-using-rowsets-and-database-context">Chapter 36. Using RowSets and Database Context<a class="headerlink" href="#chapter-36-using-rowsets-and-database-context" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Using RowSets;
Using the Database
Context; Copying Data
From Base To Calc</p>
<p>Example folders: "Base
Tests" and "Utils"</p>
</div>
<p>This chapter looks at programming with the XRowSet and
XDatabaseContext interfaces, which were labelled (2) and
(3) in Figure 5 of the Chapter 34. Figure 1 repeats that
figure but without the alternative query approaches (labels (1) and (4)).</p>
<p><img alt="" src="images/36-RowSets_DB_Context-1.png" /></p>
<p>Figure 1.  Querying a Base Document.</p>
<h2 id="1-using-rowsets">1.  Using RowSets<a class="headerlink" href="#1-using-rowsets" title="Permanent link">&para;</a></h2>
<p>Base's RowSet offers much the same functionality as JDBC's RowSet in that it
abstracts away from connecting Java to a database towards queries applied to general
tabular data. This means that a row set can access different types of information
include flat files, spreadsheets, and ODB files.</p>
<p>The JDBC RowSet is implemented in a different way from the sdb row set – JDBC
supports several RowSet subclasses, including JdbcRowSet, CachedRowSet and
WebRowSet, none of which are present in the Base API. Instead the different ways of
manipulating files are specified by setting properties in a RowSet object before it is
executed.</p>
<p>Figure 2 shows that row set properties are distributed between two RowSet services,
one in the sdbc module, the other in the higher-level sdb module.</p>
<p><img alt="" src="images/36-RowSets_DB_Context-2.png" /></p>
<p>Figure 2. The RowSet Services and Interfaces.</p>
<p>Although the XRowSet interface's most important method is execute(), it inherits
XResultSet which adds other useful functions. One benefit is that an executed row set,
which contains results, can be passed to the BaseTablePrinter class for ASCII
printing.</p>
<p>Aside from the documentation webpages for the two RowSet services, a good
summary of row set properties can be found in "The RowSet Service" section of the
Developer's Guide in chapter 12. The same information is online at:
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Database/Usage">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Database/Usage</a> (or use
<code>loguide "Database usage"</code>).</p>
<p>My personal view is that the RowSet service is overly complex, trying to combine too
many ways of accessing databases and tabular data. It's easier to use separate services
aimed at specific forms of data. For example, XOfficeDatabaseDocument for ODB
files, XDatabaseContext for URLs, and XDriverManager for none-ODB data such as
CSV files and e-mail address books. I'll discuss XDatabaseContext  in section 2 and
XDriverManager in the next chapter.</p>
<p>Another 'black mark' against RowSet is that the my example below hangs after
closing a row set; Lo.killOffice() must be called to end the program.</p>
<p>UseRowSets.java executes a row set containing a simple SQL query:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in UseRowSets.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">execQuery</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">killOffice</span><span class="p">();</span>    <span class="c1">// needed to clean-up after XRowSet</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>


<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">execQuery</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Initializing rowset...&quot;</span><span class="p">);</span>
    <span class="n">XRowSet</span> <span class="n">xRowSet</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">rowSetQuery</span><span class="p">(</span><span class="s">&quot;liangTables.odb&quot;</span><span class="p">,</span>
          <span class="s">&quot;SELECT \&quot;firstName\&quot;, \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">);</span>

    <span class="c1">// add rowset listener</span>
    <span class="n">xRowSet</span><span class="p">.</span><span class="na">addRowSetListener</span><span class="p">(</span> <span class="k">new</span> <span class="n">XRowSetListener</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cursorMoved</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">e</span><span class="p">)</span>
      <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Cursor moved&quot;</span><span class="p">);</span>  <span class="p">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rowChanged</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">e</span><span class="p">)</span>
      <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Row changed&quot;</span><span class="p">);</span>  <span class="p">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rowSetChanged</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">e</span><span class="p">)</span>
      <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;RowSet changed&quot;</span><span class="p">);</span>  <span class="p">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disposing</span><span class="p">(</span><span class="n">EventObject</span> <span class="n">e</span><span class="p">)</span>
      <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;RowSet being destroyed&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Executing rowset...&quot;</span><span class="p">);</span>
    <span class="n">xRowSet</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>

    <span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">xRowSet</span><span class="p">);</span>
      <span class="c1">// possible since XRowSet is a subclass of XResultSet</span>

    <span class="c1">// dispose of row set</span>
    <span class="n">XComponent</span> <span class="n">xComp</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xRowSet</span><span class="p">);</span>
    <span class="n">xComp</span><span class="p">.</span><span class="na">dispose</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of execQuery()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The tricky initialization of RowSet properties is handled by Base.rowSetQuery():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XRowSet</span> <span class="nf">rowSetQuery</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">String</span> <span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XRowSet</span> <span class="n">xRowSet</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XRowSet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                 <span class="s">&quot;com.sun.star.sdb.RowSet&quot;</span><span class="p">);</span>

  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xRowSet</span><span class="p">,</span> <span class="s">&quot;DataSourceName&quot;</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xRowSet</span><span class="p">,</span> <span class="s">&quot;CommandType&quot;</span><span class="p">,</span> <span class="n">CommandType</span><span class="p">.</span><span class="na">COMMAND</span><span class="p">);</span>
                                       <span class="c1">// TABLE, QUERY or COMMAND</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">xRowSet</span><span class="p">,</span> <span class="s">&quot;Command&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">);</span>
         <span class="c1">// command could be a table, query name, or SQL,</span>
         <span class="c1">// depending on the CommandType</span>

  <span class="c1">// set these if your database requires a login</span>
  <span class="c1">// Props.setProperty(xRowSet, &quot;User&quot;, &quot;&quot;);</span>
  <span class="c1">// Props.setProperty(xRowSet, &quot;Password&quot;, &quot;&quot;);</span>

  <span class="c1">// more attributes are defined in sdb and sdbc Rowset...</span>


  <span class="k">return</span> <span class="n">xRowSet</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of rowSetQuery()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Base.rowSetQuery() shows that initializing a row set is less work than directly
obtaining an ODB data source, connecting to the database, and creating a Statement
service. The equivalent of executing a statement is the call to XRowset.execute(),
carried out by execQuery() in UseRowSets.java:
xRowSet.execute();
Once the row set has been populated, it's passed to BaseTablePrinter.printResultSet()
where it's treated as an XResultSet instance:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in execQuery()...</span>
<span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">xRowSet</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="listening-to-the-row-set">Listening to the Row Set<a class="headerlink" href="#listening-to-the-row-set" title="Permanent link">&para;</a></h4>
<p>execQuery() shows how it's possible to attach a listener to a row set, which is woken
up when the result set cursor moves or the set is changed.</p>
<p>The anonymous XRowSetListener in execQuery() prints a short message if any of its
handlers are triggered; their output can be seen in Figure 3.</p>
<p><img alt="" src="images/36-RowSets_DB_Context-3.png" /></p>
<p>Figure 3. The Execution of UseRowSets.java.</p>
<h4 id="termination-problem-after-closing-a-row-set">Termination Problem after Closing a Row Set<a class="headerlink" href="#termination-problem-after-closing-a-row-set" title="Permanent link">&para;</a></h4>
<p>The disposal of the row set is easy:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// at the end of execQuery()...</span>
<span class="n">XComponent</span> <span class="n">xComp</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xRowSet</span><span class="p">);</span>
<span class="n">xComp</span><span class="p">.</span><span class="na">dispose</span><span class="p">();</span>
</code></pre></div>
</div>
</div>
</div>
<p>Back in main(), Lo.closeOffice() is executed, returns, but then the program hangs. A
call to Lo.killOffice() (which utilizes Window's taskkill) is needed to terminate the
program and Office.</p>
<h2 id="2-using-the-database-context">2.  Using the Database Context<a class="headerlink" href="#2-using-the-database-context" title="Permanent link">&para;</a></h2>
<p>Sdbc's XDatabaseContext lets the programmer access Base's database context, which
is a container for data sources (see Figure 1). Data sources map names to databases,
hiding the low-level details of the driver's protocol, and whether the database is
embedded in an ODB file or located at the other end of a URL. Base's database
context performs a similar role to JNDI for data sources in JDBC.</p>
<p>Figure 4 shows the DatabaseContext service and some of its important interfaces.</p>
<p><img alt="" src="images/36-RowSets_DB_Context-4.png" /></p>
<p>Figure 4. The DatabaseContext Service and Interfaces.</p>
<h3 id="21-registered-data-sources">2.1.  Registered Data Sources<a class="headerlink" href="#21-registered-data-sources" title="Permanent link">&para;</a></h3>
<p>It's possible to add (or register) new data sources to Base's database context, but I
won't be using that feature. Currently registered sources are listed by
Base.printRegisteredDataSources():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printRegisteredDataSources</span><span class="p">()</span>
<span class="c1">// print all registered datasources</span>
<span class="p">{</span>
  <span class="n">XDatabaseRegistrations</span> <span class="n">dbRegs</span> <span class="o">=</span>
       <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XDatabaseRegistrations</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                           <span class="s">&quot;com.sun.star.sdb.DatabaseContext&quot;</span><span class="p">);</span>

  <span class="n">XNameAccess</span> <span class="n">nmsAccess</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XNameAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                             <span class="s">&quot;com.sun.star.sdb.DatabaseContext&quot;</span><span class="p">);</span>

  <span class="n">String</span> <span class="n">dsNames</span><span class="o">[]</span> <span class="o">=</span> <span class="n">nmsAccess</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Registered Data Sources (&quot;</span> <span class="o">+</span>
                                  <span class="n">dsNames</span><span class="p">.</span><span class="na">length</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dsNames</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">dbLoc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">dbLoc</span> <span class="o">=</span> <span class="n">dbRegs</span><span class="p">.</span><span class="na">getDatabaseLocation</span><span class="p">(</span><span class="n">dsNames</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">dsNames</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; in &quot;</span> <span class="o">+</span> <span class="n">dbLoc</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of printRegisteredDataSources()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The method iterates through the data source names in the database context, printing
the locations of their associated databases. The output for my version of Base is:</p>
<div class="highlight"><pre><span></span><code>Registered Data Sources (1)
  Bibliography in file:///C:/Users/Dell/AppData/Roaming/LibreOffice/4/user/database/biblio.odb
</code></pre></div>
<p>Only a "Bibliography" data source is stored in the database context, which maps to an
ODB file called biblio.odb.</p>
<h3 id="22-accessing-a-file-using-a-data-source">2.2.  Accessing a File Using a Data Source<a class="headerlink" href="#22-accessing-a-file-using-a-data-source" title="Permanent link">&para;</a></h3>
<p>New data sources can be created in the database context, which offers a way to access
ODB files without having to explicitly open them as documents. For example, the
DataSourcer.java example shows how "liangTables.odb" can be queried without
having to first instantiate XOfficeDatabaseDocument (i.e. without opening the ODB
file).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in DataSourcer.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">printRegisteredDataSources</span><span class="p">();</span>  <span class="c1">// explained above</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span>
          <span class="n">Base</span><span class="p">.</span><span class="na">getFileDataSource</span><span class="p">(</span><span class="s">&quot;liangTables.odb&quot;</span><span class="p">);</span>
          <span class="c1">// no office document opened</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// no login/password</span>

    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
        <span class="s">&quot;SELECT \&quot;firstName\&quot;, \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">killOffice</span><span class="p">();</span>   <span class="c1">// needed when Base.getFileDataSource() used</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The database context is manipulated by Base.getFileDataSource():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XDataSource</span> <span class="nf">getFileDataSource</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">fileURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="n">XNameAccess</span> <span class="n">nmsAccess</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XNameAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                            <span class="s">&quot;com.sun.star.sdb.DatabaseContext&quot;</span><span class="p">);</span>
    <span class="n">XDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDataSource</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                               <span class="n">nmsAccess</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ds</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No data source for &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Found data source for &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">ds</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to access data source for &quot;</span> <span class="o">+</span> <span class="n">fnm</span> <span class="o">+</span>
                       <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getFileDataSource()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The database context's XNameAccess interface is used to map the supplied filename
to a data source.</p>
<p>Back in main() of DataSourcer.java, the Student table in the database is queried using
the data source, and then the program closes the connection and Office. There's no
need to close an XOfficeDatabaseDocument document, (e.g. by calling
Base.closeBaseDoc(dbDoc)) since one was never opened.</p>
<p>Unfortunately, DataSourcer.java needs to call Lo.killOffice() or the program will
hang after the return of Lo.closeOffice(). This is similar to the row set problem in
UseRowSets.java in the previus section.</p>
<h2 id="3-copying-data-from-base-to-calc">3.  Copying Data From Base To Calc<a class="headerlink" href="#3-copying-data-from-base-to-calc" title="Permanent link">&para;</a></h2>
<p>There are a few places in my Office support classes where the code assumes only one
document is open at a time. For programs that copy data from one document to
another, problems can be avoided by using an intermediate data structure. The usual
strategy is to read the data from the first document,  then close the file before the
second document is opened, and then the data is added to it.</p>
<p>This situation arises when copying database records (stored in a Base document) to a
spreadsheet (a Calc document). An alternative solution to using an intermediate data
structure is to access the database as a data source instead of as a
XOfficeDatabaseDocument object. This means that only a single Calc document is
manipulated by the program so no problems arise with my support classes. This
approach is implemented in StoreInCalc.java:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// globals</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;liangTables.odb&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CALC_FNM</span> <span class="o">=</span> <span class="s">&quot;liangCalc.ods&quot;</span><span class="p">;</span>


<span class="c1">// in StoreInCalc.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Created a Calc document&quot;</span><span class="p">);</span>

  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No spreadsheet found&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>  <span class="c1">// show the new sheet</span>

  <span class="n">Object</span><span class="o">[][]</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">queryDB</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span>
         <span class="s">&quot;SELECT \&quot;firstName\&quot;, \&quot;lastName\&quot; FROM \&quot;Student\&quot;&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rsa</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">fillSheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">rsa</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>  <span class="c1">// wait for visible sheet to be changed</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">CALC_FNM</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>

  <span class="c1">// Lo.killOffice();   // needed when getFileDataSource() used</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The program creates a XSpreadsheetDocument object, which is left open while
queryDB() queries the database. The result set is returned as a 2D array called rsa,
which fillSheet() uses to populate the spreadsheet. The document is saved and Office
closed.</p>
<p>queryDB() accesses the database as a data source, not as a document:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in StoreInCalc.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">queryDB</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">String</span> <span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">rsa</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">getFileDataSource</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">rsa</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">getResultSetArr</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">rsa</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of queryDB()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Base.getResultSetArr() returns the result set as a 2D array of Objects. It builds the
array by traversing the result set a row at a time, creating a one-dimensional array for
each row. The data structure could be a defined as a 2D array of strings, except that
the Calc API requires an object array fillSheet() uses XCellRangeData.setDataArray()
to add the array to the sheet:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in StoreInCalc.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">fillSheet</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">rsa</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="na">getCellRangeByPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="n">rsa</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rsa</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">XCellRangeData</span> <span class="n">xData</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XCellRangeData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cellRange</span><span class="p">);</span>
    <span class="n">xData</span><span class="p">.</span><span class="na">setDataArray</span><span class="p">(</span><span class="n">rsa</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not writes values to cells&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of fillSheet()</span>
</code></pre></div>
</div>
</div>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="35-Examining_Base_Docs.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 35. Examining Base Documents" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 35. Examining Base Documents
            </div>
          </div>
        </a>
      
      
        
        <a href="37-Driver_Manager.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 37. Using the Driver Manager" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 37. Using the Driver Manager
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>