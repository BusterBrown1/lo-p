
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/20-Spreadsheet_Manipulation.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Chapter 20. Spreadsheet Displaying and Creation - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-20-spreadsheet-displaying-and-creation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 20. Spreadsheet Displaying and Creation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 20. Spreadsheet Displaying and Creation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link md-nav__link--active">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-displaying-a-document" class="md-nav__link">
    1.  Displaying a Document
  </a>
  
    <nav class="md-nav" aria-label="1.  Displaying a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-read-only-and-protected-viewing" class="md-nav__link">
    1.1.  Read-only and Protected Viewing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-changing-the-active-sheet" class="md-nav__link">
    1.2.  Changing the Active Sheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-sheet-names" class="md-nav__link">
    1.3.  Sheet Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-zooming" class="md-nav__link">
    1.4.  Zooming
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-a-document" class="md-nav__link">
    2.  Creating a Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Creating a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-switching-between-cell-names-cell-ranges-and-positions" class="md-nav__link">
    2.1.  Switching between Cell Names, Cell Ranges, and Positions
  </a>
  
    <nav class="md-nav" aria-label="2.1.  Switching between Cell Names, Cell Ranges, and Positions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cell-name-manipulation" class="md-nav__link">
    Cell Name Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cell-range-manipulation" class="md-nav__link">
    Cell Range Manipulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-changing-cell-values" class="md-nav__link">
    2.2.  Changing Cell Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-storing-2d-arrays-of-data" class="md-nav__link">
    2.3.  Storing 2D Arrays of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-storing-rows-of-data" class="md-nav__link">
    2.4.  Storing Rows of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-storing-columns-of-data" class="md-nav__link">
    2.5.  Storing Columns of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-adding-a-picture" class="md-nav__link">
    2.6.  Adding a Picture
  </a>
  
    <nav class="md-nav" aria-label="2.6.  Adding a Picture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warning-when-drawing" class="md-nav__link">
    Warning when Drawing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-adding-a-chart" class="md-nav__link">
    2.7.  Adding a Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-displaying-a-document" class="md-nav__link">
    1.  Displaying a Document
  </a>
  
    <nav class="md-nav" aria-label="1.  Displaying a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-read-only-and-protected-viewing" class="md-nav__link">
    1.1.  Read-only and Protected Viewing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-changing-the-active-sheet" class="md-nav__link">
    1.2.  Changing the Active Sheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-sheet-names" class="md-nav__link">
    1.3.  Sheet Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-zooming" class="md-nav__link">
    1.4.  Zooming
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-a-document" class="md-nav__link">
    2.  Creating a Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Creating a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-switching-between-cell-names-cell-ranges-and-positions" class="md-nav__link">
    2.1.  Switching between Cell Names, Cell Ranges, and Positions
  </a>
  
    <nav class="md-nav" aria-label="2.1.  Switching between Cell Names, Cell Ranges, and Positions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cell-name-manipulation" class="md-nav__link">
    Cell Name Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cell-range-manipulation" class="md-nav__link">
    Cell Range Manipulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-changing-cell-values" class="md-nav__link">
    2.2.  Changing Cell Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-storing-2d-arrays-of-data" class="md-nav__link">
    2.3.  Storing 2D Arrays of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-storing-rows-of-data" class="md-nav__link">
    2.4.  Storing Rows of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-storing-columns-of-data" class="md-nav__link">
    2.5.  Storing Columns of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-adding-a-picture" class="md-nav__link">
    2.6.  Adding a Picture
  </a>
  
    <nav class="md-nav" aria-label="2.6.  Adding a Picture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warning-when-drawing" class="md-nav__link">
    Warning when Drawing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-adding-a-chart" class="md-nav__link">
    2.7.  Adding a Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/flywire/lo-p/edit/main/docs/20-Spreadsheet_Manipulation.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="chapter-20-spreadsheet-displaying-and-creation">Chapter 20. Spreadsheet Displaying and Creation<a class="headerlink" href="#chapter-20-spreadsheet-displaying-and-creation" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Displaying a
Document; Read-only
and Protected Viewing;
Active Sheets; Sheet
Names; Zooming;
Creating a Document;
Cell Names and Ranges;
Cell Values; Data
Arrays; Rows and
Columns of Data;
Adding a Picture and a
Chart</p>
<p>Example folders: "Calc
Tests" and "Utils"</p>
</div>
<p>This chapter looks at two main topics: the display of an
existing spreadsheet document, and the creation of a new
document, based around two examples, ShowSheet.java
and BuildTable.java.</p>
<p>As part of displaying a document, I'll also describe how to
use read-only and protected viewing, change the active
sheet, use sheet names, and adjust the window view size
by zooming.</p>
<p>Document creation illustrates the use of cell names and
ranges, the setting of cell data using arrays, rows, and columns, and adding a picture
and a chart to a sheet.</p>
<h2 id="1-displaying-a-document">1.  Displaying a Document<a class="headerlink" href="#1-displaying-a-document" title="Permanent link">&para;</a></h2>
<p>The ShowSheet.java example shows how to open a spreadsheet document, and
display its first sheet. If the program is called with a filename argument, then the
document is saved to that file before the program closes. The extension of the output
filename is used to determine the exported file type.  For example:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">run</span> <span class="n">ShowSheet</span> <span class="n">totals</span><span class="p">.</span><span class="na">ods</span> <span class="n">show</span><span class="p">.</span><span class="na">pdf</span>
</code></pre></div>
</div>
</div>
</div>
<p>displays the totals.ods spreadsheet, and saves it as a PDF file. Alternatively:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">run</span> <span class="n">ShowSheet</span> <span class="n">sorted</span><span class="p">.</span><span class="na">csv</span> <span class="n">sorted</span><span class="p">.</span><span class="na">html</span>
</code></pre></div>
</div>
</div>
</div>
<p>opens the CSV file as a Calc document, and saves it as HTML.</p>
<p>The main() function of ShowSheet.java:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in ShowSheet.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">outFnm</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run ShowSheet fnm [out-fnm]&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">outFnm</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">gotoCell</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">);</span>   <span class="c1">// move view to top of sheet</span>

  <span class="c1">// XSpreadsheet sheet = Calc.getSheet(doc, 0);  // not needed here</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>  <span class="c1">// wait for user to press &lt;ENTER&gt;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">outFnm</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">outFnm</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Calc.openDoc() opens the document, returning an XSpreadsheetDocument reference:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XSpreadsheetDocument</span> <span class="nf">openDoc</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span>
                         <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">getSSDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of openDoc()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XSpreadsheetDocument</span> <span class="nf">getSSDoc</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Info</span><span class="p">.</span><span class="na">isDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Lo</span><span class="p">.</span><span class="na">CALC_SERVICE</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Not a spreadsheet doc; closing&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">ssDoc</span> <span class="o">=</span>
                  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ssDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Not a spreadsheet doc; closing&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ssDoc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getSSDoc()</span>
</code></pre></div>
</div>
</div>
</div>
<p>First Lo.openDoc() returns an XComponent reference, then getSSDoc() converts it to
XSpreadsheetDocument. This conversion will fail if the input document isn't a
spreadsheet.</p>
<p>GUI.setVisible(true) causes Office to display the spreadsheet's active sheet, which is
the one that was being worked on when the file was previously saved. In addition, the
application will display the cell or cells selected in the sheet at that time. The selection
can be changed by calling Calc.gotoCell():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">gotoCell</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">,</span>
                                               <span class="n">String</span> <span class="n">cellName</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XFrame</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">getController</span><span class="p">(</span><span class="n">doc</span><span class="p">).</span><span class="na">getFrame</span><span class="p">();</span>
  <span class="n">gotoCell</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cellName</span><span class="p">);</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XController</span> <span class="nf">getController</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">();</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">gotoCell</span><span class="p">(</span><span class="n">XFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">String</span> <span class="n">cellName</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s">&quot;GoToCell&quot;</span><span class="p">,</span>
            <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;ToPoint&quot;</span><span class="p">,</span> <span class="n">cellName</span><span class="p">));</span>  <span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Any changes to the document's view requires a reference to its controller. The active
cell is changed by sending a "GoToCell" dispatch to the controller's frame.
"GoToCell" requires a cell name argument, which is encoded as a property array
containing a single "ToPoint" property.</p>
<p>Calc.getSheet() returns a reference to the currently active sheet. but that line is
commented out in ShowSheet.java, since it's not needed. getSheet() is implemented
using code similar to that described in the previous chapter:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XSpreadsheet</span> <span class="nf">getSheet</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">,</span>
                                              <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XSpreadsheets</span> <span class="n">sheets</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getSheets</span><span class="p">();</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XIndexAccess</span> <span class="n">xSheetsIdx</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XIndexAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">sheets</span><span class="p">);</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSpreadsheet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                <span class="n">xSheetsIdx</span><span class="p">.</span><span class="na">getByIndex</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access spreadsheet: &quot;</span> <span class="o">+</span> <span class="n">index</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sheet</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getSheet()</span>
</code></pre></div>
</div>
</div>
</div>
<p>If the user calls ShowSheet.java with a filename argument, then Lo.saveDoc()
performs a save to that file. saveDoc() utilizes Lo.ext2Format() to map the filename's
extension (e.g. "pdf", "html", "xhtml") and the document type (in this case, a
spreadsheet) to a suitable output format. The function consists of a long switch
statement which decides on the most suitable mapping, as illustrated by the code
fragment:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">ext2Format</span><span class="p">(</span><span class="kt">int</span> <span class="n">docType</span><span class="p">,</span> <span class="n">String</span> <span class="n">ext</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s">&quot;doc&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;MS Word 97&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="s">&quot;docx&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;Office Open XML Text&quot;</span><span class="p">;</span>
       <span class="p">:</span>
       <span class="p">:</span>   <span class="c1">// many more cases</span>

    <span class="k">case</span> <span class="s">&quot;pdf&quot;</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;writer_pdf_Export&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;impress_pdf_Export&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">DRAW</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;draw_pdf_Export&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">CALC</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;calc_pdf_Export&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">MATH</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;math_pdf_Export&quot;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="s">&quot;writer_pdf_Export&quot;</span><span class="p">;</span>
        <span class="p">:</span>  <span class="c1">// many more cases</span>
<span class="p">}</span>   <span class="c1">// end of ext2Format()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The "pdf" case is selected when the output file extension is "pdf", but the export
format also depends on the Office document. For ShowSheet.java, the docType value
will be Lo.CALC, which causes ext2Format() to return "calc_pdf_Export".</p>
<p>Lo.ext2Format() is very far from comprehensive, but understands Office and MS
spreadsheet formats, CSV, RTF, text, HTML, XHTML, and PDF. Other mappings
can be added as required.</p>
<h3 id="11-read-only-and-protected-viewing">1.1.  Read-only and Protected Viewing<a class="headerlink" href="#11-read-only-and-protected-viewing" title="Permanent link">&para;</a></h3>
<p>One variant of ShowSheet.java prevents a user from changing the spreadsheet.
Unfortunately, implementing this by opening the document read-only isn't particularly
robust because Office always displays a message asking if the user wants to override
the read-only setting. Nevertheless, the code is short:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// commented out in ShowSheet.java</span>
<span class="n">XComponent</span> <span class="n">cDoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openReadOnlyDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
<span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSSDoc</span><span class="p">(</span><span class="n">cDoc</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>openReadOnlyDoc() calls Lo.openDoc() with the "ReadOnly" property set to true:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XComponent</span> <span class="nf">openReadOnlyDoc</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">,</span>
                                         <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">openDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span>
                <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;Hidden&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="s">&quot;ReadOnly&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>If you want to actually stop the user from changing the spreadsheet, then it must be
protected, using the XProtectable interface:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XProtectable</span> <span class="n">pro</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XProtectable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">pro</span><span class="p">.</span><span class="na">protect</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>XProtectable.protect() assigns a password to the sheet (in this example, "foobar"),
which the user must supply in order to change any data .</p>
<p>Document-level protection isn't supported in the current version of Office. The best
we can do is to apply protection to individual sheets. Namely:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// commented out in ShowSheet.java</span>
<span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// get sheet 1</span>
<span class="n">XProtectable</span> <span class="n">pro</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XProtectable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">sheet</span><span class="p">);</span>
<span class="n">pro</span><span class="p">.</span><span class="na">protect</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">);</span>

<span class="c1">// query the user for the password</span>
<span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(</span><span class="s">&quot;Sheet protection&quot;</span><span class="p">,</span> <span class="s">&quot;Supply password:&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">((</span><span class="n">pwd</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">pwd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">))</span> <span class="p">{</span>  <span class="c1">// check input</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Password correct&quot;</span><span class="p">);</span>
  <span class="n">pro</span><span class="p">.</span><span class="na">unprotect</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Password incorrect&quot;</span><span class="p">);</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">showJMessageBox</span><span class="p">(</span><span class="s">&quot;Password Status&quot;</span><span class="p">,</span> <span class="s">&quot;Password incorrect&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code fragment above shows how to query the user for the password.
GUI.getPassword() displays a dialog window which includes a Java JPasswordField
component for hiding the entered data:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">String</span> <span class="n">inputMsg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">JLabel</span> <span class="n">jl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JLabel</span><span class="p">(</span><span class="n">inputMsg</span><span class="p">);</span>
  <span class="n">JPasswordField</span> <span class="n">jpf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JPasswordField</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>
  <span class="n">Object</span><span class="o">[]</span> <span class="n">ob</span> <span class="o">=</span> <span class="p">{</span><span class="n">jl</span><span class="p">,</span> <span class="n">jpf</span><span class="p">};</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                                    <span class="n">JOptionPane</span><span class="p">.</span><span class="na">OK_CANCEL_OPTION</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">JOptionPane</span><span class="p">.</span><span class="na">OK_OPTION</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">jpf</span><span class="p">.</span><span class="na">getPassword</span><span class="p">());</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getPassword()</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="12-changing-the-active-sheet">1.2.  Changing the Active Sheet<a class="headerlink" href="#12-changing-the-active-sheet" title="Permanent link">&para;</a></h3>
<p>Another variation of ShowSheet allows the user to specify which sheet to make
active, and so be displayed in Office. It's not enough to execute Calc.getSheet() with a
sheet index; Calc.setActiveSheet() must also be called to make that sheet active:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setActiveSheet</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">,</span>
                                     <span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XSpreadsheetView</span> <span class="n">ssView</span> <span class="o">=</span>
          <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSpreadsheetView</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">getController</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
  <span class="n">ssView</span><span class="p">.</span><span class="na">setActiveSheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setActiveSheet()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Calc.setActiveSheet() converts the controller interface for the document into an
XSpreadsheetView, which is the main interface for the SpreadsheetView service (see
Figure 1).</p>
<p><img alt="" src="images/20-Spreadsheet_Manipulation-1.png" /></p>
<p>Figure 1. The SpreadsheetView Services and Interfaces.</p>
<p>SpreadsheetView implements a number of interfaces for affecting the user's view of a
document. View-related properties are stored in the inherited
SpreadsheetViewSettings class, which can be listed by calling Props.showObjProps():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// commented out in ShowSheet.java</span>
<span class="n">XSpreadsheetView</span> <span class="n">ssView</span> <span class="o">=</span>
          <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSpreadsheetView</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">getController</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
<span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Spreadsheet view&quot;</span><span class="p">,</span> <span class="n">ssView</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="13-sheet-names">1.3.  Sheet Names<a class="headerlink" href="#13-sheet-names" title="Permanent link">&para;</a></h3>
<p>Default spreadsheet names use "Sheet" followed by a positive integer. For example, a
new document will name its first sheet "Sheet1". Calc.getSheet() can accept a sheet
name, as in the following code which makes "Sheet1" active:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in ShowSheet.java</span>
<span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;Sheet1&quot;</span><span class="p">);</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setActiveSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">sheet</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>All the sheet names in a document can be accessed via Calc.getSheetNames(), and a
sheet's name can be changed by Calc.setSheetName():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getSheetNames</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XSpreadsheets</span> <span class="n">sheets</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getSheets</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">sheets</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setSheetName</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XNamed</span> <span class="n">xNamed</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XNamed</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">sheet</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xNamed</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access spreadsheet&quot;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">xNamed</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setSheetName()</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="14-zooming">1.4.  Zooming<a class="headerlink" href="#14-zooming" title="Permanent link">&para;</a></h3>
<p>Zooming the view of a document is done by adjusting properties in
SpreadsheetViewSettings (see Figure 1 above). The "ZoomType" property specifies
the kind of zooming, which may be a size percentage or a constant indicating a
particular zooming amount. The constants are defined in Calc.java:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">OPTIMAL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">PAGE_WIDTH</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">ENTIRE_PAGE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">BY_VALUE</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">PAGE_WIDTH_EXACT</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
<p>The constants are understood by Calc.zoom():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:1"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">zoom</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">short</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XController</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="n">getController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="s">&quot;ZoomType&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>For example, the entire sheet can be made visible by calling:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:1"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">Calc</span><span class="p">.</span><span class="na">zoom</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Calc</span><span class="p">.</span><span class="na">ENTIRE_PAGE</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>For percentage zooming, the value must be assigned to the "ZoomValue" property.
This is handled by Calc.zoomValue():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:1"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">zoomValue</span><span class="p">(</span><span class="n">XSpreadsheetDocument</span> <span class="n">doc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XController</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="n">getController</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="s">&quot;ZoomType&quot;</span><span class="p">,</span> <span class="n">BY_VALUE</span><span class="p">);</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="s">&quot;ZoomValue&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="2-creating-a-document">2.  Creating a Document<a class="headerlink" href="#2-creating-a-document" title="Permanent link">&para;</a></h2>
<p>The BuildTable.java example shows how to create a new spreadsheet document,
populate it with data, apply cell styling, and save it to a file. I'll look at styling in the
next chapter, and will concentrate here on the different ways to add data to a sheet.</p>
<p>The main() function of BuildTable.java is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:1"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildTable.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XSpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">XSpreadsheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getSheet</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">convertAddresses</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>

  <span class="c1">// uncomment one of these build methods</span>
  <span class="c1">// buildCells(sheet);</span>
  <span class="c1">// buildRows(sheet);</span>
  <span class="c1">// buildCols(sheet);</span>
  <span class="n">buildArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;buildTable.ods&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>main() can call one of four different build methods to demonstrate various Calc.java
functions for filling cells and cell ranges. convertAddresses() illustrates the Calc.java
methods for converting between cell names and positions, and between cell range
names and position intervals.</p>
<h3 id="21-switching-between-cell-names-cell-ranges-and-positions">2.1.  Switching between Cell Names, Cell Ranges, and Positions<a class="headerlink" href="#21-switching-between-cell-names-cell-ranges-and-positions" title="Permanent link">&para;</a></h3>
<p>Although the Calc.java get/set methods for cells, columns, rows, and cell ranges
support both name and position based addressing (e.g. "D5" and (3, 4)), it's still
sometimes necessary to convert between the different formats. convertAddresses()
demonstrates those methods:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:1"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildTable.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">convertAddresses</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// cell name &lt;--&gt; position</span>
  <span class="n">java</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">Point</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellPosition</span><span class="p">(</span><span class="s">&quot;AA2&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Position of AA2: (&quot;</span> <span class="o">+</span><span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span><span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="o">+</span><span class="s">&quot;)&quot;</span><span class="p">);</span>

  <span class="n">XCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">printCellAddress</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;AA2: &quot;</span> <span class="o">+</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellStr</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">));</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

  <span class="c1">// cell range name &lt;--&gt; position</span>
  <span class="n">java</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">Point</span><span class="o">[]</span> <span class="n">range</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRangePositions</span><span class="p">(</span><span class="s">&quot;A1:D5&quot;</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Range of A1:D5: (&quot;</span> <span class="o">+</span>
                      <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>  <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span>
           <span class="s">&quot;) -- (&quot;</span> <span class="o">+</span> <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>  <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span>  <span class="s">&quot;)&quot;</span><span class="p">);</span>

  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span>
           <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">y</span><span class="p">,</span> <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">y</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">printAddress</span><span class="p">(</span><span class="n">cellRange</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;A1:D5: &quot;</span> <span class="o">+</span>
             <span class="n">Calc</span><span class="p">.</span><span class="na">getRangeStr</span><span class="p">(</span><span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">y</span><span class="p">,</span>
                                <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">y</span><span class="p">));</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of convertAddresses()</span>
</code></pre></div>
</div>
</div>
</div>
<p>convertAddresses() prints the following:</p>
<div class="highlight"><pre><span></span><code>Position of AA2: (26, 1)
Cell: Sheet1.AA2
AA2: AA2

Range of A1:D5: (0, 0) -- (3, 4)
Range: Sheet1.A1:D5
A1:D5: A1:D5
</code></pre></div>
<h4 id="cell-name-manipulation">Cell Name Manipulation<a class="headerlink" href="#cell-name-manipulation" title="Permanent link">&para;</a></h4>
<p>Calc.getCellPosition() converts a cell name, such as "AA2", into a (column, row)
position coordinate, which it returns as a Java Point object. For "AA2" the result is
(26, 1), since the column labeled "AA" follows "Z" in a spreadsheet. The
implementation uses regular expression parsing of the input string to separate out the
alphabetic and numerical parts before processing them:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:1"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Point</span> <span class="nf">getCellPosition</span><span class="p">(</span><span class="n">String</span> <span class="n">cellName</span><span class="p">)</span>
<span class="p">{</span>
 <span class="n">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span> <span class="s">&quot;([a-zA-Z]+)([0-9]+)&quot;</span> <span class="p">);</span>
 <span class="n">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="na">matcher</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">matches</span><span class="p">())</span> <span class="p">{</span> 
 <span class="kt">int</span> <span class="n">nColumn</span> <span class="o">=</span> <span class="n">columnStringToNumber</span><span class="p">(</span> <span class="n">m</span><span class="p">.</span><span class="na">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">()</span> <span class="p">);</span>
 <span class="kt">int</span> <span class="n">nRow</span> <span class="o">=</span> <span class="n">rowStringToNumber</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">group</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
 <span class="k">return</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="n">nColumn</span><span class="p">,</span> <span class="n">nRow</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="k">else</span> <span class="p">{</span>
 <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No match found&quot;</span><span class="p">);</span>
 <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end of getCellPosition()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Calc.getCell() converts a position into an XCell reference to the cell:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:1"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The function is a wrapper around XCellRange.getCellByPosition():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:1"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// first version of Calc.getCell()</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XCell</span> <span class="nf">getCell</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">sheet</span><span class="p">.</span><span class="na">getCellByPosition</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access cell at: &quot;</span> <span class="o">+</span>
                               <span class="n">column</span> <span class="o">+</span> <span class="s">&quot; - &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getCell()</span>
</code></pre></div>
</div>
</div>
</div>
<p>A second version of getCell() refers to a cell by name:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:1"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;AA2&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="27:1"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// 2nd version of Calc.getCell()</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XCell</span> <span class="nf">getCell</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">String</span> <span class="n">cellName</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="na">getCellRangeByName</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">getCell</span><span class="p">(</span><span class="n">cellRange</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>   <span class="c1">// calls 1st getCell()</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The call to XCellRange.getCellRangeByName() with a single cell name returns a cell
range made up of one cell. This XCellRange reference can be passed to Calc.getCell()
since XCellRange is a superclass of XSpreadsheet. The first version of getCell() is
called, and XCellRange.getCellByPosition() treats (0, 0) as a position relative to the
cell range. There's only one cell in this range, so getCellByPosition() returns a
reference to the "AA2" cell.</p>
<h4 id="cell-range-manipulation">Cell Range Manipulation<a class="headerlink" href="#cell-range-manipulation" title="Permanent link">&para;</a></h4>
<p>The second half of convertAddresses() shows off some of the cell range addressing
methods. Calc.getCellRangePositions() returns an array of two Java Point objects
corresponding to the top-left and bottom-right cells of the range:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="28:1"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in convertAddresses() in BuildTable.java</span>
    <span class="p">:</span>
<span class="n">java</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">Point</span><span class="o">[]</span> <span class="n">range</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRangePositions</span><span class="p">(</span><span class="s">&quot;A1:D5&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Range of A1:D5: (&quot;</span> <span class="o">+</span>
                       <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>  <span class="n">range</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span>
            <span class="s">&quot;) -- (&quot;</span> <span class="o">+</span> <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span>  <span class="n">range</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span>  <span class="s">&quot;)&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>Only simple cell range names of the form <cell name> ':' <cell name> are understood
by my functions. Range operators, such as "~", "!", and absolute references using "$"
aren't supported.</p>
<p>Calc.getCellRange() converts a range address into an XCellRange reference:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="29:1"><input checked="checked" id="__tabbed_29_1" name="__tabbed_29" type="radio" /><div class="tabbed-labels"><label for="__tabbed_29_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">.</span><span class="na">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1:D5&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>This method wraps a call to XCellRange.getCellRangeByName():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="30:1"><input checked="checked" id="__tabbed_30_1" name="__tabbed_30" type="radio" /><div class="tabbed-labels"><label for="__tabbed_30_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XCellRange</span> <span class="nf">getCellRange</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                                              <span class="n">String</span> <span class="n">rangeName</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="na">getCellRangeByName</span><span class="p">(</span><span class="n">rangeName</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cellRange</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access: \&quot;&quot;</span> <span class="o">+</span> <span class="n">rangeName</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">cellRange</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="22-changing-cell-values">2.2.  Changing Cell Values<a class="headerlink" href="#22-changing-cell-values" title="Permanent link">&para;</a></h3>
<p>Back in BuildTable.java, the buildCells() methods shows how individual cells can be
assigned values. The code uses two versions of Calc.setVal(), one that accepts a cell
position, the other a cell name. For example:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="31:1"><input checked="checked" id="__tabbed_31_1" name="__tabbed_31" type="radio" /><div class="tabbed-labels"><label for="__tabbed_31_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in buildCells() in BuildTable.java</span>
   <span class="p">:</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">,</span> <span class="mf">31.45</span><span class="p">);</span>    <span class="c1">// name</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;JAN&quot;</span><span class="p">);</span>    <span class="c1">// (column, row)</span>
</code></pre></div>
</div>
</div>
</div>
<p>Both methods store a number or a string in a cell, by processing the input value as an
Object:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="32:1"><input checked="checked" id="__tabbed_32_1" name="__tabbed_32" type="radio" /><div class="tabbed-labels"><label for="__tabbed_32_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setVal</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                               <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span> <span class="n">Object</span> <span class="n">value</span><span class="p">)</span>
<span class="c1">// save value using cell name</span>
<span class="p">{</span> <span class="n">Point</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">getCellPosition</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
  <span class="n">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>  <span class="c1">// column, row</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setVal</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                           <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">Object</span> <span class="n">value</span><span class="p">)</span>
<span class="c1">// save value using cell position</span>
<span class="p">{</span> <span class="n">XCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
  <span class="n">setVal</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setVal</span><span class="p">(</span><span class="n">XCell</span> <span class="n">cell</span><span class="p">,</span> <span class="n">Object</span> <span class="n">value</span><span class="p">)</span>
<span class="c1">// decide how to save value based on its type</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Number</span><span class="p">)</span>
    <span class="n">cell</span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span> <span class="n">convertToDouble</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="p">)</span>
    <span class="n">cell</span><span class="p">.</span><span class="na">setFormula</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Value is not a number/string: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setVal()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The third setVal() function examines the type of the value to decide whether to call
XCell.setValue() or XCell.setFormula().</p>
<h3 id="23-storing-2d-arrays-of-data">2.3.  Storing 2D Arrays of Data<a class="headerlink" href="#23-storing-2d-arrays-of-data" title="Permanent link">&para;</a></h3>
<p>The buildArray() method in BuildTables.java shows how a block of data can be stored
by Calc.setArray():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="33:1"><input checked="checked" id="__tabbed_33_1" name="__tabbed_33" type="radio" /><div class="tabbed-labels"><label for="__tabbed_33_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildTable.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">buildArray</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Object</span><span class="o">[][]</span> <span class="n">vals</span> <span class="o">=</span> <span class="p">{</span>
               <span class="p">{</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;JAN&quot;</span><span class="p">,</span> <span class="s">&quot;FEB&quot;</span><span class="p">,</span> <span class="s">&quot;MAR&quot;</span><span class="p">,</span> <span class="s">&quot;APR&quot;</span><span class="p">,</span> <span class="s">&quot;MAY&quot;</span><span class="p">,</span> <span class="s">&quot;JUN&quot;</span><span class="p">,</span>
                     <span class="s">&quot;JUL&quot;</span><span class="p">,</span> <span class="s">&quot;AUG&quot;</span><span class="p">,</span> <span class="s">&quot;SEP&quot;</span><span class="p">,</span> <span class="s">&quot;OCT&quot;</span><span class="p">,</span> <span class="s">&quot;NOV&quot;</span><span class="p">,</span> <span class="s">&quot;DEC&quot;</span><span class="p">},</span>
               <span class="p">{</span><span class="s">&quot;Smith&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mf">58.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">66.5</span><span class="p">,</span> <span class="mf">43.4</span><span class="p">,</span> <span class="mf">44.5</span><span class="p">,</span> <span class="mf">45.3</span><span class="p">,</span>
                        <span class="o">-</span><span class="mf">67.3</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">,</span> <span class="mf">23.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">97.3</span><span class="p">,</span> <span class="mf">22.4</span><span class="p">,</span> <span class="mf">23.5</span><span class="p">},</span>
               <span class="p">{</span><span class="s">&quot;Jones&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mf">40.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">57.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.4</span><span class="p">,</span> <span class="mf">34.5</span><span class="p">,</span> <span class="mf">59.3</span><span class="p">,</span>
                         <span class="mf">27.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">38.5</span><span class="p">,</span> <span class="mf">43.2</span><span class="p">,</span> <span class="mf">57.3</span><span class="p">,</span> <span class="mf">25.4</span><span class="p">,</span> <span class="mf">28.5</span><span class="p">},</span>
               <span class="p">{</span><span class="s">&quot;Brown&quot;</span><span class="p">,</span> <span class="mf">31.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">117.5</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">114.5</span><span class="p">,</span> <span class="mf">115.3</span><span class="p">,</span>
                         <span class="o">-</span><span class="mf">171.3</span><span class="p">,</span> <span class="mf">89.5</span><span class="p">,</span> <span class="mf">41.2</span><span class="p">,</span> <span class="mf">71.3</span><span class="p">,</span> <span class="mf">25.4</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">}</span>
            <span class="p">};</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1:M4&quot;</span><span class="p">,</span> <span class="n">vals</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;N1&quot;</span><span class="p">,</span> <span class="s">&quot;SUM&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;N2&quot;</span><span class="p">,</span> <span class="s">&quot;=SUM(B2:M2)&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;N3&quot;</span><span class="p">,</span> <span class="s">&quot;=SUM(B3:M3)&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;N4&quot;</span><span class="p">,</span> <span class="s">&quot;=SUM(A4:L4)&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of buildArray()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Calc.setArray() accepts a 2D array of Object values (which means it can contain a
mix of strings and doubles) with the data arranged in row-order. For example, the data
shown above is stored in the sheet as in Figure 2.</p>
<p><img alt="" src="images/20-Spreadsheet_Manipulation-2.png" /></p>
<p>Figure 2. A Block of Data Added to a Sheet.</p>
<p>The second argument of Calc.setArray() can be a cell range or a single cell name
representing the top-left corner of the range. In the latter case, the cell range is
calculated from the size of the array. This means that the call used above could be
rewritten as:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="34:1"><input checked="checked" id="__tabbed_34_1" name="__tabbed_34" type="radio" /><div class="tabbed-labels"><label for="__tabbed_34_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1&quot;</span><span class="p">,</span> <span class="n">vals</span><span class="p">);</span>  <span class="c1">// string was &quot;A1:M4&quot;</span>
<span class="n">Calc</span><span class="p">.</span><span class="na">setArray</span><span class="p">()</span> <span class="n">is</span> <span class="n">defined</span> <span class="n">as</span><span class="p">:</span>

<span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setArray</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                         <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// decide how sheet area is referred to by name</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">isCellRangeName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">setArrayRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
  <span class="k">else</span>   <span class="c1">// is a cell name</span>
    <span class="n">setArrayCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setArray()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setArrayRange</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                        <span class="n">String</span> <span class="n">rangeName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store array using cell range name</span>
<span class="p">{</span> <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">rangeName</span><span class="p">);</span>
  <span class="n">setCellRangeArray</span><span class="p">(</span><span class="n">cellRange</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setArrayRange()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setArrayCell</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                           <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store array using cell name</span>
<span class="p">{</span>
  <span class="c1">// calculate cell range name using array size</span>
  <span class="n">Point</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">getCellPosition</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">colEnd</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span> <span class="o">+</span> <span class="n">values</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">rowEnd</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span>
            <span class="n">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">,</span> <span class="n">colEnd</span><span class="p">,</span> <span class="n">rowEnd</span><span class="p">);</span>
  <span class="n">setCellRangeArray</span><span class="p">(</span><span class="n">cellRange</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setArrayCell()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setCellRangeArray</span><span class="p">(</span><span class="n">XCellRange</span> <span class="n">cellRange</span><span class="p">,</span>
                                     <span class="n">Object</span><span class="o">[][]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store the array as data in the cell range</span>
<span class="p">{</span> <span class="n">XCellRangeData</span> <span class="n">crData</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XCellRangeData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cellRange</span><span class="p">);</span>
  <span class="n">crData</span><span class="p">.</span><span class="na">setDataArray</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of setCellRangeArray()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The storage of the array is performed by Calc.setCellRangeArray() which is passed an
XCellRange object and a 2D array. XCellRange is converted into XCellRangeData
which has a setDataArray() method.</p>
<h3 id="24-storing-rows-of-data">2.4.  Storing Rows of Data<a class="headerlink" href="#24-storing-rows-of-data" title="Permanent link">&para;</a></h3>
<p>Calc.setRow() lets the programmer store a 1D array as a row of data:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="35:1"><input checked="checked" id="__tabbed_35_1" name="__tabbed_35" type="radio" /><div class="tabbed-labels"><label for="__tabbed_35_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">Calc</span><span class="p">.</span><span class="na">setRow</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">,</span>
           <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="mi">42</span><span class="p">,</span> <span class="mf">58.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">66.5</span><span class="p">,</span> <span class="mf">43.4</span><span class="p">,</span> <span class="mf">44.5</span><span class="p">,</span> <span class="mf">45.3</span><span class="p">,</span>
                         <span class="o">-</span><span class="mf">67.3</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">,</span> <span class="mf">23.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">97.3</span><span class="p">,</span> <span class="mf">22.4</span><span class="p">,</span> <span class="mf">23.5</span><span class="p">});</span>
</code></pre></div>
</div>
</div>
</div>
<p>Calc.setRow() employs XCellRangeData.setDataArray(), which requires an
XCellRange object and a 2D array:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="36:1"><input checked="checked" id="__tabbed_36_1" name="__tabbed_36" type="radio" /><div class="tabbed-labels"><label for="__tabbed_36_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setRow</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                           <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store values in row using cell name</span>
<span class="p">{</span> <span class="n">Point</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">getCellPosition</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
  <span class="n">setRow</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>    <span class="c1">// column, row</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setRow</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                       <span class="kt">int</span> <span class="n">colStart</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rowStart</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store values in row starting at (colstart, rowstart)</span>
<span class="p">{</span>
  <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">colStart</span><span class="p">,</span> <span class="n">rowStart</span><span class="p">,</span>
                            <span class="n">colStart</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowStart</span><span class="p">);</span>
      <span class="c1">// calculate cell range based on array size</span>
  <span class="n">XCellRangeData</span> <span class="n">crData</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XCellRangeData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cellRange</span><span class="p">);</span>
  <span class="n">crData</span><span class="p">.</span><span class="na">setDataArray</span><span class="p">(</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[][]</span><span class="p">{</span><span class="n">values</span><span class="p">});</span>
       <span class="c1">// store the row as a 2D array containing one row of data</span>
<span class="p">}</span>  <span class="c1">// end of setRow()</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="25-storing-columns-of-data">2.5.  Storing Columns of Data<a class="headerlink" href="#25-storing-columns-of-data" title="Permanent link">&para;</a></h3>
<p>Calc.setCol() lets the programmer store a column of data, as shown in
BuildTable.java in its buildCols() method:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="37:1"><input checked="checked" id="__tabbed_37_1" name="__tabbed_37" type="radio" /><div class="tabbed-labels"><label for="__tabbed_37_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in BuildTable.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">buildCols</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setCol</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A2&quot;</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="s">&quot;JAN&quot;</span><span class="p">,</span> <span class="s">&quot;FEB&quot;</span><span class="p">,</span> <span class="s">&quot;MAR&quot;</span><span class="p">,</span> <span class="s">&quot;APR&quot;</span><span class="p">,</span> <span class="s">&quot;MAY&quot;</span><span class="p">,</span> <span class="s">&quot;JUN&quot;</span><span class="p">,</span>
                      <span class="s">&quot;JUL&quot;</span><span class="p">,</span> <span class="s">&quot;AUG&quot;</span><span class="p">,</span> <span class="s">&quot;SEP&quot;</span><span class="p">,</span> <span class="s">&quot;OCT&quot;</span><span class="p">,</span> <span class="s">&quot;NOV&quot;</span><span class="p">,</span> <span class="s">&quot;DEC&quot;</span><span class="p">});</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A14&quot;</span><span class="p">,</span> <span class="s">&quot;SUM&quot;</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B1&quot;</span><span class="p">,</span> <span class="s">&quot;Smith&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setCol</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B2&quot;</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="mi">42</span><span class="p">,</span> <span class="mf">58.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">66.5</span><span class="p">,</span> <span class="mf">43.4</span><span class="p">,</span> <span class="mf">44.5</span><span class="p">,</span> <span class="mf">45.3</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">67.3</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">,</span> <span class="mf">23.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">97.3</span><span class="p">,</span> <span class="mf">22.4</span><span class="p">,</span> <span class="mf">23.5</span><span class="p">});</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;B14&quot;</span><span class="p">,</span> <span class="s">&quot;=SUM(B2:M2)&quot;</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Jones&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setCol</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="mi">21</span><span class="p">,</span> <span class="mf">40.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">57.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.4</span><span class="p">,</span> <span class="mf">34.5</span><span class="p">,</span> <span class="mf">59.3</span><span class="p">,</span>
                      <span class="mf">27.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">38.5</span><span class="p">,</span> <span class="mf">43.2</span><span class="p">,</span> <span class="mf">57.3</span><span class="p">,</span> <span class="mf">25.4</span><span class="p">,</span> <span class="mf">28.5</span><span class="p">});</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&quot;=SUM(B3:M3)&quot;</span><span class="p">);</span>

  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Brown&quot;</span><span class="p">);</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setCol</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span><span class="mf">31.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">117.5</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">114.5</span><span class="p">,</span> <span class="mf">115.3</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">171.3</span><span class="p">,</span> <span class="mf">89.5</span><span class="p">,</span> <span class="mf">41.2</span><span class="p">,</span> <span class="mf">71.3</span><span class="p">,</span> <span class="mf">25.4</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">});</span>
  <span class="n">Calc</span><span class="p">.</span><span class="na">setVal</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&quot;=SUM(A4:L4)&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of buildCols()</span>
</code></pre></div>
</div>
</div>
</div>
<p>buildCols() creates the spreadsheet shown in Figure 3.</p>
<p><img alt="" src="images/20-Spreadsheet_Manipulation-3.png" /></p>
<p>Figure 3. Columns of Data in a Sheet.</p>
<p>Column creation is a little harder than row building since it's not possible to use
XCellRangeData.setDataArray() which assumes that data is row-ordered. Instead
Calc.setCol() calls Calc.setVal() in a loop:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="38:1"><input checked="checked" id="__tabbed_38_1" name="__tabbed_38" type="radio" /><div class="tabbed-labels"><label for="__tabbed_38_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Calc class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setCol</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                       <span class="n">String</span> <span class="n">cellName</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store values in column using cell name</span>
<span class="p">{</span> <span class="n">Point</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">getCellPosition</span><span class="p">(</span><span class="n">cellName</span><span class="p">);</span>
  <span class="n">setCol</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="na">y</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>    <span class="c1">// column, row</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setCol</span><span class="p">(</span><span class="n">XSpreadsheet</span> <span class="n">sheet</span><span class="p">,</span>
                    <span class="kt">int</span> <span class="n">colStart</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rowStart</span><span class="p">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">values</span><span class="p">)</span>
<span class="c1">// store values down a column starting at (colstart, rowstart)</span>
<span class="p">{</span>
 <span class="n">XCellRange</span> <span class="n">cellRange</span> <span class="o">=</span> <span class="n">getCellRange</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">colStart</span><span class="p">,</span> <span class="n">rowStart</span><span class="p">,</span>
                            <span class="n">colStart</span><span class="p">,</span> <span class="n">rowStart</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="c1">// calculate cell range from data size</span>
  <span class="n">XCell</span> <span class="n">xCell</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">xCell</span> <span class="o">=</span> <span class="n">getCell</span><span class="p">(</span><span class="n">cellRange</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>     <span class="c1">// column -- row</span>
    <span class="n">setVal</span><span class="p">(</span><span class="n">xCell</span><span class="p">,</span> <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of setCol()</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="26-adding-a-picture">2.6.  Adding a Picture<a class="headerlink" href="#26-adding-a-picture" title="Permanent link">&para;</a></h3>
<p>Adding an image to a spreadsheet is straightforward since every sheet is also a draw
page. The Spreadsheet service has an XDrawPageSupplier interface, which has a
getDrawPage() method. The returned XDrawPage reference points to a transparent
drawing surface that lies over the top of the sheet.</p>
<p>Adding a picture is done by calling Draw.drawImage():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="39:1"><input checked="checked" id="__tabbed_39_1" name="__tabbed_39" type="radio" /><div class="tabbed-labels"><label for="__tabbed_39_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in addPic() in BuildTables.java</span>
<span class="n">XDrawPageSupplier</span> <span class="n">dpSupp</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDrawPageSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">sheet</span><span class="p">);</span>
<span class="n">XDrawPage</span> <span class="n">page</span> <span class="o">=</span> <span class="n">dpSupp</span><span class="p">.</span><span class="na">getDrawPage</span><span class="p">();</span>
<span class="n">Draw</span><span class="p">.</span><span class="na">drawImage</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="s">&quot;skinner.png&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
    <span class="p">:</span>
</code></pre></div>
</div>
</div>
</div>
<p>The (50, 40) passed to Draw.drawImage() is the (x, y) offset from the top-left corner
of the sheet, specified in millimeters. This method comes from my Draw.java support
class, explained in Part 3.</p>
<h4 id="warning-when-drawing">Warning when Drawing<a class="headerlink" href="#warning-when-drawing" title="Permanent link">&para;</a></h4>
<p>Many of the Draw.java methods take a document argument, such as
Draw.getSlidesCount() which returns the number of draw pages in the document:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="40:1"><input checked="checked" id="__tabbed_40_1" name="__tabbed_40" type="radio" /><div class="tabbed-labels"><label for="__tabbed_40_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No of draw pages: &quot;</span> <span class="o">+</span>
                             <span class="n">Draw</span><span class="p">.</span><span class="na">getSlidesCount</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
</code></pre></div>
</div>
</div>
</div>
<p>These methods assume that the document argument can be cast to XComponent. For
instance, the function prototype for getSlidesCount() is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="41:1"><input checked="checked" id="__tabbed_41_1" name="__tabbed_41" type="radio" /><div class="tabbed-labels"><label for="__tabbed_41_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">getSlidesCount</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>Unfortunately, this casting will not work with spreadsheet documents because
XSpreadsheetDocument doesn't inherit XComponent. Instead the
XSpreadsheetDocument interface must be explicitly converted to XComponent first,
as in:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="42:1"><input checked="checked" id="__tabbed_42_1" name="__tabbed_42" type="radio" /><div class="tabbed-labels"><label for="__tabbed_42_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in addPic() in BuildTables.java</span>
<span class="n">XComponent</span> <span class="n">compDoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No of draw pages: &quot;</span> <span class="o">+</span>
                             <span class="n">Draw</span><span class="p">.</span><span class="na">getSlidesCount</span><span class="p">(</span><span class="n">compDoc</span><span class="p">));</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="27-adding-a-chart">2.7.  Adding a Chart<a class="headerlink" href="#27-adding-a-chart" title="Permanent link">&para;</a></h3>
<p>I'll be discussing charting at length in Part 5, but I'll give a taster of it here since a
CellRangeAddress object is used to pass data to the charting methods. For example,
the cell range for "A1:N4" is passed to Chart2.insertChart():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="43:1"><input checked="checked" id="__tabbed_43_1" name="__tabbed_43" type="radio" /><div class="tabbed-labels"><label for="__tabbed_43_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// commented out code in BuildTables.java</span>
<span class="n">CellRangeAddress</span> <span class="n">rangeAddr</span> <span class="o">=</span>  <span class="n">Calc</span><span class="p">.</span><span class="na">getAddress</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="s">&quot;A1:N4&quot;</span><span class="p">);</span>
<span class="n">Chart2</span><span class="p">.</span><span class="na">insertChart</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">rangeAddr</span><span class="p">,</span> <span class="s">&quot;D6&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s">&quot;Column&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The other arguments used by Chart2.insertChart() are a cell name, the millimeter
width and height of the generated chart, and a chart type string. The named cell acts as
an anchor point for the top-left corner of the chart. Figure 4 shows what the resulting
chart looks like.</p>
<p><img alt="" src="images/20-Spreadsheet_Manipulation-4.png" /></p>
<p>Figure 4. A Column Chart in a Spreadsheet.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="19-Calc_API_Overview.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 19. Calc API Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 19. Calc API Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="21-Extracting_Data.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 21. Extracting Data" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 21. Extracting Data
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>