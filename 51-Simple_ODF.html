
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.0.6">
    
    
      
        <title>Chapter 51. Simple ODF - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-51-simple-odf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 51. Simple ODF
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 51. Simple ODF
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="51-Simple_ODF.html" class="md-nav__link md-nav__link--active">
        Chapter 51. Simple ODF
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-opendocument-format" class="md-nav__link">
    1.  The OpenDocument Format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-document-information" class="md-nav__link">
    2.  Document Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-unzipping-an-odf-document" class="md-nav__link">
    3.  Unzipping an ODF Document
  </a>
  
    <nav class="md-nav" aria-label="3.  Unzipping an ODF Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-listing-the-contents-of-a-zipped-folder" class="md-nav__link">
    3.1.  Listing the Contents of a Zipped Folder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-extracting-a-mime-type" class="md-nav__link">
    3.2.  Extracting a MIME-type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-extracting-a-zipped-file" class="md-nav__link">
    3.3.  Extracting a Zipped File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-higher-level-manipulation-of-odf" class="md-nav__link">
    4.  Higher-level Manipulation of ODF
  </a>
  
    <nav class="md-nav" aria-label="4.  Higher-level Manipulation of ODF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-building-simple-documents" class="md-nav__link">
    4.1.  Building Simple Documents
  </a>
  
    <nav class="md-nav" aria-label="4.1.  Building Simple Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-a-spreadsheet" class="md-nav__link">
    Make a Spreadsheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-slide-deck" class="md-nav__link">
    Make a Slide Deck
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-moving-a-slide" class="md-nav__link">
    4.2.  Moving a Slide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-combining-two-documents" class="md-nav__link">
    4.3.  Combining Two Documents
  </a>
  
    <nav class="md-nav" aria-label="4.3.  Combining Two Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#combining-text-documents" class="md-nav__link">
    Combining Text Documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-spreadsheets" class="md-nav__link">
    Combining Spreadsheets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-slide-decks" class="md-nav__link">
    Combining Slide Decks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-opendocument-format" class="md-nav__link">
    1.  The OpenDocument Format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-document-information" class="md-nav__link">
    2.  Document Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-unzipping-an-odf-document" class="md-nav__link">
    3.  Unzipping an ODF Document
  </a>
  
    <nav class="md-nav" aria-label="3.  Unzipping an ODF Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-listing-the-contents-of-a-zipped-folder" class="md-nav__link">
    3.1.  Listing the Contents of a Zipped Folder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-extracting-a-mime-type" class="md-nav__link">
    3.2.  Extracting a MIME-type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-extracting-a-zipped-file" class="md-nav__link">
    3.3.  Extracting a Zipped File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-higher-level-manipulation-of-odf" class="md-nav__link">
    4.  Higher-level Manipulation of ODF
  </a>
  
    <nav class="md-nav" aria-label="4.  Higher-level Manipulation of ODF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-building-simple-documents" class="md-nav__link">
    4.1.  Building Simple Documents
  </a>
  
    <nav class="md-nav" aria-label="4.1.  Building Simple Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-a-spreadsheet" class="md-nav__link">
    Make a Spreadsheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-slide-deck" class="md-nav__link">
    Make a Slide Deck
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-moving-a-slide" class="md-nav__link">
    4.2.  Moving a Slide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-combining-two-documents" class="md-nav__link">
    4.3.  Combining Two Documents
  </a>
  
    <nav class="md-nav" aria-label="4.3.  Combining Two Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#combining-text-documents" class="md-nav__link">
    Combining Text Documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-spreadsheets" class="md-nav__link">
    Combining Spreadsheets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-slide-decks" class="md-nav__link">
    Combining Slide Decks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/master/docs/51-Simple_ODF.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-51-simple-odf">Chapter 51. Simple ODF</h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>The OpenDocument Format;
Doc Information;
Unzipping an ODF Doc;
the Simple Java API for
ODF (Apache ODF
Toolkit): making docs
(text, sheet, and slides),
slide movement, doc
concatenation (text,
sheet, and slides)</p>
<p>Example folders:
"ODFToolkit Tests" and
"Utils"</p>
</div>
<p>An OpenDocument Format (ODF) document is a zipped
folder containing an assortment of XML files, images, and
other resources. This makes it possible to manipulate using
zip/unzip and XML features, but that isn't a good idea due
to the complexity of the formats. This chapter looks at a
few of these lower-level techniques, but is mainly about the
Simple API for ODF, a sub-project of the Apache ODF
Toolkit (http://incubator.apache.org/odftoolkit/simple/). It's
a small Java API for creating, modifying and extracting
data from ODF documents, built on top of the ODFDOM
library (http://incubator.apache.org/odftoolkit/odfdom/). Rather surprisingly, its
support for the concatenation of documents is better than that in the Office API.</p>
<h2 id="1-the-opendocument-format">1.  The OpenDocument Format</h2>
<p>The contents of an ODF document (i.e. the zipped folder) depend on its type (e.g.</p>
<p>does it contain a spreadsheet, presentation, or text?), but several files always appear
inside the folder:</p>
<ul>
<li>content.xml: the document's textual contents, but not binary data such as
images;</li>
<li>meta.xml: the document's meta information, such as the author's name and the
last modification date. The data is most easily viewed through Office's File &gt;
Properties menu item;</li>
<li>styles.xml: the styles used for the document's pages, paragraphs, text formats,
and others, which are usually set via the Styles and Formatting dialogs in
Office;</li>
<li>settings.xml: information specific to the application and document's display,
such as the window's size/position, printer settings, and whether headers and
footers are visible;</li>
<li>manifest.xml: this lists the content of the zipped folder, and is stored in the
META-INF/ subdirectory;</li>
<li>mimetype: a one-line file listing the document's MIME-type.</li>
</ul>
<p>The easiest way of viewing these files and folders is to unzip the ODF file using a
utility such as 7-Zip, as in Figure 1.</p>
<p><img alt="" src="images/51-Simple_ODF-1.png" /></p>
<p>Figure 1. An Unzipped View of algs.odp.</p>
<p>Figure 1's Configurations2/ folder stores localization information for the Office GUI;
Pictures/ stores the images used in the document; Thumbnails/ holds a small 128x128
picture of the document in thumbnail.png.</p>
<p>The wikipedia page about ODF is quite informative
(https://en.wikipedia.org/wiki/OpenDocument), as is its entry for the OpenDocument
technical specification
(https://en.wikipedia.org/wiki/OpenDocument_technical_specification). There's a
quick summary of the OpenDocument Format (ODF) at
https://help.libreoffice.org/Common/XML_File_Formats.</p>
<p>The ODF standard was developed by the Organization for the Advancement of
Structured Information Standards (OASIS) consortium  (https://www.oasis-
open.org/), whose website hosts a lot of information. A related community site is
http://opendocument.xml.org/</p>
<p>The most complete textbook on ODF is:</p>
<p>OASIS OpenDocument Essentials
J. David Eisenberg, 2005
http:// books.evc-cit.info/
The associated website has a free draft of the book, and all the examples and support
code. The site often seems to be offline, but the book can be found at other locations.</p>
<p>A recent version can be purchased at Lulu: http://www.lulu.com/shop/j-david-
eisenberg/oasis-opendocument-essentials/paperback/product-392512.html</p>
<h2 id="2-document-information">2.  Document Information</h2>
<p>There's little need to directly manipulate a document's XML files since the Office API
offers high-level techniques for accessing most of their information.</p>
<p>For example, part of meta.xml for algs.odp is:</p>
<div class="highlight"><pre><span></span><code>&lt;office:meta&gt;
  &lt;dc:title&gt;PowerPoint Presentation&lt;/dc:title&gt;
  &lt;dc:date&gt;2017-01-06T16:53:58.639000000&lt;/dc:date&gt;
  &lt;meta:editing-cycles&gt;4&lt;/meta:editing-cycles&gt;
  &lt;meta:editing-duration&gt;PT1M52S&lt;/meta:editing-duration&gt;
  &lt;meta:generator&gt;LibreOffice/5.1.0.3$
      Windows_x86LibreOffice_project/
      5e3e00a007d9b3b6efb6797a8b8e57b51ab1f737&lt;/meta:generator&gt;
  &lt;meta:document-statistic meta:object-count=&quot;92&quot;/&gt;
  &lt;meta:user-defined meta:name=&quot;Secret&quot;&gt;Made in
                            Thailand&lt;/meta:user-defined&gt;
&lt;/office:meta&gt;
</code></pre></div>
<p>This data is displayed in the General tab of the  File, Properties window in Figure 2.</p>
<p><img alt="" src="images/51-Simple_ODF-2.png" /></p>
<p>Figure 2. File, Properties Window.</p>
<p>Rather than attempting to extract and parse meta.xml, this information is reachable
through the XDocumentProperties interface which I described back in Chapter 3,
section 2.</p>
<p>The following DocInfo.java example uses Info.printDocProperties() to print document
details:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in DocInfo.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocInfo</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run DocInfo &lt;fnm&gt;&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
    <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
    <span class="n">Info</span><span class="p">.</span><span class="na">printDocProperties</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of DocInfo class</span>
</code></pre></div>
<p>When DocInfo is passed algs.odp, some of the output is:</p>
<div class="highlight"><pre><span></span><code>Document Properties Info
  Author:
  Title: PowerPoint Presentation
  Subject:
  Description:
  Generator: LibreOffice/5.1.0.3$Windows_x86 LibreOffice_project/
                     5e3e00a007d9b3b6efb6797a8b8e57b51ab1f737
     :
  Modification Date: Jan 06, 2017 16:53
     :
  Secret == Made in Thailand
</code></pre></div>
<p>Info.printDocProperties() calls many XDocumentProperties.getXXX() methods to
obtain these details:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Info class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printDocProperties</span><span class="p">(</span><span class="n">Object</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XDocumentPropertiesSupplier</span> <span class="n">docPropsSupp</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDocumentPropertiesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="n">XDocumentProperties</span> <span class="n">dps</span> <span class="o">=</span> <span class="n">docPropsSupp</span><span class="p">.</span><span class="na">getDocumentProperties</span><span class="p">();</span>
  <span class="n">printDocProps</span><span class="p">(</span><span class="n">dps</span><span class="p">);</span>

  <span class="n">XPropertyContainer</span> <span class="n">udProps</span> <span class="o">=</span> <span class="n">dps</span><span class="p">.</span><span class="na">getUserDefinedProperties</span><span class="p">();</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;UserDefined Info&quot;</span><span class="p">,</span> <span class="n">udProps</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of printDocProperties()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printDocProps</span><span class="p">(</span><span class="n">XDocumentProperties</span> <span class="n">dps</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document Properties Info&quot;</span><span class="p">);</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Author: &quot;</span> <span class="o">+</span> <span class="n">dps</span><span class="p">.</span><span class="na">getAuthor</span><span class="p">());</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Title: &quot;</span> <span class="o">+</span> <span class="n">dps</span><span class="p">.</span><span class="na">getTitle</span><span class="p">());</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Subject: &quot;</span> <span class="o">+</span> <span class="n">dps</span><span class="p">.</span><span class="na">getSubject</span><span class="p">());</span>
     <span class="p">:</span>  <span class="c1">// many more prints</span>
<span class="p">}</span>  <span class="c1">// end of printDocProps()</span>
</code></pre></div>
<p>XDocumentProperties replaces the deprecated XDocumentInfo interface, which has
been removed from LibreOffice (although it's still in OpenOffice). The two classes
manipulate almost the same information, but the older XDocumentInfo can retrieve
the document's MIME-type, which is absent from XDocumentProperties. One way of
obtaining this would be to access the mimetype file zipped inside the document, as
shown next.</p>
<h2 id="3-unzipping-an-odf-document">3.  Unzipping an ODF Document</h2>
<p>My DocUnzip.java example shows how it's possible to list the zipped contents of a
document, access its MIME-type, and extract a zipped file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in DocUnzip.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocUnzip</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run DocUnzip &lt;fnm&gt; [&lt;ExtractFnm&gt;]&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>

    <span class="n">FileIO</span><span class="p">.</span><span class="na">zipList</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="c1">// FileIO.zipListUno(args[0]);   // only names listed</span>

    <span class="c1">// get zip access to the document</span>
    <span class="n">XZipFileAccess</span> <span class="n">zfa</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">zipAccess</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>

    <span class="n">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">(</span><span class="n">zfa</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;MIME type: &quot;</span> <span class="o">+</span> <span class="n">mimeType</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Other MIME type approach: &quot;</span> <span class="o">+</span>
                                <span class="n">Info</span><span class="p">.</span><span class="na">getMIMEType</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>

    <span class="c1">// convert MIME-type too other forms</span>
    <span class="kt">int</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">mimeDocType</span><span class="p">(</span><span class="n">mimeType</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Doc Type: &quot;</span> <span class="o">+</span> <span class="n">docType</span> <span class="o">+</span> <span class="s">&quot;; &quot;</span> <span class="o">+</span>
                                 <span class="n">Lo</span><span class="p">.</span><span class="na">docTypeStr</span><span class="p">(</span><span class="n">docType</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1">// extract the named file</span>
      <span class="n">FileIO</span><span class="p">.</span><span class="na">unzipFile</span><span class="p">(</span><span class="n">zfa</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>
<span class="p">}</span>  <span class="c1">// end of DocUnzip class</span>
</code></pre></div>
<p>The program can be called like so:</p>
<div class="highlight"><pre><span></span><code>run DocUnzip algs.odp content.xml
</code></pre></div>
<p>content.xml will be unzipped from algs.odp and saved as contentCopy.xml in the
local directory.</p>
<p>The rest of the output is:</p>
<div class="highlight"><pre><span></span><code>Listing of algs.odp:
Raw Size    Size     Date        Time         Name
--------  -------  -------      -------      --------
47        47       Jan 6, 2017  9:54:00 AM   mimetype
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/popupmenu/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/floater/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/images/Bitmaps/
0         2        Jan 6, 2017  9:54:00 AM
Configurations2/accelerator/current.xml
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/menubar/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/progressbar/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/toolbar/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/statusbar/
0         0        Jan 6, 2017  9:54:00 AM   Configurations2/toolpanel/
83608     6501     Jan 6, 2017  9:54:00 AM   styles.xml
4364      4364     Jan 6, 2017  9:54:00 AM
Pictures/100000000000004600000035E6F1CB2181A9ACF1.png
16977     16977    Jan 6, 2017  9:54:00 AM
Pictures/10000000000003080000002A0A348B9039C3652D.png
20480     20480    Jan 6, 2017  9:54:00 AM
Pictures/10000000000001F4000001F4E2E69E1D.jpg
45056     45056    Jan 6, 2017  9:54:00 AM
Pictures/10000000000000C8000000EEB0A3D2D2.jpg
8192      8192     Jan 6, 2017  9:54:00 AM
Pictures/10000000000000E1000000E1B343DD04.jpg
40960     40960    Jan 6, 2017  9:54:00 AM
Pictures/10000000000000E60000015E784CAA37.jpg
69632     69632    Jan 6, 2017  9:54:00 AM
Pictures/10000000000000DC000000FF9A43DBBF.jpg
28672     28672    Jan 6, 2017  9:54:00 AM
Pictures/100000000000011800000160792BAA16.jpg
12288     12288    Jan 6, 2017  9:54:00 AM
Pictures/10000000000000DC0000014B7CFE8C49.jpg
11901     11901    Jan 6, 2017  9:54:00 AM
Pictures/10000000000000BC0000010DD7ECB1F7.jpg
18238     18238    Jan 6, 2017  9:54:02 AM   Thumbnails/thumbnail.png
86313     8040     Jan 6, 2017  9:54:02 AM   content.xml
6037      913      Jan 6, 2017  9:54:02 AM   settings.xml
1141      491      Jan 6, 2017  9:54:02 AM   meta.xml
2248      452      Jan 6, 2017  9:54:02 AM   META-INF/manifest.xml


MIME type: application/vnd.oasis.opendocument.presentation
Other MIME type approach: application/vnd.oasis.opendocument.presentation
Doc Type: 5; simpress

Extracting content.xml
Saving to contentCopy.xml
</code></pre></div>
<p>Most of the output is a detailed listing of the zipped contents of algs.odp.</p>
<h3 id="31-listing-the-contents-of-a-zipped-folder">3.1.  Listing the Contents of a Zipped Folder</h3>
<p>There are two "zipList" functions in the FileIO utility class. FileIO.zipListUno() is
simpler since only file and folder names are printed:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the FileIO class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">zipListUno</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XZipFileAccess</span> <span class="n">zfa</span> <span class="o">=</span> <span class="n">zipAccess</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="n">XNameAccess</span> <span class="n">nmAccess</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XNameAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">zfa</span><span class="p">);</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">nmAccess</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nZipped Contents of &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">printNames</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of zipListUno()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XZipFileAccess</span> <span class="nf">zipAccess</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="c1">// get zip access to the document using Office API</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XZipFileAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                         <span class="s">&quot;com.sun.star.packages.zip.ZipFileAccess&quot;</span><span class="p">,</span>
                         <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span><span class="p">{</span> <span class="n">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">)</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>XZipFileAccess is created by instantiating the ZipFileAccess service with the
document's filename. The interface is cast to XNameAccess which allows the names
of the zipped files to be retrieved as an array of strings. Figure 3 shows the
relationships between the service and interfaces.</p>
<p><img alt="" src="images/51-Simple_ODF-3.png" /></p>
<p>Figure 3. The ZipFileAccess Service.</p>
<p>The ZipFileAccess service and interfaces are in the com.sun.star.packages.zip
module, which includes a ZipEntry class for holding information about each zipped
file (e.g. its compressed size). I was unable to find a way of creating ZipEntry objects,
but Java contains a complete zip API. By using Java rather than Office, I was able to
implement a more fancy "zipList":</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the FileIO class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">zipList</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="c1">// using the Java API</span>
<span class="p">{</span>
  <span class="n">DateFormat</span> <span class="n">df</span><span class="o">=</span> <span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateInstance</span><span class="p">();</span>   <span class="c1">// date format</span>
  <span class="n">DateFormat</span> <span class="n">tf</span><span class="o">=</span> <span class="n">DateFormat</span><span class="p">.</span><span class="na">getTimeInstance</span><span class="p">();</span>   <span class="c1">// time format</span>
  <span class="n">tf</span><span class="p">.</span><span class="na">setTimeZone</span><span class="p">(</span> <span class="n">TimeZone</span><span class="p">.</span><span class="na">getDefault</span><span class="p">()</span> <span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">ZipFile</span> <span class="n">zfile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Listing of &quot;</span> <span class="o">+</span> <span class="n">zfile</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Raw  Size  Size  Date   Time   Name&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;---  ----  ----  ----   ----   ----&quot;</span><span class="p">);</span>
    <span class="n">Enumeration</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">zip</span><span class="p">.</span><span class="na">ZipEntry</span><span class="o">&gt;</span> <span class="n">zfs</span> <span class="o">=</span>
                                            <span class="n">zfile</span><span class="p">.</span><span class="na">entries</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">zfs</span><span class="p">.</span><span class="na">hasMoreElements</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">zip</span><span class="p">.</span><span class="na">ZipEntry</span> <span class="n">entry</span> <span class="o">=</span>
              <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">zip</span><span class="p">.</span><span class="na">ZipEntry</span><span class="p">)</span> <span class="n">zfs</span><span class="p">.</span><span class="na">nextElement</span><span class="p">();</span>
      <span class="n">Date</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span> <span class="n">padSpaces</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getSize</span><span class="p">(),</span> <span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span> <span class="n">padSpaces</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getCompressedSize</span><span class="p">(),</span><span class="mi">7</span><span class="p">)</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">tf</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;  &quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">IOException</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of zipList()</span>
</code></pre></div>
<p>Another advantage of switching to Java are the large number of online examples of
zip manipulation; my zipList() function is closely based on one at
http://www.drdobbs.com/jvm/java-and-the-zip-file-format/184410339.</p>
<h3 id="32-extracting-a-mime-type">3.2.  Extracting a MIME-type</h3>
<p>FileIO.getMimeType() employs XZipFileAccess.getStreamByPattern() to access the
zipped mimetype file as an input stream.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the FileIO class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getMimeType</span><span class="p">(</span><span class="n">XZipFileAccess</span> <span class="n">zfa</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XInputStream</span> <span class="n">inStream</span> <span class="o">=</span> <span class="n">zfa</span><span class="p">.</span><span class="na">getStreamByPattern</span><span class="p">(</span><span class="s">&quot;mimetype&quot;</span><span class="p">);</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">readLines</span><span class="p">(</span><span class="n">inStream</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lines</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">lines</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">trim</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No mimetype found&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getMimeType()</span>

<span class="n">There</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">an</span> <span class="n">alternative</span> <span class="n">approach</span> <span class="n">which</span> <span class="n">looks</span> <span class="n">up</span> <span class="n">the</span> <span class="n">file</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">MIME</span><span class="o">-</span><span class="n">type</span>  <span class="n">using</span> <span class="n">the</span> <span class="n">Java</span>
<span class="n">API</span> <span class="kd">class</span> <span class="nc">MimetypesFileTypeMap</span><span class="p">:</span>

<span class="c1">// in the Info class</span>
<span class="c1">// global</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MIME_FNM</span> <span class="o">=</span> <span class="s">&quot;mime.types&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getMIMEType</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">MimetypesFileTypeMap</span> <span class="n">mftMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimetypesFileTypeMap</span><span class="p">(</span>
                         <span class="n">FileIO</span><span class="p">.</span><span class="na">getUtilsFolder</span><span class="p">()</span> <span class="o">+</span> <span class="n">MIME_FNM</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">mftMap</span><span class="p">.</span><span class="na">getContentType</span><span class="p">(</span><span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not find &quot;</span> <span class="o">+</span> <span class="n">MIME_FNM</span><span class="p">);</span>
     <span class="k">return</span> <span class="s">&quot;application/octet-stream&quot;</span><span class="p">;</span>   <span class="c1">// better than nothing</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of getMIMEType()</span>

<span class="n">The</span> <span class="nf">MimetypesFileTypeMap</span><span class="p">()</span> <span class="n">constructor</span> <span class="n">examines</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">MIME</span><span class="o">-</span><span class="n">types</span> <span class="n">loaded</span>
<span class="n">from</span> <span class="n">the</span> <span class="n">utility</span> <span class="n">classes</span> <span class="n">folder</span><span class="p">.</span>

<span class="n">Most</span> <span class="n">of</span> <span class="n">my</span> <span class="n">utility</span> <span class="n">functions</span> <span class="n">use</span> <span class="n">document</span> <span class="err">&#39;</span><span class="n">types</span><span class="err">&#39;</span> <span class="n">coded</span> <span class="n">as</span> <span class="n">integers</span> <span class="n">rather</span> <span class="n">than</span> <span class="n">as</span>
<span class="n">MIME</span><span class="o">-</span><span class="n">type</span> <span class="n">strings</span><span class="p">;</span> <span class="n">the</span> <span class="n">values</span> <span class="n">are</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">the</span> <span class="n">start</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Lo</span> <span class="n">utility</span> <span class="n">class</span><span class="p">:</span>

<span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">WRITER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">BASE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">CALC</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DRAW</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">IMPRESS</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MATH</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

<span class="n">Info</span><span class="p">.</span><span class="na">mimeDocType</span><span class="p">()</span> <span class="n">maps</span> <span class="n">ODF</span> <span class="n">MIME</span><span class="o">-</span><span class="n">type</span> <span class="n">strings</span> <span class="n">to</span> <span class="n">one</span> <span class="n">of</span> <span class="n">these</span> <span class="n">integers</span><span class="p">:</span>

<span class="c1">// in the Info class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">mimeDocType</span><span class="p">(</span><span class="n">String</span> <span class="n">mimeType</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">UNKNOWN</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.text&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.base&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">BASE</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.spreadsheet&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">CALC</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.graphics&quot;</span><span class="p">)</span> <span class="o">||</span>
           <span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.image&quot;</span><span class="p">)</span> <span class="o">||</span>
           <span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.chart&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">DRAW</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.presentation&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;vnd.oasis.opendocument.formula&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">MATH</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">UNKNOWN</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of mimeDocType()</span>
</code></pre></div>
<p>Some of my functions also utilize short document type strings, which are also defined
in the Lo class:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="c1">// docType strings</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UNKNOWN_STR</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">WRITER_STR</span> <span class="o">=</span> <span class="s">&quot;swriter&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">BASE_STR</span> <span class="o">=</span> <span class="s">&quot;sbase&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CALC_STR</span> <span class="o">=</span> <span class="s">&quot;scalc&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DRAW_STR</span> <span class="o">=</span> <span class="s">&quot;sdraw&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">IMPRESS_STR</span> <span class="o">=</span> <span class="s">&quot;simpress&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MATH_STR</span> <span class="o">=</span> <span class="s">&quot;smath&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Lo.docTypeStr() maps document type integers to these strings.</p>
<h3 id="33-extracting-a-zipped-file">3.3.  Extracting a Zipped File</h3>
<p>The XZipFileAccess.getStreamByPattern() method used in FileIO.getMimeType() is
also employed by FileIO.unzipFile() to extract a zipped file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FileIO class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">unzipFile</span><span class="p">(</span><span class="n">XZipFileAccess</span> <span class="n">zfa</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getExt</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Extracting &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">XInputStream</span> <span class="n">inStream</span> <span class="o">=</span> <span class="n">zfa</span><span class="p">.</span><span class="na">getStreamByPattern</span><span class="p">(</span><span class="s">&quot;*&quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>

    <span class="n">XSimpleFileAccess3</span> <span class="n">fileAcc</span> <span class="o">=</span>
          <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XSimpleFileAccess3</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                    <span class="s">&quot;com.sun.star.ucb.SimpleFileAccess&quot;</span><span class="p">);</span>

    <span class="n">String</span> <span class="n">copyFnm</span> <span class="o">=</span>  <span class="p">(</span><span class="n">ext</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">fileName</span> <span class="o">+</span> <span class="s">&quot;Copy&quot;</span><span class="p">)</span> <span class="p">:</span>
                                      <span class="p">(</span><span class="n">fileName</span> <span class="o">+</span> <span class="s">&quot;Copy.&quot;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving to &quot;</span> <span class="o">+</span> <span class="n">copyFnm</span><span class="p">);</span>
    <span class="n">fileAcc</span><span class="p">.</span><span class="na">writeFile</span><span class="p">(</span><span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">copyFnm</span><span class="p">),</span> <span class="n">inStream</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of unzipFile()</span>
</code></pre></div>
<p>The XZipFileAccess.getStreamByPattern() call includes the wildcard character "*" so
the filename will be found even if prefixed by a directory path, as in the case of an
ODF document's manifest.xml which is stored in "META-INF/manifest.xml".</p>
<p>I utilize Office's IO interface, XSimpleFileAccess3, which supports writeFile() to
directly connect an XInputStream  to a file. The filename of the extracted data is
constructed from the zipped filename with the addition of "Copy".</p>
<h2 id="4-higher-level-manipulation-of-odf">4.  Higher-level Manipulation of ODF</h2>
<p>Manipulating an ODF document as zipped files and XML is a recipe for highly
complex (and probably bug-ridden) code. And why bother when the Office API offers
all the necessary functionality in a higher-level framework?</p>
<p>"Maslow's hammer" maxim comes to mind; it states: "if all you have is a hammer,
then everything looks like a nail". In other words, it's useful to know about ODF APIs
other than Office's since they might offer better, easier ways of doing some tasks.</p>
<p>As a consequence, I'm going to spend the rest of the chapter looking at the Simple
Java API for ODF, a sub-project of Apache ODF Toolkit
(http://incubator.apache.org/odftoolkit/simple/). It's a relatively small Java API for
creating, modifying and extracting data from ODF documents, built on top of the
ODFDOM  library (http://incubator.apache.org/odftoolkit/odfdom/).</p>
<p>Its best features are the cookbook pages at
http://incubator.apache.org/odftoolkit/simple/document/cookbook/, the Getting
Started Guide (http://incubator.apache.org/odftoolkit/simple/gettingstartguide.html),
and its demo pages (http://incubator.apache.org/odftoolkit/simple/demo/).</p>
<p>The cookbook contains examples for manipulating text documents, presentations,
tables in text documents and spreadsheets, charts, style handling, text navigation, text
extraction, text fields, text forms, and document metadata. The API documentation is
at http://incubator.apache.org/odftoolkit/mvn-site/0.8-incubating/simple-odf/apidocs/,
and a mail archive at http://mail-archives.apache.org/mod_mbox/incubator-odf-users/</p>
<p>By far the worst feature of the API is the large number of libraries that must be
installed before even a lowly "Hello World" example will work. Fortunately, I've
included copies of those libraries at this chapter's website at
http://fivedots.coe.psu.ac.th/~ad/jlop/.</p>
<p>The Simple API doesn't have the depth of features of Office, so it's best suited for the
creation of simple text documents, spreadsheets, and presentations. However, it has
better support for combining documents (e.g. concatenating two slide decks into a
single one), and can move/copy slides in a presentation much more easily than Office;
look back at Chapter 17, sections 4 and 5 for my complaints about that.</p>
<h3 id="41-building-simple-documents">4.1.  Building Simple Documents</h3>
<p>This subsection looks at how the Simple API can be used to create text, spreadsheet,
and slide documents.</p>
<p>Make a Text Document
My MakeTextDoc.java example creates a text document containing an image, some
text, a list, and a table.; the result is shown in Figure 4.</p>
<p><img alt="" src="images/51-Simple_ODF-4.png" /></p>
<p>Figure 4. The Output of MakeTextDoc.java.</p>
<p>This isn't quite what the output looks like in the "Getting Started Guide", where the
program is called HelloWorld.java – in the guide the first paragraph is beneath the
image rather than to one side.</p>
<p>The MakeTextDoc.java code:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MakeTextDoc</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">TextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">TextDocument</span><span class="p">.</span><span class="na">newTextDocument</span><span class="p">();</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">newImage</span><span class="p">(</span><span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;odf-logo.png&quot;</span><span class="p">));</span>

      <span class="c1">// add paragraphs and list</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">addParagraph</span><span class="p">(</span><span class="s">&quot;Hello World, Hello Simple ODF!&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">addParagraph</span><span class="p">(</span><span class="s">&quot;The following is a list.&quot;</span><span class="p">);</span>
      <span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">addList</span><span class="p">();</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">items</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;item1&quot;</span><span class="p">,</span> <span class="s">&quot;item2&quot;</span><span class="p">,</span> <span class="s">&quot;item3&quot;</span><span class="p">};</span>
      <span class="n">list</span><span class="p">.</span><span class="na">addItems</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>

      <span class="c1">// add table</span>
      <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">addTable</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="n">Cell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="na">getCellByPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">cell</span><span class="p">.</span><span class="na">setStringValue</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Creating MakeTextDoc.odt&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;MakeTextDoc.odt&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span> <span class="c1">// end of MakeTextDoc class</span>
</code></pre></div>
<p>I was unable to find a way of changing the image's text wrap property to affect the
paragraph's position. It's probably do-able using the lower-level ODFDOM  library,
but the programming information for that part of ODF Toolkit is mostly limited to its
API documentation. However, there's a good introductory tutorial at
http://www.langintro.com/odfdom_tutorials/.</p>
<h4 id="make-a-spreadsheet">Make a Spreadsheet</h4>
<p>The MakeSheet.java example creates a spreadsheet with a single sheet, and a few
cells of data, as in Figure 5.</p>
<p><img alt="" src="images/51-Simple_ODF-5.png" /></p>
<p>Figure 5. The Output of MakeSheet.java.</p>
<p>The program:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MakeSheet</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">SpreadsheetDocument</span> <span class="n">doc</span> <span class="o">=</span>
             <span class="n">SpreadsheetDocument</span><span class="p">.</span><span class="na">newSpreadsheetDocument</span><span class="p">();</span>
      <span class="n">Table</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getSheetByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="n">sheet</span><span class="p">.</span><span class="na">getCellByPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="na">setStringValue</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">row</span><span class="o">++</span><span class="p">)</span>
        <span class="n">sheet</span><span class="p">.</span><span class="na">getCellByPosition</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">).</span><span class="na">setDoubleValue</span><span class="p">(</span><span class="n">row</span><span class="o">*</span><span class="mf">2.0</span><span class="p">);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving document to makeSheet.ods&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;makeSheet.ods&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of MakeSheet class</span>
</code></pre></div>
<h4 id="make-a-slide-deck">Make a Slide Deck</h4>
<p>The MakeSlides.java example creates a slide deck. The first slide contains a title, the
second some bulleted text and a picture, and the third slide is blank, as in Figure 6.</p>
<p><img alt="" src="images/51-Simple_ODF-6.png" /></p>
<p>Figure 6. The Output of MakeSlides.java.</p>
<p>The program:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MakeSlides</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">PresentationDocument</span> <span class="n">doc</span> <span class="o">=</span>
                <span class="n">PresentationDocument</span><span class="p">.</span><span class="na">newPresentationDocument</span><span class="p">();</span>

      <span class="c1">// a title slide</span>
      <span class="n">Slide</span> <span class="n">slide1</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">newSlide</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;slide1&quot;</span><span class="p">,</span>
                                   <span class="n">SlideLayout</span><span class="p">.</span><span class="na">TITLE_ONLY</span><span class="p">);</span>
      <span class="n">Textbox</span> <span class="n">titleBox</span> <span class="o">=</span> <span class="n">slide1</span><span class="p">.</span><span class="na">getTextboxByUsage</span><span class="p">(</span>
                             <span class="n">PresentationClass</span><span class="p">.</span><span class="na">TITLE</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="n">titleBox</span><span class="p">.</span><span class="na">setTextContent</span><span class="p">(</span><span class="s">&quot;Important Slide Presentation&quot;</span><span class="p">);</span>

      <span class="c1">// a slide with text bullets and a picture</span>
      <span class="n">Slide</span> <span class="n">slide2</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">newSlide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;slide2&quot;</span><span class="p">,</span>
                                 <span class="n">SlideLayout</span><span class="p">.</span><span class="na">TITLE_OUTLINE</span><span class="p">);</span>
      <span class="n">titleBox</span> <span class="o">=</span> <span class="n">slide2</span><span class="p">.</span><span class="na">getTextboxByUsage</span><span class="p">(</span>
                             <span class="n">PresentationClass</span><span class="p">.</span><span class="na">TITLE</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="n">titleBox</span><span class="p">.</span><span class="na">setTextContent</span><span class="p">(</span><span class="s">&quot;Overview&quot;</span><span class="p">);</span>

      <span class="n">Textbox</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">slide2</span><span class="p">.</span><span class="na">getTextboxByUsage</span><span class="p">(</span>
                             <span class="n">PresentationClass</span><span class="p">.</span><span class="na">OUTLINE</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="n">List</span> <span class="n">txtList</span> <span class="o">=</span> <span class="n">outline</span><span class="p">.</span><span class="na">addList</span><span class="p">();</span>   <span class="c1">// two bullets</span>
      <span class="n">txtList</span><span class="p">.</span><span class="na">addItem</span><span class="p">(</span><span class="s">&quot;Item 1&quot;</span><span class="p">);</span>
      <span class="n">txtList</span><span class="p">.</span><span class="na">addItem</span><span class="p">(</span><span class="s">&quot;Item 2&quot;</span><span class="p">);</span>

      <span class="n">Image</span> <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="na">newImage</span><span class="p">(</span><span class="n">slide2</span><span class="p">,</span> <span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;skinner.png&quot;</span><span class="p">));</span>
      <span class="n">FrameRectangle</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="na">getRectangle</span><span class="p">();</span>
      <span class="n">rect</span><span class="p">.</span><span class="na">setX</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>     <span class="c1">// position the image</span>
      <span class="n">rect</span><span class="p">.</span><span class="na">setY</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
      <span class="n">image</span><span class="p">.</span><span class="na">setRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving document to makeSlides.odp&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;makeSlides.odp&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of MakeSlides class</span>
</code></pre></div>
<p>Programming with this part of the API is a littlie tricky since slide elements are
represented by different types of boxes. I also found it hard to determine the position
of the image, except by trial-and-error.</p>
<h3 id="42-moving-a-slide">4.2.  Moving a Slide</h3>
<p>Back in Chapter 17, section 4, I had to use copy and paste dispatch commands in the
slide-sorter view to rearrange a deck. Moving a slide in the Simple API is much
easier, as shown in MoveSlide.java, which moves the first slide of the deck to its end:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MoveSlide</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">PresentationDocument</span> <span class="n">doc</span> <span class="o">=</span>
             <span class="n">PresentationDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;algs.odp&quot;</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">numSlides</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getSlideCount</span><span class="p">();</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Moving first slide to the end&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">moveSlide</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numSlides</span><span class="p">);</span>   <span class="c1">// why not numSlides-1?</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving document to algsMoved.odp&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;algsMoved.odp&quot;</span><span class="p">);</span>
      <span class="n">doc</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of MoveSlide class</span>
</code></pre></div>
<p>PresentationDocument.moveSlide() works without a hitch, although I'm confused
why I need to supply numSlides as the second numerical argument rather than
numSlides-1.</p>
<p>There's also a PresentationDocument.copySlide() method for copying.</p>
<h3 id="43-combining-two-documents">4.3.  Combining Two Documents</h3>
<p>This subsection presents three short programs that combine two text documents,
appends the sheets of two spreadsheets, and concatenates two slide decks. These
examples are much simpler to program than equivalent ones using the Office API.</p>
<h4 id="combining-text-documents">Combining Text Documents</h4>
<p>CombineTexts.java adds the contents of doc2.odt to the end of the contents of
doc1.odt, separating them with a page break. The result is saved to combined.odt:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CombineTexts</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">TextDocument</span> <span class="n">doc1</span> <span class="o">=</span> <span class="n">TextDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;doc1.odt&quot;</span><span class="p">);</span>
      <span class="n">TextDocument</span> <span class="n">doc2</span> <span class="o">=</span> <span class="n">TextDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;doc2.odt&quot;</span><span class="p">);</span>

      <span class="n">doc1</span><span class="p">.</span><span class="na">addPageBreak</span><span class="p">();</span>
      <span class="n">Paragraph</span> <span class="n">lastPara</span> <span class="o">=</span> <span class="n">doc1</span><span class="p">.</span><span class="na">getParagraphByReverseIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

      <span class="c1">// insert contents at end and copy styles</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">insertContentFromDocumentAfter</span><span class="p">(</span><span class="n">doc2</span><span class="p">,</span> <span class="n">lastPara</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving combination to combined.odt&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;combined.odt&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
      <span class="n">doc2</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of CombineTexts class</span>
</code></pre></div>
<p>The crucial method is TextDocument.insertContentFromDocumentAfter().</p>
<h4 id="combining-spreadsheets">Combining Spreadsheets</h4>
<p>CombineSheets.java places the sheets in ss2.odt after the sheets in ss1.odt, and saves
the result in combined.ods:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CombineSheets</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">SpreadsheetDocument</span> <span class="n">doc1</span> <span class="o">=</span>
              <span class="n">SpreadsheetDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;ss1.ods&quot;</span><span class="p">);</span>
      <span class="n">SpreadsheetDocument</span> <span class="n">doc2</span> <span class="o">=</span>
              <span class="n">SpreadsheetDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;ss2.ods&quot;</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">numSheets2</span> <span class="o">=</span> <span class="n">doc2</span><span class="p">.</span><span class="na">getSheetCount</span><span class="p">();</span>

      <span class="c1">// add sheets of second document to end of first doc</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numSheets2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="n">doc2</span><span class="p">.</span><span class="na">getSheetByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">doc1</span><span class="p">.</span><span class="na">appendSheet</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="na">getTableName</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving combination to combined.ods&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;combined.ods&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
      <span class="n">doc2</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of CombineSheets class</span>
</code></pre></div>
<p>Sadly there isn't a single method that appends tables. Instead  I've used a loop to
append each sheet from ss2.ods after the sheets in ss1.ods.</p>
<h4 id="combining-slide-decks">Combining Slide Decks</h4>
<p>CombineDecks.java adds the slides in deck2.odp after the slides in deck1.odp, saving
the result in combined.odp:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CombineDecks</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">PresentationDocument</span> <span class="n">doc1</span> <span class="o">=</span>
              <span class="n">PresentationDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;deck1.odp&quot;</span><span class="p">);</span>
      <span class="n">PresentationDocument</span> <span class="n">doc2</span> <span class="o">=</span>
              <span class="n">PresentationDocument</span><span class="p">.</span><span class="na">loadDocument</span><span class="p">(</span><span class="s">&quot;deck2.odp&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">appendPresentation</span><span class="p">(</span><span class="n">doc2</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving combination to combined.odp&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="s">&quot;combined.odp&quot;</span><span class="p">);</span>
      <span class="n">doc1</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
      <span class="n">doc2</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>  <span class="c1">// end of main()</span>

<span class="p">}</span>  <span class="c1">// end of CombineDecks class</span>
</code></pre></div>
<p>The PresentationDocument.appendPresentation() method does all the work, and
should be compared to my hacky Office solution in Chapter 17, section 5.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="50-Importing_XML.html" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 50. Importing XML
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>